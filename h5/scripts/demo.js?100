;(function () {
	'use strict';

	/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */

	/*jslint browser:true, node:true*/
	/*global define, Event, Node*/


	/**
	 * Instantiate fast-clicking listeners on the specified layer.
	 *
	 * @constructor
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	function FastClick(layer, options) {
		var oldOnClick;

		options = options || {};

		/**
		 * Whether a click is currently being tracked.
		 *
		 * @type boolean
		 */
		this.trackingClick = false;


		/**
		 * Timestamp for when click tracking started.
		 *
		 * @type number
		 */
		this.trackingClickStart = 0;


		/**
		 * The element being tracked for a click.
		 *
		 * @type EventTarget
		 */
		this.targetElement = null;


		/**
		 * X-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartX = 0;


		/**
		 * Y-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartY = 0;


		/**
		 * ID of the last touch, retrieved from Touch.identifier.
		 *
		 * @type number
		 */
		this.lastTouchIdentifier = 0;


		/**
		 * Touchmove boundary, beyond which a click will be cancelled.
		 *
		 * @type number
		 */
		this.touchBoundary = options.touchBoundary || 10;


		/**
		 * The FastClick layer.
		 *
		 * @type Element
		 */
		this.layer = layer;

		/**
		 * The minimum time between tap(touchstart and touchend) events
		 *
		 * @type number
		 */
		this.tapDelay = options.tapDelay || 200;

		/**
		 * The maximum time for a tap
		 *
		 * @type number
		 */
		this.tapTimeout = options.tapTimeout || 700;

		if (FastClick.notNeeded(layer)) {
			return;
		}

		// Some old versions of Android don't have Function.prototype.bind
		function bind(method, context) {
			return function() { return method.apply(context, arguments); };
		}


		var methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];
		var context = this;
		for (var i = 0, l = methods.length; i < l; i++) {
			context[methods[i]] = bind(context[methods[i]], context);
		}

		// Set up event handlers as required
		if (deviceIsAndroid) {
			layer.addEventListener('mouseover', this.onMouse, true);
			layer.addEventListener('mousedown', this.onMouse, true);
			layer.addEventListener('mouseup', this.onMouse, true);
		}

		layer.addEventListener('click', this.onClick, true);
		layer.addEventListener('touchstart', this.onTouchStart, false);
		layer.addEventListener('touchmove', this.onTouchMove, false);
		layer.addEventListener('touchend', this.onTouchEnd, false);
		layer.addEventListener('touchcancel', this.onTouchCancel, false);

		// Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
		// which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick
		// layer when they are cancelled.
		if (!Event.prototype.stopImmediatePropagation) {
			layer.removeEventListener = function(type, callback, capture) {
				var rmv = Node.prototype.removeEventListener;
				if (type === 'click') {
					rmv.call(layer, type, callback.hijacked || callback, capture);
				} else {
					rmv.call(layer, type, callback, capture);
				}
			};

			layer.addEventListener = function(type, callback, capture) {
				var adv = Node.prototype.addEventListener;
				if (type === 'click') {
					adv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {
						if (!event.propagationStopped) {
							callback(event);
						}
					}), capture);
				} else {
					adv.call(layer, type, callback, capture);
				}
			};
		}

		// If a handler is already declared in the element's onclick attribute, it will be fired before
		// FastClick's onClick handler. Fix this by pulling out the user-defined handler function and
		// adding it as listener.
		if (typeof layer.onclick === 'function') {

			// Android browser on at least 3.2 requires a new reference to the function in layer.onclick
			// - the old one won't work if passed to addEventListener directly.
			oldOnClick = layer.onclick;
			layer.addEventListener('click', function(event) {
				oldOnClick(event);
			}, false);
			layer.onclick = null;
		}
	}

	/**
	* Windows Phone 8.1 fakes user agent string to look like Android and iPhone.
	*
	* @type boolean
	*/
	var deviceIsWindowsPhone = navigator.userAgent.indexOf("Windows Phone") >= 0;

	/**
	 * Android requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0 && !deviceIsWindowsPhone;


	/**
	 * iOS requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !deviceIsWindowsPhone;


	/**
	 * iOS 4 requires an exception for select elements.
	 *
	 * @type boolean
	 */
	var deviceIsIOS4 = deviceIsIOS && (/OS 4_\d(_\d)?/).test(navigator.userAgent);


	/**
	 * iOS 6.0-7.* requires the target element to be manually derived
	 *
	 * @type boolean
	 */
	var deviceIsIOSWithBadTarget = deviceIsIOS && (/OS [6-7]_\d/).test(navigator.userAgent);

	/**
	 * BlackBerry requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;

	/**
	 * Determine whether a given element requires a native click.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element needs a native click
	 */
	FastClick.prototype.needsClick = function(target) {
		switch (target.nodeName.toLowerCase()) {

		// Don't send a synthetic click to disabled inputs (issue #62)
		case 'button':
		case 'select':
		case 'textarea':
			if (target.disabled) {
				return true;
			}

			break;
		case 'input':

			// File inputs need real clicks on iOS 6 due to a browser bug (issue #68)
			if ((deviceIsIOS && target.type === 'file') || target.disabled) {
				return true;
			}

			break;
		case 'label':
		case 'iframe': // iOS8 homescreen apps can prevent events bubbling into frames
		case 'video':
			return true;
		}

		return (/\bneedsclick\b/).test(target.className);
	};


	/**
	 * Determine whether a given element requires a call to focus to simulate click into element.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.
	 */
	FastClick.prototype.needsFocus = function(target) {
		switch (target.nodeName.toLowerCase()) {
		case 'textarea':
			return true;
		case 'select':
			return !deviceIsAndroid;
		case 'input':
			switch (target.type) {
			case 'button':
			case 'checkbox':
			case 'file':
			case 'image':
			case 'radio':
			case 'submit':
				return false;
			}

			// No point in attempting to focus disabled inputs
			return !target.disabled && !target.readOnly;
		default:
			return (/\bneedsfocus\b/).test(target.className);
		}
	};


	/**
	 * Send a click event to the specified element.
	 *
	 * @param {EventTarget|Element} targetElement
	 * @param {Event} event
	 */
	FastClick.prototype.sendClick = function(targetElement, event) {
		var clickEvent, touch;

		// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)
		if (document.activeElement && document.activeElement !== targetElement) {
			document.activeElement.blur();
		}

		touch = event.changedTouches[0];

		// Synthesise a click event, with an extra attribute so it can be tracked
		clickEvent = document.createEvent('MouseEvents');
		clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
		clickEvent.forwardedTouchEvent = true;
		targetElement.dispatchEvent(clickEvent);
	};

	FastClick.prototype.determineEventType = function(targetElement) {

		//Issue #159: Android Chrome Select Box does not open with a synthetic click event
		if (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {
			return 'mousedown';
		}

		return 'click';
	};


	/**
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.focus = function(targetElement) {
		var length;

		// Issue #160: on iOS 7, some input elements (e.g. date datetime month) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.
		if (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time' && targetElement.type !== 'month') {
			length = targetElement.value.length;
			targetElement.setSelectionRange(length, length);
		} else {
			targetElement.focus();
		}
	};


	/**
	 * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.
	 *
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.updateScrollParent = function(targetElement) {
		var scrollParent, parentElement;

		scrollParent = targetElement.fastClickScrollParent;

		// Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the
		// target element was moved to another parent.
		if (!scrollParent || !scrollParent.contains(targetElement)) {
			parentElement = targetElement;
			do {
				if (parentElement.scrollHeight > parentElement.offsetHeight) {
					scrollParent = parentElement;
					targetElement.fastClickScrollParent = parentElement;
					break;
				}

				parentElement = parentElement.parentElement;
			} while (parentElement);
		}

		// Always update the scroll top tracker if possible.
		if (scrollParent) {
			scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;
		}
	};


	/**
	 * @param {EventTarget} targetElement
	 * @returns {Element|EventTarget}
	 */
	FastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {

		// On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.
		if (eventTarget.nodeType === Node.TEXT_NODE) {
			return eventTarget.parentNode;
		}

		return eventTarget;
	};


	/**
	 * On touch start, record the position and scroll offset.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchStart = function(event) {
		var targetElement, touch, selection;

		// Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).
		if (event.targetTouches.length > 1) {
			return true;
		}

		targetElement = this.getTargetElementFromEventTarget(event.target);
		touch = event.targetTouches[0];

		if (deviceIsIOS) {

			// Only trusted events will deselect text on iOS (issue #49)
			selection = window.getSelection();
			if (selection.rangeCount && !selection.isCollapsed) {
				return true;
			}

			if (!deviceIsIOS4) {

				// Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):
				// when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched
				// with the same identifier as the touch event that previously triggered the click that triggered the alert.
				// Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an
				// immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.
				// Issue 120: touch.identifier is 0 when Chrome dev tools 'Emulate touch events' is set with an iOS device UA string,
				// which causes all touch events to be ignored. As this block only applies to iOS, and iOS identifiers are always long,
				// random integers, it's safe to to continue if the identifier is 0 here.
				if (touch.identifier && touch.identifier === this.lastTouchIdentifier) {
					event.preventDefault();
					return false;
				}

				this.lastTouchIdentifier = touch.identifier;

				// If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:
				// 1) the user does a fling scroll on the scrollable layer
				// 2) the user stops the fling scroll with another tap
				// then the event.target of the last 'touchend' event will be the element that was under the user's finger
				// when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check
				// is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).
				this.updateScrollParent(targetElement);
			}
		}

		this.trackingClick = true;
		this.trackingClickStart = event.timeStamp;
		this.targetElement = targetElement;

		this.touchStartX = touch.pageX;
		this.touchStartY = touch.pageY;

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			event.preventDefault();
		}

		return true;
	};


	/**
	 * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.touchHasMoved = function(event) {
		var touch = event.changedTouches[0], boundary = this.touchBoundary;

		if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {
			return true;
		}

		return false;
	};


	/**
	 * Update the last position.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchMove = function(event) {
		if (!this.trackingClick) {
			return true;
		}

		// If the touch has moved, cancel the click tracking
		if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {
			this.trackingClick = false;
			this.targetElement = null;
		}

		return true;
	};


	/**
	 * Attempt to find the labelled control for the given label element.
	 *
	 * @param {EventTarget|HTMLLabelElement} labelElement
	 * @returns {Element|null}
	 */
	FastClick.prototype.findControl = function(labelElement) {

		// Fast path for newer browsers supporting the HTML5 control attribute
		if (labelElement.control !== undefined) {
			return labelElement.control;
		}

		// All browsers under test that support touch events also support the HTML5 htmlFor attribute
		if (labelElement.htmlFor) {
			return document.getElementById(labelElement.htmlFor);
		}

		// If no for attribute exists, attempt to retrieve the first labellable descendant element
		// the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label
		return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');
	};


	/**
	 * On touch end, determine whether to send a click event at once.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchEnd = function(event) {
		var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;

		if (!this.trackingClick) {
			return true;
		}

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			this.cancelNextClick = true;
			return true;
		}

		if ((event.timeStamp - this.trackingClickStart) > this.tapTimeout) {
			return true;
		}

		// Reset to prevent wrong click cancel on input (issue #156).
		this.cancelNextClick = false;

		this.lastClickTime = event.timeStamp;

		trackingClickStart = this.trackingClickStart;
		this.trackingClick = false;
		this.trackingClickStart = 0;

		// On some iOS devices, the targetElement supplied with the event is invalid if the layer
		// is performing a transition or scroll, and has to be re-detected manually. Note that
		// for this to function correctly, it must be called *after* the event target is checked!
		// See issue #57; also filed as rdar://13048589 .
		if (deviceIsIOSWithBadTarget) {
			touch = event.changedTouches[0];

			// In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null
			targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;
			targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;
		}

		targetTagName = targetElement.tagName.toLowerCase();
		if (targetTagName === 'label') {
			forElement = this.findControl(targetElement);
			if (forElement) {
				this.focus(targetElement);
				if (deviceIsAndroid) {
					return false;
				}

				targetElement = forElement;
			}
		} else if (this.needsFocus(targetElement)) {

			// Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.
			// Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).
			if ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {
				this.targetElement = null;
				return false;
			}

			this.focus(targetElement);
			this.sendClick(targetElement, event);

			// Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.
			// Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)
			if (!deviceIsIOS || targetTagName !== 'select') {
				this.targetElement = null;
				event.preventDefault();
			}

			return false;
		}

		if (deviceIsIOS && !deviceIsIOS4) {

			// Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled
			// and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).
			scrollParent = targetElement.fastClickScrollParent;
			if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {
				return true;
			}
		}

		// Prevent the actual click from going though - unless the target node is marked as requiring
		// real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.
		if (!this.needsClick(targetElement)) {
			event.preventDefault();
			this.sendClick(targetElement, event);
		}

		return false;
	};


	/**
	 * On touch cancel, stop tracking the click.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.onTouchCancel = function() {
		this.trackingClick = false;
		this.targetElement = null;
	};


	/**
	 * Determine mouse events which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onMouse = function(event) {

		// If a target element was never set (because a touch event was never fired) allow the event
		if (!this.targetElement) {
			return true;
		}

		if (event.forwardedTouchEvent) {
			return true;
		}

		// Programmatically generated events targeting a specific element should be permitted
		if (!event.cancelable) {
			return true;
		}

		// Derive and check the target element to see whether the mouse event needs to be permitted;
		// unless explicitly enabled, prevent non-touch click events from triggering actions,
		// to prevent ghost/doubleclicks.
		if (!this.needsClick(this.targetElement) || this.cancelNextClick) {

			// Prevent any user-added listeners declared on FastClick element from being fired.
			if (event.stopImmediatePropagation) {
				event.stopImmediatePropagation();
			} else {

				// Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
				event.propagationStopped = true;
			}

			// Cancel the event
			event.stopPropagation();
			event.preventDefault();

			return false;
		}

		// If the mouse event is permitted, return true for the action to go through.
		return true;
	};


	/**
	 * On actual clicks, determine whether this is a touch-generated click, a click action occurring
	 * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or
	 * an actual click which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onClick = function(event) {
		var permitted;

		// It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.
		if (this.trackingClick) {
			this.targetElement = null;
			this.trackingClick = false;
			return true;
		}

		// Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.
		if (event.target.type === 'submit' && event.detail === 0) {
			return true;
		}

		permitted = this.onMouse(event);

		// Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.
		if (!permitted) {
			this.targetElement = null;
		}

		// If clicks are permitted, return true for the action to go through.
		return permitted;
	};


	/**
	 * Remove all FastClick's event listeners.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.destroy = function() {
		var layer = this.layer;

		if (deviceIsAndroid) {
			layer.removeEventListener('mouseover', this.onMouse, true);
			layer.removeEventListener('mousedown', this.onMouse, true);
			layer.removeEventListener('mouseup', this.onMouse, true);
		}

		layer.removeEventListener('click', this.onClick, true);
		layer.removeEventListener('touchstart', this.onTouchStart, false);
		layer.removeEventListener('touchmove', this.onTouchMove, false);
		layer.removeEventListener('touchend', this.onTouchEnd, false);
		layer.removeEventListener('touchcancel', this.onTouchCancel, false);
	};


	/**
	 * Check whether FastClick is needed.
	 *
	 * @param {Element} layer The layer to listen on
	 */
	FastClick.notNeeded = function(layer) {
		var metaViewport;
		var chromeVersion;
		var blackberryVersion;
		var firefoxVersion;

		// Devices that don't support touch don't need FastClick
		if (typeof window.ontouchstart === 'undefined') {
			return true;
		}

		// Chrome version - zero for other browsers
		chromeVersion = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (chromeVersion) {

			if (deviceIsAndroid) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// Chrome on Android with user-scalable="no" doesn't need FastClick (issue #89)
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// Chrome 32 and above with width=device-width or less don't need FastClick
					if (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}

			// Chrome desktop doesn't need FastClick (issue #15)
			} else {
				return true;
			}
		}

		if (deviceIsBlackBerry10) {
			blackberryVersion = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);

			// BlackBerry 10.3+ does not require Fastclick library.
			// https://github.com/ftlabs/fastclick/issues/251
			if (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// user-scalable=no eliminates click delay.
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// width=device-width (or less than device-width) eliminates click delay.
					if (document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}
			}
		}

		// IE10 with -ms-touch-action: none or manipulation, which disables double-tap-to-zoom (issue #97)
		if (layer.style.msTouchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		// Firefox version - zero for other browsers
		firefoxVersion = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (firefoxVersion >= 27) {
			// Firefox 27+ does not have tap delay if the content is not zoomable - https://bugzilla.mozilla.org/show_bug.cgi?id=922896

			metaViewport = document.querySelector('meta[name=viewport]');
			if (metaViewport && (metaViewport.content.indexOf('user-scalable=no') !== -1 || document.documentElement.scrollWidth <= window.outerWidth)) {
				return true;
			}
		}

		// IE11: prefixed -ms-touch-action is no longer supported and it's recomended to use non-prefixed version
		// http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx
		if (layer.style.touchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		return false;
	};


	/**
	 * Factory method for creating a FastClick object
	 *
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	FastClick.attach = function(layer, options) {
		return new FastClick(layer, options);
	};


	if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {

		// AMD. Register as an anonymous module.
		define(function() {
			return FastClick;
		});
	} else if (typeof module !== 'undefined' && module.exports) {
		module.exports = FastClick.attach;
		module.exports.FastClick = FastClick;
	} else {
		window.FastClick = FastClick;
	}
}());

/**
 * @preserve FTColumnflow is a polyfill that fixes the inadequacies of CSS column layouts.
 *
 * It is developed by FT Labs (http://labs.ft.com), part of the Financial Times.
 * It is extensively used in the FT Web App (http://app.ft.com), where it allows us to
 * publish articles with complex newspaper/magazine style layouts, including features such as:
 *		- Configurable column widths, gutters and margins
 *		- Fixed-position elements
 *		- Elements spanning columns
 *		- Keep-with-next to avoid headings at the bottom of a column
 *		- No-wrap class to avoid splitting elements across columns
 *		- Grouping of columns into pages
 *		- Horizontal or vertical alignment of pages
 *		- Standardised line height to align text baseline to a grid
 *		- Rapid reflow as required by events such as device orientation or font-size change
 * It is designed with the same column dimension specification API as the CSS3 multi-column specification
 * (http://www.w3.org/TR/css3-multicol/), but gives far greater flexibility over element positioning within those columns.
 *
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENCE.txt)
 * @codingstandard ftlabs-jslint
 */

/*jslint browser:true, es5: true*/
/*global Node*/


// UMD from https://gist.github.com/wilsonpage/8598603
;(function(define){define(function(require,exports,module){

	"use strict";


	// Set up FTColumnflowException class
	function FTColumnflowException(name, message) {
		this.name    = 'FTColumnflow' + name || 'FTColumnflowException';
		this.message = message || '';
	}
	FTColumnflowException.prototype   = new Error();
	FTColumnflowException.constructor = FTColumnflowException;



	/* Scope vars */

	var

		layoutDimensionList = [
			'pageInnerWidth',
			'pageInnerHeight',
			'colDefaultTop',
			'colDefaultLeft',
			'columnCount',
			'columnWidth',
			'columnGap'
		],

		defaultConfig = {
			layoutDimensions:         null,
			columnFragmentMinHeight:  0,
			viewportWidth:            null,
			viewportHeight:           null,
			columnWidth:              'auto',
			columnCount:              'auto',
			columnGap:                'normal',
			pageClass:                'cf-page',
			columnClass:              'cf-column',
			pageArrangement:          'horizontal',
			pagePadding:              0,
			debug:                    false,
			showGrid:                 false,
			standardiseLineHeight:    false,
			minFixedPadding:          1,
			lineHeight:               null,
			noWrapOnTags:             [],
			allowReflow:              true
		},

		// CSS Style declarations
		cssStyles = '#[targetId] { position: relative; height: 100%; }\n' +
		'#[targetId] .[preloadAreaClassName].[pageClass] { visibility: hidden; position: absolute; overflow: hidden; }\n' +
		'#[targetId] .[preloadFixedAreaClassName] { visibility: hidden; position: absolute; }\n' +
		'#[targetId] .[pageClass] { position: absolute; width: [viewportWidth]px; height: [viewportHeight]px; [pageArrangement] }\n' +
		'#[targetId] .[columnClass] { position: absolute; width: [columnWidth]px; overflow: hidden; }\n' +
		'#[targetId] .[pageClass] .[fixedElementClassName] { position: absolute; }\n' +
		'#[targetId] .[pageClass] .[columnClass] > :first-child { margin-top: 0px; }\n',

		cssColumnStyles = '#[targetId] .[columnClass].[columnClass]-[columnNum] { left: [leftPos]px; }\n',

		showGridStyles = '#[targetId] .[pageClass] { background-image: -webkit-linear-gradient(skyblue 1px, transparent 1px); background-size: 100% [lh]px; background-origin: content-box; }',


		// Implement outerHTML in browsers which don't support it
		// Adapted from Modernizr's outerHTML polyfill: bit.ly/polyfills
		_outerHTML = (function() {
			var outerHTMLContainer;
			if (typeof document !== "undefined" && !document.documentElement.hasOwnProperty('outerHTML')) {
				outerHTMLContainer = document.createElementNS("http://www.w3.org/1999/xhtml", "_");
				return function _outerHTMLNode(node) {
					var html;
					outerHTMLContainer.appendChild(node.cloneNode(false));
					html = outerHTMLContainer.innerHTML.replace("><", ">" + node.innerHTML + "<");
					outerHTMLContainer.innerHTML = "";
					return html;
				};
			} else {
				return function _outerHTMLNative(node) {
					return node.outerHTML;
				};
			}
		}());



	function FTColumnflow(target, viewport, userConfig) {

		var

			// Instance configuration
			config = {},

			// Debugging
			showGrid,

			// String or DOM node
			flowedContent,
			fixedContent,

			// Dimensions
			colDefaultBottom,
			colMiddle,
			minFixedPadding,
			fixedPadding,

			// DOM elements
			renderArea,
			preloadColumn,
			fixedPreloadArea,
			headElement,
			headerStyles,

			// Class names
			targetIdPrefix            = 'cf-target-',
			renderAreaClassName       = 'cf-render-area',
			preloadAreaClassName      = 'cf-preload',
			preloadFixedAreaClassName = 'cf-preload-fixed',
			fixedElementClassName     = 'cf-fixed',
			nowrapClassName           = 'nowrap',
			keepwithnextClassName     = 'keepwithnext',

			// HTML fragments
			lineHeightTestContents,

			// Collections
			pagedContent = [],
			pagedEndContent = [],

			// Counters
			borderElementIndex,
			indexedPageNum,
			indexedColumnNum,
			indexedColumnFrag,
			topElementOverflow,
			totalColumnHeight,

			// Object references
			workingPage,
			workingColumn,
			workingColumnFrag,

			// Copy of parent scope
			that = this;


		/* Constructor */

		this.target   = target;
		this.viewport = viewport;

		this._checkInstanceArgs();

		_setConfig(userConfig);

		_setLayoutDimensions();



		function _setConfig(userConfig) {
			var i;

			// Reference local config as public property
			that.config = config = {};

			// Copy defaultConfig settings into config
			for (i in defaultConfig) {
				if (defaultConfig.hasOwnProperty(i)) {
					config[i] = defaultConfig[i];
				}
			}

			// Merge userConfig settings into config
			for (i in userConfig) {
				if (userConfig.hasOwnProperty(i)) {
					if (config[i] === undefined) {
						throw new FTColumnflowException('ParameterException', 'Unknown config parameter [' + i + '].');
					}
					config[i] = userConfig[i];
				}
			}

			// Enable showGrid?
			if (config.showGrid !== undefined) showGrid = !!config.showGrid;

			// Check page params
			if ('horizontal' !== config.pageArrangement && 'vertical' !== config.pageArrangement) {
				throw new FTColumnflowException('ArrangementException', config.pageArrangement + ' is not a valid Page Arrangement value.');
			}

			config.pagePadding = parseInt(config.pagePadding, 10);
			if (isNaN(config.pagePadding)) {
				throw new FTColumnflowException('PaddingException', config.pagePadding + ' is not a valid Page Padding value.');
			}

			// Check column dimension specifications are valid
			['columnWidth', 'columnCount', 'columnGap', 'columnFragmentMinHeight'].forEach(function _checkColumnSpecification(type) {

				if (defaultConfig[type] === config[type]) return true;
				config[type] = parseInt(config[type], 10);

				if (isNaN(config[type]) || config[type] < 0) {
					throw new FTColumnflowException('ColumnDimensionException', type + ' must be an positive integer or "' + defaultConfig[type] + '".');
				}
			});

			// Check standardiseLineHeight
			if (typeof config.standardiseLineHeight !== 'boolean') {
				throw new FTColumnflowException('StandardiseLineheightException', 'standardiseLineHeight must be a boolean value.');
			}

			// Check minFixedPadding
			config.minFixedPadding = parseFloat(config.minFixedPadding);
			if (isNaN(config.minFixedPadding)) {
				throw new FTColumnflowException('MinFixedPaddingException', 'minFixedPadding must be a float or integer.');
			}

			// Check viewportWidth, if specified
			if ((config.viewportWidth !== null) && isNaN(config.viewportWidth = parseInt(config.viewportWidth, 10))) {
				throw new FTColumnflowException('ViewportWidthException', 'viewportWidth must be an integer.');
			}

			// Check viewportHeight, if specified
			if ((config.viewportHeight !== null) && isNaN(config.viewportHeight = parseInt(config.viewportHeight, 10))) {
				throw new FTColumnflowException('ViewportHeightException', 'viewportHeight must be an integer.');
			}

			// Check lineHeight, if specified
			if ((config.lineHeight !== null) && isNaN(config.lineHeight = parseInt(config.lineHeight, 10))) {
				throw new FTColumnflowException('LineheightException', 'lineHeight must be an integer.');
			}

			// Check class names are valid
			config.pageClass   = _normaliseClassName('pageClass', config.pageClass);
			config.columnClass = _normaliseClassName('columnClass', config.columnClass);

			// Check noWrapOnTags
			if (!Array.isArray(config.noWrapOnTags)) {
				throw new FTColumnflowException('NoWrapException', 'noWrapOnTags must be an Array.');
			}

			// Ensure tags are lowercase
			config.noWrapOnTags = config.noWrapOnTags.map(function _lowercase(item) {
				return item.toLowerCase();
			});
		}


		function _setLayoutDimensions() {

			var i, l, derivedColumnCount, computedStyle;

			// If the layoutDimensions parameter was passed in
			if (config.layoutDimensions !== null) {

				// Check each one
				for (i = 0, l = layoutDimensionList.length; i < l; i++) {
					if (isNaN(Number(config.layoutDimensions[layoutDimensionList[i]]))) {
						throw new FTColumnflowException('DimensionCacheException', 'Must specify an integer value for ' + layoutDimensionList[i]);
					}
				}

				// Done
				return;
			}

			config.layoutDimensions = {};

			// Determine viewport dimensions if they have not been specified
			if (!config.viewportWidth) {
				computedStyle = window.getComputedStyle(that.viewport);
				config.viewportWidth = parseInt(computedStyle.getPropertyValue('width'), 10);
			}

			if (!config.viewportHeight) {
				if (!computedStyle) computedStyle = window.getComputedStyle(that.viewport);
				config.viewportHeight = parseInt(computedStyle.getPropertyValue('height'), 10);
			}

			if (!config.viewportWidth || !config.viewportHeight) {
				throw new FTColumnflowException('ViewportException', 'Viewport element must have width and height.');
			}

			// Determine column gap - 'normal' defaults to 1em
			if ('normal' === config.columnGap) {
				if (!computedStyle) computedStyle = window.getComputedStyle(that.viewport);
				config.layoutDimensions.columnGap = parseInt(computedStyle.fontSize, 10);
			} else {
				config.layoutDimensions.columnGap = config.columnGap;
			}

			// Determine page dimensions
			if ('horizontal' === config.pageArrangement) {
				config.layoutDimensions.pageInnerWidth  = config.viewportWidth - (2 * config.pagePadding);
				config.layoutDimensions.pageInnerHeight = config.viewportHeight;
				config.layoutDimensions.colDefaultTop   = 0;
				config.layoutDimensions.colDefaultLeft  = config.pagePadding;
			} else {
				config.layoutDimensions.pageInnerWidth  = config.viewportWidth;
				config.layoutDimensions.pageInnerHeight = config.viewportHeight - (2 * config.pagePadding);
				config.layoutDimensions.colDefaultTop   = config.pagePadding;
				config.layoutDimensions.colDefaultLeft  = 0;
			}

			// Determine columns per page and column dimensions.
			// For logic, see pseudo-code at http://www.w3.org/TR/css3-multicol/#pseudo-algorithm
			if ('auto' === config.columnWidth && 'auto' === config.columnCount) {

				// Auto - default to 1 column
				config.layoutDimensions.columnCount = 1;
				config.layoutDimensions.columnWidth = config.layoutDimensions.pageInnerWidth;
			} else if ('auto' === config.columnWidth && 'auto' !== config.columnCount) {

				// Determine column width from specified column count and page width
				config.layoutDimensions.columnCount = config.columnCount;
				config.layoutDimensions.columnWidth = (config.layoutDimensions.pageInnerWidth - ((config.columnCount - 1) * config.layoutDimensions.columnGap)) / config.columnCount;

			// Column width is specified.
			} else {

				// Derive the optimal column count
				// COMPLEX:GC:20120312: Add 1px to the page width to avoid precision errors in the case that the config values
				// result in a column count very near to a whole number
				derivedColumnCount = Math.max(1, Math.floor((config.layoutDimensions.pageInnerWidth + 1 + config.layoutDimensions.columnGap) / (config.columnWidth + config.layoutDimensions.columnGap)));

				if ('auto' === config.columnCount) {

					// Use the derived count
					config.layoutDimensions.columnCount = derivedColumnCount;
					config.layoutDimensions.columnWidth = ((config.layoutDimensions.pageInnerWidth + config.layoutDimensions.columnGap) / config.layoutDimensions.columnCount) - config.layoutDimensions.columnGap;
				} else {

					// Count is specified, but we may be able to fit more
					config.layoutDimensions.columnCount = Math.min(config.columnCount, derivedColumnCount);
					config.layoutDimensions.columnWidth = ((config.layoutDimensions.pageInnerWidth + config.layoutDimensions.columnGap) / config.layoutDimensions.columnCount) - config.layoutDimensions.columnGap;
				}
			}

			config.layoutDimensions.columnHeight = config.lineHeight ? _roundDownToGrid(config.layoutDimensions.pageInnerHeight) : config.layoutDimensions.pageInnerHeight;
		}


		/* Add the necessary CSS to <head> */

		function _writeTargetStyles() {

			var styleContents, columnNum;

			if (!headElement) headElement = document.querySelector('head');

			// Set a random ID on the target
			if (!that.target.id) that.target.id = targetIdPrefix + Math.floor(Math.random() * (9000000000) + 1000000000);

			// Main styles
			styleContents = _replaceStringTokens(cssStyles, {
				targetId:                   that.target.id,
				preloadAreaClassName:       preloadAreaClassName,
				preloadFixedAreaClassName:  preloadFixedAreaClassName,
				fixedElementClassName:      fixedElementClassName,
				pageClass:                  config.pageClass,
				columnClass:                config.columnClass,
				columnWidth:                config.layoutDimensions.columnWidth,
				viewportWidth:              config.viewportWidth,
				viewportHeight:             config.viewportHeight,
				pageArrangement:            ('horizontal' === config.pageArrangement) ? 'top: 0;' : 'left: 0;'
			});

			// Column-specific styles
			for (columnNum = 1; columnNum <= config.layoutDimensions.columnCount; columnNum++) {

				styleContents += _replaceStringTokens(cssColumnStyles, {
					targetId:        that.target.id,
					columnClass:     config.columnClass,
					columnNum:       columnNum,
					leftPos:         config.layoutDimensions.colDefaultLeft + (config.layoutDimensions.columnWidth * (columnNum - 1)) + (config.layoutDimensions.columnGap * (columnNum - 1))
				});
			}

			if (headerStyles) {

				// Remove existing CSS
				while (headerStyles.hasChildNodes()) {
					headerStyles.removeChild(headerStyles.firstChild);
				}

			} else {
				headerStyles = document.createElement('style');
				headerStyles.setAttribute('type', 'text/css');
			}

			headerStyles.appendChild(document.createTextNode(styleContents));
			headElement.appendChild(headerStyles);
		}

		function _createTargetElements() {

			var preloadElement, targetChildren;

			// Create the preload and render areas
			targetChildren   = document.createDocumentFragment();
			preloadElement   = targetChildren.appendChild(document.createElement('div'));
			renderArea       = targetChildren.appendChild(document.createElement('div'));

			// Add the flowed content to the preload area
			if ('string' === typeof flowedContent || !flowedContent) {
				preloadColumn = preloadElement.appendChild(document.createElement('div'));
				if (flowedContent) preloadColumn.innerHTML = flowedContent;
			} else if (flowedContent instanceof HTMLElement) {
				preloadColumn = flowedContent.cloneNode(true);
				preloadElement.appendChild(preloadColumn);
			} else {
				throw new FTColumnflowException('FlowedContentException', 'flowedContent must be a HTML string or a DOM element.');
			}

			// Add the fixed content to the preload area
			if ('string' === typeof fixedContent || !fixedContent) {
				fixedPreloadArea = targetChildren.appendChild(document.createElement('div'));
				if (fixedContent) fixedPreloadArea.innerHTML = fixedContent;
			} else if (fixedContent instanceof HTMLElement) {
				fixedPreloadArea = fixedContent.cloneNode(true);
				targetChildren.appendChild(fixedPreloadArea);
			} else {
				throw new FTColumnflowException('FixedContentException', 'fixedContent must be a HTML string or a DOM element.');
			}

			preloadElement.className   = preloadAreaClassName + ' ' + config.pageClass;
			renderArea.className       = renderAreaClassName;
			preloadColumn.className    = config.columnClass;
			fixedPreloadArea.className = preloadFixedAreaClassName;

			that.target.appendChild(targetChildren);
		}


		/* Determine the baseline grid for the flowed content from the line-height */

		function _findLineHeight() {

			var lineHeights, i, l, node, testNode, testLineHeight;

			// If the grid height is not pre-set, we need to determine it
			if (!config.lineHeight) {

				if (!lineHeightTestContents) {

					// 10 lines of text
					lineHeightTestContents = new Array(10).join('x<br />') + 'x';
				}

				// Here we take the mode (most common) line-height value from the first few
				// elements (maximum 10), and assume that that is our desired baseline grid value
				lineHeights = [];
				for (i = 0, l = Math.min(10, (preloadColumn.childNodes.length)); i < l; i++) {

					node = preloadColumn.childNodes[i];
					if (Node.ELEMENT_NODE !== node.nodeType) continue;

					testLineHeight = parseInt(window.getComputedStyle(node).getPropertyValue('line-height'), 10);

					// We haven't found a pixel lineheight, so it must be 'normal' or 'inherit'. Unless there's
					// a better way of doing this, for now we just create a (similar) element at the end of the
					// column with 10 lines of text, and measure its height
					if (!testLineHeight) {

						testNode = node.cloneNode(false);

						if (node.className) testNode.className = node.className;
						testNode.style.padding = "0px";
						testNode.style.border  = "none";
						testNode.style.height  = "auto";
						testNode.innerHTML     = lineHeightTestContents;

						preloadColumn.appendChild(testNode);
						testLineHeight = testNode.offsetHeight / 10;
						preloadColumn.removeChild(testNode);
					}

					lineHeights.push(testLineHeight);
				}

				if (lineHeights.length < 5) {

					// If we haven't yet build up a large enough sample, add some simple paragraphs
					testNode = document.createElement('p');

					testNode.style.padding = "0px";
					testNode.style.border  = "none";
					testNode.style.height  = "auto";
					testNode.innerHTML     = lineHeightTestContents;

					preloadColumn.appendChild(testNode);
					testLineHeight = testNode.offsetHeight / 10;
					preloadColumn.removeChild(testNode);

					for (i = lineHeights.length; i < 5; i++) lineHeights.push(testLineHeight);
				}

				config.lineHeight = _mode(lineHeights);
			}

			// Now the line-height is known, the column height can be determined
			config.layoutDimensions.columnHeight = config.lineHeight ? _roundDownToGrid(config.layoutDimensions.pageInnerHeight) : config.layoutDimensions.pageInnerHeight;

			// For debugging, show the grid lines with CSS
			if (showGrid) {

				headerStyles.innerHTML += _replaceStringTokens(showGridStyles, {
					targetId:    that.target.id,
					pageClass:   config.pageClass,
					'lh':        config.lineHeight
				});
			}
		}


		function _setFixedElementHeight(element) {

			var computedStyle, indexedColStart, indexedColEnd,
				matches, anchorY, anchorX, colSpan, spanDir;

			// Don't do any manipulation on text nodes, or nodes which are hidden
			if (Node.TEXT_NODE === element.nodeType) return false;

			computedStyle = window.getComputedStyle(element);
			if ('none' === computedStyle.getPropertyValue('display')) return false;

			// Determine the anchor point
			matches = element.className.match(/(\s|^)anchor-(top|middle|bottom)-(left|right|(?:col-(\d+)))(\s|$)/);
			if (matches) {

				anchorY = matches[2];

				if (matches[4]) {

					// A numeric column anchor
					anchorX = Math.max(0, (Math.min(matches[4], config.layoutDimensions.columnCount) - 1));
				} else {

					// Left or right
					anchorX = matches[3];
				}

			} else {
				anchorY = 'top';
				anchorX = 'left';
			}

			// Determine the affected columns
			matches = element.className.match(/(\s|^)col-span-(\d+|all)(-(left|right))?(\s|$)/);
			if (matches) {

				spanDir = matches[4] || 'right';

				if (matches[2] === 'all') {
					colSpan = config.layoutDimensions.columnCount;
				} else {
					colSpan = parseInt(matches[2], 10);
				}

				if ('left' === anchorX) {
					indexedColStart = 0;
					indexedColEnd   = Math.min(colSpan, config.layoutDimensions.columnCount) - 1;
				} else if ('right' === anchorX) {
					indexedColEnd   = config.layoutDimensions.columnCount - 1;
					indexedColStart = config.layoutDimensions.columnCount - Math.min(colSpan, config.layoutDimensions.columnCount);
				} else {
					if ('right' === spanDir) {
						indexedColStart = anchorX;
						indexedColEnd   = Math.min((indexedColStart + colSpan), config.layoutDimensions.columnCount) - 1;
					} else {
						indexedColEnd   = anchorX;
						indexedColStart = Math.max((indexedColEnd - colSpan - 1), 0);
					}
				}
			} else {

				if ('left' === anchorX) {
					indexedColStart = 0;
				} else if ('right' === anchorX) {
					indexedColStart = config.layoutDimensions.columnCount - 1;
				} else {
					indexedColStart = anchorX;
				}

				indexedColEnd = indexedColStart;
			}

			// Set an explicit width to that of the columnspan attribute
			element.style.width = _round(((indexedColEnd - indexedColStart) * (config.layoutDimensions.columnWidth + config.layoutDimensions.columnGap)) + config.layoutDimensions.columnWidth) + 'px';

			return {
				element:          element,
				preComputedStyle: computedStyle,
				indexedColStart:  indexedColStart,
				indexedColEnd:    indexedColEnd,
				anchorY:          anchorY,
				anchorX:          anchorX
			};
		}


		function _addFixedElement(elementDefinition) {

			var element = elementDefinition.element,
				matches, pageNum, workingPage, normalisedElementHeight,
				elementTopPos, elementBottomPos, lowestTopPos, highestBottomPos,
				topSplitPoint, bottomSplitPoint,
				firstColFragment, lastColFragment, newColumnFragment, newFragmentHeight,
				fragment, column, fragNum, fragLen,	columnNum;


			// Determine the page
			if (element.classList.contains('attach-page-last')) {

				// Add to a separate store of elements to be added after all the other content is rendered
				pagedEndContent.push({
					'fixed': [{
						content: _outerHTML(element),
						top:     config.layoutDimensions.colDefaultTop,
						left:    config.layoutDimensions.colDefaultLeft
					}]
				});
				return;

			} else {

				// Look for a numeric page
				matches = element.className.match(/(\s|^)attach-page-(\d+)(\s|$)/);
				if (matches) {
					pageNum = matches[2] - 1;
				} else {
					pageNum = 0;
				}
			}

			// Create any necessary page objects
			_createPageObjects(pageNum);
			workingPage = pagedContent[pageNum];

			// Determine the height of the element, taking into account any vertical shift applied to it using margin-top
			normalisedElementHeight = element.offsetHeight + parseInt(elementDefinition.preComputedStyle.getPropertyValue('margin-top'), 10);

			// Find the most appropriate available space for the element on the page
			switch (elementDefinition.anchorY) {

				case 'top':
					elementTopPos = config.layoutDimensions.colDefaultTop;
					lowestTopPos  = colDefaultBottom - normalisedElementHeight;

					for (columnNum = elementDefinition.indexedColStart; columnNum <= elementDefinition.indexedColEnd; columnNum++) {

						// Find the topmost column fragment
						firstColFragment = workingPage.columns[columnNum].fragments[0];

						if (!firstColFragment) {

							// Column is full, so place element at the bottom
							elementTopPos = lowestTopPos;
						} else {

							// If the fragment starts below the element top position, move the element down
							if (firstColFragment.top > elementTopPos) {
								elementTopPos = (firstColFragment.top > lowestTopPos) ? lowestTopPos : firstColFragment.top;
							}
						}
					}
					elementBottomPos = elementTopPos + normalisedElementHeight;
					topSplitPoint    = elementTopPos - config.lineHeight;
					bottomSplitPoint = _roundUpToGrid(elementBottomPos, true);
					break;

				case 'middle':
					elementTopPos    = colMiddle - (normalisedElementHeight / 2);
					topSplitPoint    = _roundDownToGrid(elementTopPos, true);
					bottomSplitPoint = _roundUpToGrid(elementTopPos + normalisedElementHeight, true);

					if (topSplitPoint < 0) topSplitPoint = 0;
					if (bottomSplitPoint > config.layoutDimensions.columnHeight) bottomSplitPoint = config.layoutDimensions.columnHeight;
					break;

				case 'bottom':
					elementBottomPos = colDefaultBottom;
					highestBottomPos = normalisedElementHeight;

					for (columnNum = elementDefinition.indexedColStart; columnNum <= elementDefinition.indexedColEnd; columnNum++) {

						// Find the bottommost column fragment
						lastColFragment = workingPage.columns[columnNum].fragments[workingPage.columns[columnNum].fragments.length - 1];

						if (!lastColFragment) {

							// Column is full, so place element at the top
							elementBottomPos = highestBottomPos;
						} else {

							// If the fragment ends above the element bottom position, move the element up
							if (lastColFragment.bottom < elementBottomPos) {
								elementBottomPos = (lastColFragment.bottom < highestBottomPos) ? highestBottomPos : lastColFragment.bottom;
							}
						}
					}

					elementTopPos    = elementBottomPos - normalisedElementHeight;
					topSplitPoint    = _roundDownToGrid(elementTopPos, true);
					bottomSplitPoint = elementBottomPos + config.lineHeight;
					break;
			}


			/* Alter dimensions and placing of any affected column fragments. */

			// Loop the columns spanned by the element
			for (columnNum = elementDefinition.indexedColStart; columnNum <= elementDefinition.indexedColEnd; columnNum++) {

				column = workingPage.columns[columnNum];

				// Loop the fragments
				for (fragNum = 0, fragLen = column.fragments.length; fragNum < fragLen; fragNum++) {

					fragment = column.fragments[fragNum];

					// The fragment is entirely overlapped by the fixed element, so delete it and continue the loop
					if (topSplitPoint < fragment.top && bottomSplitPoint > fragment.bottom) {
						column.fragments.splice(fragNum, 1);
						fragLen--;
						continue;
					} else if (topSplitPoint > fragment.bottom || bottomSplitPoint < fragment.top) {

						// The fragment is not disturbed by the element at all
						continue;
					}

					// Determine the height of the new fragment
					newFragmentHeight = fragment.top + fragment.height - bottomSplitPoint;

					// Modify the original column fragment
					fragment.height = topSplitPoint - fragment.top;
					fragment.bottom = fragment.top + fragment.height;


					if (!fragment.height || fragment.height < config.columnFragmentMinHeight) {

						// The fragment is now too small, so delete it and decrement the iteration counter
						column.fragments.splice(fragNum--, 1);
						fragLen--;
					}

					// Only create the new fragment if it has enough height
					if (newFragmentHeight && newFragmentHeight >= config.columnFragmentMinHeight) {

						// Create a new column fragment
						newColumnFragment = _createColumnFragment();

						newColumnFragment.top    = bottomSplitPoint;
						newColumnFragment.height = newFragmentHeight;
						newColumnFragment.bottom = newColumnFragment.top + newColumnFragment.height;

						// Insert it into the collection, and increment the iteration counter
						column.fragments.splice(++fragNum, 0, newColumnFragment);
						fragNum++;
						fragLen++;
					}
				}
			}

			// Save the fixed content string, plus positioning details
			workingPage.fixed.push({
				content: _outerHTML(element),
				top:     elementTopPos,
				left:    (config.layoutDimensions.colDefaultLeft + (('left' === elementDefinition.anchorX) ? 0 : ((config.layoutDimensions.columnWidth + config.layoutDimensions.columnGap) * elementDefinition.indexedColStart)))
			});

		}

		function _normaliseFlowedElement(element) {

			var p;

			if (Node.TEXT_NODE !== element.nodeType) return;

			if (element.nodeValue.match(/^\s*$/)) {

				// A plain text node, containing only white space
				element.parentNode.removeChild(element);

			} else {

				// A plain text node, containing more than just white space.
				// Wrap it in a <p> tag
				p = document.createElement('p');

				p.appendChild(document.createTextNode(element.nodeValue));
				element.parentNode.replaceChild(p, element);
			}
		}


		function _flowContent() {

			var fixedElementDefinitions = [],
				fixedElementDefinition, i, l;

			// Initialise some variables
			pagedContent      = [];
			pagedEndContent   = [];

			indexedPageNum         =
				indexedColumnNum   =
				indexedColumnFrag  =
				borderElementIndex =
				indexedColumnNum   =
				indexedColumnFrag  =
				topElementOverflow =
				totalColumnHeight  = 0;

			// Set the maximum column height to a multiple of the lineHeight
			colDefaultBottom  = config.layoutDimensions.columnHeight + config.layoutDimensions.colDefaultTop;
			colMiddle         = config.layoutDimensions.colDefaultTop + (config.layoutDimensions.columnHeight / 2);
			minFixedPadding   = config.minFixedPadding * config.lineHeight;
			fixedPadding      = _roundUpToGrid(minFixedPadding);

			// Add each fixed element to a page in the correct position,
			// and determine the remaining free space for columns
			// Two loops are run: the first sets an explicit width on the element, therefore invalidating the layout,
			// and the second reads the element's width, forcing a recalculation of styles. This batching avoids layout thrashing.
			for (i = 0, l = fixedPreloadArea.childNodes.length; i < l; i++) {
				fixedElementDefinition = _setFixedElementHeight(fixedPreloadArea.childNodes[i]);
				if (fixedElementDefinition) fixedElementDefinitions.push(fixedElementDefinition);
			}

			for (i = 0, l = fixedElementDefinitions.length; i < l; i++) {
				_addFixedElement(fixedElementDefinitions[i]);
			}

			/* Loop through the preload elements, and determine which column to put them in */

			// Preliminary loop to remove whitespace, and wrap plain text nodes
			for (i = preloadColumn.childNodes.length - 1; i >= 0; i--) {
				_normaliseFlowedElement(preloadColumn.childNodes[i]);
			}

			if (!preloadColumn.childNodes.length) return;

			// Select the first available column for content
			_createPageObjects(indexedPageNum);

			workingPage       = pagedContent[indexedPageNum];
			workingColumn     = workingPage.columns[indexedColumnNum];
			workingColumnFrag = workingColumn.fragments[indexedColumnFrag];

			if (!workingColumnFrag) {
				_advanceWorkingColumnFragment();
			}

			// Start with the free space in the first available column
			totalColumnHeight = workingColumnFrag.height;

			// TODO:GC: Save these measurements, so there's no need to re-measure
			// when we return to an orientation we've already rendered.
			for (i = 0, l = preloadColumn.childNodes.length; i < l; i++) {
				_addFlowedElement(preloadColumn.childNodes[i], i);
			}

			// Wrap one more time, to add everything from borderElementIndex to the the final element
			_wrapColumn(l - 1, false);

			if (!config.allowReflow) {
				if (fixedPreloadArea.parentNode) fixedPreloadArea.parentNode.removeChild(fixedPreloadArea);
				fixedPreloadArea = null;

				if (preloadColumn.parentNode && preloadColumn.parentNode.parentNode) preloadColumn.parentNode.parentNode.removeChild(preloadColumn.parentNode);
				preloadColumn = null;
			}
		}

		function _addFlowedElement(element, index) {

			var originalMargin, existingMargin, nextElementOffset, elementHeight,
				newMargin, largestMargin, overflow, loopCount,

				nextElement = element.nextSibling;

			// Check if it's necessary to sanitize elements to conform to the baseline grid
			if (config.standardiseLineHeight) {

				existingMargin = parseFloat(window.getComputedStyle(element).getPropertyValue('margin-bottom'), 10);

				// If reflowing is enabled, try to read the original margin for the
				// element, in case it was already modified
				if (config.allowReflow) {
					originalMargin = parseFloat(element.getAttribute('data-cf-original-margin'), 10) || null;
					if (null === originalMargin) {
						originalMargin = existingMargin;
						element.setAttribute('data-cf-original-margin', originalMargin);
					} else if (originalMargin !== existingMargin) {

						// Return the element to its original margin
						element.style.marginBottom = originalMargin + 'px';
					}
				} else {
					originalMargin = existingMargin;
				}

				nextElementOffset = _getNextElementOffset(element, nextElement);
				elementHeight     = element.offsetHeight;

				// The next element's top is not aligned to the grid
				if (nextElementOffset % config.lineHeight) {

					// Allow for collapsing margins
					largestMargin = Math.max(existingMargin, nextElement ? parseFloat(window.getComputedStyle(nextElement).getPropertyValue('margin-top'), 10) : 0);
					newMargin     = _roundUpToGrid(elementHeight) - elementHeight + _roundUpToGrid(largestMargin);

					if (newMargin !== existingMargin) {
						element.style.marginBottom = newMargin + 'px';
					}
				}
			}

			element.offsetBottom = element.offsetTop + element.offsetHeight;

			// TODO:GC: Remove this loop-protection check
			loopCount = 0;
			while ((element.offsetBottom >= totalColumnHeight || (nextElement && nextElement.offsetTop >= totalColumnHeight)) && (loopCount++ < 30)) {

				overflow = (element.offsetBottom > totalColumnHeight);
				_wrapColumn(index, overflow);
			}

			// TODO:GC: Remove this loop-protection check
			if (loopCount >= 30) console.error('FTColumnflow: Caught and destroyed a loop when wrapping columns for element', element.outerHTML.substr(0, 200) + '...');
		}

		function _getNextElementOffset(element, nextElement) {
			if (!element.getBoundingClientRect) {
				return nextElement ? (nextElement.offsetTop - element.offsetTop) : element.offsetHeight;
			}
			return nextElement ? nextElement.getBoundingClientRect().top - element.getBoundingClientRect().top : element.getBoundingClientRect().height;
		}

		function _wrapColumn(currentElementIndex, overflow) {

			var nowrap, keepwithnext, prevElementKeepwithnext, firstInColumn, finalColumnElementIndex,
				cropCurrentElement, pushElement, pushFromElementIndex, i, lastElement, element,

				currentElement = preloadColumn.childNodes[currentElementIndex],
				nextElement    = currentElement.nextSibling,
				prevElement    = currentElement.previousSibling;

			// Determine any special classes
			nowrap                  = currentElement.classList.contains(nowrapClassName);
			keepwithnext            = currentElement.classList.contains(keepwithnextClassName);
			prevElementKeepwithnext = (prevElement && prevElement.classList.contains(keepwithnextClassName));

			// Assume nowrap if element's tag is in the noWrapOnTags list
			if (-1 !== config.noWrapOnTags.indexOf(currentElement.tagName.toLowerCase())) {
				nowrap = true;
			}

			// Is this the last element of all?
			if (!nextElement) {
				lastElement = true;
			}

			// Is this the first element of a column?
			if (currentElementIndex === borderElementIndex) {
				firstInColumn = true;
			}

			// Does the element fit if we collapse the bottom margin?
			if (currentElement.offsetBottom === totalColumnHeight) {
				overflow = false;
				if (nextElement) totalColumnHeight = nextElement.offsetTop;
			}

			// Do we need to crop the current element?
			if ((nowrap || (keepwithnext && nextElement)) && overflow && (firstInColumn)) {
				cropCurrentElement = true;
			}

			// Do we need to push the current element to the next column?
			if (!cropCurrentElement && !firstInColumn && ((nowrap && overflow) || (keepwithnext && nextElement))) {
				pushElement = true;
				pushFromElementIndex = currentElementIndex;
			}

			// Do we need to push the previous element to the next column?
			if ((currentElementIndex - 1) > borderElementIndex && prevElementKeepwithnext && overflow && nowrap) {
				pushElement = true;
				pushFromElementIndex = currentElementIndex - 1;
			}

			// Determine the final element in this column
			finalColumnElementIndex = pushElement ? pushFromElementIndex - 1 : currentElementIndex;

			if (finalColumnElementIndex < borderElementIndex) {

				// We've already added all the elements. We're finished.
				return;
			}

			// Set the overflow for the current column to the value determined in the last iteration
			workingColumnFrag.overflow = topElementOverflow;

			// Loop through all elements from the last column border element up to the current element
			for (i = borderElementIndex; i <= finalColumnElementIndex; i++) {

				element = preloadColumn.childNodes[i];

				// Add the content of the element to the column
				workingColumnFrag.elements.push({
					content: _outerHTML(element)
				});
			}

			// Determine the new border element
			if (pushElement) {
				borderElementIndex = pushFromElementIndex;
			} else if (overflow && !cropCurrentElement) {
				borderElementIndex = currentElementIndex;
			} else {
				borderElementIndex = currentElementIndex + 1;
			}

			if (pushElement) {

				// By pushing an element to the next column prematurely, white space has effectively been added to the stream of
				// column elements. Measurements will therefore be wrong unless the total column height is changed to reflect this. Set
				// the column height to be the top of the pushed element.
				totalColumnHeight = preloadColumn.childNodes[pushFromElementIndex].offsetTop;

			} else if (cropCurrentElement && nextElement) {

				// By cropping an element, white space has been removed, so adjust the
				// column height to be equal to the top of the next element.
				totalColumnHeight = nextElement.offsetTop;
			}

			// Set the required negative top margin for the first element in the next column
			if (!overflow || (nowrap || (keepwithnext && nextElement))) {
				topElementOverflow = 0;
			} else {
				topElementOverflow = totalColumnHeight - currentElement.offsetTop;
			}

			// Add the height of the next column
			_advanceWorkingColumnFragment();
			totalColumnHeight += workingColumnFrag.height;
		}


		/* Add the flowed and fixed content to the target, arranged in pages and columns */

		function _renderFlowedContent() {

			var outputHTML = '', indexedPageNum, page_len, pageHTML, page, i, l, element, indexedColumnNum,
				column_len, column, indexedColumnFrag, fragLen, el, fragment;

			for (indexedPageNum = 0, page_len = pagedContent.length; indexedPageNum < page_len; indexedPageNum++) {

				pageHTML = '';
				page     = pagedContent[indexedPageNum];

				// Add any fixed elements for this page
				for (i = 0, l = page.fixed.length; i < l; i++) {

					element = page.fixed[i];
					element.content = _addClass(element.content, fixedElementClassName);
					pageHTML += _addStyleRule(element.content, 'top:' + _round(element.top) + 'px;left:' + _round(element.left) + 'px;');
				}

				// Add flowed content for this page
				// First loop the columns
				for (indexedColumnNum = 0, column_len = page.columns.length; indexedColumnNum < column_len; indexedColumnNum++) {

					column = page.columns[indexedColumnNum];

					// Loop the column fragments
					for (indexedColumnFrag = 0, fragLen = column.fragments.length; indexedColumnFrag < fragLen; indexedColumnFrag++) {

						fragment = column.fragments[indexedColumnFrag];

						// Don't write empty columns to the page
						if (0 === fragment.elements.length) {
							continue;
						}

						// Open a column div
						pageHTML += _openColumn(fragment, indexedColumnNum);

						for (el = 0, l = fragment.elements.length; el < l; el++) {

							element = fragment.elements[el];

							// Set the top margin on the first element of the column
							if (el === 0) {

								// Set a *negative* top margin to shift the element up and hide the content already displayed
								element.content = _addStyleRule(element.content, 'margin-top:' + (-fragment.overflow) + 'px;');
							}

							pageHTML += element.content;
						}

						// Close the column
						pageHTML += '</div>';
					}
				}

				// Don't write empty pages
				if ('' === pageHTML) {
					pagedContent.splice(indexedPageNum, 1);
					indexedPageNum--;
					page_len--;
					continue;
				}

				// Add the page contents to the HTML string
				outputHTML += _openPage(indexedPageNum) + pageHTML + '</div>';
			}

			// Add any end pages
			for (indexedPageNum = 0, page_len = pagedEndContent.length; indexedPageNum < page_len; indexedPageNum++) {
				pageHTML = '';
				page     = pagedEndContent[indexedPageNum];

				for (i = 0, l = page.fixed.length; i < l; i++) {

					element = page.fixed[i];
					element.content = _addClass(element.content, fixedElementClassName);
					pageHTML += _addStyleRule(element.content, 'top:' + _round(element.top) + 'px;left:' + _round(element.left) + 'px;');
				}

				// Add the page contents to the HTML string
				outputHTML += _openPage(pagedContent.length + indexedPageNum) + pageHTML + '</div>';
			}

			renderArea.innerHTML = outputHTML;
			page_len = pagedContent.length + pagedEndContent.length;

			// Set an explicit width on the target - not necessary but will allow adjacent content to flow around the flowed columns normally
			that.target.style.width = (config.viewportWidth * page_len) + 'px';

			// Update the instance page counter
			that.pagedContentCount = page_len;
		}


		/* Private methods */

		function _addClass(element, className) {

			// Modify the opening tag of the element
			return element.replace(/<(\w+)([^>]*)>/, function _addRuleToTag(string, tag, attributes) {

				// If there's not yet a style attribute, add one
				if (!string.match(/class\s*=/)) {
					string = '<' + tag + ' class="" ' + attributes + '>';
				}

				// Add the class name
				string = string.replace(/class=(["'])/, 'class=$1 ' + className + ' ');
				return string;
			});
		}


		function _addStyleRule(element, rule) {

			// Modify the opening tag of the element
			return element.replace(/<(\w+)([^>]*)>/, function _addRuleToTag(string, tag, attributes) {

				// If there's not yet a style attribute, add one
				if (!string.match(/style\s*=/)) {
					string = '<' + tag + ' style="" ' + attributes + '>';
				}

				// Add the style rule
				string = string.replace(/style=(["'])/, 'style=$1 ' + rule);
				return string;
			});
		}


		function _roundDownToGrid(val, addPadding) {
			var resized = val - (val % config.lineHeight);

			// If the difference after rounding down is less than the minimum padding, also subtract one grid line
			if (addPadding && ((val - resized) < minFixedPadding)) {
				resized -= fixedPadding;
			}

			return resized;
		}


		function _roundUpToGrid(val, addPadding) {

			var delta   = val % config.lineHeight,
				resized = (delta ? (val - delta + config.lineHeight) : val);

			// If the difference after rounding up is less than the minimum padding, also add one grid line
			if (addPadding && ((resized - val) < minFixedPadding)) {
				resized += fixedPadding;
			}

			return resized;
		}

		function _round(val) {
			return Math.round(val * 100) / 100;
		}

		function _replaceStringTokens(string, tokens) {
			return string.replace(/\[(\w+)\]/g,
				function _replace(a, b) {
					var r = tokens[b];
					return typeof r === 'string' || typeof r === 'number' ? r : a;
				});
		}


		function _normaliseClassName(type, value) {

			if (typeof value !== 'string') {
				throw new FTColumnflowException('ClassnameException', type + ' must be a string.');
			}

			return value.replace(/[^\w]/g, '-');
		}


		function _createPageObjects(indexedPageNum) {
			var pageNum, indexedColNum;

			for (pageNum = pagedContent.length; pageNum <= indexedPageNum; pageNum++) {

				pagedContent.push({
					'fixed':    [],
					'columns':  []
				});

				for (indexedColNum = 0; indexedColNum < config.layoutDimensions.columnCount; indexedColNum++) {
					pagedContent[pageNum].columns.push({
						fragments: [_createColumnFragment()]
					});
				}
			}
		}


		function _createColumnFragment() {

			return {
				elements:    [],
				overflow:    0,
				height:      config.layoutDimensions.columnHeight,
				top:         config.layoutDimensions.colDefaultTop,
				bottom:      colDefaultBottom
			};
		}


		function _advanceWorkingColumnFragment() {

			// Advance the fragment counter and check for another fragment
			if (!workingColumn.fragments[++indexedColumnFrag]) {
				indexedColumnFrag = 0;

				// Advance the column counter and check for another column
				if (!workingPage.columns[++indexedColumnNum]) {
					indexedColumnNum = 0;

					// Advance the page counter and create another page if necessary
					indexedPageNum++;
					_createPageObjects(indexedPageNum);
				}
			}

			workingPage       = pagedContent[indexedPageNum];
			workingColumn     = workingPage.columns[indexedColumnNum];
			workingColumnFrag = workingColumn.fragments[indexedColumnFrag];

			if (!workingColumnFrag) {
				_advanceWorkingColumnFragment();
			}
		}


		function _openPage(indexedPageNum) {
			var pagePos;

			if ('horizontal' === config.pageArrangement) {
				pagePos = 'left: ' + (indexedPageNum * config.viewportWidth) + 'px;';
			} else {
				pagePos = 'top: ' + (indexedPageNum * config.viewportHeight) + 'px;';
			}

			return '<div class="' + config.pageClass + ' ' + config.pageClass + '-' + (indexedPageNum + 1) + '" style="' + pagePos + '">';
		}


		function _openColumn(column, indexedColumnNum) {
			return '<div class="' + config.columnClass + ' ' + config.columnClass + '-' + (indexedColumnNum + 1) + '" style="height: ' + _round(column.height) + 'px; top: ' + _round(column.top) + 'px;">';
		}


		function _mode(array) {

			var modeMap = {},
				maxEl, maxCount, i, el;

			if (array.length === 0) {
				return null;
			}

			maxEl = array[0];
			maxCount = 1;

			for (i = 0; i < array.length; i++) {
				el = array[i];
				if (modeMap[el] === undefined) {
					modeMap[el] = 1;
				} else {
					modeMap[el]++;
				}
				if (modeMap[el] > maxCount) {
					maxEl = el;
					maxCount = modeMap[el];
				}
			}
			return maxEl;
		}


		/* Public methods */

		this.flow = function(flowed, fixed) {

			flowedContent = flowed;
			fixedContent  = fixed;

			_writeTargetStyles();
			_createTargetElements();

			_findLineHeight();
			_flowContent();
			_renderFlowedContent();
		};

		this.reflow = function(newConfig) {

			if (!config.allowReflow) {
				throw new FTColumnflowException('ReflowException', 'reflow() was called but "allowReflow" config option was false.');
			}

			if (newConfig) {
				_setConfig(newConfig);
			}

			_setLayoutDimensions();
			_writeTargetStyles();

			_findLineHeight();
			_flowContent();
			_renderFlowedContent();
		};

		this.destroy = function() {

			if (headerStyles) {
				headerStyles.parentNode.removeChild(headerStyles);
				headerStyles = null;
			}

			if (that.target) {
				that.target.parentNode.removeChild(that.target);
				that.target = null;
			}
		};
	}

	FTColumnflow.prototype = {
		get layoutDimensions() {
			return this.config.layoutDimensions;
		},
		set layoutDimensions(value) {
			throw new FTColumnflowException('SetterException', 'Setter not defined for layoutDimensions.');
		},
		get pageClass() {
			return this.config.pageClass;
		},
		set pageClass(value) {
			throw new FTColumnflowException('SetterException', 'Setter not defined for pageClass.');
		},
		get columnClass() {
			return this.config.columnClass;
		},
		set columnClass(value) {
			throw new FTColumnflowException('SetterException', 'Setter not defined for columnClass.');
		},
		get pageCount() {
			return this.pagedContentCount;
		},
		set pageCount(value) {
			throw new FTColumnflowException('SetterException', 'Setter not defined for pageCount.');
		},

		_checkInstanceArgs: function () {

			var that = this;

			// Check type of required target and viewport parameters
			['target', 'viewport'].forEach(function _checkArg(name) {

				var arg = that[name];

				switch (typeof arg) {

					case 'string':

						arg = document.getElementById(arg);
						if (!arg) throw new FTColumnflowException('SelectorException', name + ' must be a valid DOM element.');
						break;

					case 'object':
						if (!(arg instanceof HTMLElement)) {
							throw new FTColumnflowException('ParameterException', name + ' must be a string ID or DOM element.');
						}
						break;

					default:
						throw new FTColumnflowException('ParameterException', name + ' must be a string ID or DOM element.');
				}

				that[name] = arg;
			});

			// Check target is a child of viewport
			if (this.viewport.compareDocumentPosition(this.target) < this.viewport.DOCUMENT_POSITION_CONTAINED_BY) {
				throw new FTColumnflowException('InheritanceException', 'Target element must be a child of the viewport.');
			}

			// Ensure we have an empty target
			while (this.target.lastChild) {
				this.target.removeChild(this.target.lastChild);
			}
		}
	};

	module.exports = FTColumnflow;

// Close UMD
});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('FTColumnflow',this));

/*
 Highcharts JS v4.1.6 (2015-06-12)

 (c) 2009-2014 Torstein Honsi

 License: www.highcharts.com/license
*/
(function(){function A(){var a,b=arguments,c,d={},e=function(a,b){var c,d;typeof a!=="object"&&(a={});for(d in b)b.hasOwnProperty(d)&&(c=b[d],a[d]=c&&typeof c==="object"&&Object.prototype.toString.call(c)!=="[object Array]"&&d!=="renderTo"&&typeof c.nodeType!=="number"?e(a[d]||{},c):b[d]);return a};b[0]===!0&&(d=b[1],b=Array.prototype.slice.call(b,2));c=b.length;for(a=0;a<c;a++)d=e(d,b[a]);return d}function F(a,b){return parseInt(a,b||10)}function Da(a){return typeof a==="string"}function da(a){return a&&
typeof a==="object"}function Ha(a){return Object.prototype.toString.call(a)==="[object Array]"}function ra(a){return typeof a==="number"}function Ea(a){return W.log(a)/W.LN10}function ia(a){return W.pow(10,a)}function ja(a,b){for(var c=a.length;c--;)if(a[c]===b){a.splice(c,1);break}}function q(a){return a!==y&&a!==null}function J(a,b,c){var d,e;if(Da(b))q(c)?a.setAttribute(b,c):a&&a.getAttribute&&(e=a.getAttribute(b));else if(q(b)&&da(b))for(d in b)a.setAttribute(d,b[d]);return e}function sa(a){return Ha(a)?
a:[a]}function L(a,b){if(ya&&!ca&&b&&b.opacity!==y)b.filter="alpha(opacity="+b.opacity*100+")";x(a.style,b)}function $(a,b,c,d,e){a=B.createElement(a);b&&x(a,b);e&&L(a,{padding:0,border:O,margin:0});c&&L(a,c);d&&d.appendChild(a);return a}function ka(a,b){var c=function(){return y};c.prototype=new a;x(c.prototype,b);return c}function Ia(a,b){return Array((b||2)+1-String(a).length).join(0)+a}function Wa(a){return(eb&&eb(a)||ob||0)*6E4}function Ja(a,b){for(var c="{",d=!1,e,f,g,h,i,j=[];(c=a.indexOf(c))!==
-1;){e=a.slice(0,c);if(d){f=e.split(":");g=f.shift().split(".");i=g.length;e=b;for(h=0;h<i;h++)e=e[g[h]];if(f.length)f=f.join(":"),g=/\.([0-9])/,h=T.lang,i=void 0,/f$/.test(f)?(i=(i=f.match(g))?i[1]:-1,e!==null&&(e=z.numberFormat(e,i,h.decimalPoint,f.indexOf(",")>-1?h.thousandsSep:""))):e=Oa(f,e)}j.push(e);a=a.slice(c+1);c=(d=!d)?"}":"{"}j.push(a);return j.join("")}function pb(a){return W.pow(10,V(W.log(a)/W.LN10))}function qb(a,b,c,d,e){var f,g=a,c=p(c,1);f=a/c;b||(b=[1,2,2.5,5,10],d===!1&&(c===
1?b=[1,2,5,10]:c<=0.1&&(b=[1/c])));for(d=0;d<b.length;d++)if(g=b[d],e&&g*c>=a||!e&&f<=(b[d]+(b[d+1]||b[d]))/2)break;g*=c;return g}function rb(a,b){var c=a.length,d,e;for(e=0;e<c;e++)a[e].ss_i=e;a.sort(function(a,c){d=b(a,c);return d===0?a.ss_i-c.ss_i:d});for(e=0;e<c;e++)delete a[e].ss_i}function Pa(a){for(var b=a.length,c=a[0];b--;)a[b]<c&&(c=a[b]);return c}function Fa(a){for(var b=a.length,c=a[0];b--;)a[b]>c&&(c=a[b]);return c}function Qa(a,b){for(var c in a)a[c]&&a[c]!==b&&a[c].destroy&&a[c].destroy(),
delete a[c]}function Ra(a){fb||(fb=$(Ka));a&&fb.appendChild(a);fb.innerHTML=""}function la(a,b){var c="Highcharts error #"+a+": www.highcharts.com/errors/"+a;if(b)throw c;K.console&&console.log(c)}function ea(a){return parseFloat(a.toPrecision(14))}function Sa(a,b){za=p(a,b.animation)}function Cb(){var a=T.global,b=a.useUTC,c=b?"getUTC":"get",d=b?"setUTC":"set";Aa=a.Date||window.Date;ob=b&&a.timezoneOffset;eb=b&&a.getTimezoneOffset;gb=function(a,c,d,h,i,j){var k;b?(k=Aa.UTC.apply(0,arguments),k+=
Wa(k)):k=(new Aa(a,c,p(d,1),p(h,0),p(i,0),p(j,0))).getTime();return k};sb=c+"Minutes";tb=c+"Hours";ub=c+"Day";Xa=c+"Date";Ya=c+"Month";Za=c+"FullYear";Db=d+"Milliseconds";Eb=d+"Seconds";Fb=d+"Minutes";Gb=d+"Hours";vb=d+"Date";wb=d+"Month";xb=d+"FullYear"}function P(){}function Ta(a,b,c,d){this.axis=a;this.pos=b;this.type=c||"";this.isNew=!0;!c&&!d&&this.addLabel()}function Hb(a,b,c,d,e){var f=a.chart.inverted;this.axis=a;this.isNegative=c;this.options=b;this.x=d;this.total=null;this.points={};this.stack=
e;this.alignOptions={align:b.align||(f?c?"left":"right":"center"),verticalAlign:b.verticalAlign||(f?"middle":c?"bottom":"top"),y:p(b.y,f?4:c?14:-6),x:p(b.x,f?c?-6:6:0)};this.textAlign=b.textAlign||(f?c?"right":"left":"center")}var y,B=document,K=window,W=Math,s=W.round,V=W.floor,ta=W.ceil,v=W.max,C=W.min,N=W.abs,X=W.cos,aa=W.sin,ma=W.PI,ha=ma*2/360,Ba=navigator.userAgent,Ib=K.opera,ya=/(msie|trident)/i.test(Ba)&&!Ib,hb=B.documentMode===8,ib=/AppleWebKit/.test(Ba),La=/Firefox/.test(Ba),Jb=/(Mobile|Android|Windows Phone)/.test(Ba),
Ca="http://www.w3.org/2000/svg",ca=!!B.createElementNS&&!!B.createElementNS(Ca,"svg").createSVGRect,Nb=La&&parseInt(Ba.split("Firefox/")[1],10)<4,fa=!ca&&!ya&&!!B.createElement("canvas").getContext,$a,ab,Kb={},yb=0,fb,T,Oa,za,zb,D,na=function(){return y},Y=[],bb=0,Ka="div",O="none",Ob=/^[0-9]+$/,jb=["plotTop","marginRight","marginBottom","plotLeft"],Pb="stroke-width",Aa,gb,ob,eb,sb,tb,ub,Xa,Ya,Za,Db,Eb,Fb,Gb,vb,wb,xb,M={},z;z=K.Highcharts=K.Highcharts?la(16,!0):{};z.seriesTypes=M;var x=z.extend=function(a,
b){var c;a||(a={});for(c in b)a[c]=b[c];return a},p=z.pick=function(){var a=arguments,b,c,d=a.length;for(b=0;b<d;b++)if(c=a[b],c!==y&&c!==null)return c},cb=z.wrap=function(a,b,c){var d=a[b];a[b]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(d);return c.apply(this,a)}};Oa=function(a,b,c){if(!q(b)||isNaN(b))return"Invalid date";var a=p(a,"%Y-%m-%d %H:%M:%S"),d=new Aa(b-Wa(b)),e,f=d[tb](),g=d[ub](),h=d[Xa](),i=d[Ya](),j=d[Za](),k=T.lang,l=k.weekdays,d=x({a:l[g].substr(0,3),A:l[g],
d:Ia(h),e:h,w:g,b:k.shortMonths[i],B:k.months[i],m:Ia(i+1),y:j.toString().substr(2,2),Y:j,H:Ia(f),I:Ia(f%12||12),l:f%12||12,M:Ia(d[sb]()),p:f<12?"AM":"PM",P:f<12?"am":"pm",S:Ia(d.getSeconds()),L:Ia(s(b%1E3),3)},z.dateFormats);for(e in d)for(;a.indexOf("%"+e)!==-1;)a=a.replace("%"+e,typeof d[e]==="function"?d[e](b):d[e]);return c?a.substr(0,1).toUpperCase()+a.substr(1):a};D={millisecond:1,second:1E3,minute:6E4,hour:36E5,day:864E5,week:6048E5,month:24192E5,year:314496E5};z.numberFormat=function(a,b,
c,d){var e=T.lang,a=+a||0,f=b===-1?C((a.toString().split(".")[1]||"").length,20):isNaN(b=N(b))?2:b,b=c===void 0?e.decimalPoint:c,d=d===void 0?e.thousandsSep:d,e=a<0?"-":"",c=String(F(a=N(a).toFixed(f))),g=c.length>3?c.length%3:0;return e+(g?c.substr(0,g)+d:"")+c.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(f?b+N(a-c).toFixed(f).slice(2):"")};zb={init:function(a,b,c){var b=b||"",d=a.shift,e=b.indexOf("C")>-1,f=e?7:3,g,b=b.split(" "),c=[].concat(c),h,i,j=function(a){for(g=a.length;g--;)a[g]==="M"&&a.splice(g+
1,0,a[g+1],a[g+2],a[g+1],a[g+2])};e&&(j(b),j(c));a.isArea&&(h=b.splice(b.length-6,6),i=c.splice(c.length-6,6));if(d<=c.length/f&&b.length===c.length)for(;d--;)c=[].concat(c).splice(0,f).concat(c);a.shift=0;if(b.length)for(a=c.length;b.length<a;)d=[].concat(b).splice(b.length-f,f),e&&(d[f-6]=d[f-2],d[f-5]=d[f-1]),b=b.concat(d);h&&(b=b.concat(h),c=c.concat(i));return[b,c]},step:function(a,b,c,d){var e=[],f=a.length;if(c===1)e=d;else if(f===b.length&&c<1)for(;f--;)d=parseFloat(a[f]),e[f]=isNaN(d)?a[f]:
c*parseFloat(b[f]-d)+d;else e=b;return e}};(function(a){K.HighchartsAdapter=K.HighchartsAdapter||a&&{init:function(b){var c=a.fx;a.extend(a.easing,{easeOutQuad:function(a,b,c,g,h){return-g*(b/=h)*(b-2)+c}});a.each(["cur","_default","width","height","opacity"],function(b,e){var f=c.step,g;e==="cur"?f=c.prototype:e==="_default"&&a.Tween&&(f=a.Tween.propHooks[e],e="set");(g=f[e])&&(f[e]=function(a){var c,a=b?a:this;if(a.prop!=="align")return c=a.elem,c.attr?c.attr(a.prop,e==="cur"?y:a.now):g.apply(this,
arguments)})});cb(a.cssHooks.opacity,"get",function(a,b,c){return b.attr?b.opacity||0:a.call(this,b,c)});this.addAnimSetter("d",function(a){var c=a.elem,f;if(!a.started)f=b.init(c,c.d,c.toD),a.start=f[0],a.end=f[1],a.started=!0;c.attr("d",b.step(a.start,a.end,a.pos,c.toD))});this.each=Array.prototype.forEach?function(a,b){return Array.prototype.forEach.call(a,b)}:function(a,b){var c,g=a.length;for(c=0;c<g;c++)if(b.call(a[c],a[c],c,a)===!1)return c};a.fn.highcharts=function(){var a="Chart",b=arguments,
c,g;if(this[0]){Da(b[0])&&(a=b[0],b=Array.prototype.slice.call(b,1));c=b[0];if(c!==y)c.chart=c.chart||{},c.chart.renderTo=this[0],new z[a](c,b[1]),g=this;c===y&&(g=Y[J(this[0],"data-highcharts-chart")])}return g}},addAnimSetter:function(b,c){a.Tween?a.Tween.propHooks[b]={set:c}:a.fx.step[b]=c},getScript:a.getScript,inArray:a.inArray,adapterRun:function(b,c){return a(b)[c]()},grep:a.grep,map:function(a,c){for(var d=[],e=0,f=a.length;e<f;e++)d[e]=c.call(a[e],a[e],e,a);return d},offset:function(b){return a(b).offset()},
addEvent:function(b,c,d){a(b).bind(c,d)},removeEvent:function(b,c,d){var e=B.removeEventListener?"removeEventListener":"detachEvent";B[e]&&b&&!b[e]&&(b[e]=function(){});a(b).unbind(c,d)},fireEvent:function(b,c,d,e){var f=a.Event(c),g="detached"+c,h;!ya&&d&&(delete d.layerX,delete d.layerY,delete d.returnValue);x(f,d);b[c]&&(b[g]=b[c],b[c]=null);a.each(["preventDefault","stopPropagation"],function(a,b){var c=f[b];f[b]=function(){try{c.call(f)}catch(a){b==="preventDefault"&&(h=!0)}}});a(b).trigger(f);
b[g]&&(b[c]=b[g],b[g]=null);e&&!f.isDefaultPrevented()&&!h&&e(f)},washMouseEvent:function(a){var c=a.originalEvent||a;if(c.pageX===y)c.pageX=a.pageX,c.pageY=a.pageY;return c},animate:function(b,c,d){var e=a(b);if(!b.style)b.style={};if(c.d)b.toD=c.d,c.d=1;e.stop();c.opacity!==y&&b.attr&&(c.opacity+="px");b.hasAnim=1;e.animate(c,d)},stop:function(b){b.hasAnim&&a(b).stop()}}})(K.jQuery);var U=K.HighchartsAdapter,E=U||{};U&&U.init.call(U,zb);var kb=E.adapterRun,Qb=E.getScript,Ma=E.inArray,o=z.each=E.each,
lb=E.grep,Rb=E.offset,Ua=E.map,H=E.addEvent,Z=E.removeEvent,I=E.fireEvent,Sb=E.washMouseEvent,mb=E.animate,db=E.stop;T={colors:"#7cb5ec,#434348,#90ed7d,#f7a35c,#8085e9,#f15c80,#e4d354,#2b908f,#f45b5b,#91e8e1".split(","),symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),
decimalPoint:".",numericSymbols:"k,M,G,T,P,E".split(","),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:" "},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/4.1.6/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/4.1.6/gfx/vml-radial-gradient.png"},chart:{borderColor:"#4572A7",borderRadius:0,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacing:[10,10,15,10],backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0",resetZoomButton:{theme:{zIndex:20},
position:{align:"right",x:-10,y:10}}},title:{text:"Chart title",align:"center",margin:15,style:{color:"#333333",fontSize:"18px"}},subtitle:{text:"",align:"center",style:{color:"#555555"}},plotOptions:{line:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1E3},events:{},lineWidth:2,marker:{lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0,lineWidthPlus:1,radiusPlus:2},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{align:"center",
formatter:function(){return this.y===null?"":z.numberFormat(this.y,-1)},style:{color:"contrast",fontSize:"11px",fontWeight:"bold",textShadow:"0 0 6px contrast, 0 0 3px contrast"},verticalAlign:"bottom",x:0,y:0,padding:5},cropThreshold:300,pointRange:0,states:{hover:{lineWidthPlus:1,marker:{},halo:{size:10,opacity:0.25}},select:{marker:{}}},stickyTracking:!0,turboThreshold:1E3}},labels:{style:{position:"absolute",color:"#3E576F"}},legend:{enabled:!0,align:"center",layout:"horizontal",labelFormatter:function(){return this.name},
borderColor:"#909090",borderRadius:0,navigation:{activeColor:"#274b6d",inactiveColor:"#CCC"},shadow:!1,itemStyle:{color:"#333333",fontSize:"12px",fontWeight:"bold"},itemHoverStyle:{color:"#000"},itemHiddenStyle:{color:"#CCC"},itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"white",opacity:0.5,
textAlign:"center"}},tooltip:{enabled:!0,animation:ca,backgroundColor:"rgba(249, 249, 249, .85)",borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},footerFormat:"",headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.y}</b><br/>',
shadow:!0,snap:Jb?25:10,style:{color:"#333333",cursor:"default",fontSize:"12px",padding:"8px",whiteSpace:"nowrap"}},credits:{enabled:!0,text:"",href:"",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#909090",fontSize:"9px"}}};var ba=T.plotOptions,U=ba.line;Cb();var Tb=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,Ub=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,
Vb=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,oa=function(a){var b=[],c,d;(function(a){a&&a.stops?d=Ua(a.stops,function(a){return oa(a[1])}):(c=Tb.exec(a))?b=[F(c[1]),F(c[2]),F(c[3]),parseFloat(c[4],10)]:(c=Ub.exec(a))?b=[F(c[1],16),F(c[2],16),F(c[3],16),1]:(c=Vb.exec(a))&&(b=[F(c[1]),F(c[2]),F(c[3]),1])})(a);return{get:function(c){var f;d?(f=A(a),f.stops=[].concat(f.stops),o(d,function(a,b){f.stops[b]=[f.stops[b][0],a.get(c)]})):f=b&&!isNaN(b[0])?c==="rgb"?"rgb("+b[0]+","+
b[1]+","+b[2]+")":c==="a"?b[3]:"rgba("+b.join(",")+")":a;return f},brighten:function(a){if(d)o(d,function(b){b.brighten(a)});else if(ra(a)&&a!==0){var c;for(c=0;c<3;c++)b[c]+=F(a*255),b[c]<0&&(b[c]=0),b[c]>255&&(b[c]=255)}return this},rgba:b,setOpacity:function(a){b[3]=a;return this},raw:a}};P.prototype={opacity:1,textProps:"fontSize,fontWeight,fontFamily,fontStyle,color,lineHeight,width,textDecoration,textShadow".split(","),init:function(a,b){this.element=b==="span"?$(b):B.createElementNS(Ca,b);
this.renderer=a},animate:function(a,b,c){b=p(b,za,!0);db(this);if(b){b=A(b,{});if(c)b.complete=c;mb(this,a,b)}else this.attr(a),c&&c();return this},colorGradient:function(a,b,c){var d=this.renderer,e,f,g,h,i,j,k,l,m,n,u=[];a.linearGradient?f="linearGradient":a.radialGradient&&(f="radialGradient");if(f){g=a[f];h=d.gradients;j=a.stops;m=c.radialReference;Ha(g)&&(a[f]=g={x1:g[0],y1:g[1],x2:g[2],y2:g[3],gradientUnits:"userSpaceOnUse"});f==="radialGradient"&&m&&!q(g.gradientUnits)&&(g=A(g,{cx:m[0]-m[2]/
2+g.cx*m[2],cy:m[1]-m[2]/2+g.cy*m[2],r:g.r*m[2],gradientUnits:"userSpaceOnUse"}));for(n in g)n!=="id"&&u.push(n,g[n]);for(n in j)u.push(j[n]);u=u.join(",");h[u]?a=h[u].attr("id"):(g.id=a="highcharts-"+yb++,h[u]=i=d.createElement(f).attr(g).add(d.defs),i.stops=[],o(j,function(a){a[1].indexOf("rgba")===0?(e=oa(a[1]),k=e.get("rgb"),l=e.get("a")):(k=a[1],l=1);a=d.createElement("stop").attr({offset:a[0],"stop-color":k,"stop-opacity":l}).add(i);i.stops.push(a)}));c.setAttribute(b,"url("+d.url+"#"+a+")")}},
applyTextShadow:function(a){var b=this.element,c,d=a.indexOf("contrast")!==-1,e={},f=this.renderer.forExport||b.style.textShadow!==y&&!ya;if(d)e.textShadow=a=a.replace(/contrast/g,this.renderer.getContrast(b.style.fill));if(ib)e.textRendering="geometricPrecision";f?L(b,e):(this.fakeTS=!0,this.ySetter=this.xSetter,c=[].slice.call(b.getElementsByTagName("tspan")),o(a.split(/\s?,\s?/g),function(a){var d=b.firstChild,e,f,a=a.split(" ");e=a[a.length-1];(f=a[a.length-2])&&o(c,function(a,c){var g;c===0&&
(a.setAttribute("x",b.getAttribute("x")),c=b.getAttribute("y"),a.setAttribute("y",c||0),c===null&&b.setAttribute("y",0));g=a.cloneNode(1);J(g,{"class":"highcharts-text-shadow",fill:e,stroke:e,"stroke-opacity":1/v(F(f),3),"stroke-width":f,"stroke-linejoin":"round"});b.insertBefore(g,d)})}))},attr:function(a,b){var c,d,e=this.element,f,g=this,h;typeof a==="string"&&b!==y&&(c=a,a={},a[c]=b);if(typeof a==="string")g=(this[a+"Getter"]||this._defaultGetter).call(this,a,e);else{for(c in a){d=a[c];h=!1;this.symbolName&&
/^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(c)&&(f||(this.symbolAttr(a),f=!0),h=!0);if(this.rotation&&(c==="x"||c==="y"))this.doTransform=!0;h||(this[c+"Setter"]||this._defaultSetter).call(this,d,c,e);this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(c)&&this.updateShadows(c,d)}if(this.doTransform)this.updateTransform(),this.doTransform=!1}return g},updateShadows:function(a,b){for(var c=this.shadows,d=c.length;d--;)c[d].setAttribute(a,a==="height"?v(b-(c[d].cutHeight||
0),0):a==="d"?this.d:b)},addClass:function(a){var b=this.element,c=J(b,"class")||"";c.indexOf(a)===-1&&J(b,"class",c+" "+a);return this},symbolAttr:function(a){var b=this;o("x,y,r,start,end,width,height,innerR,anchorX,anchorY".split(","),function(c){b[c]=p(a[c],b[c])});b.attr({d:b.renderer.symbols[b.symbolName](b.x,b.y,b.width,b.height,b)})},clip:function(a){return this.attr("clip-path",a?"url("+this.renderer.url+"#"+a.id+")":O)},crisp:function(a){var b,c={},d,e=a.strokeWidth||this.strokeWidth||0;
d=s(e)%2/2;a.x=V(a.x||this.x||0)+d;a.y=V(a.y||this.y||0)+d;a.width=V((a.width||this.width||0)-2*d);a.height=V((a.height||this.height||0)-2*d);a.strokeWidth=e;for(b in a)this[b]!==a[b]&&(this[b]=c[b]=a[b]);return c},css:function(a){var b=this.styles,c={},d=this.element,e,f,g="";e=!b;if(a&&a.color)a.fill=a.color;if(b)for(f in a)a[f]!==b[f]&&(c[f]=a[f],e=!0);if(e){e=this.textWidth=a&&a.width&&d.nodeName.toLowerCase()==="text"&&F(a.width)||this.textWidth;b&&(a=x(b,c));this.styles=a;e&&(fa||!ca&&this.renderer.forExport)&&
delete a.width;if(ya&&!ca)L(this.element,a);else{b=function(a,b){return"-"+b.toLowerCase()};for(f in a)g+=f.replace(/([A-Z])/g,b)+":"+a[f]+";";J(d,"style",g)}e&&this.added&&this.renderer.buildText(this)}return this},on:function(a,b){var c=this,d=c.element;ab&&a==="click"?(d.ontouchstart=function(a){c.touchEventFired=Aa.now();a.preventDefault();b.call(d,a)},d.onclick=function(a){(Ba.indexOf("Android")===-1||Aa.now()-(c.touchEventFired||0)>1100)&&b.call(d,a)}):d["on"+a]=b;return this},setRadialReference:function(a){this.element.radialReference=
a;return this},translate:function(a,b){return this.attr({translateX:a,translateY:b})},invert:function(){this.inverted=!0;this.updateTransform();return this},updateTransform:function(){var a=this.translateX||0,b=this.translateY||0,c=this.scaleX,d=this.scaleY,e=this.inverted,f=this.rotation,g=this.element;e&&(a+=this.attr("width"),b+=this.attr("height"));a=["translate("+a+","+b+")"];e?a.push("rotate(90) scale(-1,1)"):f&&a.push("rotate("+f+" "+(g.getAttribute("x")||0)+" "+(g.getAttribute("y")||0)+")");
(q(c)||q(d))&&a.push("scale("+p(c,1)+" "+p(d,1)+")");a.length&&g.setAttribute("transform",a.join(" "))},toFront:function(){var a=this.element;a.parentNode.appendChild(a);return this},align:function(a,b,c){var d,e,f,g,h={};e=this.renderer;f=e.alignedObjects;if(a){if(this.alignOptions=a,this.alignByTranslate=b,!c||Da(c))this.alignTo=d=c||"renderer",ja(f,this),f.push(this),c=null}else a=this.alignOptions,b=this.alignByTranslate,d=this.alignTo;c=p(c,e[d],e);d=a.align;e=a.verticalAlign;f=(c.x||0)+(a.x||
0);g=(c.y||0)+(a.y||0);if(d==="right"||d==="center")f+=(c.width-(a.width||0))/{right:1,center:2}[d];h[b?"translateX":"x"]=s(f);if(e==="bottom"||e==="middle")g+=(c.height-(a.height||0))/({bottom:1,middle:2}[e]||1);h[b?"translateY":"y"]=s(g);this[this.placed?"animate":"attr"](h);this.placed=!0;this.alignAttr=h;return this},getBBox:function(a){var b,c=this.renderer,d,e=this.rotation,f=this.element,g=this.styles,h=e*ha;d=this.textStr;var i,j=f.style,k,l;d!==y&&(l=["",e||0,g&&g.fontSize,f.style.width].join(","),
l=d===""||Ob.test(d)?"num:"+d.toString().length+l:d+l);l&&!a&&(b=c.cache[l]);if(!b){if(f.namespaceURI===Ca||c.forExport){try{k=this.fakeTS&&function(a){o(f.querySelectorAll(".highcharts-text-shadow"),function(b){b.style.display=a})},La&&j.textShadow?(i=j.textShadow,j.textShadow=""):k&&k(O),b=f.getBBox?x({},f.getBBox()):{width:f.offsetWidth,height:f.offsetHeight},i?j.textShadow=i:k&&k("")}catch(m){}if(!b||b.width<0)b={width:0,height:0}}else b=this.htmlGetBBox();if(c.isSVG){a=b.width;d=b.height;if(ya&&
g&&g.fontSize==="11px"&&d.toPrecision(3)==="16.9")b.height=d=14;if(e)b.width=N(d*aa(h))+N(a*X(h)),b.height=N(d*X(h))+N(a*aa(h))}c.cache[l]=b}return b},show:function(a){a&&this.element.namespaceURI===Ca?this.element.removeAttribute("visibility"):this.attr({visibility:a?"inherit":"visible"});return this},hide:function(){return this.attr({visibility:"hidden"})},fadeOut:function(a){var b=this;b.animate({opacity:0},{duration:a||150,complete:function(){b.attr({y:-9999})}})},add:function(a){var b=this.renderer,
c=this.element,d;if(a)this.parentGroup=a;this.parentInverted=a&&a.inverted;this.textStr!==void 0&&b.buildText(this);this.added=!0;if(!a||a.handleZ||this.zIndex)d=this.zIndexSetter();d||(a?a.element:b.box).appendChild(c);if(this.onAdd)this.onAdd();return this},safeRemoveChild:function(a){var b=a.parentNode;b&&b.removeChild(a)},destroy:function(){var a=this,b=a.element||{},c=a.shadows,d=a.renderer.isSVG&&b.nodeName==="SPAN"&&a.parentGroup,e,f;b.onclick=b.onmouseout=b.onmouseover=b.onmousemove=b.point=
null;db(a);if(a.clipPath)a.clipPath=a.clipPath.destroy();if(a.stops){for(f=0;f<a.stops.length;f++)a.stops[f]=a.stops[f].destroy();a.stops=null}a.safeRemoveChild(b);for(c&&o(c,function(b){a.safeRemoveChild(b)});d&&d.div&&d.div.childNodes.length===0;)b=d.parentGroup,a.safeRemoveChild(d.div),delete d.div,d=b;a.alignTo&&ja(a.renderer.alignedObjects,a);for(e in a)delete a[e];return null},shadow:function(a,b,c){var d=[],e,f,g=this.element,h,i,j,k;if(a){i=p(a.width,3);j=(a.opacity||0.15)/i;k=this.parentInverted?
"(-1,-1)":"("+p(a.offsetX,1)+", "+p(a.offsetY,1)+")";for(e=1;e<=i;e++){f=g.cloneNode(0);h=i*2+1-2*e;J(f,{isShadow:"true",stroke:a.color||"black","stroke-opacity":j*e,"stroke-width":h,transform:"translate"+k,fill:O});if(c)J(f,"height",v(J(f,"height")-h,0)),f.cutHeight=h;b?b.element.appendChild(f):g.parentNode.insertBefore(f,g);d.push(f)}this.shadows=d}return this},xGetter:function(a){this.element.nodeName==="circle"&&(a={x:"cx",y:"cy"}[a]||a);return this._defaultGetter(a)},_defaultGetter:function(a){a=
p(this[a],this.element?this.element.getAttribute(a):null,0);/^[\-0-9\.]+$/.test(a)&&(a=parseFloat(a));return a},dSetter:function(a,b,c){a&&a.join&&(a=a.join(" "));/(NaN| {2}|^$)/.test(a)&&(a="M 0 0");c.setAttribute(b,a);this[b]=a},dashstyleSetter:function(a){var b;if(a=a&&a.toLowerCase()){a=a.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,
"").split(",");for(b=a.length;b--;)a[b]=F(a[b])*this["stroke-width"];a=a.join(",").replace("NaN","none");this.element.setAttribute("stroke-dasharray",a)}},alignSetter:function(a){this.element.setAttribute("text-anchor",{left:"start",center:"middle",right:"end"}[a])},opacitySetter:function(a,b,c){this[b]=a;c.setAttribute(b,a)},titleSetter:function(a){var b=this.element.getElementsByTagName("title")[0];b||(b=B.createElementNS(Ca,"title"),this.element.appendChild(b));b.textContent=String(p(a),"").replace(/<[^>]*>/g,
"")},textSetter:function(a){if(a!==this.textStr)delete this.bBox,this.textStr=a,this.added&&this.renderer.buildText(this)},fillSetter:function(a,b,c){typeof a==="string"?c.setAttribute(b,a):a&&this.colorGradient(a,b,c)},zIndexSetter:function(a,b){var c=this.renderer,d=this.parentGroup,c=(d||c).element||c.box,e,f,g=this.element,h;e=this.added;var i;q(a)&&(g.setAttribute(b,a),a=+a,this[b]===a&&(e=!1),this[b]=a);if(e){if((a=this.zIndex)&&d)d.handleZ=!0;d=c.childNodes;for(i=0;i<d.length&&!h;i++)if(e=
d[i],f=J(e,"zIndex"),e!==g&&(F(f)>a||!q(a)&&q(f)))c.insertBefore(g,e),h=!0;h||c.appendChild(g)}return h},_defaultSetter:function(a,b,c){c.setAttribute(b,a)}};P.prototype.yGetter=P.prototype.xGetter;P.prototype.translateXSetter=P.prototype.translateYSetter=P.prototype.rotationSetter=P.prototype.verticalAlignSetter=P.prototype.scaleXSetter=P.prototype.scaleYSetter=function(a,b){this[b]=a;this.doTransform=!0};P.prototype["stroke-widthSetter"]=P.prototype.strokeSetter=function(a,b,c){this[b]=a;if(this.stroke&&
this["stroke-width"])this.strokeWidth=this["stroke-width"],P.prototype.fillSetter.call(this,this.stroke,"stroke",c),c.setAttribute("stroke-width",this["stroke-width"]),this.hasStroke=!0;else if(b==="stroke-width"&&a===0&&this.hasStroke)c.removeAttribute("stroke"),this.hasStroke=!1};var ua=function(){this.init.apply(this,arguments)};ua.prototype={Element:P,init:function(a,b,c,d,e){var f=location,g,d=this.createElement("svg").attr({version:"1.1"}).css(this.getStyle(d));g=d.element;a.appendChild(g);
a.innerHTML.indexOf("xmlns")===-1&&J(g,"xmlns",Ca);this.isSVG=!0;this.box=g;this.boxWrapper=d;this.alignedObjects=[];this.url=(La||ib)&&B.getElementsByTagName("base").length?f.href.replace(/#.*?$/,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"";this.createElement("desc").add().element.appendChild(B.createTextNode("Created with Highcharts 4.1.6"));this.defs=this.createElement("defs").add();this.forExport=e;this.gradients={};this.cache={};this.setSize(b,c,!1);var h;if(La&&a.getBoundingClientRect)this.subPixelFix=
b=function(){L(a,{left:0,top:0});h=a.getBoundingClientRect();L(a,{left:ta(h.left)-h.left+"px",top:ta(h.top)-h.top+"px"})},b(),H(K,"resize",b)},getStyle:function(a){return this.style=x({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},a)},isHidden:function(){return!this.boxWrapper.getBBox().width},destroy:function(){var a=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();Qa(this.gradients||{});this.gradients=null;if(a)this.defs=a.destroy();
this.subPixelFix&&Z(K,"resize",this.subPixelFix);return this.alignedObjects=null},createElement:function(a){var b=new this.Element;b.init(this,a);return b},draw:function(){},buildText:function(a){for(var b=a.element,c=this,d=c.forExport,e=p(a.textStr,"").toString(),f=e.indexOf("<")!==-1,g=b.childNodes,h,i,j=J(b,"x"),k=a.styles,l=a.textWidth,m=k&&k.lineHeight,n=k&&k.textShadow,u=k&&k.textOverflow==="ellipsis",r=g.length,S=l&&!a.added&&this.box,Q=function(a){return m?F(m):c.fontMetrics(/(px|em)$/.test(a&&
a.style.fontSize)?a.style.fontSize:k&&k.fontSize||c.style.fontSize||12,a).h},t=function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">")};r--;)b.removeChild(g[r]);!f&&!n&&!u&&e.indexOf(" ")===-1?b.appendChild(B.createTextNode(t(e))):(h=/<.*style="([^"]+)".*>/,i=/<.*href="(http[^"]+)".*>/,S&&S.appendChild(b),e=f?e.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">').replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(/<br.*?>/g):
[e],e[e.length-1]===""&&e.pop(),o(e,function(e,f){var g,m=0,e=e.replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||");g=e.split("|||");o(g,function(e){if(e!==""||g.length===1){var n={},r=B.createElementNS(Ca,"tspan"),p;h.test(e)&&(p=e.match(h)[1].replace(/(;| |^)color([ :])/,"$1fill$2"),J(r,"style",p));i.test(e)&&!d&&(J(r,"onclick",'location.href="'+e.match(i)[1]+'"'),L(r,{cursor:"pointer"}));e=t(e.replace(/<(.|\n)*?>/g,"")||" ");if(e!==" "){r.appendChild(B.createTextNode(e));if(m)n.dx=0;
else if(f&&j!==null)n.x=j;J(r,n);b.appendChild(r);!m&&f&&(!ca&&d&&L(r,{display:"block"}),J(r,"dy",Q(r)));if(l){for(var n=e.replace(/([^\^])-/g,"$1- ").split(" "),o=g.length>1||f||n.length>1&&k.whiteSpace!=="nowrap",S,w,q,v=[],y=Q(r),s=1,x=a.rotation,A=e,C=A.length;(o||u)&&(n.length||v.length);)a.rotation=0,S=a.getBBox(!0),q=S.width,!ca&&c.forExport&&(q=c.measureSpanWidth(r.firstChild.data,a.styles)),S=q>l,w===void 0&&(w=S),u&&w?(C/=2,A===""||!S&&C<0.5?n=[]:(S&&(w=!0),A=e.substring(0,A.length+(S?-1:
1)*ta(C)),n=[A+(l>3?"":"")],r.removeChild(r.firstChild))):!S||n.length===1?(n=v,v=[],n.length&&(s++,r=B.createElementNS(Ca,"tspan"),J(r,{dy:y,x:j}),p&&J(r,"style",p),b.appendChild(r)),q>l&&(l=q)):(r.removeChild(r.firstChild),v.unshift(n.pop())),n.length&&r.appendChild(B.createTextNode(n.join(" ").replace(/- /g,"-")));w&&a.attr("title",a.textStr);a.rotation=x}m++}}})}),S&&S.removeChild(b),n&&a.applyTextShadow&&a.applyTextShadow(n))},getContrast:function(a){a=oa(a).rgba;return a[0]+a[1]+a[2]>384?"#000000":
"#FFFFFF"},button:function(a,b,c,d,e,f,g,h,i){var j=this.label(a,b,c,i,null,null,null,null,"button"),k=0,l,m,n,u,r,p,a={x1:0,y1:0,x2:0,y2:1},e=A({"stroke-width":1,stroke:"#CCCCCC",fill:{linearGradient:a,stops:[[0,"#FEFEFE"],[1,"#F6F6F6"]]},r:2,padding:5,style:{color:"black"}},e);n=e.style;delete e.style;f=A(e,{stroke:"#68A",fill:{linearGradient:a,stops:[[0,"#FFF"],[1,"#ACF"]]}},f);u=f.style;delete f.style;g=A(e,{stroke:"#68A",fill:{linearGradient:a,stops:[[0,"#9BD"],[1,"#CDF"]]}},g);r=g.style;delete g.style;
h=A(e,{style:{color:"#CCC"}},h);p=h.style;delete h.style;H(j.element,ya?"mouseover":"mouseenter",function(){k!==3&&j.attr(f).css(u)});H(j.element,ya?"mouseout":"mouseleave",function(){k!==3&&(l=[e,f,g][k],m=[n,u,r][k],j.attr(l).css(m))});j.setState=function(a){(j.state=k=a)?a===2?j.attr(g).css(r):a===3&&j.attr(h).css(p):j.attr(e).css(n)};return j.on("click",function(){k!==3&&d.call(j)}).attr(e).css(x({cursor:"default"},n))},crispLine:function(a,b){a[1]===a[4]&&(a[1]=a[4]=s(a[1])-b%2/2);a[2]===a[5]&&
(a[2]=a[5]=s(a[2])+b%2/2);return a},path:function(a){var b={fill:O};Ha(a)?b.d=a:da(a)&&x(b,a);return this.createElement("path").attr(b)},circle:function(a,b,c){a=da(a)?a:{x:a,y:b,r:c};b=this.createElement("circle");b.xSetter=function(a){this.element.setAttribute("cx",a)};b.ySetter=function(a){this.element.setAttribute("cy",a)};return b.attr(a)},arc:function(a,b,c,d,e,f){if(da(a))b=a.y,c=a.r,d=a.innerR,e=a.start,f=a.end,a=a.x;a=this.symbol("arc",a||0,b||0,c||0,c||0,{innerR:d||0,start:e||0,end:f||0});
a.r=c;return a},rect:function(a,b,c,d,e,f){var e=da(a)?a.r:e,g=this.createElement("rect"),a=da(a)?a:a===y?{}:{x:a,y:b,width:v(c,0),height:v(d,0)};if(f!==y)a.strokeWidth=f,a=g.crisp(a);if(e)a.r=e;g.rSetter=function(a){J(this.element,{rx:a,ry:a})};return g.attr(a)},setSize:function(a,b,c){var d=this.alignedObjects,e=d.length;this.width=a;this.height=b;for(this.boxWrapper[p(c,!0)?"animate":"attr"]({width:a,height:b});e--;)d[e].align()},g:function(a){var b=this.createElement("g");return q(a)?b.attr({"class":"highcharts-"+
a}):b},image:function(a,b,c,d,e){var f={preserveAspectRatio:O};arguments.length>1&&x(f,{x:b,y:c,width:d,height:e});f=this.createElement("image").attr(f);f.element.setAttributeNS?f.element.setAttributeNS("http://www.w3.org/1999/xlink","href",a):f.element.setAttribute("hc-svg-href",a);return f},symbol:function(a,b,c,d,e,f){var g,h=this.symbols[a],h=h&&h(s(b),s(c),d,e,f),i=/^url\((.*?)\)$/,j,k;if(h)g=this.path(h),x(g,{symbolName:a,x:b,y:c,width:d,height:e}),f&&x(g,f);else if(i.test(a))k=function(a,b){a.element&&
(a.attr({width:b[0],height:b[1]}),a.alignByTranslate||a.translate(s((d-b[0])/2),s((e-b[1])/2)))},j=a.match(i)[1],a=Kb[j]||f&&f.width&&f.height&&[f.width,f.height],g=this.image(j).attr({x:b,y:c}),g.isImg=!0,a?k(g,a):(g.attr({width:0,height:0}),$("img",{onload:function(){k(g,Kb[j]=[this.width,this.height])},src:j}));return g},symbols:{circle:function(a,b,c,d){var e=0.166*c;return["M",a+c/2,b,"C",a+c+e,b,a+c+e,b+d,a+c/2,b+d,"C",a-e,b+d,a-e,b,a+c/2,b,"Z"]},square:function(a,b,c,d){return["M",a,b,"L",
a+c,b,a+c,b+d,a,b+d,"Z"]},triangle:function(a,b,c,d){return["M",a+c/2,b,"L",a+c,b+d,a,b+d,"Z"]},"triangle-down":function(a,b,c,d){return["M",a,b,"L",a+c,b,a+c/2,b+d,"Z"]},diamond:function(a,b,c,d){return["M",a+c/2,b,"L",a+c,b+d/2,a+c/2,b+d,a,b+d/2,"Z"]},arc:function(a,b,c,d,e){var f=e.start,c=e.r||c||d,g=e.end-0.001,d=e.innerR,h=e.open,i=X(f),j=aa(f),k=X(g),g=aa(g),e=e.end-f<ma?0:1;return["M",a+c*i,b+c*j,"A",c,c,0,e,1,a+c*k,b+c*g,h?"M":"L",a+d*k,b+d*g,"A",d,d,0,e,0,a+d*i,b+d*j,h?"":"Z"]},callout:function(a,
b,c,d,e){var f=C(e&&e.r||0,c,d),g=f+6,h=e&&e.anchorX,e=e&&e.anchorY,i;i=["M",a+f,b,"L",a+c-f,b,"C",a+c,b,a+c,b,a+c,b+f,"L",a+c,b+d-f,"C",a+c,b+d,a+c,b+d,a+c-f,b+d,"L",a+f,b+d,"C",a,b+d,a,b+d,a,b+d-f,"L",a,b+f,"C",a,b,a,b,a+f,b];h&&h>c&&e>b+g&&e<b+d-g?i.splice(13,3,"L",a+c,e-6,a+c+6,e,a+c,e+6,a+c,b+d-f):h&&h<0&&e>b+g&&e<b+d-g?i.splice(33,3,"L",a,e+6,a-6,e,a,e-6,a,b+f):e&&e>d&&h>a+g&&h<a+c-g?i.splice(23,3,"L",h+6,b+d,h,b+d+6,h-6,b+d,a+f,b+d):e&&e<0&&h>a+g&&h<a+c-g&&i.splice(3,3,"L",h-6,b,h,b-6,h+6,
b,c-f,b);return i}},clipRect:function(a,b,c,d){var e="highcharts-"+yb++,f=this.createElement("clipPath").attr({id:e}).add(this.defs),a=this.rect(a,b,c,d,0).add(f);a.id=e;a.clipPath=f;a.count=0;return a},text:function(a,b,c,d){var e=fa||!ca&&this.forExport,f={};if(d&&!this.forExport)return this.html(a,b,c);f.x=Math.round(b||0);if(c)f.y=Math.round(c);if(a||a===0)f.text=a;a=this.createElement("text").attr(f);e&&a.css({position:"absolute"});if(!d)a.xSetter=function(a,b,c){var d=c.getElementsByTagName("tspan"),
e,f=c.getAttribute(b),m;for(m=0;m<d.length;m++)e=d[m],e.getAttribute(b)===f&&e.setAttribute(b,a);c.setAttribute(b,a)};return a},fontMetrics:function(a,b){a=a||this.style.fontSize;if(b&&K.getComputedStyle)b=b.element||b,a=K.getComputedStyle(b,"").fontSize;var a=/px/.test(a)?F(a):/em/.test(a)?parseFloat(a)*12:12,c=a<24?a+3:s(a*1.2),d=s(c*0.8);return{h:c,b:d,f:a}},rotCorr:function(a,b,c){var d=a;b&&c&&(d=v(d*X(b*ha),4));return{x:-a/3*aa(b*ha),y:d}},label:function(a,b,c,d,e,f,g,h,i){function j(){var a,
b;a=u.element.style;p=(ga===void 0||v===void 0||n.styles.textAlign)&&q(u.textStr)&&u.getBBox();n.width=(ga||p.width||0)+2*t+w;n.height=(v||p.height||0)+2*t;F=t+m.fontMetrics(a&&a.fontSize,u).b;if(E){if(!r)a=s(-Q*t)+z,b=(h?-F:0)+z,n.box=r=d?m.symbol(d,a,b,n.width,n.height,G):m.rect(a,b,n.width,n.height,0,G[Pb]),r.attr("fill",O).add(n);r.isImg||r.attr(x({width:s(n.width),height:s(n.height)},G));G=null}}function k(){var a=n.styles,a=a&&a.textAlign,b=w+t*(1-Q),c;c=h?0:F;if(q(ga)&&p&&(a==="center"||a===
"right"))b+={center:0.5,right:1}[a]*(ga-p.width);if(b!==u.x||c!==u.y)u.attr("x",b),c!==y&&u.attr("y",c);u.x=b;u.y=c}function l(a,b){r?r.attr(a,b):G[a]=b}var m=this,n=m.g(i),u=m.text("",0,0,g).attr({zIndex:1}),r,p,Q=0,t=3,w=0,ga,v,C,B,z=0,G={},F,E;n.onAdd=function(){u.add(n);n.attr({text:a||a===0?a:"",x:b,y:c});r&&q(e)&&n.attr({anchorX:e,anchorY:f})};n.widthSetter=function(a){ga=a};n.heightSetter=function(a){v=a};n.paddingSetter=function(a){if(q(a)&&a!==t)t=n.padding=a,k()};n.paddingLeftSetter=function(a){q(a)&&
a!==w&&(w=a,k())};n.alignSetter=function(a){Q={left:0,center:0.5,right:1}[a]};n.textSetter=function(a){a!==y&&u.textSetter(a);j();k()};n["stroke-widthSetter"]=function(a,b){a&&(E=!0);z=a%2/2;l(b,a)};n.strokeSetter=n.fillSetter=n.rSetter=function(a,b){b==="fill"&&a&&(E=!0);l(b,a)};n.anchorXSetter=function(a,b){e=a;l(b,s(a)-z-C)};n.anchorYSetter=function(a,b){f=a;l(b,a-B)};n.xSetter=function(a){n.x=a;Q&&(a-=Q*((ga||p.width)+t));C=s(a);n.attr("translateX",C)};n.ySetter=function(a){B=n.y=s(a);n.attr("translateY",
B)};var D=n.css;return x(n,{css:function(a){if(a){var b={},a=A(a);o(n.textProps,function(c){a[c]!==y&&(b[c]=a[c],delete a[c])});u.css(b)}return D.call(n,a)},getBBox:function(){return{width:p.width+2*t,height:p.height+2*t,x:p.x-t,y:p.y-t}},shadow:function(a){r&&r.shadow(a);return n},destroy:function(){Z(n.element,"mouseenter");Z(n.element,"mouseleave");u&&(u=u.destroy());r&&(r=r.destroy());P.prototype.destroy.call(n);n=m=j=k=l=null}})}};$a=ua;x(P.prototype,{htmlCss:function(a){var b=this.element;if(b=
a&&b.tagName==="SPAN"&&a.width)delete a.width,this.textWidth=b,this.updateTransform();if(a&&a.textOverflow==="ellipsis")a.whiteSpace="nowrap",a.overflow="hidden";this.styles=x(this.styles,a);L(this.element,a);return this},htmlGetBBox:function(){var a=this.element;if(a.nodeName==="text")a.style.position="absolute";return{x:a.offsetLeft,y:a.offsetTop,width:a.offsetWidth,height:a.offsetHeight}},htmlUpdateTransform:function(){if(this.added){var a=this.renderer,b=this.element,c=this.translateX||0,d=this.translateY||
0,e=this.x||0,f=this.y||0,g=this.textAlign||"left",h={left:0,center:0.5,right:1}[g],i=this.shadows,j=this.styles;L(b,{marginLeft:c,marginTop:d});i&&o(i,function(a){L(a,{marginLeft:c+1,marginTop:d+1})});this.inverted&&o(b.childNodes,function(c){a.invertChild(c,b)});if(b.tagName==="SPAN"){var k=this.rotation,l,m=F(this.textWidth),n=[k,g,b.innerHTML,this.textWidth].join(",");if(n!==this.cTT){l=a.fontMetrics(b.style.fontSize).b;q(k)&&this.setSpanRotation(k,h,l);i=p(this.elemWidth,b.offsetWidth);if(i>
m&&/[ \-]/.test(b.textContent||b.innerText))L(b,{width:m+"px",display:"block",whiteSpace:j&&j.whiteSpace||"normal"}),i=m;this.getSpanCorrection(i,l,h,k,g)}L(b,{left:e+(this.xCorr||0)+"px",top:f+(this.yCorr||0)+"px"});if(ib)l=b.offsetHeight;this.cTT=n}}else this.alignOnAdd=!0},setSpanRotation:function(a,b,c){var d={},e=ya?"-ms-transform":ib?"-webkit-transform":La?"MozTransform":Ib?"-o-transform":"";d[e]=d.transform="rotate("+a+"deg)";d[e+(La?"Origin":"-origin")]=d.transformOrigin=b*100+"% "+c+"px";
L(this.element,d)},getSpanCorrection:function(a,b,c){this.xCorr=-a*c;this.yCorr=-b}});x(ua.prototype,{html:function(a,b,c){var d=this.createElement("span"),e=d.element,f=d.renderer;d.textSetter=function(a){a!==e.innerHTML&&delete this.bBox;e.innerHTML=this.textStr=a};d.xSetter=d.ySetter=d.alignSetter=d.rotationSetter=function(a,b){b==="align"&&(b="textAlign");d[b]=a;d.htmlUpdateTransform()};d.attr({text:a,x:s(b),y:s(c)}).css({position:"absolute",fontFamily:this.style.fontFamily,fontSize:this.style.fontSize});
e.style.whiteSpace="nowrap";d.css=d.htmlCss;if(f.isSVG)d.add=function(a){var b,c=f.box.parentNode,j=[];if(this.parentGroup=a){if(b=a.div,!b){for(;a;)j.push(a),a=a.parentGroup;o(j.reverse(),function(a){var d;b=a.div=a.div||$(Ka,{className:J(a.element,"class")},{position:"absolute",left:(a.translateX||0)+"px",top:(a.translateY||0)+"px"},b||c);d=b.style;x(a,{translateXSetter:function(b,c){d.left=b+"px";a[c]=b;a.doTransform=!0},translateYSetter:function(b,c){d.top=b+"px";a[c]=b;a.doTransform=!0},visibilitySetter:function(a,
b){d[b]=a}})})}}else b=c;b.appendChild(e);d.added=!0;d.alignOnAdd&&d.htmlUpdateTransform();return d};return d}});if(!ca&&!fa){E={init:function(a,b){var c=["<",b,' filled="f" stroked="f"'],d=["position: ","absolute",";"],e=b===Ka;(b==="shape"||e)&&d.push("left:0;top:0;width:1px;height:1px;");d.push("visibility: ",e?"hidden":"visible");c.push(' style="',d.join(""),'"/>');if(b)c=e||b==="span"||b==="img"?c.join(""):a.prepVML(c),this.element=$(c);this.renderer=a},add:function(a){var b=this.renderer,c=
this.element,d=b.box,d=a?a.element||a:d;a&&a.inverted&&b.invertChild(c,d);d.appendChild(c);this.added=!0;this.alignOnAdd&&!this.deferUpdateTransform&&this.updateTransform();if(this.onAdd)this.onAdd();return this},updateTransform:P.prototype.htmlUpdateTransform,setSpanRotation:function(){var a=this.rotation,b=X(a*ha),c=aa(a*ha);L(this.element,{filter:a?["progid:DXImageTransform.Microsoft.Matrix(M11=",b,", M12=",-c,", M21=",c,", M22=",b,", sizingMethod='auto expand')"].join(""):O})},getSpanCorrection:function(a,
b,c,d,e){var f=d?X(d*ha):1,g=d?aa(d*ha):0,h=p(this.elemHeight,this.element.offsetHeight),i;this.xCorr=f<0&&-a;this.yCorr=g<0&&-h;i=f*g<0;this.xCorr+=g*b*(i?1-c:c);this.yCorr-=f*b*(d?i?c:1-c:1);e&&e!=="left"&&(this.xCorr-=a*c*(f<0?-1:1),d&&(this.yCorr-=h*c*(g<0?-1:1)),L(this.element,{textAlign:e}))},pathToVML:function(a){for(var b=a.length,c=[];b--;)if(ra(a[b]))c[b]=s(a[b]*10)-5;else if(a[b]==="Z")c[b]="x";else if(c[b]=a[b],a.isArc&&(a[b]==="wa"||a[b]==="at"))c[b+5]===c[b+7]&&(c[b+7]+=a[b+7]>a[b+5]?
1:-1),c[b+6]===c[b+8]&&(c[b+8]+=a[b+8]>a[b+6]?1:-1);return c.join(" ")||"x"},clip:function(a){var b=this,c;a?(c=a.members,ja(c,b),c.push(b),b.destroyClip=function(){ja(c,b)},a=a.getCSS(b)):(b.destroyClip&&b.destroyClip(),a={clip:hb?"inherit":"rect(auto)"});return b.css(a)},css:P.prototype.htmlCss,safeRemoveChild:function(a){a.parentNode&&Ra(a)},destroy:function(){this.destroyClip&&this.destroyClip();return P.prototype.destroy.apply(this)},on:function(a,b){this.element["on"+a]=function(){var a=K.event;
a.target=a.srcElement;b(a)};return this},cutOffPath:function(a,b){var c,a=a.split(/[ ,]/);c=a.length;if(c===9||c===11)a[c-4]=a[c-2]=F(a[c-2])-10*b;return a.join(" ")},shadow:function(a,b,c){var d=[],e,f=this.element,g=this.renderer,h,i=f.style,j,k=f.path,l,m,n,u;k&&typeof k.value!=="string"&&(k="x");m=k;if(a){n=p(a.width,3);u=(a.opacity||0.15)/n;for(e=1;e<=3;e++){l=n*2+1-2*e;c&&(m=this.cutOffPath(k.value,l+0.5));j=['<shape isShadow="true" strokeweight="',l,'" filled="false" path="',m,'" coordsize="10 10" style="',
f.style.cssText,'" />'];h=$(g.prepVML(j),null,{left:F(i.left)+p(a.offsetX,1),top:F(i.top)+p(a.offsetY,1)});if(c)h.cutOff=l+1;j=['<stroke color="',a.color||"black",'" opacity="',u*e,'"/>'];$(g.prepVML(j),null,null,h);b?b.element.appendChild(h):f.parentNode.insertBefore(h,f);d.push(h)}this.shadows=d}return this},updateShadows:na,setAttr:function(a,b){hb?this.element[a]=b:this.element.setAttribute(a,b)},classSetter:function(a){this.element.className=a},dashstyleSetter:function(a,b,c){(c.getElementsByTagName("stroke")[0]||
$(this.renderer.prepVML(["<stroke/>"]),null,null,c))[b]=a||"solid";this[b]=a},dSetter:function(a,b,c){var d=this.shadows,a=a||[];this.d=a.join&&a.join(" ");c.path=a=this.pathToVML(a);if(d)for(c=d.length;c--;)d[c].path=d[c].cutOff?this.cutOffPath(a,d[c].cutOff):a;this.setAttr(b,a)},fillSetter:function(a,b,c){var d=c.nodeName;if(d==="SPAN")c.style.color=a;else if(d!=="IMG")c.filled=a!==O,this.setAttr("fillcolor",this.renderer.color(a,c,b,this))},opacitySetter:na,rotationSetter:function(a,b,c){c=c.style;
this[b]=c[b]=a;c.left=-s(aa(a*ha)+1)+"px";c.top=s(X(a*ha))+"px"},strokeSetter:function(a,b,c){this.setAttr("strokecolor",this.renderer.color(a,c,b))},"stroke-widthSetter":function(a,b,c){c.stroked=!!a;this[b]=a;ra(a)&&(a+="px");this.setAttr("strokeweight",a)},titleSetter:function(a,b){this.setAttr(b,a)},visibilitySetter:function(a,b,c){a==="inherit"&&(a="visible");this.shadows&&o(this.shadows,function(c){c.style[b]=a});c.nodeName==="DIV"&&(a=a==="hidden"?"-999em":0,hb||(c.style[b]=a?"visible":"hidden"),
b="top");c.style[b]=a},xSetter:function(a,b,c){this[b]=a;b==="x"?b="left":b==="y"&&(b="top");this.updateClipping?(this[b]=a,this.updateClipping()):c.style[b]=a},zIndexSetter:function(a,b,c){c.style[b]=a}};z.VMLElement=E=ka(P,E);E.prototype.ySetter=E.prototype.widthSetter=E.prototype.heightSetter=E.prototype.xSetter;var Na={Element:E,isIE8:Ba.indexOf("MSIE 8.0")>-1,init:function(a,b,c,d){var e;this.alignedObjects=[];d=this.createElement(Ka).css(x(this.getStyle(d),{position:"relative"}));e=d.element;
a.appendChild(d.element);this.isVML=!0;this.box=e;this.boxWrapper=d;this.cache={};this.setSize(b,c,!1);if(!B.namespaces.hcv){B.namespaces.add("hcv","urn:schemas-microsoft-com:vml");try{B.createStyleSheet().cssText="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}catch(f){B.styleSheets[0].cssText+="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "}}},isHidden:function(){return!this.box.offsetWidth},
clipRect:function(a,b,c,d){var e=this.createElement(),f=da(a);return x(e,{members:[],count:0,left:(f?a.x:a)+1,top:(f?a.y:b)+1,width:(f?a.width:c)-1,height:(f?a.height:d)-1,getCSS:function(a){var b=a.element,c=b.nodeName,a=a.inverted,d=this.top-(c==="shape"?b.offsetTop:0),e=this.left,b=e+this.width,f=d+this.height,d={clip:"rect("+s(a?e:d)+"px,"+s(a?f:b)+"px,"+s(a?b:f)+"px,"+s(a?d:e)+"px)"};!a&&hb&&c==="DIV"&&x(d,{width:b+"px",height:f+"px"});return d},updateClipping:function(){o(e.members,function(a){a.element&&
a.css(e.getCSS(a))})}})},color:function(a,b,c,d){var e=this,f,g=/^rgba/,h,i,j=O;a&&a.linearGradient?i="gradient":a&&a.radialGradient&&(i="pattern");if(i){var k,l,m=a.linearGradient||a.radialGradient,n,u,r,p,Q,t="",a=a.stops,w,ga=[],q=function(){h=['<fill colors="'+ga.join(",")+'" opacity="',r,'" o:opacity2="',u,'" type="',i,'" ',t,'focus="100%" method="any" />'];$(e.prepVML(h),null,null,b)};n=a[0];w=a[a.length-1];n[0]>0&&a.unshift([0,n[1]]);w[0]<1&&a.push([1,w[1]]);o(a,function(a,b){g.test(a[1])?
(f=oa(a[1]),k=f.get("rgb"),l=f.get("a")):(k=a[1],l=1);ga.push(a[0]*100+"% "+k);b?(r=l,p=k):(u=l,Q=k)});if(c==="fill")if(i==="gradient")c=m.x1||m[0]||0,a=m.y1||m[1]||0,n=m.x2||m[2]||0,m=m.y2||m[3]||0,t='angle="'+(90-W.atan((m-a)/(n-c))*180/ma)+'"',q();else{var j=m.r,v=j*2,y=j*2,s=m.cx,x=m.cy,C=b.radialReference,A,j=function(){C&&(A=d.getBBox(),s+=(C[0]-A.x)/A.width-0.5,x+=(C[1]-A.y)/A.height-0.5,v*=C[2]/A.width,y*=C[2]/A.height);t='src="'+T.global.VMLRadialGradientURL+'" size="'+v+","+y+'" origin="0.5,0.5" position="'+
s+","+x+'" color2="'+Q+'" ';q()};d.added?j():d.onAdd=j;j=p}else j=k}else if(g.test(a)&&b.tagName!=="IMG")f=oa(a),h=["<",c,' opacity="',f.get("a"),'"/>'],$(this.prepVML(h),null,null,b),j=f.get("rgb");else{j=b.getElementsByTagName(c);if(j.length)j[0].opacity=1,j[0].type="solid";j=a}return j},prepVML:function(a){var b=this.isIE8,a=a.join("");b?(a=a.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />'),a=a.indexOf('style="')===-1?a.replace("/>",' style="display:inline-block;behavior:url(#default#VML);" />'):
a.replace('style="','style="display:inline-block;behavior:url(#default#VML);')):a=a.replace("<","<hcv:");return a},text:ua.prototype.html,path:function(a){var b={coordsize:"10 10"};Ha(a)?b.d=a:da(a)&&x(b,a);return this.createElement("shape").attr(b)},circle:function(a,b,c){var d=this.symbol("circle");if(da(a))c=a.r,b=a.y,a=a.x;d.isCircle=!0;d.r=c;return d.attr({x:a,y:b})},g:function(a){var b;a&&(b={className:"highcharts-"+a,"class":"highcharts-"+a});return this.createElement(Ka).attr(b)},image:function(a,
b,c,d,e){var f=this.createElement("img").attr({src:a});arguments.length>1&&f.attr({x:b,y:c,width:d,height:e});return f},createElement:function(a){return a==="rect"?this.symbol(a):ua.prototype.createElement.call(this,a)},invertChild:function(a,b){var c=this,d=b.style,e=a.tagName==="IMG"&&a.style;L(a,{flip:"x",left:F(d.width)-(e?F(e.top):1),top:F(d.height)-(e?F(e.left):1),rotation:-90});o(a.childNodes,function(b){c.invertChild(b,a)})},symbols:{arc:function(a,b,c,d,e){var f=e.start,g=e.end,h=e.r||c||
d,c=e.innerR,d=X(f),i=aa(f),j=X(g),k=aa(g);if(g-f===0)return["x"];f=["wa",a-h,b-h,a+h,b+h,a+h*d,b+h*i,a+h*j,b+h*k];e.open&&!c&&f.push("e","M",a,b);f.push("at",a-c,b-c,a+c,b+c,a+c*j,b+c*k,a+c*d,b+c*i,"x","e");f.isArc=!0;return f},circle:function(a,b,c,d,e){e&&(c=d=2*e.r);e&&e.isCircle&&(a-=c/2,b-=d/2);return["wa",a,b,a+c,b+d,a+c,b+d/2,a+c,b+d/2,"e"]},rect:function(a,b,c,d,e){return ua.prototype.symbols[!q(e)||!e.r?"square":"callout"].call(0,a,b,c,d,e)}}};z.VMLRenderer=E=function(){this.init.apply(this,
arguments)};E.prototype=A(ua.prototype,Na);$a=E}ua.prototype.measureSpanWidth=function(a,b){var c=B.createElement("span"),d;d=B.createTextNode(a);c.appendChild(d);L(c,b);this.box.appendChild(c);d=c.offsetWidth;Ra(c);return d};var Lb;if(fa)z.CanVGRenderer=E=function(){Ca="http://www.w3.org/1999/xhtml"},E.prototype.symbols={},Lb=function(){function a(){var a=b.length,d;for(d=0;d<a;d++)b[d]();b=[]}var b=[];return{push:function(c,d){b.length===0&&Qb(d,a);b.push(c)}}}(),$a=E;Ta.prototype={addLabel:function(){var a=
this.axis,b=a.options,c=a.chart,d=a.categories,e=a.names,f=this.pos,g=b.labels,h=a.tickPositions,i=f===h[0],j=f===h[h.length-1],e=d?p(d[f],e[f],f):f,d=this.label,h=h.info,k;a.isDatetimeAxis&&h&&(k=b.dateTimeLabelFormats[h.higherRanks[f]||h.unitName]);this.isFirst=i;this.isLast=j;b=a.labelFormatter.call({axis:a,chart:c,isFirst:i,isLast:j,dateTimeLabelFormat:k,value:a.isLog?ea(ia(e)):e});q(d)?d&&d.attr({text:b}):(this.labelLength=(this.label=d=q(b)&&g.enabled?c.renderer.text(b,0,0,g.useHTML).css(A(g.style)).add(a.labelGroup):
null)&&d.getBBox().width,this.rotation=0)},getLabelSize:function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},handleOverflow:function(a){var b=this.axis,c=a.x,d=b.chart.chartWidth,e=b.chart.spacing,f=p(b.labelLeft,e[3]),e=p(b.labelRight,d-e[1]),g=this.label,h=this.rotation,i={left:0,center:0.5,right:1}[b.labelAlign],j=g.getBBox().width,k=b.slotWidth,l=1,m;if(h)h<0&&c-i*j<f?m=s(c/X(h*ha)-f):h>0&&c+i*j>e&&(m=s((d-c)/X(h*ha)));else if(d=c+(1-i)*j,c-i*j<f?k=a.x+k*(1-i)-
f:d>e&&(k=e-a.x+k*i,l=-1),k=C(b.slotWidth,k),k<b.slotWidth&&b.labelAlign==="center"&&(a.x+=l*(b.slotWidth-k-i*(b.slotWidth-C(j,k)))),j>k||b.autoRotation&&g.styles.width)m=k;m&&g.css({width:m,textOverflow:"ellipsis"})},getPosition:function(a,b,c,d){var e=this.axis,f=e.chart,g=d&&f.oldChartHeight||f.chartHeight;return{x:a?e.translate(b+c,null,null,d)+e.transB:e.left+e.offset+(e.opposite?(d&&f.oldChartWidth||f.chartWidth)-e.right-e.left:0),y:a?g-e.bottom+e.offset-(e.opposite?e.height:0):g-e.translate(b+
c,null,null,d)-e.transB}},getLabelPosition:function(a,b,c,d,e,f,g,h){var i=this.axis,j=i.transA,k=i.reversed,l=i.staggerLines,m=i.tickRotCorr||{x:0,y:0},c=p(e.y,m.y+(i.side===2?8:-(c.getBBox().height/2))),a=a+e.x+m.x-(f&&d?f*j*(k?-1:1):0),b=b+c-(f&&!d?f*j*(k?1:-1):0);l&&(b+=g/(h||1)%l*(i.labelOffset/l));return{x:a,y:s(b)}},getMarkPath:function(a,b,c,d,e,f){return f.crispLine(["M",a,b,"L",a+(e?0:-c),b+(e?c:0)],d)},render:function(a,b,c){var d=this.axis,e=d.options,f=d.chart.renderer,g=d.horiz,h=this.type,
i=this.label,j=this.pos,k=e.labels,l=this.gridLine,m=h?h+"Grid":"grid",n=h?h+"Tick":"tick",u=e[m+"LineWidth"],r=e[m+"LineColor"],o=e[m+"LineDashStyle"],Q=e[n+"Length"],m=e[n+"Width"]||0,t=e[n+"Color"],w=e[n+"Position"],n=this.mark,ga=k.step,q=!0,v=d.tickmarkOffset,s=this.getPosition(g,j,v,b),x=s.x,s=s.y,A=g&&x===d.pos+d.len||!g&&s===d.pos?-1:1,c=p(c,1);this.isActive=!0;if(u){j=d.getPlotLinePath(j+v,u*A,b,!0);if(l===y){l={stroke:r,"stroke-width":u};if(o)l.dashstyle=o;if(!h)l.zIndex=1;if(b)l.opacity=
0;this.gridLine=l=u?f.path(j).attr(l).add(d.gridGroup):null}if(!b&&l&&j)l[this.isNew?"attr":"animate"]({d:j,opacity:c})}if(m&&Q)w==="inside"&&(Q=-Q),d.opposite&&(Q=-Q),h=this.getMarkPath(x,s,Q,m*A,g,f),n?n.animate({d:h,opacity:c}):this.mark=f.path(h).attr({stroke:t,"stroke-width":m,opacity:c}).add(d.axisGroup);if(i&&!isNaN(x))i.xy=s=this.getLabelPosition(x,s,i,g,k,v,a,ga),this.isFirst&&!this.isLast&&!p(e.showFirstLabel,1)||this.isLast&&!this.isFirst&&!p(e.showLastLabel,1)?q=!1:g&&!d.isRadial&&!k.step&&
!k.rotation&&!b&&c!==0&&this.handleOverflow(s),ga&&a%ga&&(q=!1),q&&!isNaN(s.y)?(s.opacity=c,i[this.isNew?"attr":"animate"](s),this.isNew=!1):i.attr("y",-9999)},destroy:function(){Qa(this,this.axis)}};z.PlotLineOrBand=function(a,b){this.axis=a;if(b)this.options=b,this.id=b.id};z.PlotLineOrBand.prototype={render:function(){var a=this,b=a.axis,c=b.horiz,d=a.options,e=d.label,f=a.label,g=d.width,h=d.to,i=d.from,j=q(i)&&q(h),k=d.value,l=d.dashStyle,m=a.svgElem,n=[],u,r=d.color,p=d.zIndex,o=d.events,t=
{},w=b.chart.renderer;b.isLog&&(i=Ea(i),h=Ea(h),k=Ea(k));if(g){if(n=b.getPlotLinePath(k,g),t={stroke:r,"stroke-width":g},l)t.dashstyle=l}else if(j){n=b.getPlotBandPath(i,h,d);if(r)t.fill=r;if(d.borderWidth)t.stroke=d.borderColor,t["stroke-width"]=d.borderWidth}else return;if(q(p))t.zIndex=p;if(m)if(n)m.animate({d:n},null,m.onGetPath);else{if(m.hide(),m.onGetPath=function(){m.show()},f)a.label=f=f.destroy()}else if(n&&n.length&&(a.svgElem=m=w.path(n).attr(t).add(),o))for(u in d=function(b){m.on(b,
function(c){o[b].apply(a,[c])})},o)d(u);if(e&&q(e.text)&&n&&n.length&&b.width>0&&b.height>0){e=A({align:c&&j&&"center",x:c?!j&&4:10,verticalAlign:!c&&j&&"middle",y:c?j?16:10:j?6:-4,rotation:c&&!j&&90},e);if(!f){t={align:e.textAlign||e.align,rotation:e.rotation};if(q(p))t.zIndex=p;a.label=f=w.text(e.text,0,0,e.useHTML).attr(t).css(e.style).add()}b=[n[1],n[4],j?n[6]:n[1]];j=[n[2],n[5],j?n[7]:n[2]];n=Pa(b);c=Pa(j);f.align(e,!1,{x:n,y:c,width:Fa(b)-n,height:Fa(j)-c});f.show()}else f&&f.hide();return a},
destroy:function(){ja(this.axis.plotLinesAndBands,this);delete this.axis;Qa(this)}};var va=z.Axis=function(){this.init.apply(this,arguments)};va.prototype={defaultOptions:{dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},endOnTick:!1,gridLineColor:"#D8D8D8",labels:{enabled:!0,style:{color:"#606060",cursor:"default",fontSize:"11px"},x:0,y:15},lineColor:"#C0D0E0",lineWidth:1,minPadding:0.01,maxPadding:0.01,
minorGridLineColor:"#E0E0E0",minorGridLineWidth:1,minorTickColor:"#A0A0A0",minorTickLength:2,minorTickPosition:"outside",startOfWeek:1,startOnTick:!1,tickColor:"#C0D0E0",tickLength:10,tickmarkPlacement:"between",tickPixelInterval:100,tickPosition:"outside",tickWidth:1,title:{align:"middle",style:{color:"#707070"}},type:"linear"},defaultYAxisOptions:{endOnTick:!0,gridLineWidth:1,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8,y:3},lineWidth:0,maxPadding:0.05,minPadding:0.05,startOnTick:!0,tickWidth:0,
title:{rotation:270,text:"Values"},stackLabels:{enabled:!1,formatter:function(){return z.numberFormat(this.total,-1)},style:A(ba.line.dataLabels.style,{color:"#000000"})}},defaultLeftAxisOptions:{labels:{x:-15,y:null},title:{rotation:270}},defaultRightAxisOptions:{labels:{x:15,y:null},title:{rotation:90}},defaultBottomAxisOptions:{labels:{autoRotation:[-45],x:0,y:null},title:{rotation:0}},defaultTopAxisOptions:{labels:{autoRotation:[-45],x:0,y:-15},title:{rotation:0}},init:function(a,b){var c=b.isX;
this.horiz=a.inverted?!c:c;this.coll=(this.isXAxis=c)?"xAxis":"yAxis";this.opposite=b.opposite;this.side=b.side||(this.horiz?this.opposite?0:2:this.opposite?1:3);this.setOptions(b);var d=this.options,e=d.type;this.labelFormatter=d.labels.formatter||this.defaultLabelFormatter;this.userOptions=b;this.minPixelPadding=0;this.chart=a;this.reversed=d.reversed;this.zoomEnabled=d.zoomEnabled!==!1;this.categories=d.categories||e==="category";this.names=this.names||[];this.isLog=e==="logarithmic";this.isDatetimeAxis=
e==="datetime";this.isLinked=q(d.linkedTo);this.ticks={};this.labelEdge=[];this.minorTicks={};this.plotLinesAndBands=[];this.alternateBands={};this.len=0;this.minRange=this.userMinRange=d.minRange||d.maxZoom;this.range=d.range;this.offset=d.offset||0;this.stacks={};this.oldStacks={};this.min=this.max=null;this.crosshair=p(d.crosshair,sa(a.options.tooltip.crosshairs)[c?0:1],!1);var f,d=this.options.events;Ma(this,a.axes)===-1&&(c&&!this.isColorAxis?a.axes.splice(a.xAxis.length,0,this):a.axes.push(this),
a[this.coll].push(this));this.series=this.series||[];if(a.inverted&&c&&this.reversed===y)this.reversed=!0;this.removePlotLine=this.removePlotBand=this.removePlotBandOrLine;for(f in d)H(this,f,d[f]);if(this.isLog)this.val2lin=Ea,this.lin2val=ia},setOptions:function(a){this.options=A(this.defaultOptions,this.isXAxis?{}:this.defaultYAxisOptions,[this.defaultTopAxisOptions,this.defaultRightAxisOptions,this.defaultBottomAxisOptions,this.defaultLeftAxisOptions][this.side],A(T[this.coll],a))},defaultLabelFormatter:function(){var a=
this.axis,b=this.value,c=a.categories,d=this.dateTimeLabelFormat,e=T.lang.numericSymbols,f=e&&e.length,g,h=a.options.labels.format,a=a.isLog?b:a.tickInterval;if(h)g=Ja(h,this);else if(c)g=b;else if(d)g=Oa(d,b);else if(f&&a>=1E3)for(;f--&&g===y;)c=Math.pow(1E3,f+1),a>=c&&e[f]!==null&&(g=z.numberFormat(b/c,-1)+e[f]);g===y&&(g=N(b)>=1E4?z.numberFormat(b,0):z.numberFormat(b,-1,y,""));return g},getSeriesExtremes:function(){var a=this,b=a.chart;a.hasVisibleSeries=!1;a.dataMin=a.dataMax=a.ignoreMinPadding=
a.ignoreMaxPadding=null;a.buildStacks&&a.buildStacks();o(a.series,function(c){if(c.visible||!b.options.chart.ignoreHiddenSeries){var d;d=c.options.threshold;var e;a.hasVisibleSeries=!0;a.isLog&&d<=0&&(d=null);if(a.isXAxis){if(d=c.xData,d.length)a.dataMin=C(p(a.dataMin,d[0]),Pa(d)),a.dataMax=v(p(a.dataMax,d[0]),Fa(d))}else{c.getExtremes();e=c.dataMax;c=c.dataMin;if(q(c)&&q(e))a.dataMin=C(p(a.dataMin,c),c),a.dataMax=v(p(a.dataMax,e),e);if(q(d))if(a.dataMin>=d)a.dataMin=d,a.ignoreMinPadding=!0;else if(a.dataMax<
d)a.dataMax=d,a.ignoreMaxPadding=!0}}})},translate:function(a,b,c,d,e,f){var g=this.linkedParent||this,h=1,i=0,j=d?g.oldTransA:g.transA,d=d?g.oldMin:g.min,k=g.minPixelPadding,e=(g.doPostTranslate||g.isLog&&e)&&g.lin2val;if(!j)j=g.transA;if(c)h*=-1,i=g.len;g.reversed&&(h*=-1,i-=h*(g.sector||g.len));b?(a=a*h+i,a-=k,a=a/j+d,e&&(a=g.lin2val(a))):(e&&(a=g.val2lin(a)),f==="between"&&(f=0.5),a=h*(a-d)*j+i+h*k+(ra(f)?j*f*g.pointRange:0));return a},toPixels:function(a,b){return this.translate(a,!1,!this.horiz,
null,!0)+(b?0:this.pos)},toValue:function(a,b){return this.translate(a-(b?0:this.pos),!0,!this.horiz,null,!0)},getPlotLinePath:function(a,b,c,d,e){var f=this.chart,g=this.left,h=this.top,i,j,k=c&&f.oldChartHeight||f.chartHeight,l=c&&f.oldChartWidth||f.chartWidth,m;i=this.transB;var n=function(a,b,c){if(a<b||a>c)d?a=C(v(b,a),c):m=!0;return a},e=p(e,this.translate(a,null,null,c)),a=c=s(e+i);i=j=s(k-e-i);isNaN(e)?m=!0:this.horiz?(i=h,j=k-this.bottom,a=c=n(a,g,g+this.width)):(a=g,c=l-this.right,i=j=n(i,
h,h+this.height));return m&&!d?null:f.renderer.crispLine(["M",a,i,"L",c,j],b||1)},getLinearTickPositions:function(a,b,c){var d,e=ea(V(b/a)*a),f=ea(ta(c/a)*a),g=[];if(b===c&&ra(b))return[b];for(b=e;b<=f;){g.push(b);b=ea(b+a);if(b===d)break;d=b}return g},getMinorTickPositions:function(){var a=this.options,b=this.tickPositions,c=this.minorTickInterval,d=[],e,f=this.min;e=this.max;var g=e-f;if(g&&g/c<this.len/3)if(this.isLog){a=b.length;for(e=1;e<a;e++)d=d.concat(this.getLogTickPositions(c,b[e-1],b[e],
!0))}else if(this.isDatetimeAxis&&a.minorTickInterval==="auto")d=d.concat(this.getTimeTicks(this.normalizeTimeTickInterval(c),f,e,a.startOfWeek));else for(b=f+(b[0]-f)%c;b<=e;b+=c)d.push(b);this.trimTicks(d);return d},adjustForMinRange:function(){var a=this.options,b=this.min,c=this.max,d,e=this.dataMax-this.dataMin>=this.minRange,f,g,h,i,j;if(this.isXAxis&&this.minRange===y&&!this.isLog)q(a.min)||q(a.max)?this.minRange=null:(o(this.series,function(a){i=a.xData;for(g=j=a.xIncrement?1:i.length-1;g>
0;g--)if(h=i[g]-i[g-1],f===y||h<f)f=h}),this.minRange=C(f*5,this.dataMax-this.dataMin));if(c-b<this.minRange){var k=this.minRange;d=(k-c+b)/2;d=[b-d,p(a.min,b-d)];if(e)d[2]=this.dataMin;b=Fa(d);c=[b+k,p(a.max,b+k)];if(e)c[2]=this.dataMax;c=Pa(c);c-b<k&&(d[0]=c-k,d[1]=p(a.min,c-k),b=Fa(d))}this.min=b;this.max=c},setAxisTranslation:function(a){var b=this,c=b.max-b.min,d=b.axisPointRange||0,e,f=0,g=0,h=b.linkedParent,i=!!b.categories,j=b.transA,k=b.isXAxis;if(k||i||d)if(h?(f=h.minPointOffset,g=h.pointRangePadding):
o(b.series,function(a){var h=i?1:k?a.pointRange:b.axisPointRange||0,j=a.options.pointPlacement,u=a.closestPointRange;h>c&&(h=0);d=v(d,h);b.single||(f=v(f,Da(j)?0:h/2),g=v(g,j==="on"?0:h));!a.noSharedTooltip&&q(u)&&(e=q(e)?C(e,u):u)}),h=b.ordinalSlope&&e?b.ordinalSlope/e:1,b.minPointOffset=f*=h,b.pointRangePadding=g*=h,b.pointRange=C(d,c),k)b.closestPointRange=e;if(a)b.oldTransA=j;b.translationSlope=b.transA=j=b.len/(c+g||1);b.transB=b.horiz?b.left:b.bottom;b.minPixelPadding=j*f},setTickInterval:function(a){var b=
this,c=b.chart,d=b.options,e=b.isLog,f=b.isDatetimeAxis,g=b.isXAxis,h=b.isLinked,i=d.maxPadding,j=d.minPadding,k=d.tickInterval,l=d.tickPixelInterval,m=b.categories;!f&&!m&&!h&&this.getTickAmount();h?(b.linkedParent=c[b.coll][d.linkedTo],c=b.linkedParent.getExtremes(),b.min=p(c.min,c.dataMin),b.max=p(c.max,c.dataMax),d.type!==b.linkedParent.options.type&&la(11,1)):(b.min=p(b.userMin,d.min,b.dataMin),b.max=p(b.userMax,d.max,b.dataMax));if(e)!a&&C(b.min,p(b.dataMin,b.min))<=0&&la(10,1),b.min=ea(Ea(b.min)),
b.max=ea(Ea(b.max));if(b.range&&q(b.max))b.userMin=b.min=v(b.min,b.max-b.range),b.userMax=b.max,b.range=null;b.beforePadding&&b.beforePadding();b.adjustForMinRange();if(!m&&!b.axisPointRange&&!b.usePercentage&&!h&&q(b.min)&&q(b.max)&&(c=b.max-b.min)){if(!q(d.min)&&!q(b.userMin)&&j&&(b.dataMin<0||!b.ignoreMinPadding))b.min-=c*j;if(!q(d.max)&&!q(b.userMax)&&i&&(b.dataMax>0||!b.ignoreMaxPadding))b.max+=c*i}if(ra(d.floor))b.min=v(b.min,d.floor);if(ra(d.ceiling))b.max=C(b.max,d.ceiling);b.tickInterval=
b.min===b.max||b.min===void 0||b.max===void 0?1:h&&!k&&l===b.linkedParent.options.tickPixelInterval?k=b.linkedParent.tickInterval:p(k,this.tickAmount?(b.max-b.min)/v(this.tickAmount-1,1):void 0,m?1:(b.max-b.min)*l/v(b.len,l));g&&!a&&o(b.series,function(a){a.processData(b.min!==b.oldMin||b.max!==b.oldMax)});b.setAxisTranslation(!0);b.beforeSetTickPositions&&b.beforeSetTickPositions();if(b.postProcessTickInterval)b.tickInterval=b.postProcessTickInterval(b.tickInterval);if(b.pointRange)b.tickInterval=
v(b.pointRange,b.tickInterval);a=p(d.minTickInterval,b.isDatetimeAxis&&b.closestPointRange);if(!k&&b.tickInterval<a)b.tickInterval=a;if(!f&&!e&&!k)b.tickInterval=qb(b.tickInterval,null,pb(b.tickInterval),p(d.allowDecimals,!(b.tickInterval>0.5&&b.tickInterval<5&&b.max>1E3&&b.max<9999)),!!this.tickAmount);if(!this.tickAmount&&this.len)b.tickInterval=b.unsquish();this.setTickPositions()},setTickPositions:function(){var a=this.options,b,c=a.tickPositions,d=a.tickPositioner,e=a.startOnTick,f=a.endOnTick,
g;this.tickmarkOffset=this.categories&&a.tickmarkPlacement==="between"&&this.tickInterval===1?0.5:0;this.minorTickInterval=a.minorTickInterval==="auto"&&this.tickInterval?this.tickInterval/5:a.minorTickInterval;this.tickPositions=b=c&&c.slice();if(!b&&(this.tickPositions=b=this.isDatetimeAxis?this.getTimeTicks(this.normalizeTimeTickInterval(this.tickInterval,a.units),this.min,this.max,a.startOfWeek,this.ordinalPositions,this.closestPointRange,!0):this.isLog?this.getLogTickPositions(this.tickInterval,
this.min,this.max):this.getLinearTickPositions(this.tickInterval,this.min,this.max),d&&(d=d.apply(this,[this.min,this.max]))))this.tickPositions=b=d;if(!this.isLinked)this.trimTicks(b,e,f),this.min===this.max&&q(this.min)&&!this.tickAmount&&(g=!0,this.min-=0.5,this.max+=0.5),this.single=g,!c&&!d&&this.adjustTickAmount()},trimTicks:function(a,b,c){var d=a[0],e=a[a.length-1],f=this.minPointOffset||0;b?this.min=d:this.min-f>d&&a.shift();c?this.max=e:this.max+f<e&&a.pop();a.length===0&&q(d)&&a.push((e+
d)/2)},getTickAmount:function(){var a={},b,c=this.options,d=c.tickAmount,e=c.tickPixelInterval;!q(c.tickInterval)&&this.len<e&&!this.isRadial&&!this.isLog&&c.startOnTick&&c.endOnTick&&(d=2);!d&&this.chart.options.chart.alignTicks!==!1&&c.alignTicks!==!1&&(o(this.chart[this.coll],function(c){var d=c.options,e=c.horiz,d=[e?d.left:d.top,e?d.width:d.height,d.pane].join(",");a[d]?c.series.length&&(b=!0):a[d]=1}),b&&(d=ta(this.len/e)+1));if(d<4)this.finalTickAmt=d,d=5;this.tickAmount=d},adjustTickAmount:function(){var a=
this.tickInterval,b=this.tickPositions,c=this.tickAmount,d=this.finalTickAmt,e=b&&b.length;if(e<c){for(;b.length<c;)b.push(ea(b[b.length-1]+a));this.transA*=(e-1)/(c-1);this.max=b[b.length-1]}else e>c&&(this.tickInterval*=2,this.setTickPositions());if(q(d)){for(a=c=b.length;a--;)(d===3&&a%2===1||d<=2&&a>0&&a<c-1)&&b.splice(a,1);this.finalTickAmt=y}},setScale:function(){var a=this.stacks,b,c,d,e;this.oldMin=this.min;this.oldMax=this.max;this.oldAxisLength=this.len;this.setAxisSize();e=this.len!==this.oldAxisLength;
o(this.series,function(a){if(a.isDirtyData||a.isDirty||a.xAxis.isDirty)d=!0});if(e||d||this.isLinked||this.forceRedraw||this.userMin!==this.oldUserMin||this.userMax!==this.oldUserMax){if(!this.isXAxis)for(b in a)for(c in a[b])a[b][c].total=null,a[b][c].cum=0;this.forceRedraw=!1;this.getSeriesExtremes();this.setTickInterval();this.oldUserMin=this.userMin;this.oldUserMax=this.userMax;if(!this.isDirty)this.isDirty=e||this.min!==this.oldMin||this.max!==this.oldMax}else if(!this.isXAxis){if(this.oldStacks)a=
this.stacks=this.oldStacks;for(b in a)for(c in a[b])a[b][c].cum=a[b][c].total}},setExtremes:function(a,b,c,d,e){var f=this,g=f.chart,c=p(c,!0);o(f.series,function(a){delete a.kdTree});e=x(e,{min:a,max:b});I(f,"setExtremes",e,function(){f.userMin=a;f.userMax=b;f.eventArgs=e;f.isDirtyExtremes=!0;c&&g.redraw(d)})},zoom:function(a,b){var c=this.dataMin,d=this.dataMax,e=this.options;this.allowZoomOutside||(q(c)&&a<=C(c,p(e.min,c))&&(a=y),q(d)&&b>=v(d,p(e.max,d))&&(b=y));this.displayBtn=a!==y||b!==y;this.setExtremes(a,
b,!1,y,{trigger:"zoom"});return!0},setAxisSize:function(){var a=this.chart,b=this.options,c=b.offsetLeft||0,d=this.horiz,e=p(b.width,a.plotWidth-c+(b.offsetRight||0)),f=p(b.height,a.plotHeight),g=p(b.top,a.plotTop),b=p(b.left,a.plotLeft+c),c=/%$/;c.test(f)&&(f=parseFloat(f)/100*a.plotHeight);c.test(g)&&(g=parseFloat(g)/100*a.plotHeight+a.plotTop);this.left=b;this.top=g;this.width=e;this.height=f;this.bottom=a.chartHeight-f-g;this.right=a.chartWidth-e-b;this.len=v(d?e:f,0);this.pos=d?b:g},getExtremes:function(){var a=
this.isLog;return{min:a?ea(ia(this.min)):this.min,max:a?ea(ia(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}},getThreshold:function(a){var b=this.isLog,c=b?ia(this.min):this.min,b=b?ia(this.max):this.max;c>a||a===null?a=c:b<a&&(a=b);return this.translate(a,0,1,0,1)},autoLabelAlign:function(a){a=(p(a,0)-this.side*90+720)%360;return a>15&&a<165?"right":a>195&&a<345?"left":"center"},unsquish:function(){var a=this.ticks,b=this.options.labels,c=
this.horiz,d=this.tickInterval,e=d,f=this.len/(((this.categories?1:0)+this.max-this.min)/d),g,h=b.rotation,i=this.chart.renderer.fontMetrics(b.style.fontSize,a[0]&&a[0].label),j,k=Number.MAX_VALUE,l,m=function(a){a/=f||1;a=a>1?ta(a):1;return a*d};c?(l=q(h)?[h]:f<p(b.autoRotationLimit,80)&&!b.staggerLines&&!b.step&&b.autoRotation)&&o(l,function(a){var b;if(a===h||a&&a>=-90&&a<=90)j=m(N(i.h/aa(ha*a))),b=j+N(a/360),b<k&&(k=b,g=a,e=j)}):e=m(i.h);this.autoRotation=l;this.labelRotation=g;return e},renderUnsquish:function(){var a=
this.chart,b=a.renderer,c=this.tickPositions,d=this.ticks,e=this.options.labels,f=this.horiz,g=a.margin,h=this.categories?c.length:c.length-1,h=this.slotWidth=f&&!e.step&&!e.rotation&&(this.staggerLines||1)*a.plotWidth/h||!f&&(g[3]&&g[3]-a.spacing[3]||a.chartWidth*0.33),i=v(1,s(h-2*(e.padding||5))),j={},g=b.fontMetrics(e.style.fontSize,d[0]&&d[0].label),k,l=0;if(!Da(e.rotation))j.rotation=e.rotation;if(this.autoRotation)o(c,function(a){if((a=d[a])&&a.labelLength>l)l=a.labelLength}),l>i&&l>g.h?j.rotation=
this.labelRotation:this.labelRotation=0;else if(h){k={width:i+"px",textOverflow:"clip"};for(h=c.length;!f&&h--;)if(i=c[h],i=d[i].label)if(i.styles.textOverflow==="ellipsis"&&i.css({textOverflow:"clip"}),i.getBBox().height>this.len/c.length-(g.h-g.f))i.specCss={textOverflow:"ellipsis"}}j.rotation&&(k={width:(l>a.chartHeight*0.5?a.chartHeight*0.33:a.chartHeight)+"px",textOverflow:"ellipsis"});this.labelAlign=j.align=e.align||this.autoLabelAlign(this.labelRotation);o(c,function(a){var b=(a=d[a])&&a.label;
if(b)k&&b.css(A(k,b.specCss)),delete b.specCss,b.attr(j),a.rotation=j.rotation});this.tickRotCorr=b.rotCorr(g.b,this.labelRotation||0,this.side===2)},getOffset:function(){var a=this,b=a.chart,c=b.renderer,d=a.options,e=a.tickPositions,f=a.ticks,g=a.horiz,h=a.side,i=b.inverted?[1,0,3,2][h]:h,j,k,l=0,m,n=0,u=d.title,r=d.labels,S=0,Q=b.axisOffset,b=b.clipOffset,t=[-1,1,1,-1][h],w;a.hasData=j=a.hasVisibleSeries||q(a.min)&&q(a.max)&&!!e;a.showAxis=k=j||p(d.showEmpty,!0);a.staggerLines=a.horiz&&r.staggerLines;
if(!a.axisGroup)a.gridGroup=c.g("grid").attr({zIndex:d.gridZIndex||1}).add(),a.axisGroup=c.g("axis").attr({zIndex:d.zIndex||2}).add(),a.labelGroup=c.g("axis-labels").attr({zIndex:r.zIndex||7}).addClass("highcharts-"+a.coll.toLowerCase()+"-labels").add();if(j||a.isLinked){if(o(e,function(b){f[b]?f[b].addLabel():f[b]=new Ta(a,b)}),a.renderUnsquish(),o(e,function(b){if(h===0||h===2||{1:"left",3:"right"}[h]===a.labelAlign)S=v(f[b].getLabelSize(),S)}),a.staggerLines)S*=a.staggerLines,a.labelOffset=S}else for(w in f)f[w].destroy(),
delete f[w];if(u&&u.text&&u.enabled!==!1){if(!a.axisTitle)a.axisTitle=c.text(u.text,0,0,u.useHTML).attr({zIndex:7,rotation:u.rotation||0,align:u.textAlign||{low:"left",middle:"center",high:"right"}[u.align]}).addClass("highcharts-"+this.coll.toLowerCase()+"-title").css(u.style).add(a.axisGroup),a.axisTitle.isNew=!0;if(k)l=a.axisTitle.getBBox()[g?"height":"width"],m=u.offset,n=q(m)?0:p(u.margin,g?5:10);a.axisTitle[k?"show":"hide"]()}a.offset=t*p(d.offset,Q[h]);a.tickRotCorr=a.tickRotCorr||{x:0,y:0};
c=h===2?a.tickRotCorr.y:0;g=S+n+(S&&t*(g?p(r.y,a.tickRotCorr.y+8):r.x)-c);a.axisTitleMargin=p(m,g);Q[h]=v(Q[h],a.axisTitleMargin+l+t*a.offset,g);b[i]=v(b[i],V(d.lineWidth/2)*2)},getLinePath:function(a){var b=this.chart,c=this.opposite,d=this.offset,e=this.horiz,f=this.left+(c?this.width:0)+d,d=b.chartHeight-this.bottom-(c?this.height:0)+d;c&&(a*=-1);return b.renderer.crispLine(["M",e?this.left:f,e?d:this.top,"L",e?b.chartWidth-this.right:f,e?d:b.chartHeight-this.bottom],a)},getTitlePosition:function(){var a=
this.horiz,b=this.left,c=this.top,d=this.len,e=this.options.title,f=a?b:c,g=this.opposite,h=this.offset,i=e.x||0,j=e.y||0,k=F(e.style.fontSize||12),d={low:f+(a?0:d),middle:f+d/2,high:f+(a?d:0)}[e.align],b=(a?c+this.height:b)+(a?1:-1)*(g?-1:1)*this.axisTitleMargin+(this.side===2?k:0);return{x:a?d+i:b+(g?this.width:0)+h+i,y:a?b+j-(g?this.height:0)+h:d+j}},render:function(){var a=this,b=a.chart,c=b.renderer,d=a.options,e=a.isLog,f=a.isLinked,g=a.tickPositions,h=a.axisTitle,i=a.ticks,j=a.minorTicks,k=
a.alternateBands,l=d.stackLabels,m=d.alternateGridColor,n=a.tickmarkOffset,u=d.lineWidth,r,p=b.hasRendered&&q(a.oldMin)&&!isNaN(a.oldMin);r=a.hasData;var Q=a.showAxis,t,w;a.labelEdge.length=0;a.overlap=!1;o([i,j,k],function(a){for(var b in a)a[b].isActive=!1});if(r||f){a.minorTickInterval&&!a.categories&&o(a.getMinorTickPositions(),function(b){j[b]||(j[b]=new Ta(a,b,"minor"));p&&j[b].isNew&&j[b].render(null,!0);j[b].render(null,!1,1)});if(g.length&&(o(g,function(b,c){if(!f||b>=a.min&&b<=a.max)i[b]||
(i[b]=new Ta(a,b)),p&&i[b].isNew&&i[b].render(c,!0,0.1),i[b].render(c)}),n&&(a.min===0||a.single)))i[-1]||(i[-1]=new Ta(a,-1,null,!0)),i[-1].render(-1);m&&o(g,function(b,c){if(c%2===0&&b<a.max)k[b]||(k[b]=new z.PlotLineOrBand(a)),t=b+n,w=g[c+1]!==y?g[c+1]+n:a.max,k[b].options={from:e?ia(t):t,to:e?ia(w):w,color:m},k[b].render(),k[b].isActive=!0});if(!a._addedPlotLB)o((d.plotLines||[]).concat(d.plotBands||[]),function(b){a.addPlotBandOrLine(b)}),a._addedPlotLB=!0}o([i,j,k],function(a){var c,d,e=[],
f=za?za.duration||500:0,g=function(){for(d=e.length;d--;)a[e[d]]&&!a[e[d]].isActive&&(a[e[d]].destroy(),delete a[e[d]])};for(c in a)if(!a[c].isActive)a[c].render(c,!1,0),a[c].isActive=!1,e.push(c);a===k||!b.hasRendered||!f?g():f&&setTimeout(g,f)});if(u)r=a.getLinePath(u),a.axisLine?a.axisLine.animate({d:r}):a.axisLine=c.path(r).attr({stroke:d.lineColor,"stroke-width":u,zIndex:7}).add(a.axisGroup),a.axisLine[Q?"show":"hide"]();if(h&&Q)h[h.isNew?"attr":"animate"](a.getTitlePosition()),h.isNew=!1;l&&
l.enabled&&a.renderStackTotals();a.isDirty=!1},redraw:function(){this.render();o(this.plotLinesAndBands,function(a){a.render()});o(this.series,function(a){a.isDirty=!0})},destroy:function(a){var b=this,c=b.stacks,d,e=b.plotLinesAndBands;a||Z(b);for(d in c)Qa(c[d]),c[d]=null;o([b.ticks,b.minorTicks,b.alternateBands],function(a){Qa(a)});for(a=e.length;a--;)e[a].destroy();o("stackTotalGroup,axisLine,axisTitle,axisGroup,cross,gridGroup,labelGroup".split(","),function(a){b[a]&&(b[a]=b[a].destroy())});
this.cross&&this.cross.destroy()},drawCrosshair:function(a,b){var c,d=this.crosshair,e=d.animation;if(!this.crosshair||(q(b)||!p(this.crosshair.snap,!0))===!1||b&&b.series&&b.series[this.coll]!==this)this.hideCrosshair();else if(p(d.snap,!0)?q(b)&&(c=this.isXAxis?b.plotX:this.len-b.plotY):c=this.horiz?a.chartX-this.pos:this.len-a.chartY+this.pos,c=this.isRadial?this.getPlotLinePath(this.isXAxis?b.x:p(b.stackY,b.y))||null:this.getPlotLinePath(null,null,null,null,c)||null,c===null)this.hideCrosshair();
else if(this.cross)this.cross.attr({visibility:"visible"})[e?"animate":"attr"]({d:c},e);else{e=this.categories&&!this.isRadial;e={"stroke-width":d.width||(e?this.transA:1),stroke:d.color||(e?"rgba(155,200,255,0.2)":"#C0C0C0"),zIndex:d.zIndex||2};if(d.dashStyle)e.dashstyle=d.dashStyle;this.cross=this.chart.renderer.path(c).attr(e).add()}},hideCrosshair:function(){this.cross&&this.cross.hide()}};x(va.prototype,{getPlotBandPath:function(a,b){var c=this.getPlotLinePath(b,null,null,!0),d=this.getPlotLinePath(a,
null,null,!0);d&&c&&d.toString()!==c.toString()?d.push(c[4],c[5],c[1],c[2]):d=null;return d},addPlotBand:function(a){return this.addPlotBandOrLine(a,"plotBands")},addPlotLine:function(a){return this.addPlotBandOrLine(a,"plotLines")},addPlotBandOrLine:function(a,b){var c=(new z.PlotLineOrBand(this,a)).render(),d=this.userOptions;c&&(b&&(d[b]=d[b]||[],d[b].push(a)),this.plotLinesAndBands.push(c));return c},removePlotBandOrLine:function(a){for(var b=this.plotLinesAndBands,c=this.options,d=this.userOptions,
e=b.length;e--;)b[e].id===a&&b[e].destroy();o([c.plotLines||[],d.plotLines||[],c.plotBands||[],d.plotBands||[]],function(b){for(e=b.length;e--;)b[e].id===a&&ja(b,b[e])})}});va.prototype.getTimeTicks=function(a,b,c,d){var e=[],f={},g=T.global.useUTC,h,i=new Aa(b-Wa(b)),j=a.unitRange,k=a.count;if(q(b)){i[Db](j>=D.second?0:k*V(i.getMilliseconds()/k));if(j>=D.second)i[Eb](j>=D.minute?0:k*V(i.getSeconds()/k));if(j>=D.minute)i[Fb](j>=D.hour?0:k*V(i[sb]()/k));if(j>=D.hour)i[Gb](j>=D.day?0:k*V(i[tb]()/k));
if(j>=D.day)i[vb](j>=D.month?1:k*V(i[Xa]()/k));j>=D.month&&(i[wb](j>=D.year?0:k*V(i[Ya]()/k)),h=i[Za]());j>=D.year&&(h-=h%k,i[xb](h));if(j===D.week)i[vb](i[Xa]()-i[ub]()+p(d,1));b=1;if(ob||eb)i=i.getTime(),i=new Aa(i+Wa(i));h=i[Za]();for(var d=i.getTime(),l=i[Ya](),m=i[Xa](),n=(D.day+(g?Wa(i):i.getTimezoneOffset()*6E4))%D.day;d<c;)e.push(d),j===D.year?d=gb(h+b*k,0):j===D.month?d=gb(h,l+b*k):!g&&(j===D.day||j===D.week)?d=gb(h,l,m+b*k*(j===D.day?1:7)):d+=j*k,b++;e.push(d);o(lb(e,function(a){return j<=
D.hour&&a%D.day===n}),function(a){f[a]="day"})}e.info=x(a,{higherRanks:f,totalRange:j*k});return e};va.prototype.normalizeTimeTickInterval=function(a,b){var c=b||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],d=c[c.length-1],e=D[d[0]],f=d[1],g;for(g=0;g<c.length;g++)if(d=c[g],e=D[d[0]],f=d[1],c[g+1]&&a<=(e*f[f.length-1]+D[c[g+1][0]])/2)break;e===D.year&&
a<5*e&&(f=[1,2,5]);c=qb(a/e,f,d[0]==="year"?v(pb(a/e),1):1);return{unitRange:e,count:c,unitName:d[0]}};va.prototype.getLogTickPositions=function(a,b,c,d){var e=this.options,f=this.len,g=[];if(!d)this._minorAutoInterval=null;if(a>=0.5)a=s(a),g=this.getLinearTickPositions(a,b,c);else if(a>=0.08)for(var f=V(b),h,i,j,k,l,e=a>0.3?[1,2,4]:a>0.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];f<c+1&&!l;f++){i=e.length;for(h=0;h<i&&!l;h++)j=Ea(ia(f)*e[h]),j>b&&(!d||k<=c)&&k!==y&&g.push(k),k>c&&(l=!0),k=j}else if(b=ia(b),
c=ia(c),a=e[d?"minorTickInterval":"tickInterval"],a=p(a==="auto"?null:a,this._minorAutoInterval,(c-b)*(e.tickPixelInterval/(d?5:1))/((d?f/this.tickPositions.length:f)||1)),a=qb(a,null,pb(a)),g=Ua(this.getLinearTickPositions(a,b,c),Ea),!d)this._minorAutoInterval=a/5;if(!d)this.tickInterval=a;return g};var Mb=z.Tooltip=function(){this.init.apply(this,arguments)};Mb.prototype={init:function(a,b){var c=b.borderWidth,d=b.style,e=F(d.padding);this.chart=a;this.options=b;this.crosshairs=[];this.now={x:0,
y:0};this.isHidden=!0;this.label=a.renderer.label("",0,0,b.shape||"callout",null,null,b.useHTML,null,"tooltip").attr({padding:e,fill:b.backgroundColor,"stroke-width":c,r:b.borderRadius,zIndex:8}).css(d).css({padding:0}).add().attr({y:-9999});fa||this.label.shadow(b.shadow);this.shared=b.shared},destroy:function(){if(this.label)this.label=this.label.destroy();clearTimeout(this.hideTimer);clearTimeout(this.tooltipTimeout)},move:function(a,b,c,d){var e=this,f=e.now,g=e.options.animation!==!1&&!e.isHidden&&
(N(a-f.x)>1||N(b-f.y)>1),h=e.followPointer||e.len>1;x(f,{x:g?(2*f.x+a)/3:a,y:g?(f.y+b)/2:b,anchorX:h?y:g?(2*f.anchorX+c)/3:c,anchorY:h?y:g?(f.anchorY+d)/2:d});e.label.attr(f);if(g)clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){e&&e.move(a,b,c,d)},32)},hide:function(a){var b=this;clearTimeout(this.hideTimer);if(!this.isHidden)this.hideTimer=setTimeout(function(){b.label.fadeOut();b.isHidden=!0},p(a,this.options.hideDelay,500))},getAnchor:function(a,b){var c,d=this.chart,
e=d.inverted,f=d.plotTop,g=d.plotLeft,h=0,i=0,j,k,a=sa(a);c=a[0].tooltipPos;this.followPointer&&b&&(b.chartX===y&&(b=d.pointer.normalize(b)),c=[b.chartX-d.plotLeft,b.chartY-f]);c||(o(a,function(a){j=a.series.yAxis;k=a.series.xAxis;h+=a.plotX+(!e&&k?k.left-g:0);i+=(a.plotLow?(a.plotLow+a.plotHigh)/2:a.plotY)+(!e&&j?j.top-f:0)}),h/=a.length,i/=a.length,c=[e?d.plotWidth-i:h,this.shared&&!e&&a.length>1&&b?b.chartY-f:e?d.plotHeight-h:i]);return Ua(c,s)},getPosition:function(a,b,c){var d=this.chart,e=this.distance,
f={},g=c.h||0,h,i=["y",d.chartHeight,b,c.plotY+d.plotTop],j=["x",d.chartWidth,a,c.plotX+d.plotLeft],k=p(c.ttBelow,d.inverted&&!c.negative||!d.inverted&&c.negative),l=function(a,b,c,d){var h=c<d-e,i=d+e+c<b,j=d-e-c;d+=e;if(k&&i)f[a]=d;else if(!k&&h)f[a]=j;else if(h)f[a]=j-g<0?j:j-g;else if(i)f[a]=d+g+c>b?d:d+g;else return!1},m=function(a,b,c,d){if(d<e||d>b-e)return!1;else f[a]=d<c/2?1:d>b-c/2?b-c-2:d-c/2},n=function(a){var b=i;i=j;j=b;h=a},u=function(){l.apply(0,i)!==!1?m.apply(0,j)===!1&&!h&&(n(!0),
u()):h?f.x=f.y=0:(n(!0),u())};(d.inverted||this.len>1)&&n();u();return f},defaultFormatter:function(a){var b=this.points||sa(this),c;c=[a.tooltipFooterHeaderFormatter(b[0])];c=c.concat(a.bodyFormatter(b));c.push(a.tooltipFooterHeaderFormatter(b[0],!0));return c.join("")},refresh:function(a,b){var c=this.chart,d=this.label,e=this.options,f,g,h,i={},j,k=[];j=e.formatter||this.defaultFormatter;var i=c.hoverPoints,l,m=this.shared;clearTimeout(this.hideTimer);this.followPointer=sa(a)[0].series.tooltipOptions.followPointer;
h=this.getAnchor(a,b);f=h[0];g=h[1];m&&(!a.series||!a.series.noSharedTooltip)?(c.hoverPoints=a,i&&o(i,function(a){a.setState()}),o(a,function(a){a.setState("hover");k.push(a.getLabelConfig())}),i={x:a[0].category,y:a[0].y},i.points=k,this.len=k.length,a=a[0]):i=a.getLabelConfig();j=j.call(i,this);i=a.series;this.distance=p(i.tooltipOptions.distance,16);j===!1?this.hide():(this.isHidden&&(db(d),d.attr("opacity",1).show()),d.attr({text:j}),l=e.borderColor||a.color||i.color||"#606060",d.attr({stroke:l}),
this.updatePosition({plotX:f,plotY:g,negative:a.negative,ttBelow:a.ttBelow,h:h[2]||0}),this.isHidden=!1);I(c,"tooltipRefresh",{text:j,x:f+c.plotLeft,y:g+c.plotTop,borderColor:l})},updatePosition:function(a){var b=this.chart,c=this.label,c=(this.options.positioner||this.getPosition).call(this,c.width,c.height,a);this.move(s(c.x),s(c.y||0),a.plotX+b.plotLeft,a.plotY+b.plotTop)},getXDateFormat:function(a,b,c){var d,b=b.dateTimeLabelFormats,e=c&&c.closestPointRange,f,g={millisecond:15,second:12,minute:9,
hour:6,day:3},h,i="millisecond";if(e){h=Oa("%m-%d %H:%M:%S.%L",a.x);for(f in D){if(e===D.week&&+Oa("%w",a.x)===c.options.startOfWeek&&h.substr(6)==="00:00:00.000"){f="week";break}else if(D[f]>e){f=i;break}else if(g[f]&&h.substr(g[f])!=="01-01 00:00:00.000".substr(g[f]))break;f!=="week"&&(i=f)}f&&(d=b[f])}else d=b.day;return d||b.year},tooltipFooterHeaderFormatter:function(a,b){var c=b?"footer":"header",d=a.series,e=d.tooltipOptions,f=e.xDateFormat,g=d.xAxis,h=g&&g.options.type==="datetime"&&ra(a.key),
c=e[c+"Format"];h&&!f&&(f=this.getXDateFormat(a,e,g));h&&f&&(c=c.replace("{point.key}","{point.key:"+f+"}"));return Ja(c,{point:a,series:d})},bodyFormatter:function(a){return Ua(a,function(a){var c=a.series.tooltipOptions;return(c.pointFormatter||a.point.tooltipFormatter).call(a.point,c.pointFormat)})}};var pa;ab=B.documentElement.ontouchstart!==y;var Va=z.Pointer=function(a,b){this.init(a,b)};Va.prototype={init:function(a,b){var c=b.chart,d=c.events,e=fa?"":c.zoomType,c=a.inverted,f;this.options=
b;this.chart=a;this.zoomX=f=/x/.test(e);this.zoomY=e=/y/.test(e);this.zoomHor=f&&!c||e&&c;this.zoomVert=e&&!c||f&&c;this.hasZoom=f||e;this.runChartClick=d&&!!d.click;this.pinchDown=[];this.lastValidTouch={};if(z.Tooltip&&b.tooltip.enabled)a.tooltip=new Mb(a,b.tooltip),this.followTouchMove=p(b.tooltip.followTouchMove,!0);this.setDOMEvents()},normalize:function(a,b){var c,d,a=a||window.event,a=Sb(a);if(!a.target)a.target=a.srcElement;d=a.touches?a.touches.length?a.touches.item(0):a.changedTouches[0]:
a;if(!b)this.chartPosition=b=Rb(this.chart.container);d.pageX===y?(c=v(a.x,a.clientX-b.left),d=a.y):(c=d.pageX-b.left,d=d.pageY-b.top);return x(a,{chartX:s(c),chartY:s(d)})},getCoordinates:function(a){var b={xAxis:[],yAxis:[]};o(this.chart.axes,function(c){b[c.isXAxis?"xAxis":"yAxis"].push({axis:c,value:c.toValue(a[c.horiz?"chartX":"chartY"])})});return b},runPointActions:function(a){var b=this.chart,c=b.series,d=b.tooltip,e=d?d.shared:!1,f=b.hoverPoint,g=b.hoverSeries,h,i=b.chartWidth,j,k,l=[],m,
n;if(!e&&!g)for(h=0;h<c.length;h++)if(c[h].directTouch||!c[h].options.stickyTracking)c=[];!e&&g&&g.directTouch&&f?m=f:(o(c,function(b){j=b.noSharedTooltip&&e;k=!e&&b.directTouch;b.visible&&!j&&!k&&p(b.options.enableMouseTracking,!0)&&(n=b.searchPoint(a,!j&&b.kdDimensions===1))&&l.push(n)}),o(l,function(a){if(a&&typeof a.dist==="number"&&a.dist<i)i=a.dist,m=a}));if(m&&(m!==this.prevKDPoint||d&&d.isHidden)){if(e&&!m.series.noSharedTooltip){for(h=l.length;h--;)(l[h].clientX!==m.clientX||l[h].series.noSharedTooltip)&&
l.splice(h,1);l.length&&d&&d.refresh(l,a);o(l,function(b){if(b!==m)b.onMouseOver(a)});(g&&g.directTouch&&f||m).onMouseOver(a)}else d&&d.refresh(m,a),m.onMouseOver(a);this.prevKDPoint=m}else c=g&&g.tooltipOptions.followPointer,d&&c&&!d.isHidden&&(c=d.getAnchor([{}],a),d.updatePosition({plotX:c[0],plotY:c[1]}));if(d&&!this._onDocumentMouseMove)this._onDocumentMouseMove=function(a){if(Y[pa])Y[pa].pointer.onDocumentMouseMove(a)},H(B,"mousemove",this._onDocumentMouseMove);o(b.axes,function(b){b.drawCrosshair(a,
p(m,f))})},reset:function(a,b){var c=this.chart,d=c.hoverSeries,e=c.hoverPoint,f=c.hoverPoints,g=c.tooltip,h=g&&g.shared?f:e;(a=a&&g&&h)&&sa(h)[0].plotX===y&&(a=!1);if(a)g.refresh(h),e&&(e.setState(e.state,!0),o(c.axes,function(a){p(a.options.crosshair&&a.options.crosshair.snap,!0)?a.drawCrosshair(null,e):a.hideCrosshair()}));else{if(e)e.onMouseOut();f&&o(f,function(a){a.setState()});if(d)d.onMouseOut();g&&g.hide(b);if(this._onDocumentMouseMove)Z(B,"mousemove",this._onDocumentMouseMove),this._onDocumentMouseMove=
null;o(c.axes,function(a){a.hideCrosshair()});this.hoverX=c.hoverPoints=c.hoverPoint=null}},scaleGroups:function(a,b){var c=this.chart,d;o(c.series,function(e){d=a||e.getPlotBox();e.xAxis&&e.xAxis.zoomEnabled&&(e.group.attr(d),e.markerGroup&&(e.markerGroup.attr(d),e.markerGroup.clip(b?c.clipRect:null)),e.dataLabelsGroup&&e.dataLabelsGroup.attr(d))});c.clipRect.attr(b||c.clipBox)},dragStart:function(a){var b=this.chart;b.mouseIsDown=a.type;b.cancelClick=!1;b.mouseDownX=this.mouseDownX=a.chartX;b.mouseDownY=
this.mouseDownY=a.chartY},drag:function(a){var b=this.chart,c=b.options.chart,d=a.chartX,e=a.chartY,f=this.zoomHor,g=this.zoomVert,h=b.plotLeft,i=b.plotTop,j=b.plotWidth,k=b.plotHeight,l,m=this.mouseDownX,n=this.mouseDownY,u=c.panKey&&a[c.panKey+"Key"];d<h?d=h:d>h+j&&(d=h+j);e<i?e=i:e>i+k&&(e=i+k);this.hasDragged=Math.sqrt(Math.pow(m-d,2)+Math.pow(n-e,2));if(this.hasDragged>10){l=b.isInsidePlot(m-h,n-i);if(b.hasCartesianSeries&&(this.zoomX||this.zoomY)&&l&&!u&&!this.selectionMarker)this.selectionMarker=
b.renderer.rect(h,i,f?1:j,g?1:k,0).attr({fill:c.selectionMarkerFill||"rgba(69,114,167,0.25)",zIndex:7}).add();this.selectionMarker&&f&&(d-=m,this.selectionMarker.attr({width:N(d),x:(d>0?0:d)+m}));this.selectionMarker&&g&&(d=e-n,this.selectionMarker.attr({height:N(d),y:(d>0?0:d)+n}));l&&!this.selectionMarker&&c.panning&&b.pan(a,c.panning)}},drop:function(a){var b=this,c=this.chart,d=this.hasPinched;if(this.selectionMarker){var e={xAxis:[],yAxis:[],originalEvent:a.originalEvent||a},f=this.selectionMarker,
g=f.attr?f.attr("x"):f.x,h=f.attr?f.attr("y"):f.y,i=f.attr?f.attr("width"):f.width,j=f.attr?f.attr("height"):f.height,k;if(this.hasDragged||d)o(c.axes,function(c){if(c.zoomEnabled&&q(c.min)&&(d||b[{xAxis:"zoomX",yAxis:"zoomY"}[c.coll]])){var f=c.horiz,n=a.type==="touchend"?c.minPixelPadding:0,u=c.toValue((f?g:h)+n),f=c.toValue((f?g+i:h+j)-n);e[c.coll].push({axis:c,min:C(u,f),max:v(u,f)});k=!0}}),k&&I(c,"selection",e,function(a){c.zoom(x(a,d?{animation:!1}:null))});this.selectionMarker=this.selectionMarker.destroy();
d&&this.scaleGroups()}if(c)L(c.container,{cursor:c._cursor}),c.cancelClick=this.hasDragged>10,c.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[]},onContainerMouseDown:function(a){a=this.normalize(a);a.preventDefault&&a.preventDefault();this.dragStart(a)},onDocumentMouseUp:function(a){Y[pa]&&Y[pa].pointer.drop(a)},onDocumentMouseMove:function(a){var b=this.chart,c=this.chartPosition,a=this.normalize(a,c);c&&!this.inClass(a.target,"highcharts-tracker")&&!b.isInsidePlot(a.chartX-b.plotLeft,
a.chartY-b.plotTop)&&this.reset()},onContainerMouseLeave:function(){var a=Y[pa];if(a)a.pointer.reset(),a.pointer.chartPosition=null},onContainerMouseMove:function(a){var b=this.chart;pa=b.index;a=this.normalize(a);a.returnValue=!1;b.mouseIsDown==="mousedown"&&this.drag(a);(this.inClass(a.target,"highcharts-tracker")||b.isInsidePlot(a.chartX-b.plotLeft,a.chartY-b.plotTop))&&!b.openMenu&&this.runPointActions(a)},inClass:function(a,b){for(var c;a;){if(c=J(a,"class"))if(c.indexOf(b)!==-1)return!0;else if(c.indexOf("highcharts-container")!==
-1)return!1;a=a.parentNode}},onTrackerMouseOut:function(a){var b=this.chart.hoverSeries,c=(a=a.relatedTarget||a.toElement)&&a.point&&a.point.series;if(b&&!b.options.stickyTracking&&!this.inClass(a,"highcharts-tooltip")&&c!==b)b.onMouseOut()},onContainerClick:function(a){var b=this.chart,c=b.hoverPoint,d=b.plotLeft,e=b.plotTop,a=this.normalize(a);a.originalEvent=a;b.cancelClick||(c&&this.inClass(a.target,"highcharts-tracker")?(I(c.series,"click",x(a,{point:c})),b.hoverPoint&&c.firePointEvent("click",
a)):(x(a,this.getCoordinates(a)),b.isInsidePlot(a.chartX-d,a.chartY-e)&&I(b,"click",a)))},setDOMEvents:function(){var a=this,b=a.chart.container;b.onmousedown=function(b){a.onContainerMouseDown(b)};b.onmousemove=function(b){a.onContainerMouseMove(b)};b.onclick=function(b){a.onContainerClick(b)};H(b,"mouseleave",a.onContainerMouseLeave);bb===1&&H(B,"mouseup",a.onDocumentMouseUp);if(ab)b.ontouchstart=function(b){a.onContainerTouchStart(b)},b.ontouchmove=function(b){a.onContainerTouchMove(b)},bb===1&&
H(B,"touchend",a.onDocumentTouchEnd)},destroy:function(){var a;Z(this.chart.container,"mouseleave",this.onContainerMouseLeave);bb||(Z(B,"mouseup",this.onDocumentMouseUp),Z(B,"touchend",this.onDocumentTouchEnd));clearInterval(this.tooltipTimeout);for(a in this)this[a]=null}};x(z.Pointer.prototype,{pinchTranslate:function(a,b,c,d,e,f){(this.zoomHor||this.pinchHor)&&this.pinchTranslateDirection(!0,a,b,c,d,e,f);(this.zoomVert||this.pinchVert)&&this.pinchTranslateDirection(!1,a,b,c,d,e,f)},pinchTranslateDirection:function(a,
b,c,d,e,f,g,h){var i=this.chart,j=a?"x":"y",k=a?"X":"Y",l="chart"+k,m=a?"width":"height",n=i["plot"+(a?"Left":"Top")],u,r,p=h||1,o=i.inverted,t=i.bounds[a?"h":"v"],w=b.length===1,q=b[0][l],v=c[0][l],s=!w&&b[1][l],y=!w&&c[1][l],x,c=function(){!w&&N(q-s)>20&&(p=h||N(v-y)/N(q-s));r=(n-v)/p+q;u=i["plot"+(a?"Width":"Height")]/p};c();b=r;b<t.min?(b=t.min,x=!0):b+u>t.max&&(b=t.max-u,x=!0);x?(v-=0.8*(v-g[j][0]),w||(y-=0.8*(y-g[j][1])),c()):g[j]=[v,y];o||(f[j]=r-n,f[m]=u);f=o?1/p:p;e[m]=u;e[j]=b;d[o?a?"scaleY":
"scaleX":"scale"+k]=p;d["translate"+k]=f*n+(v-f*q)},pinch:function(a){var b=this,c=b.chart,d=b.pinchDown,e=a.touches,f=e.length,g=b.lastValidTouch,h=b.hasZoom,i=b.selectionMarker,j={},k=f===1&&(b.inClass(a.target,"highcharts-tracker")&&c.runTrackerClick||b.runChartClick),l={};if(f>1)b.initiated=!0;h&&b.initiated&&!k&&a.preventDefault();Ua(e,function(a){return b.normalize(a)});if(a.type==="touchstart")o(e,function(a,b){d[b]={chartX:a.chartX,chartY:a.chartY}}),g.x=[d[0].chartX,d[1]&&d[1].chartX],g.y=
[d[0].chartY,d[1]&&d[1].chartY],o(c.axes,function(a){if(a.zoomEnabled){var b=c.bounds[a.horiz?"h":"v"],d=a.minPixelPadding,e=a.toPixels(p(a.options.min,a.dataMin)),f=a.toPixels(p(a.options.max,a.dataMax)),g=C(e,f),e=v(e,f);b.min=C(a.pos,g-d);b.max=v(a.pos+a.len,e+d)}}),b.res=!0;else if(d.length){if(!i)b.selectionMarker=i=x({destroy:na},c.plotBox);b.pinchTranslate(d,e,j,i,l,g);b.hasPinched=h;b.scaleGroups(j,l);if(!h&&b.followTouchMove&&f===1)this.runPointActions(b.normalize(a));else if(b.res)b.res=
!1,this.reset(!1,0)}},touch:function(a,b){var c=this.chart;pa=c.index;a.touches.length===1?(a=this.normalize(a),c.isInsidePlot(a.chartX-c.plotLeft,a.chartY-c.plotTop)&&!c.openMenu?(b&&this.runPointActions(a),this.pinch(a)):b&&this.reset()):a.touches.length===2&&this.pinch(a)},onContainerTouchStart:function(a){this.touch(a,!0)},onContainerTouchMove:function(a){this.touch(a)},onDocumentTouchEnd:function(a){Y[pa]&&Y[pa].pointer.drop(a)}});if(K.PointerEvent||K.MSPointerEvent){var wa={},Ab=!!K.PointerEvent,
Wb=function(){var a,b=[];b.item=function(a){return this[a]};for(a in wa)wa.hasOwnProperty(a)&&b.push({pageX:wa[a].pageX,pageY:wa[a].pageY,target:wa[a].target});return b},Bb=function(a,b,c,d){a=a.originalEvent||a;if((a.pointerType==="touch"||a.pointerType===a.MSPOINTER_TYPE_TOUCH)&&Y[pa])d(a),d=Y[pa].pointer,d[b]({type:c,target:a.currentTarget,preventDefault:na,touches:Wb()})};x(Va.prototype,{onContainerPointerDown:function(a){Bb(a,"onContainerTouchStart","touchstart",function(a){wa[a.pointerId]={pageX:a.pageX,
pageY:a.pageY,target:a.currentTarget}})},onContainerPointerMove:function(a){Bb(a,"onContainerTouchMove","touchmove",function(a){wa[a.pointerId]={pageX:a.pageX,pageY:a.pageY};if(!wa[a.pointerId].target)wa[a.pointerId].target=a.currentTarget})},onDocumentPointerUp:function(a){Bb(a,"onDocumentTouchEnd","touchend",function(a){delete wa[a.pointerId]})},batchMSEvents:function(a){a(this.chart.container,Ab?"pointerdown":"MSPointerDown",this.onContainerPointerDown);a(this.chart.container,Ab?"pointermove":
"MSPointerMove",this.onContainerPointerMove);a(B,Ab?"pointerup":"MSPointerUp",this.onDocumentPointerUp)}});cb(Va.prototype,"init",function(a,b,c){a.call(this,b,c);this.hasZoom&&L(b.container,{"-ms-touch-action":O,"touch-action":O})});cb(Va.prototype,"setDOMEvents",function(a){a.apply(this);(this.hasZoom||this.followTouchMove)&&this.batchMSEvents(H)});cb(Va.prototype,"destroy",function(a){this.batchMSEvents(Z);a.call(this)})}var nb=z.Legend=function(a,b){this.init(a,b)};nb.prototype={init:function(a,
b){var c=this,d=b.itemStyle,e=b.itemMarginTop||0;this.options=b;if(b.enabled)c.itemStyle=d,c.itemHiddenStyle=A(d,b.itemHiddenStyle),c.itemMarginTop=e,c.padding=d=p(b.padding,8),c.initialItemX=d,c.initialItemY=d-5,c.maxItemWidth=0,c.chart=a,c.itemHeight=0,c.symbolWidth=p(b.symbolWidth,16),c.pages=[],c.render(),H(c.chart,"endResize",function(){c.positionCheckboxes()})},colorizeItem:function(a,b){var c=this.options,d=a.legendItem,e=a.legendLine,f=a.legendSymbol,g=this.itemHiddenStyle.color,c=b?c.itemStyle.color:
g,h=b?a.legendColor||a.color||"#CCC":g,g=a.options&&a.options.marker,i={fill:h},j;d&&d.css({fill:c,color:c});e&&e.attr({stroke:h});if(f){if(g&&f.isMarker)for(j in i.stroke=h,g=a.convertAttribs(g),g)d=g[j],d!==y&&(i[j]=d);f.attr(i)}},positionItem:function(a){var b=this.options,c=b.symbolPadding,b=!b.rtl,d=a._legendItemPos,e=d[0],d=d[1],f=a.checkbox;(a=a.legendGroup)&&a.element&&a.translate(b?e:this.legendWidth-e-2*c-4,d);if(f)f.x=e,f.y=d},destroyItem:function(a){var b=a.checkbox;o(["legendItem","legendLine",
"legendSymbol","legendGroup"],function(b){a[b]&&(a[b]=a[b].destroy())});b&&Ra(a.checkbox)},destroy:function(){var a=this.group,b=this.box;if(b)this.box=b.destroy();if(a)this.group=a.destroy()},positionCheckboxes:function(a){var b=this.group.alignAttr,c,d=this.clipHeight||this.legendHeight;if(b)c=b.translateY,o(this.allItems,function(e){var f=e.checkbox,g;f&&(g=c+f.y+(a||0)+3,L(f,{left:b.translateX+e.checkboxOffset+f.x-20+"px",top:g+"px",display:g>c-6&&g<c+d-6?"":O}))})},renderTitle:function(){var a=
this.padding,b=this.options.title,c=0;if(b.text){if(!this.title)this.title=this.chart.renderer.label(b.text,a-3,a-4,null,null,null,null,null,"legend-title").attr({zIndex:1}).css(b.style).add(this.group);a=this.title.getBBox();c=a.height;this.offsetWidth=a.width;this.contentGroup.attr({translateY:c})}this.titleHeight=c},setText:function(a){var b=this.options;a.legendItem.attr({text:b.labelFormat?Ja(b.labelFormat,a):b.labelFormatter.call(a)})},renderItem:function(a){var b=this.chart,c=b.renderer,d=
this.options,e=d.layout==="horizontal",f=this.symbolWidth,g=d.symbolPadding,h=this.itemStyle,i=this.itemHiddenStyle,j=this.padding,k=e?p(d.itemDistance,20):0,l=!d.rtl,m=d.width,n=d.itemMarginBottom||0,u=this.itemMarginTop,r=this.initialItemX,o=a.legendItem,q=a.series&&a.series.drawLegendSymbol?a.series:a,t=q.options,t=this.createCheckboxForItem&&t&&t.showCheckbox,w=d.useHTML;if(!o){a.legendGroup=c.g("legend-item").attr({zIndex:1}).add(this.scrollGroup);a.legendItem=o=c.text("",l?f+g:-g,this.baseline||
0,w).css(A(a.visible?h:i)).attr({align:l?"left":"right",zIndex:2}).add(a.legendGroup);if(!this.baseline)this.fontMetrics=c.fontMetrics(h.fontSize,o),this.baseline=this.fontMetrics.f+3+u,o.attr("y",this.baseline);q.drawLegendSymbol(this,a);this.setItemEvents&&this.setItemEvents(a,o,w,h,i);this.colorizeItem(a,a.visible);t&&this.createCheckboxForItem(a)}this.setText(a);c=o.getBBox();f=a.checkboxOffset=d.itemWidth||a.legendItemWidth||f+g+c.width+k+(t?20:0);this.itemHeight=g=s(a.legendItemHeight||c.height);
if(e&&this.itemX-r+f>(m||b.chartWidth-2*j-r-d.x))this.itemX=r,this.itemY+=u+this.lastLineHeight+n,this.lastLineHeight=0;this.maxItemWidth=v(this.maxItemWidth,f);this.lastItemY=u+this.itemY+n;this.lastLineHeight=v(g,this.lastLineHeight);a._legendItemPos=[this.itemX,this.itemY];e?this.itemX+=f:(this.itemY+=u+g+n,this.lastLineHeight=g);this.offsetWidth=m||v((e?this.itemX-r-k:f)+j,this.offsetWidth)},getAllItems:function(){var a=[];o(this.chart.series,function(b){var c=b.options;if(p(c.showInLegend,!q(c.linkedTo)?
y:!1,!0))a=a.concat(b.legendItems||(c.legendType==="point"?b.data:b))});return a},adjustMargins:function(a,b){var c=this.chart,d=this.options,e=d.align[0]+d.verticalAlign[0]+d.layout[0];this.display&&!d.floating&&o([/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/],function(f,g){f.test(e)&&!q(a[g])&&(c[jb[g]]=v(c[jb[g]],c.legend[(g+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][g]*d[g%2?"x":"y"]+p(d.margin,12)+b[g]))})},render:function(){var a=this,b=a.chart,c=b.renderer,d=a.group,e,f,
g,h,i=a.box,j=a.options,k=a.padding,l=j.borderWidth,m=j.backgroundColor;a.itemX=a.initialItemX;a.itemY=a.initialItemY;a.offsetWidth=0;a.lastItemY=0;if(!d)a.group=d=c.g("legend").attr({zIndex:7}).add(),a.contentGroup=c.g().attr({zIndex:1}).add(d),a.scrollGroup=c.g().add(a.contentGroup);a.renderTitle();e=a.getAllItems();rb(e,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)});j.reversed&&e.reverse();a.allItems=e;a.display=f=!!e.length;a.lastLineHeight=0;
o(e,function(b){a.renderItem(b)});g=(j.width||a.offsetWidth)+k;h=a.lastItemY+a.lastLineHeight+a.titleHeight;h=a.handleOverflow(h);h+=k;if(l||m){if(i){if(g>0&&h>0)i[i.isNew?"attr":"animate"](i.crisp({width:g,height:h})),i.isNew=!1}else a.box=i=c.rect(0,0,g,h,j.borderRadius,l||0).attr({stroke:j.borderColor,"stroke-width":l||0,fill:m||O}).add(d).shadow(j.shadow),i.isNew=!0;i[f?"show":"hide"]()}a.legendWidth=g;a.legendHeight=h;o(e,function(b){a.positionItem(b)});f&&d.align(x({width:g,height:h},j),!0,
"spacingBox");b.isResizing||this.positionCheckboxes()},handleOverflow:function(a){var b=this,c=this.chart,d=c.renderer,e=this.options,f=e.y,f=c.spacingBox.height+(e.verticalAlign==="top"?-f:f)-this.padding,g=e.maxHeight,h,i=this.clipRect,j=e.navigation,k=p(j.animation,!0),l=j.arrowSize||12,m=this.nav,n=this.pages,u,r=this.allItems;e.layout==="horizontal"&&(f/=2);g&&(f=C(f,g));n.length=0;if(a>f&&!e.useHTML){this.clipHeight=h=v(f-20-this.titleHeight-this.padding,0);this.currentPage=p(this.currentPage,
1);this.fullHeight=a;o(r,function(a,b){var c=a._legendItemPos[1],d=s(a.legendItem.getBBox().height),e=n.length;if(!e||c-n[e-1]>h&&(u||c)!==n[e-1])n.push(u||c),e++;b===r.length-1&&c+d-n[e-1]>h&&n.push(c);c!==u&&(u=c)});if(!i)i=b.clipRect=d.clipRect(0,this.padding,9999,0),b.contentGroup.clip(i);i.attr({height:h});if(!m)this.nav=m=d.g().attr({zIndex:1}).add(this.group),this.up=d.symbol("triangle",0,0,l,l).on("click",function(){b.scroll(-1,k)}).add(m),this.pager=d.text("",15,10).css(j.style).add(m),this.down=
d.symbol("triangle-down",0,0,l,l).on("click",function(){b.scroll(1,k)}).add(m);b.scroll(0);a=f}else if(m)i.attr({height:c.chartHeight}),m.hide(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0;return a},scroll:function(a,b){var c=this.pages,d=c.length,e=this.currentPage+a,f=this.clipHeight,g=this.options.navigation,h=g.activeColor,g=g.inactiveColor,i=this.pager,j=this.padding;e>d&&(e=d);if(e>0)b!==y&&Sa(b,this.chart),this.nav.attr({translateX:j,translateY:f+this.padding+7+this.titleHeight,
visibility:"visible"}),this.up.attr({fill:e===1?g:h}).css({cursor:e===1?"default":"pointer"}),i.attr({text:e+"/"+d}),this.down.attr({x:18+this.pager.getBBox().width,fill:e===d?g:h}).css({cursor:e===d?"default":"pointer"}),c=-c[e-1]+this.initialItemY,this.scrollGroup.animate({translateY:c}),this.currentPage=e,this.positionCheckboxes(c)}};Na=z.LegendSymbolMixin={drawRectangle:function(a,b){var c=a.options.symbolHeight||a.fontMetrics.f;b.legendSymbol=this.chart.renderer.rect(0,a.baseline-c+1,a.symbolWidth,
c,a.options.symbolRadius||0).attr({zIndex:3}).add(b.legendGroup)},drawLineMarker:function(a){var b=this.options,c=b.marker,d;d=a.symbolWidth;var e=this.chart.renderer,f=this.legendGroup,a=a.baseline-s(a.fontMetrics.b*0.3),g;if(b.lineWidth){g={"stroke-width":b.lineWidth};if(b.dashStyle)g.dashstyle=b.dashStyle;this.legendLine=e.path(["M",0,a,"L",d,a]).attr(g).add(f)}if(c&&c.enabled!==!1)b=c.radius,this.legendSymbol=d=e.symbol(this.symbol,d/2-b,a-b,2*b,2*b).add(f),d.isMarker=!0}};(/Trident\/7\.0/.test(Ba)||
La)&&cb(nb.prototype,"positionItem",function(a,b){var c=this,d=function(){b._legendItemPos&&a.call(c,b)};d();setTimeout(d)});E=z.Chart=function(){this.init.apply(this,arguments)};E.prototype={callbacks:[],init:function(a,b){var c,d=a.series;a.series=null;c=A(T,a);c.series=a.series=d;this.userOptions=a;d=c.chart;this.margin=this.splashArray("margin",d);this.spacing=this.splashArray("spacing",d);var e=d.events;this.bounds={h:{},v:{}};this.callback=b;this.isResizing=0;this.options=c;this.axes=[];this.series=
[];this.hasCartesianSeries=d.showAxes;var f=this,g;f.index=Y.length;Y.push(f);bb++;d.reflow!==!1&&H(f,"load",function(){f.initReflow()});if(e)for(g in e)H(f,g,e[g]);f.xAxis=[];f.yAxis=[];f.animation=fa?!1:p(d.animation,!0);f.pointCount=f.colorCounter=f.symbolCounter=0;f.firstRender()},initSeries:function(a){var b=this.options.chart;(b=M[a.type||b.type||b.defaultSeriesType])||la(17,!0);b=new b;b.init(this,a);return b},isInsidePlot:function(a,b,c){var d=c?b:a,a=c?a:b;return d>=0&&d<=this.plotWidth&&
a>=0&&a<=this.plotHeight},redraw:function(a){var b=this.axes,c=this.series,d=this.pointer,e=this.legend,f=this.isDirtyLegend,g,h,i=this.hasCartesianSeries,j=this.isDirtyBox,k=c.length,l=k,m=this.renderer,n=m.isHidden(),p=[];Sa(a,this);n&&this.cloneRenderTo();for(this.layOutTitles();l--;)if(a=c[l],a.options.stacking&&(g=!0,a.isDirty)){h=!0;break}if(h)for(l=k;l--;)if(a=c[l],a.options.stacking)a.isDirty=!0;o(c,function(a){a.isDirty&&a.options.legendType==="point"&&(a.updateTotals&&a.updateTotals(),f=
!0)});if(f&&e.options.enabled)e.render(),this.isDirtyLegend=!1;g&&this.getStacks();if(i&&!this.isResizing)this.maxTicks=null,o(b,function(a){a.setScale()});this.getMargins();i&&(o(b,function(a){a.isDirty&&(j=!0)}),o(b,function(a){if(a.isDirtyExtremes)a.isDirtyExtremes=!1,p.push(function(){I(a,"afterSetExtremes",x(a.eventArgs,a.getExtremes()));delete a.eventArgs});(j||g)&&a.redraw()}));j&&this.drawChartBox();o(c,function(a){a.isDirty&&a.visible&&(!a.isCartesian||a.xAxis)&&a.redraw()});d&&d.reset(!0);
m.draw();I(this,"redraw");n&&this.cloneRenderTo(!0);o(p,function(a){a.call()})},get:function(a){var b=this.axes,c=this.series,d,e;for(d=0;d<b.length;d++)if(b[d].options.id===a)return b[d];for(d=0;d<c.length;d++)if(c[d].options.id===a)return c[d];for(d=0;d<c.length;d++){e=c[d].points||[];for(b=0;b<e.length;b++)if(e[b].id===a)return e[b]}return null},getAxes:function(){var a=this,b=this.options,c=b.xAxis=sa(b.xAxis||{}),b=b.yAxis=sa(b.yAxis||{});o(c,function(a,b){a.index=b;a.isX=!0});o(b,function(a,
b){a.index=b});c=c.concat(b);o(c,function(b){new va(a,b)})},getSelectedPoints:function(){var a=[];o(this.series,function(b){a=a.concat(lb(b.points||[],function(a){return a.selected}))});return a},getSelectedSeries:function(){return lb(this.series,function(a){return a.selected})},getStacks:function(){var a=this;o(a.yAxis,function(a){if(a.stacks&&a.hasVisibleSeries)a.oldStacks=a.stacks});o(a.series,function(b){if(b.options.stacking&&(b.visible===!0||a.options.chart.ignoreHiddenSeries===!1))b.stackKey=
b.type+p(b.options.stack,"")})},setTitle:function(a,b,c){var g;var d=this,e=d.options,f;f=e.title=A(e.title,a);g=e.subtitle=A(e.subtitle,b),e=g;o([["title",a,f],["subtitle",b,e]],function(a){var b=a[0],c=d[b],e=a[1],a=a[2];c&&e&&(d[b]=c=c.destroy());a&&a.text&&!c&&(d[b]=d.renderer.text(a.text,0,0,a.useHTML).attr({align:a.align,"class":"highcharts-"+b,zIndex:a.zIndex||4}).css(a.style).add())});d.layOutTitles(c)},layOutTitles:function(a){var b=0,c=this.title,d=this.subtitle,e=this.options,f=e.title,
e=e.subtitle,g=this.renderer,h=this.spacingBox.width-44;if(c&&(c.css({width:(f.width||h)+"px"}).align(x({y:g.fontMetrics(f.style.fontSize,c).b-3},f),!1,"spacingBox"),!f.floating&&!f.verticalAlign))b=c.getBBox().height;d&&(d.css({width:(e.width||h)+"px"}).align(x({y:b+(f.margin-13)+g.fontMetrics(f.style.fontSize,d).b},e),!1,"spacingBox"),!e.floating&&!e.verticalAlign&&(b=ta(b+d.getBBox().height)));c=this.titleOffset!==b;this.titleOffset=b;if(!this.isDirtyBox&&c)this.isDirtyBox=c,this.hasRendered&&
p(a,!0)&&this.isDirtyBox&&this.redraw()},getChartSize:function(){var a=this.options.chart,b=a.width,a=a.height,c=this.renderToClone||this.renderTo;if(!q(b))this.containerWidth=kb(c,"width");if(!q(a))this.containerHeight=kb(c,"height");this.chartWidth=v(0,b||this.containerWidth||600);this.chartHeight=v(0,p(a,this.containerHeight>19?this.containerHeight:400))},cloneRenderTo:function(a){var b=this.renderToClone,c=this.container;a?b&&(this.renderTo.appendChild(c),Ra(b),delete this.renderToClone):(c&&
c.parentNode===this.renderTo&&this.renderTo.removeChild(c),this.renderToClone=b=this.renderTo.cloneNode(0),L(b,{position:"absolute",top:"-9999px",display:"block"}),b.style.setProperty&&b.style.setProperty("display","block","important"),B.body.appendChild(b),c&&b.appendChild(c))},getContainer:function(){var a,b=this.options.chart,c,d,e;this.renderTo=a=b.renderTo;e="highcharts-"+yb++;if(Da(a))this.renderTo=a=B.getElementById(a);a||la(13,!0);c=F(J(a,"data-highcharts-chart"));!isNaN(c)&&Y[c]&&Y[c].hasRendered&&
Y[c].destroy();J(a,"data-highcharts-chart",this.index);a.innerHTML="";!b.skipClone&&!a.offsetWidth&&this.cloneRenderTo();this.getChartSize();c=this.chartWidth;d=this.chartHeight;this.container=a=$(Ka,{className:"highcharts-container"+(b.className?" "+b.className:""),id:e},x({position:"relative",overflow:"hidden",width:c+"px",height:d+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)"},b.style),this.renderToClone||a);this._cursor=a.style.cursor;this.renderer=
b.forExport?new ua(a,c,d,b.style,!0):new $a(a,c,d,b.style);fa&&this.renderer.create(this,a,c,d);this.renderer.chartIndex=this.index},getMargins:function(a){var b=this.spacing,c=this.margin,d=this.titleOffset;this.resetMargins();if(d&&!q(c[0]))this.plotTop=v(this.plotTop,d+this.options.title.margin+b[0]);this.legend.adjustMargins(c,b);this.extraBottomMargin&&(this.marginBottom+=this.extraBottomMargin);this.extraTopMargin&&(this.plotTop+=this.extraTopMargin);a||this.getAxisMargins()},getAxisMargins:function(){var a=
this,b=a.axisOffset=[0,0,0,0],c=a.margin;a.hasCartesianSeries&&o(a.axes,function(a){a.getOffset()});o(jb,function(d,e){q(c[e])||(a[d]+=b[e])});a.setChartSize()},reflow:function(a){var b=this,c=b.options.chart,d=b.renderTo,e=c.width||kb(d,"width"),f=c.height||kb(d,"height"),c=a?a.target:K,d=function(){if(b.container)b.setSize(e,f,!1),b.hasUserSize=null};if(!b.hasUserSize&&!b.isPrinting&&e&&f&&(c===K||c===B)){if(e!==b.containerWidth||f!==b.containerHeight)clearTimeout(b.reflowTimeout),a?b.reflowTimeout=
setTimeout(d,100):d();b.containerWidth=e;b.containerHeight=f}},initReflow:function(){var a=this,b=function(b){a.reflow(b)};H(K,"resize",b);H(a,"destroy",function(){Z(K,"resize",b)})},setSize:function(a,b,c){var d=this,e,f,g;d.isResizing+=1;g=function(){d&&I(d,"endResize",null,function(){d.isResizing-=1})};Sa(c,d);d.oldChartHeight=d.chartHeight;d.oldChartWidth=d.chartWidth;if(q(a))d.chartWidth=e=v(0,s(a)),d.hasUserSize=!!e;if(q(b))d.chartHeight=f=v(0,s(b));(za?mb:L)(d.container,{width:e+"px",height:f+
"px"},za);d.setChartSize(!0);d.renderer.setSize(e,f,c);d.maxTicks=null;o(d.axes,function(a){a.isDirty=!0;a.setScale()});o(d.series,function(a){a.isDirty=!0});d.isDirtyLegend=!0;d.isDirtyBox=!0;d.layOutTitles();d.getMargins();d.redraw(c);d.oldChartHeight=null;I(d,"resize");za===!1?g():setTimeout(g,za&&za.duration||500)},setChartSize:function(a){var b=this.inverted,c=this.renderer,d=this.chartWidth,e=this.chartHeight,f=this.options.chart,g=this.spacing,h=this.clipOffset,i,j,k,l;this.plotLeft=i=s(this.plotLeft);
this.plotTop=j=s(this.plotTop);this.plotWidth=k=v(0,s(d-i-this.marginRight));this.plotHeight=l=v(0,s(e-j-this.marginBottom));this.plotSizeX=b?l:k;this.plotSizeY=b?k:l;this.plotBorderWidth=f.plotBorderWidth||0;this.spacingBox=c.spacingBox={x:g[3],y:g[0],width:d-g[3]-g[1],height:e-g[0]-g[2]};this.plotBox=c.plotBox={x:i,y:j,width:k,height:l};d=2*V(this.plotBorderWidth/2);b=ta(v(d,h[3])/2);c=ta(v(d,h[0])/2);this.clipBox={x:b,y:c,width:V(this.plotSizeX-v(d,h[1])/2-b),height:v(0,V(this.plotSizeY-v(d,h[2])/
2-c))};a||o(this.axes,function(a){a.setAxisSize();a.setAxisTranslation()})},resetMargins:function(){var a=this;o(jb,function(b,c){a[b]=p(a.margin[c],a.spacing[c])});a.axisOffset=[0,0,0,0];a.clipOffset=[0,0,0,0]},drawChartBox:function(){var a=this.options.chart,b=this.renderer,c=this.chartWidth,d=this.chartHeight,e=this.chartBackground,f=this.plotBackground,g=this.plotBorder,h=this.plotBGImage,i=a.borderWidth||0,j=a.backgroundColor,k=a.plotBackgroundColor,l=a.plotBackgroundImage,m=a.plotBorderWidth||
0,n,p=this.plotLeft,o=this.plotTop,q=this.plotWidth,v=this.plotHeight,t=this.plotBox,w=this.clipRect,s=this.clipBox;n=i+(a.shadow?8:0);if(i||j)if(e)e.animate(e.crisp({width:c-n,height:d-n}));else{e={fill:j||O};if(i)e.stroke=a.borderColor,e["stroke-width"]=i;this.chartBackground=b.rect(n/2,n/2,c-n,d-n,a.borderRadius,i).attr(e).addClass("highcharts-background").add().shadow(a.shadow)}if(k)f?f.animate(t):this.plotBackground=b.rect(p,o,q,v,0).attr({fill:k}).add().shadow(a.plotShadow);if(l)h?h.animate(t):
this.plotBGImage=b.image(l,p,o,q,v).add();w?w.animate({width:s.width,height:s.height}):this.clipRect=b.clipRect(s);if(m)g?g.animate(g.crisp({x:p,y:o,width:q,height:v,strokeWidth:-m})):this.plotBorder=b.rect(p,o,q,v,0,-m).attr({stroke:a.plotBorderColor,"stroke-width":m,fill:O,zIndex:1}).add();this.isDirtyBox=!1},propFromSeries:function(){var a=this,b=a.options.chart,c,d=a.options.series,e,f;o(["inverted","angular","polar"],function(g){c=M[b.type||b.defaultSeriesType];f=a[g]||b[g]||c&&c.prototype[g];
for(e=d&&d.length;!f&&e--;)(c=M[d[e].type])&&c.prototype[g]&&(f=!0);a[g]=f})},linkSeries:function(){var a=this,b=a.series;o(b,function(a){a.linkedSeries.length=0});o(b,function(b){var d=b.options.linkedTo;if(Da(d)&&(d=d===":previous"?a.series[b.index-1]:a.get(d)))d.linkedSeries.push(b),b.linkedParent=d})},renderSeries:function(){o(this.series,function(a){a.translate();a.render()})},renderLabels:function(){var a=this,b=a.options.labels;b.items&&o(b.items,function(c){var d=x(b.style,c.style),e=F(d.left)+
a.plotLeft,f=F(d.top)+a.plotTop+12;delete d.left;delete d.top;a.renderer.text(c.html,e,f).attr({zIndex:2}).css(d).add()})},render:function(){var a=this.axes,b=this.renderer,c=this.options,d,e,f,g;this.setTitle();this.legend=new nb(this,c.legend);this.getStacks();this.getMargins(!0);this.setChartSize();d=this.plotWidth;e=this.plotHeight-=13;o(a,function(a){a.setScale()});this.getAxisMargins();f=d/this.plotWidth>1.1;g=e/this.plotHeight>1.1;if(f||g)this.maxTicks=null,o(a,function(a){(a.horiz&&f||!a.horiz&&
g)&&a.setTickInterval(!0)}),this.getMargins();this.drawChartBox();this.hasCartesianSeries&&o(a,function(a){a.render()});if(!this.seriesGroup)this.seriesGroup=b.g("series-group").attr({zIndex:3}).add();this.renderSeries();this.renderLabels();this.showCredits(c.credits);this.hasRendered=!0},showCredits:function(a){if(a.enabled&&!this.credits)this.credits=this.renderer.text(a.text,0,0).on("click",function(){if(a.href)location.href=a.href}).attr({align:a.position.align,zIndex:8}).css(a.style).add().align(a.position)},
destroy:function(){var a=this,b=a.axes,c=a.series,d=a.container,e,f=d&&d.parentNode;I(a,"destroy");Y[a.index]=y;bb--;a.renderTo.removeAttribute("data-highcharts-chart");Z(a);for(e=b.length;e--;)b[e]=b[e].destroy();for(e=c.length;e--;)c[e]=c[e].destroy();o("title,subtitle,chartBackground,plotBackground,plotBGImage,plotBorder,seriesGroup,clipRect,credits,pointer,scroller,rangeSelector,legend,resetZoomButton,tooltip,renderer".split(","),function(b){var c=a[b];c&&c.destroy&&(a[b]=c.destroy())});if(d)d.innerHTML=
"",Z(d),f&&Ra(d);for(e in a)delete a[e]},isReadyToRender:function(){var a=this;return!ca&&K==K.top&&B.readyState!=="complete"||fa&&!K.canvg?(fa?Lb.push(function(){a.firstRender()},a.options.global.canvasToolsURL):B.attachEvent("onreadystatechange",function(){B.detachEvent("onreadystatechange",a.firstRender);B.readyState==="complete"&&a.firstRender()}),!1):!0},firstRender:function(){var a=this,b=a.options,c=a.callback;if(a.isReadyToRender()){a.getContainer();I(a,"init");a.resetMargins();a.setChartSize();
a.propFromSeries();a.getAxes();o(b.series||[],function(b){a.initSeries(b)});a.linkSeries();I(a,"beforeRender");if(z.Pointer)a.pointer=new Va(a,b);a.render();a.renderer.draw();c&&c.apply(a,[a]);o(a.callbacks,function(b){a.index!==y&&b.apply(a,[a])});I(a,"load");a.cloneRenderTo(!0)}},splashArray:function(a,b){var c=b[a],c=da(c)?c:[c,c,c,c];return[p(b[a+"Top"],c[0]),p(b[a+"Right"],c[1]),p(b[a+"Bottom"],c[2]),p(b[a+"Left"],c[3])]}};var Xb=z.CenteredSeriesMixin={getCenter:function(){var a=this.options,
b=this.chart,c=2*(a.slicedOffset||0),d=b.plotWidth-2*c,b=b.plotHeight-2*c,e=a.center,e=[p(e[0],"50%"),p(e[1],"50%"),a.size||"100%",a.innerSize||0],f=C(d,b),g,h;for(g=0;g<4;++g)h=e[g],a=g<2||g===2&&/%$/.test(h),e[g]=(/%$/.test(h)?[d,b,f,e[2]][g]*parseFloat(h)/100:parseFloat(h))+(a?c:0);return e}},Ga=function(){};Ga.prototype={init:function(a,b,c){this.series=a;this.color=a.color;this.applyOptions(b,c);this.pointAttr={};if(a.options.colorByPoint&&(b=a.options.colors||a.chart.options.colors,this.color=
this.color||b[a.colorCounter++],a.colorCounter===b.length))a.colorCounter=0;a.chart.pointCount++;return this},applyOptions:function(a,b){var c=this.series,d=c.options.pointValKey||c.pointValKey,a=Ga.prototype.optionsToObject.call(this,a);x(this,a);this.options=this.options?x(this.options,a):a;if(d)this.y=this[d];if(this.x===y&&c)this.x=b===y?c.autoIncrement():b;return this},optionsToObject:function(a){var b={},c=this.series,d=c.options.keys,e=d||c.pointArrayMap||["y"],f=e.length,g=0,h=0;if(typeof a===
"number"||a===null)b[e[0]]=a;else if(Ha(a)){if(!d&&a.length>f){c=typeof a[0];if(c==="string")b.name=a[0];else if(c==="number")b.x=a[0];g++}for(;h<f;)b[e[h++]]=a[g++]}else if(typeof a==="object"){b=a;if(a.dataLabels)c._hasPointLabels=!0;if(a.marker)c._hasPointMarkers=!0}return b},destroy:function(){var a=this.series.chart,b=a.hoverPoints,c;a.pointCount--;if(b&&(this.setState(),ja(b,this),!b.length))a.hoverPoints=null;if(this===a.hoverPoint)this.onMouseOut();if(this.graphic||this.dataLabel)Z(this),
this.destroyElements();this.legendItem&&a.legend.destroyItem(this);for(c in this)this[c]=null},destroyElements:function(){for(var a="graphic,dataLabel,dataLabelUpper,group,connector,shadowGroup".split(","),b,c=6;c--;)b=a[c],this[b]&&(this[b]=this[b].destroy())},getLabelConfig:function(){return{x:this.category,y:this.y,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},tooltipFormatter:function(a){var b=this.series,c=b.tooltipOptions,
d=p(c.valueDecimals,""),e=c.valuePrefix||"",f=c.valueSuffix||"";o(b.pointArrayMap||["y"],function(b){b="{point."+b;if(e||f)a=a.replace(b+"}",e+b+"}"+f);a=a.replace(b+"}",b+":,."+d+"f}")});return Ja(a,{point:this,series:this.series})},firePointEvent:function(a,b,c){var d=this,e=this.series.options;(e.point.events[a]||d.options&&d.options.events&&d.options.events[a])&&this.importEvents();a==="click"&&e.allowPointSelect&&(c=function(a){d.select(null,a.ctrlKey||a.metaKey||a.shiftKey)});I(this,a,b,c)}};
var R=z.Series=function(){};R.prototype={isCartesian:!0,type:"line",pointClass:Ga,sorted:!0,requireSorting:!0,pointAttrToOptions:{stroke:"lineColor","stroke-width":"lineWidth",fill:"fillColor",r:"radius"},axisTypes:["xAxis","yAxis"],colorCounter:0,parallelArrays:["x","y"],init:function(a,b){var c=this,d,e,f=a.series,g=function(a,b){return p(a.options.index,a._i)-p(b.options.index,b._i)};c.chart=a;c.options=b=c.setOptions(b);c.linkedSeries=[];c.bindAxes();x(c,{name:b.name,state:"",pointAttr:{},visible:b.visible!==
!1,selected:b.selected===!0});if(fa)b.animation=!1;e=b.events;for(d in e)H(c,d,e[d]);if(e&&e.click||b.point&&b.point.events&&b.point.events.click||b.allowPointSelect)a.runTrackerClick=!0;c.getColor();c.getSymbol();o(c.parallelArrays,function(a){c[a+"Data"]=[]});c.setData(b.data,!1);if(c.isCartesian)a.hasCartesianSeries=!0;f.push(c);c._i=f.length-1;rb(f,g);this.yAxis&&rb(this.yAxis.series,g);o(f,function(a,b){a.index=b;a.name=a.name||"Series "+(b+1)})},bindAxes:function(){var a=this,b=a.options,c=
a.chart,d;o(a.axisTypes||[],function(e){o(c[e],function(c){d=c.options;if(b[e]===d.index||b[e]!==y&&b[e]===d.id||b[e]===y&&d.index===0)c.series.push(a),a[e]=c,c.isDirty=!0});!a[e]&&a.optionalAxis!==e&&la(18,!0)})},updateParallelArrays:function(a,b){var c=a.series,d=arguments;o(c.parallelArrays,typeof b==="number"?function(d){var f=d==="y"&&c.toYData?c.toYData(a):a[d];c[d+"Data"][b]=f}:function(a){Array.prototype[b].apply(c[a+"Data"],Array.prototype.slice.call(d,2))})},autoIncrement:function(){var a=
this.options,b=this.xIncrement,c,d=a.pointIntervalUnit,b=p(b,a.pointStart,0);this.pointInterval=c=p(this.pointInterval,a.pointInterval,1);if(d==="month"||d==="year")a=new Aa(b),a=d==="month"?+a[wb](a[Ya]()+c):+a[xb](a[Za]()+c),c=a-b;this.xIncrement=b+c;return b},getSegments:function(){var a=-1,b=[],c,d=this.points,e=d.length;if(e)if(this.options.connectNulls){for(c=e;c--;)d[c].y===null&&d.splice(c,1);d.length&&(b=[d])}else o(d,function(c,g){c.y===null?(g>a+1&&b.push(d.slice(a+1,g)),a=g):g===e-1&&
b.push(d.slice(a+1,g+1))});this.segments=b},setOptions:function(a){var b=this.chart,c=b.options.plotOptions,b=b.userOptions||{},d=b.plotOptions||{},e=c[this.type];this.userOptions=a;c=A(e,c.series,a);this.tooltipOptions=A(T.tooltip,T.plotOptions[this.type].tooltip,b.tooltip,d.series&&d.series.tooltip,d[this.type]&&d[this.type].tooltip,a.tooltip);e.marker===null&&delete c.marker;this.zoneAxis=c.zoneAxis;a=this.zones=(c.zones||[]).slice();if((c.negativeColor||c.negativeFillColor)&&!c.zones)a.push({value:c[this.zoneAxis+
"Threshold"]||c.threshold||0,color:c.negativeColor,fillColor:c.negativeFillColor});a.length&&q(a[a.length-1].value)&&a.push({color:this.color,fillColor:this.fillColor});return c},getCyclic:function(a,b,c){var d=this.userOptions,e="_"+a+"Index",f=a+"Counter";b||(q(d[e])?b=d[e]:(d[e]=b=this.chart[f]%c.length,this.chart[f]+=1),b=c[b]);this[a]=b},getColor:function(){this.options.colorByPoint||this.getCyclic("color",this.options.color||ba[this.type].color,this.chart.options.colors)},getSymbol:function(){var a=
this.options.marker;this.getCyclic("symbol",a.symbol,this.chart.options.symbols);if(/^url/.test(this.symbol))a.radius=0},drawLegendSymbol:Na.drawLineMarker,setData:function(a,b,c,d){var e=this,f=e.points,g=f&&f.length||0,h,i=e.options,j=e.chart,k=null,l=e.xAxis,m=l&&!!l.categories,n=i.turboThreshold,u=this.xData,r=this.yData,q=(h=e.pointArrayMap)&&h.length,a=a||[];h=a.length;b=p(b,!0);if(d!==!1&&h&&g===h&&!e.cropped&&!e.hasGroupedData&&e.visible)o(a,function(a,b){f[b].update(a,!1,null,!1)});else{e.xIncrement=
null;e.pointRange=m?1:i.pointRange;e.colorCounter=0;o(this.parallelArrays,function(a){e[a+"Data"].length=0});if(n&&h>n){for(c=0;k===null&&c<h;)k=a[c],c++;if(ra(k)){m=p(i.pointStart,0);i=p(i.pointInterval,1);for(c=0;c<h;c++)u[c]=m,r[c]=a[c],m+=i;e.xIncrement=m}else if(Ha(k))if(q)for(c=0;c<h;c++)i=a[c],u[c]=i[0],r[c]=i.slice(1,q+1);else for(c=0;c<h;c++)i=a[c],u[c]=i[0],r[c]=i[1];else la(12)}else for(c=0;c<h;c++)if(a[c]!==y&&(i={series:e},e.pointClass.prototype.applyOptions.apply(i,[a[c]]),e.updateParallelArrays(i,
c),m&&i.name))l.names[i.x]=i.name;Da(r[0])&&la(14,!0);e.data=[];e.options.data=a;for(c=g;c--;)f[c]&&f[c].destroy&&f[c].destroy();if(l)l.minRange=l.userMinRange;e.isDirty=e.isDirtyData=j.isDirtyBox=!0;c=!1}b&&j.redraw(c)},processData:function(a){var b=this.xData,c=this.yData,d=b.length,e;e=0;var f,g,h=this.xAxis,i,j=this.options;i=j.cropThreshold;var k=this.isCartesian,l,m;if(k&&!this.isDirty&&!h.isDirty&&!this.yAxis.isDirty&&!a)return!1;if(h)a=h.getExtremes(),l=a.min,m=a.max;if(k&&this.sorted&&(!i||
d>i||this.forceCrop))if(b[d-1]<l||b[0]>m)b=[],c=[];else if(b[0]<l||b[d-1]>m)e=this.cropData(this.xData,this.yData,l,m),b=e.xData,c=e.yData,e=e.start,f=!0;for(i=b.length-1;i>=0;i--)d=b[i]-b[i-1],d>0&&(g===y||d<g)?g=d:d<0&&this.requireSorting&&la(15);this.cropped=f;this.cropStart=e;this.processedXData=b;this.processedYData=c;if(j.pointRange===null)this.pointRange=g||1;this.closestPointRange=g},cropData:function(a,b,c,d){var e=a.length,f=0,g=e,h=p(this.cropShoulder,1),i;for(i=0;i<e;i++)if(a[i]>=c){f=
v(0,i-h);break}for(;i<e;i++)if(a[i]>d){g=i+h;break}return{xData:a.slice(f,g),yData:b.slice(f,g),start:f,end:g}},generatePoints:function(){var a=this.options.data,b=this.data,c,d=this.processedXData,e=this.processedYData,f=this.pointClass,g=d.length,h=this.cropStart||0,i,j=this.hasGroupedData,k,l=[],m;if(!b&&!j)b=[],b.length=a.length,b=this.data=b;for(m=0;m<g;m++)i=h+m,j?l[m]=(new f).init(this,[d[m]].concat(sa(e[m]))):(b[i]?k=b[i]:a[i]!==y&&(b[i]=k=(new f).init(this,a[i],d[m])),l[m]=k),l[m].index=
i;if(b&&(g!==(c=b.length)||j))for(m=0;m<c;m++)if(m===h&&!j&&(m+=g),b[m])b[m].destroyElements(),b[m].plotX=y;this.data=b;this.points=l},getExtremes:function(a){var b=this.yAxis,c=this.processedXData,d,e=[],f=0;d=this.xAxis.getExtremes();var g=d.min,h=d.max,i,j,k,l,a=a||this.stackedYData||this.processedYData;d=a.length;for(l=0;l<d;l++)if(j=c[l],k=a[l],i=k!==null&&k!==y&&(!b.isLog||k.length||k>0),j=this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||(c[l+1]||j)>=g&&(c[l-1]||j)<=h,
i&&j)if(i=k.length)for(;i--;)k[i]!==null&&(e[f++]=k[i]);else e[f++]=k;this.dataMin=Pa(e);this.dataMax=Fa(e)},translate:function(){this.processedXData||this.processData();this.generatePoints();for(var a=this.options,b=a.stacking,c=this.xAxis,d=c.categories,e=this.yAxis,f=this.points,g=f.length,h=!!this.modifyValue,i=a.pointPlacement,j=i==="between"||ra(i),k=a.threshold,l=a.startFromThreshold?k:0,m,n,u,o=Number.MAX_VALUE,a=0;a<g;a++){var s=f[a],x=s.x,t=s.y;n=s.low;var w=b&&e.stacks[(this.negStacks&&
t<(l?0:k)?"-":"")+this.stackKey];if(e.isLog&&t!==null&&t<=0)s.y=t=null,la(10);s.plotX=m=C(v(-1E5,c.translate(x,0,0,0,1,i,this.type==="flags")),1E5);if(b&&this.visible&&w&&w[x])w=w[x],t=w.points[this.index+","+a],n=t[0],t=t[1],n===l&&(n=p(k,e.min)),e.isLog&&n<=0&&(n=null),s.total=s.stackTotal=w.total,s.percentage=w.total&&s.y/w.total*100,s.stackY=t,w.setOffset(this.pointXOffset||0,this.barW||0);s.yBottom=q(n)?e.translate(n,0,1,0,1):null;h&&(t=this.modifyValue(t,s));s.plotY=n=typeof t==="number"&&t!==
Infinity?C(v(-1E5,e.translate(t,0,1,0,1)),1E5):y;s.isInside=n!==y&&n>=0&&n<=e.len&&m>=0&&m<=c.len;s.clientX=j?c.translate(x,0,0,0,1):m;s.negative=s.y<(k||0);s.category=d&&d[s.x]!==y?d[s.x]:s.x;a&&(o=C(o,N(m-u)));u=m}this.closestPointRangePx=o;this.getSegments()},setClip:function(a){var b=this.chart,c=b.renderer,d=b.inverted,e=this.clipBox,f=e||b.clipBox,g=this.sharedClipKey||["_sharedClip",a&&a.duration,a&&a.easing,f.height].join(","),h=b[g],i=b[g+"m"];if(!h){if(a)f.width=0,b[g+"m"]=i=c.clipRect(-99,
d?-b.plotLeft:-b.plotTop,99,d?b.chartWidth:b.chartHeight);b[g]=h=c.clipRect(f)}a&&(h.count+=1);if(this.options.clip!==!1)this.group.clip(a||e?h:b.clipRect),this.markerGroup.clip(i),this.sharedClipKey=g;a||(h.count-=1,h.count<=0&&g&&b[g]&&(e||(b[g]=b[g].destroy()),b[g+"m"]&&(b[g+"m"]=b[g+"m"].destroy())))},animate:function(a){var b=this.chart,c=this.options.animation,d;if(c&&!da(c))c=ba[this.type].animation;a?this.setClip(c):(d=this.sharedClipKey,(a=b[d])&&a.animate({width:b.plotSizeX},c),b[d+"m"]&&
b[d+"m"].animate({width:b.plotSizeX+99},c),this.animate=null)},afterAnimate:function(){this.setClip();I(this,"afterAnimate")},drawPoints:function(){var a,b=this.points,c=this.chart,d,e,f,g,h,i,j,k,l=this.options.marker,m=this.pointAttr[""],n,u,o,s=this.markerGroup,q=p(l.enabled,this.xAxis.isRadial,this.closestPointRangePx>2*l.radius);if(l.enabled!==!1||this._hasPointMarkers)for(f=b.length;f--;)if(g=b[f],d=V(g.plotX),e=g.plotY,k=g.graphic,n=g.marker||{},u=!!g.marker,a=q&&n.enabled===y||n.enabled,o=
g.isInside,a&&e!==y&&!isNaN(e)&&g.y!==null)if(a=g.pointAttr[g.selected?"select":""]||m,h=a.r,i=p(n.symbol,this.symbol),j=i.indexOf("url")===0,k)k[o?"show":"hide"](!0).animate(x({x:d-h,y:e-h},k.symbolName?{width:2*h,height:2*h}:{}));else{if(o&&(h>0||j))g.graphic=c.renderer.symbol(i,d-h,e-h,2*h,2*h,u?n:l).attr(a).add(s)}else if(k)g.graphic=k.destroy()},convertAttribs:function(a,b,c,d){var e=this.pointAttrToOptions,f,g,h={},a=a||{},b=b||{},c=c||{},d=d||{};for(f in e)g=e[f],h[f]=p(a[g],b[f],c[f],d[f]);
return h},getAttribs:function(){var a=this,b=a.options,c=ba[a.type].marker?b.marker:b,d=c.states,e=d.hover,f,g=a.color,h=a.options.negativeColor;f={stroke:g,fill:g};var i=a.points||[],j,k=[],l,m=a.pointAttrToOptions;l=a.hasPointSpecificOptions;var n=c.lineColor,p=c.fillColor;j=b.turboThreshold;var r=a.zones,s=a.zoneAxis||"y",v;b.marker?(e.radius=e.radius||c.radius+e.radiusPlus,e.lineWidth=e.lineWidth||c.lineWidth+e.lineWidthPlus):(e.color=e.color||oa(e.color||g).brighten(e.brightness).get(),e.negativeColor=
e.negativeColor||oa(e.negativeColor||h).brighten(e.brightness).get());k[""]=a.convertAttribs(c,f);o(["hover","select"],function(b){k[b]=a.convertAttribs(d[b],k[""])});a.pointAttr=k;g=i.length;if(!j||g<j||l)for(;g--;){j=i[g];if((c=j.options&&j.options.marker||j.options)&&c.enabled===!1)c.radius=0;if(r.length){l=0;for(f=r[l];j[s]>=f.value;)f=r[++l];j.color=j.fillColor=f.color}l=b.colorByPoint||j.color;if(j.options)for(v in m)q(c[m[v]])&&(l=!0);if(l){c=c||{};l=[];d=c.states||{};f=d.hover=d.hover||{};
if(!b.marker)f.color=f.color||!j.options.color&&e[j.negative&&h?"negativeColor":"color"]||oa(j.color).brighten(f.brightness||e.brightness).get();f={color:j.color};if(!p)f.fillColor=j.color;if(!n)f.lineColor=j.color;c.hasOwnProperty("color")&&!c.color&&delete c.color;l[""]=a.convertAttribs(x(f,c),k[""]);l.hover=a.convertAttribs(d.hover,k.hover,l[""]);l.select=a.convertAttribs(d.select,k.select,l[""])}else l=k;j.pointAttr=l}},destroy:function(){var a=this,b=a.chart,c=/AppleWebKit\/533/.test(Ba),d,e=
a.data||[],f,g,h;I(a,"destroy");Z(a);o(a.axisTypes||[],function(b){if(h=a[b])ja(h.series,a),h.isDirty=h.forceRedraw=!0});a.legendItem&&a.chart.legend.destroyItem(a);for(d=e.length;d--;)(f=e[d])&&f.destroy&&f.destroy();a.points=null;clearTimeout(a.animationTimeout);for(g in a)a[g]instanceof P&&!a[g].survive&&(d=c&&g==="group"?"hide":"destroy",a[g][d]());if(b.hoverSeries===a)b.hoverSeries=null;ja(b.series,a);for(g in a)delete a[g]},getSegmentPath:function(a){var b=this,c=[],d=b.options.step;o(a,function(e,
f){var g=e.plotX,h=e.plotY,i;b.getPointSpline?c.push.apply(c,b.getPointSpline(a,e,f)):(c.push(f?"L":"M"),d&&f&&(i=a[f-1],d==="right"?c.push(i.plotX,h):d==="center"?c.push((i.plotX+g)/2,i.plotY,(i.plotX+g)/2,h):c.push(g,i.plotY)),c.push(e.plotX,e.plotY))});return c},getGraphPath:function(){var a=this,b=[],c,d=[];o(a.segments,function(e){c=a.getSegmentPath(e);e.length>1?b=b.concat(c):d.push(e[0])});a.singlePoints=d;return a.graphPath=b},drawGraph:function(){var a=this,b=this.options,c=[["graph",b.lineColor||
this.color,b.dashStyle]],d=b.lineWidth,e=b.linecap!=="square",f=this.getGraphPath(),g=this.fillGraph&&this.color||O;o(this.zones,function(d,e){c.push(["zoneGraph"+e,d.color||a.color,d.dashStyle||b.dashStyle])});o(c,function(c,i){var j=c[0],k=a[j];if(k)db(k),k.animate({d:f});else if((d||g)&&f.length)k={stroke:c[1],"stroke-width":d,fill:g,zIndex:1},c[2]?k.dashstyle=c[2]:e&&(k["stroke-linecap"]=k["stroke-linejoin"]="round"),a[j]=a.chart.renderer.path(f).attr(k).add(a.group).shadow(i<2&&b.shadow)})},
applyZones:function(){var a=this,b=this.chart,c=b.renderer,d=this.zones,e,f,g=this.clips||[],h,i=this.graph,j=this.area,k=v(b.chartWidth,b.chartHeight),l=this[(this.zoneAxis||"y")+"Axis"],m,n=l.reversed,u=b.inverted,r=l.horiz,q,x,t,w=!1;if(d.length&&(i||j))i&&i.hide(),j&&j.hide(),m=l.getExtremes(),o(d,function(d,o){e=n?r?b.plotWidth:0:r?0:l.toPixels(m.min);e=C(v(p(f,e),0),k);f=C(v(s(l.toPixels(p(d.value,m.max),!0)),0),k);w&&(e=f=l.toPixels(m.max));q=Math.abs(e-f);x=C(e,f);t=v(e,f);if(l.isXAxis){if(h=
{x:u?t:x,y:0,width:q,height:k},!r)h.x=b.plotHeight-h.x}else if(h={x:0,y:u?t:x,width:k,height:q},r)h.y=b.plotWidth-h.y;b.inverted&&c.isVML&&(h=l.isXAxis?{x:0,y:n?x:t,height:h.width,width:b.chartWidth}:{x:h.y-b.plotLeft-b.spacingBox.x,y:0,width:h.height,height:b.chartHeight});g[o]?g[o].animate(h):(g[o]=c.clipRect(h),i&&a["zoneGraph"+o].clip(g[o]),j&&a["zoneArea"+o].clip(g[o]));w=d.value>m.max}),this.clips=g},invertGroups:function(){function a(){var a={width:b.yAxis.len,height:b.xAxis.len};o(["group",
"markerGroup"],function(c){b[c]&&b[c].attr(a).invert()})}var b=this,c=b.chart;if(b.xAxis)H(c,"resize",a),H(b,"destroy",function(){Z(c,"resize",a)}),a(),b.invertGroups=a},plotGroup:function(a,b,c,d,e){var f=this[a],g=!f;g&&(this[a]=f=this.chart.renderer.g(b).attr({visibility:c,zIndex:d||0.1}).add(e));f[g?"attr":"animate"](this.getPlotBox());return f},getPlotBox:function(){var a=this.chart,b=this.xAxis,c=this.yAxis;if(a.inverted)b=c,c=this.xAxis;return{translateX:b?b.left:a.plotLeft,translateY:c?c.top:
a.plotTop,scaleX:1,scaleY:1}},render:function(){var a=this,b=a.chart,c,d=a.options,e=(c=d.animation)&&!!a.animate&&b.renderer.isSVG&&p(c.duration,500)||0,f=a.visible?"visible":"hidden",g=d.zIndex,h=a.hasRendered,i=b.seriesGroup;c=a.plotGroup("group","series",f,g,i);a.markerGroup=a.plotGroup("markerGroup","markers",f,g,i);e&&a.animate(!0);a.getAttribs();c.inverted=a.isCartesian?b.inverted:!1;a.drawGraph&&(a.drawGraph(),a.applyZones());o(a.points,function(a){a.redraw&&a.redraw()});a.drawDataLabels&&
a.drawDataLabels();a.visible&&a.drawPoints();a.drawTracker&&a.options.enableMouseTracking!==!1&&a.drawTracker();b.inverted&&a.invertGroups();d.clip!==!1&&!a.sharedClipKey&&!h&&c.clip(b.clipRect);e&&a.animate();if(!h)e?a.animationTimeout=setTimeout(function(){a.afterAnimate()},e):a.afterAnimate();a.isDirty=a.isDirtyData=!1;a.hasRendered=!0},redraw:function(){var a=this.chart,b=this.isDirtyData,c=this.isDirty,d=this.group,e=this.xAxis,f=this.yAxis;d&&(a.inverted&&d.attr({width:a.plotWidth,height:a.plotHeight}),
d.animate({translateX:p(e&&e.left,a.plotLeft),translateY:p(f&&f.top,a.plotTop)}));this.translate();this.render();b&&I(this,"updatedData");(c||b)&&delete this.kdTree},kdDimensions:1,kdAxisArray:["clientX","plotY"],searchPoint:function(a,b){var c=this.xAxis,d=this.yAxis,e=this.chart.inverted;return this.searchKDTree({clientX:e?c.len-a.chartY+c.pos:a.chartX-c.pos,plotY:e?d.len-a.chartX+d.pos:a.chartY-d.pos},b)},buildKDTree:function(){function a(b,d,g){var h,i;if(i=b&&b.length)return h=c.kdAxisArray[d%
g],b.sort(function(a,b){return a[h]-b[h]}),i=Math.floor(i/2),{point:b[i],left:a(b.slice(0,i),d+1,g),right:a(b.slice(i+1),d+1,g)}}function b(){var b=lb(c.points,function(a){return a.y!==null});c.kdTree=a(b,d,d)}var c=this,d=c.kdDimensions;delete c.kdTree;c.options.kdSync?b():setTimeout(b)},searchKDTree:function(a,b){function c(a,b,j,k){var l=b.point,m=d.kdAxisArray[j%k],n,p,o=l;p=q(a[e])&&q(l[e])?Math.pow(a[e]-l[e],2):null;n=q(a[f])&&q(l[f])?Math.pow(a[f]-l[f],2):null;n=(p||0)+(n||0);l.dist=q(n)?Math.sqrt(n):
Number.MAX_VALUE;l.distX=q(p)?Math.sqrt(p):Number.MAX_VALUE;m=a[m]-l[m];n=m<0?"left":"right";p=m<0?"right":"left";b[n]&&(n=c(a,b[n],j+1,k),o=n[g]<o[g]?n:l);b[p]&&Math.sqrt(m*m)<o[g]&&(a=c(a,b[p],j+1,k),o=a[g]<o[g]?a:o);return o}var d=this,e=this.kdAxisArray[0],f=this.kdAxisArray[1],g=b?"distX":"dist";this.kdTree||this.buildKDTree();if(this.kdTree)return c(a,this.kdTree,this.kdDimensions,this.kdDimensions)}};Hb.prototype={destroy:function(){Qa(this,this.axis)},render:function(a){var b=this.options,
c=b.format,c=c?Ja(c,this):b.formatter.call(this);this.label?this.label.attr({text:c,visibility:"hidden"}):this.label=this.axis.chart.renderer.text(c,null,null,b.useHTML).css(b.style).attr({align:this.textAlign,rotation:b.rotation,visibility:"hidden"}).add(a)},setOffset:function(a,b){var c=this.axis,d=c.chart,e=d.inverted,f=c.reversed,f=this.isNegative&&!f||!this.isNegative&&f,g=c.translate(c.usePercentage?100:this.total,0,0,0,1),c=c.translate(0),c=N(g-c),h=d.xAxis[0].translate(this.x)+a,i=d.plotHeight,
f={x:e?f?g:g-c:h,y:e?i-h-b:f?i-g-c:i-g,width:e?c:b,height:e?b:c};if(e=this.label)e.align(this.alignOptions,null,f),f=e.alignAttr,e[this.options.crop===!1||d.isInsidePlot(f.x,f.y)?"show":"hide"](!0)}};va.prototype.buildStacks=function(){var a=this.series,b=p(this.options.reversedStacks,!0),c=a.length;if(!this.isXAxis){for(this.usePercentage=!1;c--;)a[b?c:a.length-c-1].setStackedPoints();if(this.usePercentage)for(c=0;c<a.length;c++)a[c].setPercentStacks()}};va.prototype.renderStackTotals=function(){var a=
this.chart,b=a.renderer,c=this.stacks,d,e,f=this.stackTotalGroup;if(!f)this.stackTotalGroup=f=b.g("stack-labels").attr({visibility:"visible",zIndex:6}).add();f.translate(a.plotLeft,a.plotTop);for(d in c)for(e in a=c[d],a)a[e].render(f)};R.prototype.setStackedPoints=function(){if(this.options.stacking&&!(this.visible!==!0&&this.chart.options.chart.ignoreHiddenSeries!==!1)){var a=this.processedXData,b=this.processedYData,c=[],d=b.length,e=this.options,f=e.threshold,g=e.startFromThreshold?f:0,h=e.stack,
e=e.stacking,i=this.stackKey,j="-"+i,k=this.negStacks,l=this.yAxis,m=l.stacks,n=l.oldStacks,o,r,s,q,t,w;for(q=0;q<d;q++){t=a[q];w=b[q];s=this.index+","+q;r=(o=k&&w<(g?0:f))?j:i;m[r]||(m[r]={});if(!m[r][t])n[r]&&n[r][t]?(m[r][t]=n[r][t],m[r][t].total=null):m[r][t]=new Hb(l,l.options.stackLabels,o,t,h);r=m[r][t];r.points[s]=[p(r.cum,g)];e==="percent"?(o=o?i:j,k&&m[o]&&m[o][t]?(o=m[o][t],r.total=o.total=v(o.total,r.total)+N(w)||0):r.total=ea(r.total+(N(w)||0))):r.total=ea(r.total+(w||0));r.cum=p(r.cum,
g)+(w||0);r.points[s].push(r.cum);c[q]=r.cum}if(e==="percent")l.usePercentage=!0;this.stackedYData=c;l.oldStacks={}}};R.prototype.setPercentStacks=function(){var a=this,b=a.stackKey,c=a.yAxis.stacks,d=a.processedXData;o([b,"-"+b],function(b){var e;for(var f=d.length,g,h;f--;)if(g=d[f],e=(h=c[b]&&c[b][g])&&h.points[a.index+","+f],g=e)h=h.total?100/h.total:0,g[0]=ea(g[0]*h),g[1]=ea(g[1]*h),a.stackedYData[f]=g[1]})};x(E.prototype,{addSeries:function(a,b,c){var d,e=this;a&&(b=p(b,!0),I(e,"addSeries",
{options:a},function(){d=e.initSeries(a);e.isDirtyLegend=!0;e.linkSeries();b&&e.redraw(c)}));return d},addAxis:function(a,b,c,d){var e=b?"xAxis":"yAxis",f=this.options;new va(this,A(a,{index:this[e].length,isX:b}));f[e]=sa(f[e]||{});f[e].push(a);p(c,!0)&&this.redraw(d)},showLoading:function(a){var b=this,c=b.options,d=b.loadingDiv,e=c.loading,f=function(){d&&L(d,{left:b.plotLeft+"px",top:b.plotTop+"px",width:b.plotWidth+"px",height:b.plotHeight+"px"})};if(!d)b.loadingDiv=d=$(Ka,{className:"highcharts-loading"},
x(e.style,{zIndex:10,display:O}),b.container),b.loadingSpan=$("span",null,e.labelStyle,d),H(b,"redraw",f);b.loadingSpan.innerHTML=a||c.lang.loading;if(!b.loadingShown)L(d,{opacity:0,display:""}),mb(d,{opacity:e.style.opacity},{duration:e.showDuration||0}),b.loadingShown=!0;f()},hideLoading:function(){var a=this.options,b=this.loadingDiv;b&&mb(b,{opacity:0},{duration:a.loading.hideDuration||100,complete:function(){L(b,{display:O})}});this.loadingShown=!1}});x(Ga.prototype,{update:function(a,b,c,d){function e(){f.applyOptions(a);
if(f.y===null&&h)f.graphic=h.destroy();if(da(a)&&!Ha(a))f.redraw=function(){if(h)if(a&&a.marker&&a.marker.symbol)f.graphic=h.destroy();else h.attr(f.pointAttr[f.state||""])[f.visible?"show":"hide"](!0);if(a&&a.dataLabels&&f.dataLabel)f.dataLabel=f.dataLabel.destroy();f.redraw=null};i=f.index;g.updateParallelArrays(f,i);if(l&&f.name)l[f.x]=f.name;k.data[i]=f.options;g.isDirty=g.isDirtyData=!0;if(!g.fixedBox&&g.hasCartesianSeries)j.isDirtyBox=!0;if(k.legendType==="point")j.isDirtyLegend=!0;b&&j.redraw(c)}
var f=this,g=f.series,h=f.graphic,i,j=g.chart,k=g.options,l=g.xAxis&&g.xAxis.names,b=p(b,!0);d===!1?e():f.firePointEvent("update",{options:a},e)},remove:function(a,b){this.series.removePoint(Ma(this,this.series.data),a,b)}});x(R.prototype,{addPoint:function(a,b,c,d){var e=this,f=e.options,g=e.data,h=e.graph,i=e.area,j=e.chart,k=e.xAxis&&e.xAxis.names,l=h&&h.shift||0,m=["graph","area"],h=f.data,n,u=e.xData;Sa(d,j);if(c){for(d=e.zones.length;d--;)m.push("zoneGraph"+d,"zoneArea"+d);o(m,function(a){if(e[a])e[a].shift=
l+1})}if(i)i.isArea=!0;b=p(b,!0);i={series:e};e.pointClass.prototype.applyOptions.apply(i,[a]);m=i.x;d=u.length;if(e.requireSorting&&m<u[d-1])for(n=!0;d&&u[d-1]>m;)d--;e.updateParallelArrays(i,"splice",d,0,0);e.updateParallelArrays(i,d);if(k&&i.name)k[m]=i.name;h.splice(d,0,a);n&&(e.data.splice(d,0,null),e.processData());f.legendType==="point"&&e.generatePoints();c&&(g[0]&&g[0].remove?g[0].remove(!1):(g.shift(),e.updateParallelArrays(i,"shift"),h.shift()));e.isDirty=!0;e.isDirtyData=!0;b&&(e.getAttribs(),
j.redraw())},removePoint:function(a,b,c){var d=this,e=d.data,f=e[a],g=d.points,h=d.chart,i=function(){e.length===g.length&&g.splice(a,1);e.splice(a,1);d.options.data.splice(a,1);d.updateParallelArrays(f||{series:d},"splice",a,1);f&&f.destroy();d.isDirty=!0;d.isDirtyData=!0;b&&h.redraw()};Sa(c,h);b=p(b,!0);f?f.firePointEvent("remove",null,i):i()},remove:function(a,b){var c=this,d=c.chart,a=p(a,!0);if(!c.isRemoving)c.isRemoving=!0,I(c,"remove",null,function(){c.destroy();d.isDirtyLegend=d.isDirtyBox=
!0;d.linkSeries();a&&d.redraw(b)});c.isRemoving=!1},update:function(a,b){var c=this,d=this.chart,e=this.userOptions,f=this.type,g=M[f].prototype,h=["group","markerGroup","dataLabelsGroup"],i;if(a.type&&a.type!==f||a.zIndex!==void 0)h.length=0;o(h,function(a){h[a]=c[a];delete c[a]});a=A(e,{animation:!1,index:this.index,pointStart:this.xData[0]},{data:this.options.data},a);this.remove(!1);for(i in g)this[i]=y;x(this,M[a.type||f].prototype);o(h,function(a){c[a]=h[a]});this.init(d,a);d.linkSeries();p(b,
!0)&&d.redraw(!1)}});x(va.prototype,{update:function(a,b){var c=this.chart,a=c.options[this.coll][this.options.index]=A(this.userOptions,a);this.destroy(!0);this._addedPlotLB=y;this.init(c,x(a,{events:y}));c.isDirtyBox=!0;p(b,!0)&&c.redraw()},remove:function(a){for(var b=this.chart,c=this.coll,d=this.series,e=d.length;e--;)d[e]&&d[e].remove(!1);ja(b.axes,this);ja(b[c],this);b.options[c].splice(this.options.index,1);o(b[c],function(a,b){a.options.index=b});this.destroy();b.isDirtyBox=!0;p(a,!0)&&b.redraw()},
setTitle:function(a,b){this.update({title:a},b)},setCategories:function(a,b){this.update({categories:a},b)}});var xa=ka(R);M.line=xa;ba.area=A(U,{threshold:0});var qa=ka(R,{type:"area",getSegments:function(){var a=this,b=[],c=[],d=[],e=this.xAxis,f=this.yAxis,g=f.stacks[this.stackKey],h={},i,j,k=this.points,l=this.options.connectNulls,m,n;if(this.options.stacking&&!this.cropped){for(m=0;m<k.length;m++)h[k[m].x]=k[m];for(n in g)g[n].total!==null&&d.push(+n);d.sort(function(a,b){return a-b});o(d,function(b){var d=
0,k;if(!l||h[b]&&h[b].y!==null)if(h[b])c.push(h[b]);else{for(m=a.index;m<=f.series.length;m++)if(k=g[b].points[m+","+b]){d=k[1];break}i=e.translate(b);j=f.toPixels(d,!0);c.push({y:null,plotX:i,clientX:i,plotY:j,yBottom:j,onMouseOver:na})}});c.length&&b.push(c)}else R.prototype.getSegments.call(this),b=this.segments;this.segments=b},getSegmentPath:function(a){var b=R.prototype.getSegmentPath.call(this,a),c=[].concat(b),d,e=this.options;d=b.length;var f=this.yAxis.getThreshold(e.threshold),g;d===3&&
c.push("L",b[1],b[2]);if(e.stacking&&!this.closedStacks)for(d=a.length-1;d>=0;d--)g=p(a[d].yBottom,f),d<a.length-1&&e.step&&c.push(a[d+1].plotX,g),c.push(a[d].plotX,g);else this.closeSegment(c,a,f);this.areaPath=this.areaPath.concat(c);return b},closeSegment:function(a,b,c){a.push("L",b[b.length-1].plotX,c,"L",b[0].plotX,c)},drawGraph:function(){this.areaPath=[];R.prototype.drawGraph.apply(this);var a=this,b=this.areaPath,c=this.options,d=[["area",this.color,c.fillColor]];o(this.zones,function(b,
f){d.push(["zoneArea"+f,b.color||a.color,b.fillColor||c.fillColor])});o(d,function(d){var f=d[0],g=a[f];g?g.animate({d:b}):a[f]=a.chart.renderer.path(b).attr({fill:p(d[2],oa(d[1]).setOpacity(p(c.fillOpacity,0.75)).get()),zIndex:0}).add(a.group)})},drawLegendSymbol:Na.drawRectangle});M.area=qa;ba.spline=A(U);xa=ka(R,{type:"spline",getPointSpline:function(a,b,c){var d=b.plotX,e=b.plotY,f=a[c-1],g=a[c+1],h,i,j,k;if(f&&g){a=f.plotY;j=g.plotX;var g=g.plotY,l;h=(1.5*d+f.plotX)/2.5;i=(1.5*e+a)/2.5;j=(1.5*
d+j)/2.5;k=(1.5*e+g)/2.5;l=(k-i)*(j-d)/(j-h)+e-k;i+=l;k+=l;i>a&&i>e?(i=v(a,e),k=2*e-i):i<a&&i<e&&(i=C(a,e),k=2*e-i);k>g&&k>e?(k=v(g,e),i=2*e-k):k<g&&k<e&&(k=C(g,e),i=2*e-k);b.rightContX=j;b.rightContY=k}c?(b=["C",f.rightContX||f.plotX,f.rightContY||f.plotY,h||d,i||e,d,e],f.rightContX=f.rightContY=null):b=["M",d,e];return b}});M.spline=xa;ba.areaspline=A(ba.area);qa=qa.prototype;xa=ka(xa,{type:"areaspline",closedStacks:!0,getSegmentPath:qa.getSegmentPath,closeSegment:qa.closeSegment,drawGraph:qa.drawGraph,
drawLegendSymbol:Na.drawRectangle});M.areaspline=xa;ba.column=A(U,{borderColor:"#FFFFFF",borderRadius:0,groupPadding:0.2,marker:null,pointPadding:0.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{brightness:0.1,shadow:!1,halo:!1},select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}},dataLabels:{align:null,verticalAlign:null,y:null},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0});xa=ka(R,{type:"column",pointAttrToOptions:{stroke:"borderColor",fill:"color",
r:"borderRadius"},cropShoulder:0,directTouch:!0,trackerGroups:["group","dataLabelsGroup"],negStacks:!0,init:function(){R.prototype.init.apply(this,arguments);var a=this,b=a.chart;b.hasRendered&&o(b.series,function(b){if(b.type===a.type)b.isDirty=!0})},getColumnMetrics:function(){var a=this,b=a.options,c=a.xAxis,d=a.yAxis,e=c.reversed,f,g={},h,i=0;b.grouping===!1?i=1:o(a.chart.series,function(b){var c=b.options,e=b.yAxis;if(b.type===a.type&&b.visible&&d.len===e.len&&d.pos===e.pos)c.stacking?(f=b.stackKey,
g[f]===y&&(g[f]=i++),h=g[f]):c.grouping!==!1&&(h=i++),b.columnIndex=h});var c=C(N(c.transA)*(c.ordinalSlope||b.pointRange||c.closestPointRange||c.tickInterval||1),c.len),j=c*b.groupPadding,k=(c-2*j)/i,l=b.pointWidth,b=q(l)?(k-l)/2:k*b.pointPadding,l=p(l,k-2*b);return a.columnMetrics={width:l,offset:b+(j+((e?i-(a.columnIndex||0):a.columnIndex)||0)*k-c/2)*(e?-1:1)}},translate:function(){var a=this,b=a.chart,c=a.options,d=a.borderWidth=p(c.borderWidth,a.closestPointRange*a.xAxis.transA<2?0:1),e=a.yAxis,
f=a.translatedThreshold=e.getThreshold(c.threshold),g=p(c.minPointLength,5),h=a.getColumnMetrics(),i=h.width,j=a.barW=v(i,1+2*d),k=a.pointXOffset=h.offset,l=-(d%2?0.5:0),m=d%2?0.5:1;b.inverted&&(f-=0.5,b.renderer.isVML&&(m+=1));c.pointPadding&&(j=ta(j));R.prototype.translate.apply(a);o(a.points,function(c){var d=p(c.yBottom,f),h=999+N(d),h=C(v(-h,c.plotY),e.len+h),o=c.plotX+k,q=j,t=C(h,d),w,x;w=v(h,d)-t;N(w)<g&&g&&(w=g,x=!e.reversed&&!c.negative||e.reversed&&c.negative,t=s(N(t-f)>g?d-g:f-(x?g:0)));
c.barX=o;c.pointWidth=i;q=s(o+q)+l;o=s(o)+l;q-=o;d=N(t)<0.5;w=C(s(t+w)+m,9E4);t=s(t)+m;w-=t;d&&(t-=1,w+=1);c.tooltipPos=b.inverted?[e.len+e.pos-b.plotLeft-h,a.xAxis.len-o-q/2,w]:[o+q/2,h+e.pos-b.plotTop,w];c.shapeType="rect";c.shapeArgs={x:o,y:t,width:q,height:w}})},getSymbol:na,drawLegendSymbol:Na.drawRectangle,drawGraph:na,drawPoints:function(){var a=this,b=this.chart,c=a.options,d=b.renderer,e=c.animationLimit||250,f,g;o(a.points,function(h){var i=h.plotY,j=h.graphic;if(i!==y&&!isNaN(i)&&h.y!==
null)f=h.shapeArgs,i=q(a.borderWidth)?{"stroke-width":a.borderWidth}:{},g=h.pointAttr[h.selected?"select":""]||a.pointAttr[""],j?(db(j),j.attr(i)[b.pointCount<e?"animate":"attr"](A(f))):h.graphic=d[h.shapeType](f).attr(i).attr(g).add(a.group).shadow(c.shadow,null,c.stacking&&!c.borderRadius);else if(j)h.graphic=j.destroy()})},animate:function(a){var b=this.yAxis,c=this.options,d=this.chart.inverted,e={};if(ca)a?(e.scaleY=0.001,a=C(b.pos+b.len,v(b.pos,b.toPixels(c.threshold))),d?e.translateX=a-b.len:
e.translateY=a,this.group.attr(e)):(e.scaleY=1,e[d?"translateX":"translateY"]=b.pos,this.group.animate(e,this.options.animation),this.animate=null)},remove:function(){var a=this,b=a.chart;b.hasRendered&&o(b.series,function(b){if(b.type===a.type)b.isDirty=!0});R.prototype.remove.apply(a,arguments)}});M.column=xa;ba.bar=A(ba.column);qa=ka(xa,{type:"bar",inverted:!0});M.bar=qa;ba.scatter=A(U,{lineWidth:0,marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{series.color}">\u25CF</span> <span style="font-size: 10px;"> {series.name}</span><br/>',
pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}});qa=ka(R,{type:"scatter",sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1,kdDimensions:2,drawGraph:function(){this.options.lineWidth&&R.prototype.drawGraph.call(this)}});M.scatter=qa;ba.pie=A(U,{borderColor:"#FFFFFF",borderWidth:1,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{distance:30,enabled:!0,formatter:function(){return this.point.name},x:0},
ignoreHiddenPoint:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,states:{hover:{brightness:0.1,shadow:!1}},stickyTracking:!1,tooltip:{followPointer:!0}});U={type:"pie",isCartesian:!1,pointClass:ka(Ga,{init:function(){Ga.prototype.init.apply(this,arguments);var a=this,b;x(a,{visible:a.visible!==!1,name:p(a.name,"Slice")});b=function(b){a.slice(b.type==="select")};H(a,"select",b);H(a,"unselect",b);return a},setVisible:function(a,b){var c=this,d=c.series,e=d.chart,f=d.options.ignoreHiddenPoint,
b=p(b,f);if(a!==c.visible){c.visible=c.options.visible=a=a===y?!c.visible:a;d.options.data[Ma(c,d.data)]=c.options;o(["graphic","dataLabel","connector","shadowGroup"],function(b){if(c[b])c[b][a?"show":"hide"](!0)});c.legendItem&&e.legend.colorizeItem(c,a);if(f)d.isDirty=!0;b&&e.redraw()}},slice:function(a,b,c){var d=this.series;Sa(c,d.chart);p(b,!0);this.sliced=this.options.sliced=a=q(a)?a:!this.sliced;d.options.data[Ma(this,d.data)]=this.options;a=a?this.slicedTranslation:{translateX:0,translateY:0};
this.graphic.animate(a);this.shadowGroup&&this.shadowGroup.animate(a)},haloPath:function(a){var b=this.shapeArgs,c=this.series.chart;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(c.plotLeft+b.x,c.plotTop+b.y,b.r+a,b.r+a,{innerR:this.shapeArgs.r,start:b.start,end:b.end})}}),requireSorting:!1,directTouch:!0,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},getColor:na,
animate:function(a){var b=this,c=b.points,d=b.startAngleRad;if(!a)o(c,function(a){var c=a.graphic,g=a.shapeArgs;c&&(c.attr({r:a.startR||b.center[3]/2,start:d,end:d}),c.animate({r:g.r,start:g.start,end:g.end},b.options.animation))}),b.animate=null},setData:function(a,b,c,d){R.prototype.setData.call(this,a,!1,c,d);this.processData();this.generatePoints();p(b,!0)&&this.chart.redraw(c)},updateTotals:function(){var a,b=0,c=this.points,d=c.length,e,f=this.options.ignoreHiddenPoint;for(a=0;a<d;a++)e=c[a],
b+=f&&!e.visible?0:e.y;this.total=b;for(a=0;a<d;a++)e=c[a],e.percentage=b>0&&(e.visible||!f)?e.y/b*100:0,e.total=b},generatePoints:function(){R.prototype.generatePoints.call(this);this.updateTotals()},translate:function(a){this.generatePoints();var b=0,c=this.options,d=c.slicedOffset,e=d+c.borderWidth,f,g,h,i=c.startAngle||0,j=this.startAngleRad=ma/180*(i-90),i=(this.endAngleRad=ma/180*(p(c.endAngle,i+360)-90))-j,k=this.points,l=c.dataLabels.distance,c=c.ignoreHiddenPoint,m,n=k.length,o;if(!a)this.center=
a=this.getCenter();this.getX=function(b,c){h=W.asin(C((b-a[1])/(a[2]/2+l),1));return a[0]+(c?-1:1)*X(h)*(a[2]/2+l)};for(m=0;m<n;m++){o=k[m];f=j+b*i;if(!c||o.visible)b+=o.percentage/100;g=j+b*i;o.shapeType="arc";o.shapeArgs={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:s(f*1E3)/1E3,end:s(g*1E3)/1E3};h=(g+f)/2;h>1.5*ma?h-=2*ma:h<-ma/2&&(h+=2*ma);o.slicedTranslation={translateX:s(X(h)*d),translateY:s(aa(h)*d)};f=X(h)*a[2]/2;g=aa(h)*a[2]/2;o.tooltipPos=[a[0]+f*0.7,a[1]+g*0.7];o.half=h<-ma/2||h>ma/2?1:0;
o.angle=h;e=C(e,l/2);o.labelPos=[a[0]+f+X(h)*l,a[1]+g+aa(h)*l,a[0]+f+X(h)*e,a[1]+g+aa(h)*e,a[0]+f,a[1]+g,l<0?"center":o.half?"right":"left",h]}},drawGraph:null,drawPoints:function(){var a=this,b=a.chart.renderer,c,d,e=a.options.shadow,f,g,h;if(e&&!a.shadowGroup)a.shadowGroup=b.g("shadow").add(a.group);o(a.points,function(i){d=i.graphic;g=i.shapeArgs;f=i.shadowGroup;if(e&&!f)f=i.shadowGroup=b.g("shadow").add(a.shadowGroup);c=i.sliced?i.slicedTranslation:{translateX:0,translateY:0};f&&f.attr(c);if(d)d.animate(x(g,
c));else{h={"stroke-linejoin":"round"};if(!i.visible)h.visibility="hidden";i.graphic=d=b[i.shapeType](g).setRadialReference(a.center).attr(i.pointAttr[i.selected?"select":""]).attr(h).attr(c).add(a.group).shadow(e,f)}})},searchPoint:na,sortByAngle:function(a,b){a.sort(function(a,d){return a.angle!==void 0&&(d.angle-a.angle)*b})},drawLegendSymbol:Na.drawRectangle,getCenter:Xb.getCenter,getSymbol:na};U=ka(R,U);M.pie=U;R.prototype.drawDataLabels=function(){var a=this,b=a.options,c=b.cursor,d=b.dataLabels,
e=a.points,f,g,h=a.hasRendered||0,i,j,k=a.chart.renderer;if(d.enabled||a._hasPointLabels)a.dlProcessOptions&&a.dlProcessOptions(d),j=a.plotGroup("dataLabelsGroup","data-labels",d.defer?"hidden":"visible",d.zIndex||6),p(d.defer,!0)&&(j.attr({opacity:+h}),h||H(a,"afterAnimate",function(){a.visible&&j.show();j[b.animation?"animate":"attr"]({opacity:1},{duration:200})})),g=d,o(e,function(e){var h,n=e.dataLabel,o,r,s=e.connector,v=!0,t,w={};f=e.dlOptions||e.options&&e.options.dataLabels;h=p(f&&f.enabled,
g.enabled);if(n&&!h)e.dataLabel=n.destroy();else if(h){d=A(g,f);t=d.style;h=d.rotation;o=e.getLabelConfig();i=d.format?Ja(d.format,o):d.formatter.call(o,d);t.color=p(d.color,t.color,a.color,"black");if(n)if(q(i))n.attr({text:i}),v=!1;else{if(e.dataLabel=n=n.destroy(),s)e.connector=s.destroy()}else if(q(i)){n={fill:d.backgroundColor,stroke:d.borderColor,"stroke-width":d.borderWidth,r:d.borderRadius||0,rotation:h,padding:d.padding,zIndex:1};if(t.color==="contrast")w.color=d.inside||d.distance<0||b.stacking?
k.getContrast(e.color||a.color):"#000000";if(c)w.cursor=c;for(r in n)n[r]===y&&delete n[r];n=e.dataLabel=k[h?"text":"label"](i,0,-999,d.shape,null,null,d.useHTML).attr(n).css(x(t,w)).add(j).shadow(d.shadow)}n&&a.alignDataLabel(e,n,d,null,v)}})};R.prototype.alignDataLabel=function(a,b,c,d,e){var f=this.chart,g=f.inverted,h=p(a.plotX,-999),i=p(a.plotY,-999),j=b.getBBox(),k=f.renderer.fontMetrics(c.style.fontSize).b,l=this.visible&&(a.series.forceDL||f.isInsidePlot(h,s(i),g)||d&&f.isInsidePlot(h,g?d.x+
1:d.y+d.height-1,g));if(l)d=x({x:g?f.plotWidth-i:h,y:s(g?f.plotHeight-h:i),width:0,height:0},d),x(c,{width:j.width,height:j.height}),c.rotation?(a=f.renderer.rotCorr(k,c.rotation),b[e?"attr":"animate"]({x:d.x+c.x+d.width/2+a.x,y:d.y+c.y+d.height/2}).attr({align:c.align})):(b.align(c,null,d),g=b.alignAttr,p(c.overflow,"justify")==="justify"?this.justifyDataLabel(b,c,g,j,d,e):p(c.crop,!0)&&(l=f.isInsidePlot(g.x,g.y)&&f.isInsidePlot(g.x+j.width,g.y+j.height)),c.shape&&b.attr({anchorX:a.plotX,anchorY:a.plotY}));
if(!l)b.attr({y:-999}),b.placed=!1};R.prototype.justifyDataLabel=function(a,b,c,d,e,f){var g=this.chart,h=b.align,i=b.verticalAlign,j,k,l=a.box?0:a.padding||0;j=c.x+l;if(j<0)h==="right"?b.align="left":b.x=-j,k=!0;j=c.x+d.width-l;if(j>g.plotWidth)h==="left"?b.align="right":b.x=g.plotWidth-j,k=!0;j=c.y+l;if(j<0)i==="bottom"?b.verticalAlign="top":b.y=-j,k=!0;j=c.y+d.height-l;if(j>g.plotHeight)i==="top"?b.verticalAlign="bottom":b.y=g.plotHeight-j,k=!0;if(k)a.placed=!f,a.align(b,null,e)};if(M.pie)M.pie.prototype.drawDataLabels=
function(){var a=this,b=a.data,c,d=a.chart,e=a.options.dataLabels,f=p(e.connectorPadding,10),g=p(e.connectorWidth,1),h=d.plotWidth,i=d.plotHeight,j,k,l=p(e.softConnector,!0),m=e.distance,n=a.center,q=n[2]/2,r=n[1],x=m>0,y,t,w,A=[[],[]],B,z,F,E,G,D=[0,0,0,0],L=function(a,b){return b.y-a.y};if(a.visible&&(e.enabled||a._hasPointLabels)){R.prototype.drawDataLabels.apply(a);o(b,function(a){a.dataLabel&&a.visible&&A[a.half].push(a)});for(E=2;E--;){var I=[],M=[],H=A[E],K=H.length,J;if(K){a.sortByAngle(H,
E-0.5);for(G=b=0;!b&&H[G];)b=H[G]&&H[G].dataLabel&&(H[G].dataLabel.getBBox().height||21),G++;if(m>0){t=C(r+q+m,d.plotHeight);for(G=v(0,r-q-m);G<=t;G+=b)I.push(G);t=I.length;if(K>t){c=[].concat(H);c.sort(L);for(G=K;G--;)c[G].rank=G;for(G=K;G--;)H[G].rank>=t&&H.splice(G,1);K=H.length}for(G=0;G<K;G++){c=H[G];w=c.labelPos;c=9999;var P,O;for(O=0;O<t;O++)P=N(I[O]-w[1]),P<c&&(c=P,J=O);if(J<G&&I[G]!==null)J=G;else for(t<K-G+J&&I[G]!==null&&(J=t-K+G);I[J]===null;)J++;M.push({i:J,y:I[J]});I[J]=null}M.sort(L)}for(G=
0;G<K;G++){c=H[G];w=c.labelPos;y=c.dataLabel;F=c.visible===!1?"hidden":"inherit";c=w[1];if(m>0){if(t=M.pop(),J=t.i,z=t.y,c>z&&I[J+1]!==null||c<z&&I[J-1]!==null)z=C(v(0,c),d.plotHeight)}else z=c;B=e.justify?n[0]+(E?-1:1)*(q+m):a.getX(z===r-q-m||z===r+q+m?c:z,E);y._attr={visibility:F,align:w[6]};y._pos={x:B+e.x+({left:f,right:-f}[w[6]]||0),y:z+e.y-10};y.connX=B;y.connY=z;if(this.options.size===null)t=y.width,B-t<f?D[3]=v(s(t-B+f),D[3]):B+t>h-f&&(D[1]=v(s(B+t-h+f),D[1])),z-b/2<0?D[0]=v(s(-z+b/2),D[0]):
z+b/2>i&&(D[2]=v(s(z+b/2-i),D[2]))}}}if(Fa(D)===0||this.verifyDataLabelOverflow(D))this.placeDataLabels(),x&&g&&o(this.points,function(b){j=b.connector;w=b.labelPos;if((y=b.dataLabel)&&y._pos&&b.visible)F=y._attr.visibility,B=y.connX,z=y.connY,k=l?["M",B+(w[6]==="left"?5:-5),z,"C",B,z,2*w[2]-w[4],2*w[3]-w[5],w[2],w[3],"L",w[4],w[5]]:["M",B+(w[6]==="left"?5:-5),z,"L",w[2],w[3],"L",w[4],w[5]],j?(j.animate({d:k}),j.attr("visibility",F)):b.connector=j=a.chart.renderer.path(k).attr({"stroke-width":g,stroke:e.connectorColor||
b.color||"#606060",visibility:F}).add(a.dataLabelsGroup);else if(j)b.connector=j.destroy()})}},M.pie.prototype.placeDataLabels=function(){o(this.points,function(a){var b=a.dataLabel;if(b&&a.visible)(a=b._pos)?(b.attr(b._attr),b[b.moved?"animate":"attr"](a),b.moved=!0):b&&b.attr({y:-999})})},M.pie.prototype.alignDataLabel=na,M.pie.prototype.verifyDataLabelOverflow=function(a){var b=this.center,c=this.options,d=c.center,e=c.minSize||80,f=e,g;d[0]!==null?f=v(b[2]-v(a[1],a[3]),e):(f=v(b[2]-a[1]-a[3],
e),b[0]+=(a[3]-a[1])/2);d[1]!==null?f=v(C(f,b[2]-v(a[0],a[2])),e):(f=v(C(f,b[2]-a[0]-a[2]),e),b[1]+=(a[0]-a[2])/2);f<b[2]?(b[2]=f,b[3]=/%$/.test(c.innerSize||0)?f*parseFloat(c.innerSize||0)/100:parseFloat(c.innerSize||0),this.translate(b),o(this.points,function(a){if(a.dataLabel)a.dataLabel._pos=null}),this.drawDataLabels&&this.drawDataLabels()):g=!0;return g};if(M.column)M.column.prototype.alignDataLabel=function(a,b,c,d,e){var f=this.chart.inverted,g=a.series,h=a.dlBox||a.shapeArgs,i=p(a.below,
a.plotY>p(this.translatedThreshold,g.yAxis.len)),j=p(c.inside,!!this.options.stacking);if(h&&(d=A(h),f&&(d={x:g.yAxis.len-d.y-d.height,y:g.xAxis.len-d.x-d.width,width:d.height,height:d.width}),!j))f?(d.x+=i?0:d.width,d.width=0):(d.y+=i?d.height:0,d.height=0);c.align=p(c.align,!f||j?"center":i?"right":"left");c.verticalAlign=p(c.verticalAlign,f||j?"middle":i?"top":"bottom");R.prototype.alignDataLabel.call(this,a,b,c,d,e)};(function(a){var b=a.Chart,c=a.each,d=a.pick,e=HighchartsAdapter.addEvent;b.prototype.callbacks.push(function(a){function b(){var e=
[];c(a.series,function(a){var b=a.options.dataLabels;(b.enabled||a._hasPointLabels)&&!b.allowOverlap&&a.visible&&c(a.points,function(a){if(a.dataLabel)a.dataLabel.labelrank=d(a.labelrank,a.shapeArgs&&a.shapeArgs.height),e.push(a.dataLabel)})});a.hideOverlappingLabels(e)}b();e(a,"redraw",b)});b.prototype.hideOverlappingLabels=function(a){var b=a.length,c,d,e,k;for(d=0;d<b;d++)if(c=a[d])c.oldOpacity=c.opacity,c.newOpacity=1;a.sort(function(a,b){return b.labelrank-a.labelrank});for(d=0;d<b;d++){e=a[d];
for(c=d+1;c<b;++c)if(k=a[c],e&&k&&e.placed&&k.placed&&e.newOpacity!==0&&k.newOpacity!==0&&!(k.alignAttr.x>e.alignAttr.x+e.width||k.alignAttr.x+k.width<e.alignAttr.x||k.alignAttr.y>e.alignAttr.y+e.height||k.alignAttr.y+k.height<e.alignAttr.y))(e.labelrank<k.labelrank?e:k).newOpacity=0}for(d=0;d<b;d++)if(c=a[d]){if(c.oldOpacity!==c.newOpacity&&c.placed)c.alignAttr.opacity=c.newOpacity,c[c.isOld&&c.newOpacity?"animate":"attr"](c.alignAttr);c.isOld=!0}}})(z);U=z.TrackerMixin={drawTrackerPoint:function(){var a=
this,b=a.chart,c=b.pointer,d=a.options.cursor,e=d&&{cursor:d},f=function(a){for(var c=a.target,d;c&&!d;)d=c.point,c=c.parentNode;if(d!==y&&d!==b.hoverPoint)d.onMouseOver(a)};o(a.points,function(a){if(a.graphic)a.graphic.element.point=a;if(a.dataLabel)a.dataLabel.element.point=a});if(!a._hasTracking)o(a.trackerGroups,function(b){if(a[b]&&(a[b].addClass("highcharts-tracker").on("mouseover",f).on("mouseout",function(a){c.onTrackerMouseOut(a)}).css(e),ab))a[b].on("touchstart",f)}),a._hasTracking=!0},
drawTrackerGraph:function(){var a=this,b=a.options,c=b.trackByArea,d=[].concat(c?a.areaPath:a.graphPath),e=d.length,f=a.chart,g=f.pointer,h=f.renderer,i=f.options.tooltip.snap,j=a.tracker,k=b.cursor,l=k&&{cursor:k},k=a.singlePoints,m,n=function(){if(f.hoverSeries!==a)a.onMouseOver()},p="rgba(192,192,192,"+(ca?1.0E-4:0.002)+")";if(e&&!c)for(m=e+1;m--;)d[m]==="M"&&d.splice(m+1,0,d[m+1]-i,d[m+2],"L"),(m&&d[m]==="M"||m===e)&&d.splice(m,0,"L",d[m-2]+i,d[m-1]);for(m=0;m<k.length;m++)e=k[m],d.push("M",e.plotX-
i,e.plotY,"L",e.plotX+i,e.plotY);j?j.attr({d:d}):(a.tracker=h.path(d).attr({"stroke-linejoin":"round",visibility:a.visible?"visible":"hidden",stroke:p,fill:c?p:O,"stroke-width":b.lineWidth+(c?0:2*i),zIndex:2}).add(a.group),o([a.tracker,a.markerGroup],function(a){a.addClass("highcharts-tracker").on("mouseover",n).on("mouseout",function(a){g.onTrackerMouseOut(a)}).css(l);if(ab)a.on("touchstart",n)}))}};if(M.column)xa.prototype.drawTracker=U.drawTrackerPoint;if(M.pie)M.pie.prototype.drawTracker=U.drawTrackerPoint;
if(M.scatter)qa.prototype.drawTracker=U.drawTrackerPoint;x(nb.prototype,{setItemEvents:function(a,b,c,d,e){var f=this;(c?b:a.legendGroup).on("mouseover",function(){a.setState("hover");b.css(f.options.itemHoverStyle)}).on("mouseout",function(){b.css(a.visible?d:e);a.setState()}).on("click",function(b){var c=function(){a.setVisible()},b={browserEvent:b};a.firePointEvent?a.firePointEvent("legendItemClick",b,c):I(a,"legendItemClick",b,c)})},createCheckboxForItem:function(a){a.checkbox=$("input",{type:"checkbox",
checked:a.selected,defaultChecked:a.selected},this.options.itemCheckboxStyle,this.chart.container);H(a.checkbox,"click",function(b){I(a.series||a,"checkboxClick",{checked:b.target.checked,item:a},function(){a.select()})})}});T.legend.itemStyle.cursor="pointer";x(E.prototype,{showResetZoom:function(){var a=this,b=T.lang,c=a.options.chart.resetZoomButton,d=c.theme,e=d.states,f=c.relativeTo==="chart"?null:"plotBox";this.resetZoomButton=a.renderer.button(b.resetZoom,null,null,function(){a.zoomOut()},
d,e&&e.hover).attr({align:c.position.align,title:b.resetZoomTitle}).add().align(c.position,!1,f)},zoomOut:function(){var a=this;I(a,"selection",{resetSelection:!0},function(){a.zoom()})},zoom:function(a){var b,c=this.pointer,d=!1,e;!a||a.resetSelection?o(this.axes,function(a){b=a.zoom()}):o(a.xAxis.concat(a.yAxis),function(a){var e=a.axis,h=e.isXAxis;if(c[h?"zoomX":"zoomY"]||c[h?"pinchX":"pinchY"])b=e.zoom(a.min,a.max),e.displayBtn&&(d=!0)});e=this.resetZoomButton;if(d&&!e)this.showResetZoom();else if(!d&&
da(e))this.resetZoomButton=e.destroy();b&&this.redraw(p(this.options.chart.animation,a&&a.animation,this.pointCount<100))},pan:function(a,b){var c=this,d=c.hoverPoints,e;d&&o(d,function(a){a.setState()});o(b==="xy"?[1,0]:[1],function(b){var d=a[b?"chartX":"chartY"],h=c[b?"xAxis":"yAxis"][0],i=c[b?"mouseDownX":"mouseDownY"],j=(h.pointRange||0)/2,k=h.getExtremes(),l=h.toValue(i-d,!0)+j,j=h.toValue(i+c[b?"plotWidth":"plotHeight"]-d,!0)-j,i=i>d;if(h.series.length&&(i||l>C(k.dataMin,k.min))&&(!i||j<v(k.dataMax,
k.max)))h.setExtremes(l,j,!1,!1,{trigger:"pan"}),e=!0;c[b?"mouseDownX":"mouseDownY"]=d});e&&c.redraw(!1);L(c.container,{cursor:"move"})}});x(Ga.prototype,{select:function(a,b){var c=this,d=c.series,e=d.chart,a=p(a,!c.selected);c.firePointEvent(a?"select":"unselect",{accumulate:b},function(){c.selected=c.options.selected=a;d.options.data[Ma(c,d.data)]=c.options;c.setState(a&&"select");b||o(e.getSelectedPoints(),function(a){if(a.selected&&a!==c)a.selected=a.options.selected=!1,d.options.data[Ma(a,d.data)]=
a.options,a.setState(""),a.firePointEvent("unselect")})})},onMouseOver:function(a){var b=this.series,c=b.chart,d=c.tooltip,e=c.hoverPoint;if(c.hoverSeries!==b)b.onMouseOver();if(e&&e!==this)e.onMouseOut();this.firePointEvent("mouseOver");d&&(!d.shared||b.noSharedTooltip)&&d.refresh(this,a);this.setState("hover");c.hoverPoint=this},onMouseOut:function(){var a=this.series.chart,b=a.hoverPoints;this.firePointEvent("mouseOut");if(!b||Ma(this,b)===-1)this.setState(),a.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var a=
A(this.series.options.point,this.options).events,b;this.events=a;for(b in a)H(this,b,a[b]);this.hasImportedEvents=!0}},setState:function(a,b){var c=this.plotX,d=this.plotY,e=this.series,f=e.options.states,g=ba[e.type].marker&&e.options.marker,h=g&&!g.enabled,i=g&&g.states[a],j=i&&i.enabled===!1,k=e.stateMarkerGraphic,l=this.marker||{},m=e.chart,n=e.halo,o,a=a||"";o=this.pointAttr[a]||e.pointAttr[a];if(!(a===this.state&&!b||this.selected&&a!=="select"||f[a]&&f[a].enabled===!1||a&&(j||h&&i.enabled===
!1)||a&&l.states&&l.states[a]&&l.states[a].enabled===!1)){if(this.graphic)g=g&&this.graphic.symbolName&&o.r,this.graphic.attr(A(o,g?{x:c-g,y:d-g,width:2*g,height:2*g}:{})),k&&k.hide();else{if(a&&i)if(g=i.radius,l=l.symbol||e.symbol,k&&k.currentSymbol!==l&&(k=k.destroy()),k)k[b?"animate":"attr"]({x:c-g,y:d-g});else if(l)e.stateMarkerGraphic=k=m.renderer.symbol(l,c-g,d-g,2*g,2*g).attr(o).add(e.markerGroup),k.currentSymbol=l;if(k)k[a&&m.isInsidePlot(c,d,m.inverted)?"show":"hide"]()}if((c=f[a]&&f[a].halo)&&
c.size){if(!n)e.halo=n=m.renderer.path().add(m.seriesGroup);n.attr(x({fill:oa(this.color||e.color).setOpacity(c.opacity).get()},c.attributes))[b?"animate":"attr"]({d:this.haloPath(c.size)})}else n&&n.attr({d:[]});this.state=a}},haloPath:function(a){var b=this.series,c=b.chart,d=b.getPlotBox(),e=c.inverted;return c.renderer.symbols.circle(d.translateX+(e?b.yAxis.len-this.plotY:this.plotX)-a,d.translateY+(e?b.xAxis.len-this.plotX:this.plotY)-a,a*2,a*2)}});x(R.prototype,{onMouseOver:function(){var a=
this.chart,b=a.hoverSeries;if(b&&b!==this)b.onMouseOut();this.options.events.mouseOver&&I(this,"mouseOver");this.setState("hover");a.hoverSeries=this},onMouseOut:function(){var a=this.options,b=this.chart,c=b.tooltip,d=b.hoverPoint;b.hoverSeries=null;if(d)d.onMouseOut();this&&a.events.mouseOut&&I(this,"mouseOut");c&&!a.stickyTracking&&(!c.shared||this.noSharedTooltip)&&c.hide();this.setState()},setState:function(a){var b=this.options,c=this.graph,d=b.states,e=b.lineWidth,b=0,a=a||"";if(this.state!==
a&&(this.state=a,!(d[a]&&d[a].enabled===!1)&&(a&&(e=d[a].lineWidth||e+(d[a].lineWidthPlus||0)),c&&!c.dashstyle))){a={"stroke-width":e};for(c.attr(a);this["zoneGraph"+b];)this["zoneGraph"+b].attr(a),b+=1}},setVisible:function(a,b){var c=this,d=c.chart,e=c.legendItem,f,g=d.options.chart.ignoreHiddenSeries,h=c.visible;f=(c.visible=a=c.userOptions.visible=a===y?!h:a)?"show":"hide";o(["group","dataLabelsGroup","markerGroup","tracker"],function(a){if(c[a])c[a][f]()});if(d.hoverSeries===c||(d.hoverPoint&&
d.hoverPoint.series)===c)c.onMouseOut();e&&d.legend.colorizeItem(c,a);c.isDirty=!0;c.options.stacking&&o(d.series,function(a){if(a.options.stacking&&a.visible)a.isDirty=!0});o(c.linkedSeries,function(b){b.setVisible(a,!1)});if(g)d.isDirtyBox=!0;b!==!1&&d.redraw();I(c,f)},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(a){this.selected=a=a===y?!this.selected:a;if(this.checkbox)this.checkbox.checked=a;I(this,a?"select":"unselect")},drawTracker:U.drawTrackerGraph});
x(z,{Color:oa,Point:Ga,Tick:Ta,Renderer:$a,SVGElement:P,SVGRenderer:ua,arrayMin:Pa,arrayMax:Fa,charts:Y,dateFormat:Oa,error:la,format:Ja,pathAnim:zb,getOptions:function(){return T},hasBidiBug:Nb,isTouchDevice:Jb,setOptions:function(a){T=A(!0,T,a);Cb();return T},addEvent:H,removeEvent:Z,createElement:$,discardElement:Ra,css:L,each:o,map:Ua,merge:A,splat:sa,extendClass:ka,pInt:F,svg:ca,canvas:fa,vml:!ca&&!fa,product:"Highcharts",version:"4.1.6"})})();

/*!
  * $script.js Async loader & dependency manager
  * https://github.com/ded/script.js
  * (c) Dustin Diaz, Jacob Thornton 2011
  * License: MIT
  */
(function(a,b,c){typeof c["module"]!="undefined"&&c.module.exports?c.module.exports=b():typeof c["define"]!="undefined"&&c["define"]=="function"&&c.define.amd?define(a,b):c[a]=b()})("$script",function(){function p(a,b){for(var c=0,d=a.length;c<d;++c)if(!b(a[c]))return j;return 1}function q(a,b){p(a,function(a){return!b(a)})}function r(a,b,i){function o(a){return a.call?a():d[a]}function t(){if(!--n){d[m]=1,l&&l();for(var a in f)p(a.split("|"),o)&&!q(f[a],o)&&(f[a]=[])}}a=a[k]?a:[a];var j=b&&b.call,l=j?b:i,m=j?a.join(""):b,n=a.length;return setTimeout(function(){q(a,function(a){if(h[a])return m&&(e[m]=1),h[a]==2&&t();h[a]=1,m&&(e[m]=1),s(!c.test(a)&&g?g+a+".js":a,t)})},0),r}function s(c,d){var e=a.createElement("script"),f=j;e.onload=e.onerror=e[o]=function(){if(e[m]&&!/^c|loade/.test(e[m])||f)return;e.onload=e[o]=null,f=1,h[c]=2,d()},e.async=1,e.src=c,b.insertBefore(e,b.firstChild)}var a=document,b=a.getElementsByTagName("head")[0],c=/^https?:\/\//,d={},e={},f={},g,h={},i="string",j=!1,k="push",l="DOMContentLoaded",m="readyState",n="addEventListener",o="onreadystatechange";return!a[m]&&a[n]&&(a[n](l,function t(){a.removeEventListener(l,t,j),a[m]="complete"},j),a[m]="loading"),r.get=s,r.order=function(a,b,c){(function d(e){e=a.shift(),a.length?r(e,d):r(e,b,c)})()},r.path=function(a){g=a},r.ready=function(a,b,c){a=a[k]?a:[a];var e=[];return!q(a,function(a){d[a]||e[k](a)})&&p(a,function(a){return d[a]})?b():!function(a){f[a]=f[a]||[],f[a][k](b),c&&c(e)}(a.join("|")),r},r},this)

window.__review_panel_script = __review_panel_script = 0;

function noop() {}

var __review_option = {
        "name": "FT", 
        "app_link": "itms-apps://itunes.apple.com/app/ft-shang-xue-yuan/id493892004",
        "comment_link": 'dialog{"url":"http://m.ftchinese.com/forum/mbagym"}'
    };

window.__reviewer = __reviewer = null;
if (navigator.onLine) {
    $script("http://m.ftchinese.com/js/review.js", function() {
        __reviewer = new ftcReview(__review_option);
    });
}

function reviewPanel(e) {
    //e = e || window.event.target || window.event.srcElement;

    if (!navigator.onLine) return;

    // performance was so appalling in iPad 1 that I think it's better to disable it
    if (!event.acceleration) return;

    if (!("ftcReview" in window)) {
        $script("http://m.ftchinese.com/js/review.js");
        return;
    }

    else {
        if (__reviewer == null) {
            __reviewer = new ftcReview(__review_option);
            return;
        }
        else __reviewer.show();       
    }
}



function clickcoursemenu() {
    $(".coursemenu .bigbuttons div,.bookmenu .bigbuttons div").unbind().bind("click",function() {
        if ($(this).attr("book")){
            $(this).addClass("tilt");
            remember = 0;
            window.location.href = $(this).attr("book")+".html?"+themi;
        }
    });
}



function startgame() {
    $("#startscreen").remove();
    $(".fullbody").removeClass("on");$("#bookmenu").addClass("on");
    clickcoursemenu();
    multimenu("coursemenu");
}


function TrackTraffic(i) {
    if (location.href.indexOf("http://")>=0) {
        ga('send', 'pageview',  ce+'/mbagym/article/'+i);
    }else{
        //gaTrack('UA-1608715-1', 'm.ftchinese.com', ce+'/mbagym/article/'+i, encodeURIComponent(document.title)+"/"+i);
        new Image().src = 'http://m.ftchinese.com/track/ga.php?utmac=MO-1608715-1&utmn='+thed+''+themi+'&utmr=-&utmp='+ce+'/mbagym/article/'+i+'&utmdt='+encodeURIComponent(document.title).replace(/[\s\r\n\t]/g,'')+'&guid=ON';
    }
}

function multimenu(theid) {
    var $ani = $("#"+theid);
    var pagenumber = $("#"+theid).find(".bigbuttons").length;
    if (pagenumber>1) {
        $ani.parent().before('<div class = "tap menutopic"></div>');
        $ani.parent().after("<div class = menudot></div>");
        var $bigbuttons = $ani.find(".bigbuttons");
        var lasttopic = "";
        var thistopic;
        for (var i = 0;i<pagenumber;i++) {
            $(".menudot").append("<span>&nbsp;&#149;&nbsp;</span>");
            thistopic = $bigbuttons.eq(i).attr("topic");
            $bigbuttons.eq(i).attr("n",i);
            if (!!thistopic && thistopic != lasttopic) {
                $(".menutopic").append('&nbsp;&nbsp;<span topic = "'+thistopic+'">'+$bigbuttons.eq(i).attr("topic")+'</span>');
                lasttopic = thistopic;
            }
        }
        $(".menutopic span").unbind().bind("click",function(){
            var thtopic = $(this).attr("topic");
            var ntopic = $ani.find(".bigbuttons[topic = '"+thtopic+"']").eq(0).attr("n");
            ntopic = parseInt(ntopic);
            courseSlider.slide(ntopic);
        });
        currentMenu = getvalue(theid);
        if (currentMenu == null) currentMenu = 0;
        currentMenu = parseInt(currentMenu);
        $(".menudot span").eq(currentMenu).addClass("white");
        $bigbuttons.css({"position":"absolute"});
        courseSlider = new Swipe(document.getElementById('courseSlider'),{
            type: "coursemenu",
            startSlide: currentMenu,
            callback: function(event, index, elem) {
                savevalue(theid, index);
            }
        });		
    }
}

function openbook() {
    //
    //id=fullpageads startPage=0 everyPage=5
    var adcount=0;
    var fullpageadsLength=$("#fullpageads .slide").length;
    $('#allcontent .slide').each(function(index){
        var startPage=$('#fullpageads').attr('startPage');
        var everyPage=$('#fullpageads').attr('everyPage');
        var fixedBG = $(this).attr('data-fixed-bg') || '';
        startPage=parseInt(startPage, 10);
        everyPage=parseInt(everyPage, 10);
        //
        if (($(this).find(".article").length>0 && index-startPage>=0 && (index-startPage) % everyPage==0) || index==startPage) {
            if (adcount>=fullpageadsLength) {
                adcount=0;
            }
            $("#fullpageads .slide").eq(adcount).clone().insertAfter($(this));
            adcount=adcount+1;
        }
        //iOSVideo
        if (deviceType !== 'other') {
            $(this).find('.video-bg').remove();
        }

        //
        if (fixedBG !== '') {
            $(this).css('background', 'transparent');
            $(this).attr('data-fixed-bg-0', fixedBG);
            $(this).prev().attr('data-fixed-bg-0', fixedBG);
            $(this).next().attr('data-fixed-bg-0', fixedBG);
        }
    });
    //MPU
    mpuAmount=$("#mpuads .mpuad").length;
	
	// 
	userinfo = "\n\n\n\n"+userinfo;
	$("#feedbackEmail").attr("href","mailto:ftchinese.feedback@gmail.com?subject=Lunch with the FT App Feedback&body="+encodeURIComponent(userinfo));

    var bookid = "mbagym";
    if (location.href.indexOf("interactive/")>0) {
        bookid = location.href.replace(/^.*(interactive\/.*$)/g,"/mbagym/$1");
    } else if (location.href.indexOf("photonews/")>0) {
        bookid = location.href.replace(/^.*(photonews\/.*$)/g,"$1");
    } else if (location.href.indexOf(".html")>0) {
        bookid = location.href.replace(/^.*\/([a-zA-Z0-1\_\-]+)\.html.*$/g,"$1");
    } else if (location.href.indexOf("?")>0) {
        bookid = location.href.replace(/^.*\/([a-zA-Z0-1\_\-]+)\?.*$/g,"$1");
    }
    bookid = encodeURIComponent(bookid);
    ce = bookid;
    var k = getvalue(ce+"_article");
	currentPage=parseInt(getvalue(ce+"_thispage"));
	currentPageCount=parseInt(getvalue(ce+"_allpages"));
	if (currentPageCount==null || currentPageCount<1) {
		currentPageCount=0;
		currentPage=0;
	} else {
		currentPage=parseInt(currentPage);
		currentPageCount=parseInt(currentPageCount);
	}
    var allpages = $("#allcontent .slide").length;
    articleCount=allpages;
    $("#allcontent .slide").each(function(index){
        $(this).attr("articlenumber",index);
    });
    //
    //
    $("#allcontent .slide[topic = ''] .contentintro").css("color","#000");
    //
    $("#allcontent .flowedContent img,#allcontent .flowedContent .byline").remove();
        var currenttopic = "";
    var storyid = "";
    var n = 0;
    
	//
	if (getvalue("fontPreference") && getvalue("fontPreference")!=null && getvalue("fontPreference")!="") {
		fontPreference=getvalue("fontPreference");
	}
	$("#gamecontent").attr("class",fontPreference);
	$(".fontpreferences div").unbind().bind("click",function(){
		$(".fontpreferences div").removeClass("-selected");
		$(this).addClass("-selected");
		fontPreference=$(this).attr("id");
	});
	$(".fontpreferences div").removeClass("-selected");
	$(".fontpreferences ."+fontPreference).addClass("-selected");
    
    //
    if (getvalue("bgMode") && getvalue("bgMode")!=null && getvalue("bgMode")!="") {
        bgMode=getvalue("bgMode");
		$("body").attr("class",bgMode);
        if (bgMode==null || bgMode=="") {
            bgMode="pink";
        }
        $("#"+bgMode).addClass("-selected");
	}
    $(".bgpreferences div").unbind().bind("click",function(){
		$(".bgpreferences div").removeClass("-selected");
		$(this).addClass("-selected");
		bgMode=$(this).attr("id");
        $("body").attr("class",bgMode);
        savevalue("bgMode",bgMode);
	});

    //navigation
    //
    //(n1), nn1n
    var contentpage = 0;
    //$("#allcontent .contentcategory").append("<div class=headline></div>");
    $("#allcontent .slide").each(function(i){
        $(this).find(".question").prepend("<b></b>");
        $(this).find(".option p").addClass("notouchall").append("<div class='optionButton notouchall'></div>");
        if ($(this).find(".option p[value][type = 'r']").length>0) {
            var k = $(this).find(".option p[value][type = 'r']").eq(0).attr("value");
            if (k == 0) {
                $(this).find(".quiz").parent().append("<div class = quiztip></div>");
            } else {
                $(this).find(".quiz").parent().append("<div class = quiztip>"+k+"</div>");
            }
        }
        if ($(this).find(".articleinfo .datestamp").length==0) {
            $(this).find(".flowedContent .datestamp").appendTo($(this).find(".articleinfo"));
        }
        if ($(this).find(".articleinfo .headline").html()) {
        var newheadline=$(this).find(".articleinfo .headline").html();
        $(this).find(".articleinfo .headline").html(newheadline.replace(/(.*).*/g,"$1"));
        }
        $(this).find(".flowedContent .datestamp").remove();        
        if ($(this).find(".contentcategory").length>0){contentpage = contentpage+1;}
        $(this).attr("n1",i);
        if ($(this).attr("topic") && $(this).attr("topic") != "" && $(this).attr("topic") != currenttopic) {
            currenttopic = $(this).attr("topic");
            if (i>0 && currenttopic != ""&& currenttopic != ""&& contentpage == 1 && $(this).find(".contentcategory").length == 0) {
                $("#allcontent .contentcategory").append('<p class="category Section'+i+'" n1target='+i+' onclick="jumptoarticle('+i+',0)">'+currenttopic+'</p>');
				if (currenttopic != "") {
					$("#allcontent ul.navigation").append('<li class="notouchall notouch section_'+i+'" onclick="scrollToSection('+i+')">'+currenttopic+'</li>');
				}
            }
            n = n+1;
        }
		
        var headshotImg=""
		//
		var borderColor="";
		if (currenttopic=="" || currenttopic=="") {
			borderColor=" purple";
		} else if (currenttopic=="") {
			borderColor=" red";
		} else if (currenttopic=="" || currenttopic=="") {
			borderColor=" green";
		} else if (currenttopic=="" || currenttopic=="") {
			borderColor=" blue";
		}
		if ($(this).find("img.headshot").length>0) {
			$("#imageRailInner").append('<div class="rail'+borderColor+'" n1target = '+i+' onclick="jumptoarticle('+i+',0)"><div class="railImage"><div class=railImageTable><div class=railImageCell><img src="'+$(this).find("img.headshot").attr("src")+'"></div></div></div><div class="railText">'+$(this).find(".headline").eq(0).html()+'</div></div>');
            headshotImg='<img src="'+$(this).find("img.headshot").attr("src")+'" class=rightimage>';
		} else if ($(this).find("video.headshot").length>0 && $(this).find("video.headshot").attr("poster")) {
            $("#imageRailInner").append('<div class="rail'+borderColor+'" n1target = '+i+' onclick="jumptoarticle('+i+',0)"><div class="railImage"><div class=railImageTable><div class=railImageCell><img src="'+$(this).find("video.headshot").attr("poster")+'"></div></div></div><div class="railText">'+$(this).find(".headline").eq(0).html()+'</div></div>');
            headshotImg='<img src="'+$(this).find("video.headshot").attr("poster")+'" class=rightimage>';
        } else if ($(this).find(".secStart").length>0) {
                $("#imageRailInner").append('<div class="rail'+borderColor+'" n1target = '+i+' onclick="jumptoarticle('+i+',0)"><div class="railImage"><div class=railImageTable><div class=railImageCell style="font-size:25px;background:#333;color:white;font-weight:bold;">'+$(this).find(".secStart").eq(0).html()+'</div></div></div><div class="railText">'+$(this).find(".secStart").eq(0).html()+'</div></div>');
                //headshotImg='<img src="'+$(this).find("video.headshot").attr("poster")+'" class=rightimage>';
        }
        
        

        var lead = "";
        if ($(this).find(".excerpt .lead,.article .lead,.page .lead").length>0) {lead = "<div class = contentlead>"+$(this).find(".excerpt .lead,.article .lead,.page .lead").eq(0).html()+"</div>";}
        if ($(this).find(".excerpt .headline,.article .headline,.page .headline").length>0 && i>0 && currenttopic != "" && currenttopic != "" && currenttopic != "" && contentpage == 1 && $(this).find(".contentcategory").length==0) {
            $("#allcontent .contentcategory").append('<div class=contentheadline n1target = '+i+' onclick="jumptoarticle('+i+',0)">'+headshotImg+'<b>'+$(this).find('.headline').html()+'</b>'+lead+'<div class=clearfloat></div></div>');
        }
        

    });
    
    //Margin
    $("#imageRailInner .rail:last").css({"margin-right":"20px"});


    //
    $("#allcontent .flowedContent").each(function(){
        $(this).find("p").eq(0).css("text-indent",0);
    })


    //    
    $("#allcontent .flowedContent p strong,#allcontent .flowedContent p b,#allcontent .flowedContent b p").each(function(){
        var _this = $(this);
        var _paren = _this.parent();
        var w1 = _this.html();
        w1 = w1.replace(/[\r\n\s\<\>]/g,"");
        var w2 = _this.html();
        w2 = w2.replace(/[\r\n\s\<\>]/g,"");
        if (w1.length>0 && w2.length-w1.length<4) {
            _this.css("text-indent",0);
            _paren.css({"text-indent":0});
            if (!_paren.hasClass("contentheadline")) {$("<p class=placeholder><br></p>").insertBefore(_paren);}
            _paren.next().css("text-indent",0);
            _paren.addClass("keepwithnext").addClass("subTitle");
        }
    });
    //
    $(".food .placeholder").remove();
   
    calculateWH();
    closeFullScreen();
    
    if (k != null && k != "" && k >= 0 && k<allpages && allpages>=30) {
        startFromArticle(k,currentPage,currentPageCount);
    } else {
        startFromArticle(0,0,0)
    }
    
    //
    $("#setting").unbind().bind("click",function(e){
       	if (/\b(cell)\b/.test(e.target.className)) {
            closeSetting();
        }
    });
    
    
    $("#fontsetting").unbind().bind("click",function(e){
       	if (/\b(cell)\b/.test(e.target.className)) {
            closeFontSize();
        }
    });

    
    allArticle=$("#allcontent .slide").length;

    //
    if (deviceType === 'other') {
        window.onkeydown = function(e){
            if (e.keyCode === 39 || e.keyCode === 40 || ((e.keyCode === 32 || e.keyCode === 13) && $('form, input, textarea').length === 0)) {
                slider.gonext();
            } else if (e.keyCode === 37 || e.keyCode === 38) {
                slider.goprev();
            }
        };

        $("#swipe").css("position","relative").append('<a class="arrow-prev" href="#"><div></div></a><a class="arrow-next" href="#"><div></div></a>');
        $(".arrow-prev,.arrow-next").bind("click",function(){
            var arrowId=$(this).attr("class");
            if (arrowId === "arrow-prev") {
                slider.goprev();
            } else {
                slider.gonext();
            }
        });
    }
}


function is_touch_device() {
  return !!('ontouchstart' in window) // works on most browsers 
      || !!('onmsgesturechange' in window); // works on ie10
};

function calculateWH() {
    checkScreenType();
    var w=$(window).width();
    var h=$(window).height();
	var headerHeight=$("#allcontent .contentpage .header").eq(0).height();
	headerHeight=parseInt(headerHeight);
	var thecontentHeight=h-headerHeight;
   	$("#allcontent .theContent").css("height",thecontentHeight+"px");
    if (w>1024) {
        $("#allcontent ul.navigation").css("width","1024px");
    } else {
    	$("#allcontent ul.navigation").css("width",w+"px");
    }
    $(".layout-5 .page").css({"width":w+"px","height":h+"px"});
    w=parseInt(w*0.85);
    $("body,#coverintro").css("height",h+"px");
    $("#gamecontent,#swipe").css("height",h+"px");
    h=h-20;
    if (screenType!="small") {h=h-30;}
    $(".articleviewport").css("height",h+"px");
    coverheight=h;
    if (h>120) h=parseInt((h-120)*0.9);
    $(".layout-5 img.coverImage").css({"max-width":w+"px","max-height":h+"px"});
}

function startFromArticle(articlenumber, pageNumber, pageCount) {
    articlenumber=parseInt(articlenumber);
    currentArticle=articlenumber;
    savevalue(ce+"_article",articlenumber);
    cloneArticles(articlenumber);
    
    $("#loadstatus").html("");
    calculateWH();
    $("#startbar").animate({width:"15%"},300,function(){
        $("#game").addClass("on");
        //reSizerotate        
        $("#loadstatus").html("...");
        $("#startbar").animate({width:"50%"},300,function(){
            paginate($("#gamecontent .slide .article"));
            $("#startbar").animate({width:"90%"},300,function(){
                $("#loadstatus").html("...");
                var k;
				var p=0;
                if (articlenumber>0) {
                    var listItem = $("#gamecontent .slide[articlenumber='"+ articlenumber +"']").eq(0);
                    listItem.show();
                    k=$("#gamecontent .slide").index(listItem);
                    k=parseInt(k);
                    if (k<0) {
                        k=0;
                    }
                } else {
                    k=0;
                }
				if (pageNumber && pageCount && pageNumber!=null && pageCount!=null) {
					pageNumber=parseInt(pageNumber);
					pageCount=parseInt(pageCount);
					if (pageCount>1 && pageNumber>0 && pageNumber<pageCount) {
						var $currentArticle=$("#gamecontent .slide[articlenumber='"+ articlenumber +"']");
						var newpage=parseInt(parseInt($currentArticle.eq(0).attr("allpages"))*(pageNumber)/pageCount);
						if ($currentArticle.length>=newpage+1) {
							p=newpage;
						}
					}
				} 
                startSlide=k+p;
                bookeffect();
                $("#startbar").animate({width:"100%"},300,function(){
                    $("#screenstart").hide().addClass("success");
                    $("#screenstart .backuplinks,#screenstart .backuplinks").remove();

                    //#screenstart
                    if (document.getElementById('imageRail')) {
                    scroller = new FTScroller(document.getElementById('imageRail'), {
                        scrollingY: false,
                        snapping: false,
                        scrollbars: false,
						updateOnChanges: true,
						updateOnWindowResize: true
                    });
                    }
                    //resize
                    if (window.orientation){
                        $(window).bind('orientationchange', function() {
                            reflowarticle();
                        });
                    } else {
                        $(window).resize(function() {
                            rtime = new Date();
                            if (timeout === false) {
                                timeout = true;
                                setTimeout(resizeend, delta);
                            }
                        });
                    }
                });
            });
        });
    });
}




function jumptoarticle(articlenumber,startPage) {
    articlenumber=parseInt(articlenumber);
    closeRail();
    $("#bookname,#startstatus").empty();
    $("#screenstart .instartscreen").removeClass("instartscreen");
    $("#loadstatus").empty();
    var $currentarticle=$("#allcontent .slide").eq(articlenumber);
    if ($currentarticle.find("img.headshot,img.coverImage").length>0) {
        $currentarticle.find("img.headshot,img.coverImage").eq(0).clone().appendTo("#bookname");
        var imageMaxHeight=parseInt((coverheight - 60)*0.9);
        var imageMaxWidth=parseInt($(window).width()*0.85);
        $("#bookname img").css({"max-height":imageMaxHeight+"px","max-width":imageMaxWidth+"px"});
    }
    if ($currentarticle.find(".headline").length>0) {
        $("#startstatus").append($currentarticle.find(".headline").eq(0).html());
    } else if ($currentarticle.attr("topic")!=""){
        $("#startstatus").append($currentarticle.attr("topic"));
    }
    $("#startbar").animate({width:"5%"},100,function(){
        $("#screenstart").show();
        cloneArticles(articlenumber);
        $("#startbar").animate({width:"33%"},100,function(){
            paginate($("#gamecontent .slide .article"));
            $("#startbar").animate({width:"66%"},1000,function(){
                slider.length=$("#gamecontent .slide").length;
				slider.width=$(window).width();//necessary for web app. Without it, on IOS 6 iPad, when you launch from landscape and rotate to portrait, slider.width won't change, resulting large gaps between pages. 
                var listItem = $("#gamecontent .slide[articlenumber='"+articlenumber+"']").eq(0);
				var p=0;
				var k=$("#gamecontent .slide").index(listItem);
				if (currentPage!=null && currentPageCount!=null && typeof(startPage)=="undefined") {
					currentPage=parseInt(currentPage);
					currentPageCount=parseInt(currentPageCount);
					if (currentPageCount>1 && currentPage>0 && currentPage<currentPageCount) {
						var $currentArticle=$("#gamecontent .slide[articlenumber='"+ articlenumber +"']");
						var newpage=parseInt(parseInt(listItem.attr("allpages"))*(currentPage)/currentPageCount);
						if ($("#gamecontent .slide[articlenumber='"+articlenumber+"']").length>=newpage+1) {
							p=newpage;
						}
					}
				}
                slider.slide(k+p);
                $("#startbar").animate({width:"100%"},500,function(){
                    currentArticle=articlenumber;
                    savevalue(ce+"_article",currentArticle);
                    $("#screenstart").hide();
                });
            });
        });
    });

}


function scrollToSection(articlenumber) {
	var sectionOffsetTop=$("#gamecontent .contentcategory .Section"+articlenumber).offset().top;
	var headerHeight=$("#allcontent .contentpage .header").eq(0).height();
	var sectionScrollTop=contentScroller.scrollTop + sectionOffsetTop - headerHeight;
	contentScroller.scrollTo(0, sectionScrollTop, 300);
}

function cloneArticles(articlenumber) {
    $("#gamecontent").empty();
    var allpages = $("#allcontent .slide").length;
    if (articlenumber>0) {
        var $prevSlide=$("#allcontent .slide").eq(articlenumber-1);
        $prevSlide.clone().appendTo($("#gamecontent"));
    }
    var $currentSlide=$("#allcontent .slide").eq(articlenumber);
    $currentSlide.clone().appendTo($("#gamecontent"));
    if (articlenumber<allpages-1) {
        var $nextSlide=$("#allcontent .slide").eq(articlenumber+1);
        $nextSlide.clone().appendTo($("#gamecontent"));
    }
}

//FTColumnFlowSlidemin-height
function paginate($theObject) {

    //First, Paginate article pages using FTColumn Flow
    var articleNumber = $theObject.length;
    var windowWidth = $(window).width();
    var windowHeight = coverheight;
    var pagePadding = windowWidth * 60 / 1024;
    $theObject.each(function (slidenumber) {
        var $currentSlide = $(this).parent();
        slidenumber=$currentSlide.attr("articlenumber");
        slidenumber=parseInt(slidenumber);
        $currentSlide.show();
        var $articleviewport = $currentSlide.find(".articleviewport").eq(0);
        var $articletarget = $currentSlide.find(".articletarget").eq(0);
        var $flowedContent = $currentSlide.find(".flowedContent").eq(0);
        var $fixedContent = $currentSlide.find(".fixedContent").eq(0);
        $articleviewport.attr("id","articleviewport"+slidenumber);
        $articletarget.attr("id","articletarget"+slidenumber);
        $flowedContent.attr("id","flowedContent"+slidenumber);
        $fixedContent.attr("id","fixedContent"+slidenumber);

        if ($currentSlide.find(".article").length>0 && $articleviewport.length>0 && $articletarget.length>0) {
            var headline = $currentSlide.find(".headline").html();
            var leadinfo=$currentSlide.find(".lead").html();
            var headcut=$currentSlide.find("img.headshot").attr("src");
            var datestamp=$currentSlide.find(".datestamp").eq(0).html();
            if (datestamp!=null && datestamp!="") {
                datestamp='<p class=datestamp>'+datestamp+'</p>';
            } else {
                datestamp='';
            }
            var imageMaxHeight=parseInt(coverheight - 25 * 1.8);
            var fixedContent = "";
            var large="";
            var figCaption="";
            if ($currentSlide.find("img.headshot.large").length>0){
                large=" class=large";
                figCaption='<figcaption><span class="icon zoombg"></span></figcaption>'
            }
            var mpuPage=" attach-page-3";
            //fiexedContent  var mpuAmount=0;var currentMPU=0;
            if ($currentSlide.find(".articleinfo").length>0) {
                if (screenType=="small") {
                    var headlinePage="";
                    if (headcut!=null && headcut !="") {
                        fixedContent = '<div class="anchor-top-col-1 headcut" style="display:table;height:' + coverheight + 'px;"><div style="display:table-cell;vertical-align:middle;text-align:center;"><img src="' + headcut + '" style="max-width:100%;max-height:' + imageMaxHeight + 'px" /><div style="text-align:center;font-weight:bold;">' + headline + '</div></div></div>'; 
                        headlinePage=" attach-page-2";
                        mpuPage=" attach-page-3";
                    } else {
                        mpuPage=" attach-page-2";
                    }
                    fixedContent += '<div class="anchor-top-col-1' + headlinePage + '"><div class=headline style="text-align:center;font-size:25px;font-weight:bold">' + headline + '</div><div class=lead>' + leadinfo + '</div>'+datestamp+'</div>';
                    $currentSlide.find(".headcut").css({"height":coverheight+"px"});	
                } else {
                    fixedContent = '<div class="col-span-2"><div class=headline style="text-align:center;">' + headline + '</div><div class=lead>' + leadinfo + '</div>'+datestamp+'</div>';
                    if (headcut!=null && headcut !="") {
                        imageMaxHeight=parseInt(coverheight - 200);
                        var imageHeight=431;
                        if ($("#game").hasClass("landscapeImage")==true) {
                            imageHeight=200;
                        }
                        fixedContent += '<div class="anchor-bottom-col-2" style="display:table;"><figure style="display:table-cell;text-align:center;height:'+imageHeight+'px;width:300px;vertical-align:bottom;"><img'+large+' src="' + headcut + '" style="max-width:100%;max-height:'+imageMaxHeight+'px;" />'+figCaption+'</figure></div>';
                        mpuPage=" attach-page-2";
                    } else {
                        mpuPage="";
                    }
                }
                //fixedContentMPU
                if ($currentSlide.find(".myFixedContent").length>0) {
                    fixedContent += $currentSlide.find(".myFixedContent").eq(0).html();
                } else if (mpuAmount>0){
                    var mpuHeight=250;
                   
                    if ($("#mpuads .mpuad").eq(currentMPU).find(".MPU").css("height") && $("#mpuads .mpuad").eq(currentMPU).find(".MPU").css("height")!=null) {
                        mpuHeight=$("#mpuads .mpuad").eq(currentMPU).find(".MPU").css("height");
                        mpuHeight=mpuHeight.replace(/px/g,"");
                        mpuHeight=parseInt(mpuHeight);
                    }
                    fixedContent +='<div class="anchor-bottom-col-10'+mpuPage+'" style="display:table;width:300px;height:'+mpuHeight+'px;"><div style="display:table-cell;text-align:center;height:100%;width:100%;vertical-align:bottom;">' + $("#mpuads .mpuad").eq(currentMPU).html() + '</div></div>';
                    currentMPU = currentMPU +1; 
                    if (currentMPU>=mpuAmount) {currentMPU=0;}
                }
            } else {
                    fixedContent = $currentSlide.find(".fixedContent").html();
            }

            $currentSlide.find(".flowedContent .datestamp,.flowedContent .byline").remove();
            var cf = new FTColumnflow("articletarget"+slidenumber, "articleviewport"+slidenumber, {
                    columnWidth:            300,
                    viewportWidth:          windowWidth,
                    viewportHeight:         coverheight,
                    columnGap:              21,
                    standardiseLineHeight:  true, //useful when you have subTitle or varied fonts
                    pagePadding:            pagePadding,
                    minFixedPadding:        0.5
            });
            cf.flow(document.getElementById("flowedContent"+slidenumber), fixedContent);
            $currentSlide.hide();
            $currentSlide.find(".cf-preload,.cf-preload-fixed,.fixedContent,.flowedContent").remove();
            $currentSlide.find(".articletarget").css("width","100%");
            $currentSlide.find(".cf-page").css("left",0);
            $currentSlide.find(".cf-page").each(function(cp){
                if (cp>0) {
                    var c = $currentSlide.attr("class");
                    var s = $currentSlide.attr("n1");
                    $currentSlide.clone().attr("allpages",cf.pageCount).attr("thispage",cp).attr("headline",headline).insertAfter($("#gamecontent .slide[n1 = "+s+"]:last"));
                    $("#gamecontent .slide[n1 = "+s+"]:last").find(".cf-render-area").empty().append($(this));
                }
            });
            $currentSlide.find(".cf-page").slice(1,cf.pageCount).remove();
            $currentSlide.attr("allpages",cf.pageCount).attr("thispage",0);
            //var ls = $currentSlide.attr("n1");
            //$("#fullpageads .slide").eq(0).clone().insertAfter($("#gamecontent .slide[n1 = "+ls+"]:last"));
        }
    });
}



//FT
function bookeffect() {
    allslides = $("#gamecontent .slide").length;

    //Bullet Point
    $("#gamecontent .slide .bullet ul li:first-child").each(function(){bullet($(this));});
    $("#gamecontent .slide .bullet li").unbind().bind(tapstart,function(){bullet($(this));});
    $("#gamecontent .slide .bullet ul").each(function(){
        if ($(this).find("li").length >= 7) {$(this).find("li div").css("height","448px");$(this).find("li").css("margin","15px 0 31px 0");} else if ($(this).find("li").length >= 6) {$(this).find("li div").css("height","430px");} else if ($(this).find("li").length >= 5) {$(this).find("li div").css("height","346px");}
    });


    //
    $('#gamecontent .slide .JLController > .JLbutton').each(function(){
        $(this).click(function(){
            var el = $(this).attr('trigger');
            $(this).siblings().css({background: '#777'});
            $(this).css({background: el});
            $('.JLsideA, .JLsideB').find('div').hide();
            $('.JLsideA, .JLsideB').find('.'+ el).toggle();
        });
    });
    $('.JLsideA, .JLsideB').find('div:first').show();
    //$('.JLController').find('.JLbutton:first').css({background: $('.JLController').find('.JLbutton:first').attr('trigger')});


    //Tappable Content
    $("#gamecontent .slide [tap]").bind("click",function(){showtap($(this));});
    $("#gamecontent .slide [tap]").css("-webkit-box-shadow","0 0 10px #666");
    $("#gamecontent .slide [tapfixed]").bind("click",function(){showtapfixed($(this));});

    //
    $("#gamecontent .fullpage .threecolumn").each(function(){
        if ($(this).find(".addhand").eq(0).length>0) {
            addhand($(this),$(this).find(".addhand").eq(0));
            $(this).find(".addhand").bind("click",function(){
                $(this).parent().parent().find(".hand").remove();
            });
        }
    });




    articlepage();
    
}


function openpage(pagenumber) {
    pagenumber = parseInt(pagenumber);
    cs = pagenumber;
    slider.slide(cs);
}


function turnpage(direction) {
    var n = cs+direction;
    if (n >= 0&&n <= allslides-1) {
        slider.slide(n);
    }
}

function changepage(pagenumber) {
    pagenumber = parseInt(pagenumber, 10);
    var p = pagenumber+1;
    $("#game .pagenumber span").eq(0).html(p);
    var p = 705*pagenumber/allslides;
    $("#game .pagenow div").eq(0).animate({left:p+"px"},500);
    savevalue(ce,pagenumber);


    var $ani = $("#gamecontent .slide").eq(pagenumber);

    if ($ani.find(".hidetopicbar").length>0){
        $(".topicbar").removeClass("on");
    } else {
        $(".topicbar").addClass("on");
    }


    var currenttopic = $ani.attr("topic");
    $("#game .channel div").removeClass("on");
    $("#game .channel div").css("background","transparent");
    if (currenttopic != null && currenttopic != "") {
        $("#game .channel div").each(function(){

            if ($(this).html() == currenttopic) {
                $(this).addClass("on");
                var b = $ani.css("background-image");
                if (b == ""||b == null||b == "none"){		
                    b = $ani.css("background-color");
                    $(this).css("background-color",b);
                } else {
                    $(this).css("background-image",b);
                }
            }
        });
    }
    //Viewport
    $("#gamecontent .slide").removeClass("current");
    $ani.addClass("current");
    var addArticle=-1;
    var removeArticle=-1;
    var currentArticleNumber=$ani.attr("articlenumber");
	currentPage=$ani.attr("thispage");
	currentPageCount=$ani.attr("allpages");
    currentArticleNumber=parseInt(currentArticleNumber);
    if (currentArticleNumber==currentArticle-1 || currentArticleNumber==currentArticle+1) {
        if (currentArticleNumber==currentArticle-1) {
            addArticle=currentArticleNumber-1;
            removeArticle=currentArticleNumber+2;
        } else {
            addArticle=currentArticleNumber+1;
            removeArticle=currentArticleNumber-2;
        }
        if (removeArticle>=0 && removeArticle<articleCount) {
            $("#gamecontent .slide[articlenumber='"+removeArticle+"']").remove();
        }

        if (addArticle>=0 && addArticle<articleCount) {//#gamecontent
            var thepos=slider.width;
            thepos=parseInt(thepos);
            if (currentArticleNumber==currentArticle-1) {
                thepos=-thepos;
                thepos=thepos+"px";
                $("#allcontent .slide[articlenumber='"+addArticle+"']").clone().css({'-webkit-transform':'translate3d(' + thepos + ',0,0)','-moz-transform':'translate3d(' + thepos + ',0,0)','-ms-Transform':'translateX(' + thepos + ')','-o-Transform':'translateX(' + thepos + ')'}).show().addClass("new").prependTo($("#gamecontent"));
            } else {
                thepos=thepos+"px";
                $("#allcontent .slide[articlenumber='"+addArticle+"']").clone().css({'-webkit-transform':'translate3d(' + thepos + ',0,0)','-moz-transform':'translate3d(' + thepos + ',0,0)','-ms-Transform':'translateX(' + thepos + ')','-o-Transform':'translateX(' + thepos + ')'}).show().addClass("new").appendTo($("#gamecontent"));
            }
            paginate($("#gamecontent .slide.new .article"));
            $("#gamecontent .slide.new").removeClass("new");
        }
        
        
        //
        slider.length=$("#gamecontent .slide").length;
        var listItem = $("#gamecontent .slide.current").eq(0);
        setTimeout(function(){listItem.show();},1000);//add a delay to make sure the current slide always displays
        slider.index=$("#gamecontent .slide").index(listItem);
        //slider.slide(slider.index);
    }
    $ani.prev().show();
    $ani.next().show();

    /*
    if ($ani.next().find('.video-bg video').length > 0) {
        $ani.next().find('.video-bg video').get(0).play();
    } 
    */

    
    currentArticle=currentArticleNumber;
    savevalue(ce+"_article",currentArticle);
	savevalue(ce+"_thispage",currentPage);
	savevalue(ce+"_allpages",currentPageCount);
    $("#gamecontent .slide").removeClass("current");
}

function switchRail() {
	if ($("#contentRail").hasClass("on")==true && _scrollerOn==0) {
		closeRail();
	} else {
		openRail();
	}
}

function openRail() {
	$("#contentRail").addClass("on");
    //
    $("#imageRailInner .rail").removeClass("current");
    var currentRail=$("#imageRailInner .rail[n1target='"+currentArticle+"']")
    if (currentRail.length>0) {
        currentRail.addClass("current");
        var currentRailLeft= currentRail.offset().left;
        var currentRailWidth=currentRail.outerWidth();
        var startRailLeft=$("#imageRailInner .rail").eq(0).offset().left;
        var currentRailScroll=currentRailLeft-startRailLeft-$(window).width()/2+currentRailWidth/2;
        if (currentRailScroll<0) {
            currentRailScroll=0;
        }
        if (typeof(scroller)!="undefined") {
            scroller.scrollTo(currentRailScroll,0);
        }
    }
}

function closeRail() {
	$("#contentRail").removeClass("on");
}




function articlepage() {

    slider = new Swipe(document.getElementById('swipe'),{
        type: "course",
        startSlide:startSlide
    });

    if (is_touch_device()==false) {//if you are on a none-touch device, add click functions
        $("#swipe").click(function(e){
        if (/\b(notouch|notouchall|notouchmove|notouchstart|notouchend)\b/.test(e.target.className)) {//Navigationobject
            return;
        }
            var touchX = e.pageX/slider.width;
            if (touchX<=0.2) {
                slider.goprev();
            } else if (touchX>=0.8) {
                slider.gonext();
            } else {
				try{
					switchRail();
				}catch(err){
				}
			}
        });
    }

}



function bullet($theobject) {
    $theobject.parent().find("li").removeClass("on");
    $theobject.addClass("on");
}

function showtap($theobject) {
    if ($theobject.find(".tapcontent").length>0){return;}
    $("#gamecontent .slide").find(".tapcontent,.taparrow").remove();
    var k = $theobject.attr("tap");
    var w = $theobject.css("width");w = w.replace("px","");w = parseInt(w/2);w = w-10;
    var h = $theobject.css("height");h = h.replace("px","");h = parseInt(h);
    var l = $theobject.css("left");l = l.replace("px","");l = parseInt(l);
    var t = $theobject.css("top");t = t.replace("px","");t = parseInt(t);
    w = w+l;h = h+t;
    var w1 = w;w1 = w1-150+10;
    var h1 = h+30;

    //Bubble

    if (h<350){
        if (w1<0) {w1 = 0}  else if (w1>642){w1 = 642}
        $theobject.parent().append("<div class = 'taparrow movein' style = 'left:"+w+"px;top:"+h+"px;'></div><div class = 'tapcontent movein' style = 'left:"+w1+"px;top:"+h1+"px;'><div class = close><div class = closeinner></div></div><div class = 'explaincontent'>"+k+"</div></div>");
        var rh = $theobject.parent().find('.explaincontent').eq(0).outerHeight();
        $theobject.parent().find('.tapcontent').eq(0).css({"height":rh+"px"});
    } else {
        w1 = w1-50;
        if (w1<0) {w1 = 0} else if (w1>542){w1 = 542}
        h = t-20;
        h1 = h-20;
        $theobject.parent().append("<div class = 'taparrow inverse movein' style = 'left:"+w+"px;top:"+h+"px;'></div><div class = 'tapcontent movein' style = 'width:400px;height:100px;background:#E3D3BC;-webkit-border-radius:5px;-moz-border-radius:5px;left:"+w1+"px;top:"+h1+"px;'><div class = close><div class = closeinner></div></div><div class = 'explaincontent'>"+k+"</div></div>");
        var rh = $theobject.parent().find('.explaincontent').eq(0).outerHeight();
        h1 = h-rh;
        $theobject.parent().find('.tapcontent').eq(0).css({"top":h1+"px","height":rh+"px"});
    }

    //
    $theobject.parent().find(".tapreminder").remove();

    $theobject.parent().find(".close").bind("click",function(){$(this).parent().parent().parent().find(".taparrow,.tapcontent").animate({opacity:0}, 2000,function(){$(this).remove()});});
}

function showtapfixed($theobject) {
    $("#gamecontent .slide").find(".tapcontent2").animate({opacity:0}, 2000,function(){$(this).remove()});
    var k = $theobject.attr("tapfixed");
    var w = $theobject.css("width");w = w.replace("px","");w = parseInt(w);
    var h = $theobject.css("height");h = h.replace("px","");h = parseInt(h/2);
    var l = $theobject.css("left");l = l.replace("px","");l = parseInt(l);l = l+w;
    var t = $theobject.css("top");t = t.replace("px","");t = parseInt(t);t = t+h;
    w = 590-l;
    $theobject.parent().append("<div class = 'tapcontent2 movein on tap'>"+k+"</div>");

    //Classrectpic
    if ($theobject.hasClass("circle") == true) {
        $theobject.parent().find(".circle").removeClass("orange");
        $theobject.addClass("orange");
    } else if ($theobject.hasClass("rect") == true) {
        $theobject.parent().find(".rect").css("opacity",0.5);
        $theobject.css("opacity",1);
    } else {
        //$theobject.parent().append("<div class = 'arrow on tap orange' style = 'width:"+w+"px;left:"+l+"px;top:"+t+"px'></div>");
    }
}

function chainreaction($theobject) {
    if ($theobject.hasClass("done")!=true) {
        //circle
        $theobject.find(".circle span").each(function(){
            if ($(this).parent().hasClass("start") == true) {$(this).parent().addClass("four");} else if ($(this).html().length>12) {$(this).parent().addClass("three");} else if ($(this).html().length>6) {$(this).parent().addClass("two");} else if ($(this).html().length == 4) {var k = $(this).html().replace(/^(..)/g,"$1<br>");$(this).html(k);}
        }
        );

        //
        addhand($theobject,$theobject.find(".tappable.on").eq(0));

        //
        $theobject.find("[name]").each(function(){
            //alert($(this).attr("name"));
            $(this).bind("click",function(){
                var thename = $(this).attr("name");
                showChain($theobject,thename);
                if ($(this).attr("hide")) {$(this).parent().find("."+$(this).attr("hide")).remove();}
            });
        }
        );
        $theobject.addClass("done")
    }
}




function showChain($theobject,thename) {
    var $theobject;
    var thename;
    $theobject.find(".hand").remove();
    if($theobject.find("[name = "+thename+"]:not(.on)").length) {
        $theobject.find("[name = "+thename+"]:not(.on)").eq(0).addClass("on");
        setTimeout(function(){showChain($theobject,thename)},400);
    } else {
        var nextname = $theobject.find(".tappable[name = "+thename+"][next]").attr("next");
        if ($theobject.find(".tappable[name = "+nextname+"]").length>0) {
            var $tap = $theobject.find(".tappable[name = "+nextname+"]");			
            addhand($theobject,$tap);
        }
    }
}



function addhand($theobject,$tap) {
    if ($tap.hasClass("done") == false){
        $tap.addClass("on").addClass("done");
        var l = $tap.css("left");l = l.replace("px");l = parseInt(l);
        var t = $tap.css("top");t = t.replace("px");t = parseInt(t);
        var w = $tap.css("width");w = w.replace("px");w = parseInt(w);
        var h = $tap.css("height");h = h.replace("px");h = parseInt(h);
        l = l+w*0.8;t = t+h*0.8;
        l = parseInt(l);t = parseInt(t);
        $theobject.append("<div class = 'hand on'></div>");
        $theobject.find(".hand").css("left",l+"px").css("top",t+"px");
    }
}

function onechoiceClick($theobject) {
    if ($theobject.parent().hasClass("done") == false ) {
        if (fingermoving == 1) {return;}
        onechoiceSelect($theobject);
        if ($theobject.attr("type") == "r"){
            $("#allcontent .slide").eq(currentArticle).find(".option").attr("score",$theobject.attr("value"));
        }
        setTimeout(function(){
            $theobject.parent().addClass("done");
            var k=$theobject.parent().find("p").index($theobject);
            $("#allcontent .slide").eq(currentArticle).find(".option").addClass("done").attr("done",k);
            $(".optionalert").remove();
            $theobject.parent().parent().parent().find(".notouchall").removeClass("notouchall");
        },10);
    }
}

function onechoiceSelect($theobject) {
    $theobject.addClass("selected");
    var rightorwrong = "";
    $theobject.find(".optionButton").remove();
    if ($theobject.attr("type") == "r"){
        $theobject.css("background","transparent");
        $theobject.append("<div class = ro></div>");
        rightorwrong = "";
    } else if ($theobject.attr("type") == "w") {
        $theobject.css("background","transparent");
        $theobject.append("<div class = wo></div>");
        $theobject.parent().find('p[type = "r"]').addClass("correctAnswer");
        rightorwrong = "";
    } else {
        $theobject.css({"background-image":"url(img/point.png)"});
    }
    var thisexplain = rightorwrong;
    if ($theobject.attr("explain")) {thisexplain = "<p style = 'font-weight:bold;'>"+thisexplain+$theobject.attr("explain")+"</p>";}
    var jumpid = "";
    if ($theobject.parent().attr("jumpid")&&$theobject.parent().attr("jumpid") != "") {
        jumpid = $theobject.parent().attr("jumpid");
        var hl = $("#gamecontent .slide[storyid = "+jumpid+"] .headline").eq(0).html();
        if (hl == null){hl = ""}
        if (hl != ""){hl = ""+hl;}
        jumpid = "<br><br><b><a onclick = 'jumptostory(\""+jumpid+"\")'>"+hl+"</a></b>";
    }

    if (jumpid != ""||($theobject.attr("explain")&&$theobject.attr("explain") != "")||($theobject.parent().attr("explain")&&$theobject.parent().attr("explain") != "")) {
        $theobject.parent().parent().parent().append("<div class = 'explain movein'><div class='explaincontentContainer'><div class = explaincontent><div class='nutmeg-content -bg-checkered notouchall'><div class='nutmeg-content_left'></div><div class='nutmeg-content_right'><button onclick='hideExplain($(this))' class='notouch'></button></div></div><div class=explaincontentInner>"+thisexplain+$theobject.parent().attr("explain")+jumpid+"</div></div></div></div>");
        $theobject.parent().parent().parent().parent().find(".quiztip").remove();
    }
}

function hideExplain($theobject) {
    $theobject.parent().parent().parent().parent().parent().hide();
    $theobject.parent().parent().parent().parent().parent().after('<div class="showexplain"><div class="notouchall" onclick="showExplain($(this))"></div></div>');
}

function showExplain($theobject) {
    $theobject.parent().parent().find(".explain").show();
    $theobject.parent().remove();
}
//slide
function playslide(slidenumber) {
    cs = slidenumber;
    cs = parseInt(cs);
    var gameContent = $("#gamecontent");
    var fixedBG = '';
    var $currentSlide = $("#gamecontent .slide").eq(slidenumber);
    var currentArticleNumber=$currentSlide.attr("articlenumber");
    var videoInSlide;
    currentArticleNumber=parseInt(currentArticleNumber);
    n1Number=$currentSlide.attr("n1");
    n1Number=parseInt(n1Number);
    $("#gamecontent .slide").removeClass("is-current");
    $currentSlide.addClass("is-current");
    
    //
    if ($currentSlide.find(".option p").length>0) {
        if ($currentSlide.find(".option").eq(0).hasClass("done")==false) {
            //$currentSlide.find(".option p").append('<div class = "clickarea tap notouchall"></div>');
            $currentSlide.find(".option p").unbind().bind("click",function(){onechoiceClick($(this));});
        } else if ($currentSlide.find(".option p.selected").length<=0) {
            var k=$currentSlide.find(".option").attr("done");
            k=parseInt(k);
            if (k<0) {k=0;}
            onechoiceSelect($currentSlide.find(".option p").eq(k));
        }
    }


    

    //
    $("#gamecontent .slide video").each(function(){
	   try {
        this.pause();
        } catch(ignore){

        }
    });
    
    if ($currentSlide.hasClass("ask-for-review") && "reviewPanel" in window) reviewPanel();

    
    //IOS 6Bug0
    //$("#gamecontent .slide video.on").removeClass("on").css({"width":0,"height":0});

    videoInSlide = $currentSlide.find('.video-bg video');
    if (videoInSlide.length > 0) {
        videoInSlide.get(0).play();
        //alert ($currentSlide.find('.video-bg video').length);
    } else if (1<0 && $currentSlide.find("video").length > 0) {
        var w = $(window).width();
        var h = $(window).height();
        if (w>h) {
            w = parseInt(w*0.6);
        } else {
            w = parseInt(w*0.9)
        }        
        h = w*9/16;
        h = Math.round(h);
        $currentSlide.find(".videocontainer").css({"width":w+"px","height":h+"px"});        
        $currentSlide.find("video").css({"width":0,"height":0}).addClass("on").animate({"width":w+"px","height":h+"px"},500,"easeInOutCubic");
    }
    


    //slide
    var animation = $currentSlide.find(".animation").length;
    if (animation>0) {
        playanimation();
    }

    //gamecontent
    fixedBG = $currentSlide.attr('data-fixed-bg-0') || '';
    if (fixedBG !== '') {
        gameContent.css('background-image', 'url(' + fixedBG + ')');
    } else {
        gameContent.css({'background-image':'none','background-color':'#333'});
    }
    

    //
    if ($currentSlide.find(".chainreaction").length>0){
        chainreaction($currentSlide.find(".chainreaction").eq(0));
    }

    //Rail
    if (animation>0 || $currentSlide.find("video").length > 0) {
        _clicktoTurnPage = "off";
        $('html').addClass('has-animation');
    } else {
        _clicktoTurnPage = "on";
        $('html').removeClass('has-animation');
    }


    //
    if ($currentSlide.find(".myscore").length>0) {showscore();}

    //
    var $pagedots = $("#game .pagedots").eq(0);

    if ($currentSlide.attr("allpages") && $currentSlide.attr("allpages")>0 && screenType!="small") {
        $pagedots.empty().show();
        var i = 0;
        for (i = 0;i<$currentSlide.attr("allpages");i++) {
            $pagedots.append("<span>&nbsp;&nbsp;</span>");		
        }

        $pagedots.find("span").eq($currentSlide.attr("thispage")).addClass("grey");
    } else {
        $pagedots.empty().hide();
    }
	
	//
	var $pagetitle = $("#game .pagetitle").eq(0);
	if ($currentSlide.attr("allpages") && $currentSlide.attr("allpages")>0 && $currentSlide.find(".headline").length==0 && $currentSlide.find(".headcut").length==0 && $currentSlide.attr("headline")) {
        $pagetitle.empty().show();
        $pagetitle.html(document.title + "" + $currentSlide.attr("headline"));
    } else {
        $pagetitle.empty().hide();
    }
	
	//
	try{closeRail();}catch(err){}
    
    //scroller
    if ($currentSlide.hasClass("contentpage")==true && $currentSlide.find("#contentScroller"+currentArticleNumber).length==0) {
        $currentSlide.find(".scrollPage").attr("id","contentScroller"+currentArticleNumber);
        contentScroller = new FTScroller(document.getElementById('contentScroller'+currentArticleNumber), {
            scrollingX: false,
            snapping: false,
            scrollbars: true,
			updateOnChanges: true,
			updateOnWindowResize: true
        });
        contentScroller.addEventListener("scrollend", function(){
           contentScrollTop=contentScroller.scrollTop;
           //_scrolling=0;
		   $("#gamecontent .contentcategory .category").each(function(){
				if ($(this).html()!="") {
					var headerHeight=$("#allcontent .contentpage .header").eq(0).height();
					var theScrollHeight=$(this).offset().top-headerHeight;
					if (theScrollHeight>=0 && theScrollHeight<=$("#gamecontent .theContent").height()) {
						var sectionNumber=$(this).attr("n1target");
						$("#gamecontent ul.navigation li").removeClass("on");
						$("#gamecontent ul.navigation li.section_"+sectionNumber).addClass("on");
                        scrollToMiddle($("#gamecontent ul.navigation li.section_"+sectionNumber));
						return false;
					}
					if (theScrollHeight>=$("#gamecontent .theContent").height()) {
						var sectionNumber=$(this).attr("n1target");
						$("#gamecontent ul.navigation li").removeClass("on");
						$("#gamecontent ul.navigation li.section_"+sectionNumber).prev().addClass("on");
                        scrollToMiddle($("#gamecontent ul.navigation li.section_"+sectionNumber).prev());
						return false;
					}
				}
		   });
		});
        /*
        contentScroller.addEventListener("scrollstart", function(){
            _scrolling=1;
        });
        */
        contentScroller.scrollTo(0,contentScrollTop);
		
        $currentSlide.find(".navigationScroller").attr("id","sectionScroller"+currentArticleNumber);
        sectionScroller = new FTScroller(document.getElementById('sectionScroller'+currentArticleNumber), {
            scrollingY: false,
            snapping: false,
            scrollbars: false,
			updateOnChanges: true,
			updateOnWindowResize: true
        });
		if (sectionScroller.scrollWidth<=$(window).width() && sectionScroller.scrollWidth<=1024) {//scrollerNavigation1024
            var liNumber=$("#gamecontent ul.navigation li").length;
            var newPadding=10;
            var liWidth=0;
            $("#gamecontent ul.navigation li").each(function(){
                liWidth+=$(this).outerWidth();
            });
            if (liNumber>0 && liWidth<sectionScroller.scrollWidth) {
                newPadding=10+parseInt((sectionScroller.scrollWidth-liWidth)/(2*liNumber))
            }
            $("#gamecontent ul.navigation li").css("padding","0 "+newPadding+"px");
        } else {
			$("#gamecontent ul.navigation li").css("padding","0 10px");
			checkSectionScroller();
			sectionScroller.addEventListener("scrollend", function(){
				checkSectionScroller();
			});
		}
    }
	


    
    //
    var scrollFood=0;
    if ($currentSlide.find(".food.nowrap").length>0 || $currentSlide.find(".longPicture").length>0) {
        var currentFood=$currentSlide.find(".food.nowrap, .longPicture").eq(0);
        var foodMaxHeight=coverheight-50;
        if ($currentSlide.find(".longPicture").length>0) {foodMaxHeight=$(window).height();}
        if (foodMaxHeight>0 && currentFood.outerHeight()>foodMaxHeight) {
            scrollFood=1;
            currentFood.css({"height":foodMaxHeight+"px","overflow":"hidden"});
            currentFood.attr("id","foodScroller"+currentArticleNumber);
            foodScroller = new FTScroller(document.getElementById("foodScroller"+currentArticleNumber), {
                scrollingX: false,
                snapping: false,
                scrollbars: true
            });
        }
    }
    
    if ($currentSlide.hasClass("contentpage")==true || scrollFood==1) {
        _scrollerOn=1;
    } else {
        _scrollerOn=0;
    }
    
    //
    if ($currentSlide.find(".cf-fixed figure img.large").length>0) {
        $currentSlide.find("img.large").eq(0).attr("id","largePic"+currentArticleNumber);
        enableFullScreen($currentSlide.find("img.large").eq(0));
        $currentSlide.find("figcaption").addClass("fadeInOut");
    }

    
    //PVcookieUU
    //gaTrack('UA-1608715-1', 'm.ftchinese.com', '/mbagym/book/'+ce+'/'+cs, 'MBA GYM: '+ce);
    if (typeof(currentPageCount)=="undefined") {currentPageCount=0;}
    if (typeof(currentPage)=="undefined") {currentPage=0;}
    //console.log(currentPageCount);
    TrackTraffic(currentArticle+"/"+currentPageCount+"/"+currentPage);
    //console.log (n1Number + 'allArticle: ' + allArticle);
    if (n1Number === allArticle - 1) {
        $('html').addClass('article-last');
    } else {
        $('html').removeClass('article-last');
    }
    $("body").attr("class","article-" + n1Number);
}

function checkSectionScroller(){
	//alert (sectionScroller.scrollLeft + ":" + sectionScroller.scrollWidth);
	if (sectionScroller.scrollLeft>0) {
		$("#gamecontent .navleftcontainer").show();
	} else {
		$("#gamecontent .navleftcontainer").hide();			
	}
	if (sectionScroller.scrollLeft+$(window).width()<sectionScroller.scrollWidth) {
		$("#gamecontent .navrightcontainer").show();
	} else {
		$("#gamecontent .navrightcontainer").hide();			
	}
}

function enableFullScreen(largePic) {
    largePic.removeClass("large");
    largePic.addClass("notouch");
    var picID=largePic.attr("id");
    largePic.unbind().bind("click",function(evt) {
        evt.stopPropagation();
        showFullScreen(picID);
    });
    if (is_touch_device()==true) {
        document.getElementById(picID).addEventListener('gestureend', function(event) {
            event.stopPropagation();
            event.preventDefault();
            if (event.scale > 1.25) {
                showFullScreen(picID);
            }
        });
    }
}

function showFullScreen(picID) {
    $("#largepic").addClass("on");
    $("#largepic .cell").empty();
    $("#"+picID).clone().appendTo($("#largepic .cell"));
}

function closeFullScreen() {
    if (is_touch_device() === true) {
        document.getElementById("largepic").addEventListener('gestureend', function(event) {
            event.preventDefault();
            if (event.scale < 0.7) {
                $("#largepic").removeClass("on");
                closeRail();
            }
        });
    }
    $("#largepic .cherry_button").unbind().bind("click",function(){
        $("#largepic").removeClass("on");
        closeRail();
    });
}

function scrollToMiddle($theObject) {
    var currentSectionLeft=$theObject.offset().left;
    var currentSectionScroll=parseInt(currentSectionLeft+sectionScroller.scrollLeft-$(window).width()/2+$theObject.outerWidth()/2);
    if (currentSectionScroll<0) {
        currentSectionScroll=0;
    }
    sectionScroller.scrollTo(currentSectionScroll,0,300);
}

function setting() {
	$("#setting").addClass("on");
}

function closeSetting() {
	$("#setting").removeClass("on");
}

function setFontSize() {
	$("#fontsetting").addClass("on");
	$(".fontpreferences div").removeClass("-selected");
	$(".fontpreferences ."+fontPreference).addClass("-selected");
}

function closeFontSize() {
	$("#fontsetting").removeClass("on");
	if (fontPreference!=$("#gamecontent").attr("class")) {
		$("#gamecontent").attr("class",fontPreference);
		savevalue("fontPreference",fontPreference);
		reflowarticle();
	}
}

function switchNightReading() {
    if ($("body").hasClass("night")) {
        $("body").attr("class","pink");
        bgMode="pink";
        $("#"+bgMode).addClass("-selected");
        savevalue("bgMode","pink");
    } else {
        $("body").attr("class","night");
        $(".bgpreferences div").removeClass("-selected");
        savevalue("bgMode","night");
    }
}

function showscore() {
    var csscore = 0;
    var fullscore = 0;
    var scorerate = "";
    $("#allcontent [score]").each(function(){
        if ($(this).attr("score")) {var i = $(this).attr("score");i = parseInt(i);csscore = csscore+i;}
    });
    $('#allcontent .option p[type = "r"]').each(function(){
        var i = $(this).attr("value");i = parseInt(i);fullscore = fullscore+i;
    });
    fullscore = fullscore+$(".yesorno p").length;
    $("#gamecontent .myscore").html(csscore);
    $("#gamecontent .fullscore").html(fullscore);
    if (fullscore>0){scorerate = 100*csscore/fullscore;scorerate = parseInt(scorerate);}else{scorerate = 0;}
    $("#gamecontent .scorerate").html(scorerate+"");

    //
    var openquiz = $("#allcontent .option:not(.done)").length;


    //

    k="";
    if (currentArticle == allArticle-1){k = "<a onclick = 'jumptostory(\"contentpage\")' class = 'greybutton notouchall'></a>"}
    k = "<br><br>"+k;
    if ($("#allcontent .option.done").length == 0) {
        scorecomment = "<br><br><a onclick = 'jumptoquiz()' class = 'greybutton notouchall'></a>"
        $(".scorerate").css("color","#666");
    } else if (openquiz>0) {
        scorecomment = "<br><br><a onclick = 'jumptoquiz()' class = 'greybutton notouchall'></a>"
        $(".scorerate").css("color","#666");
    } else if (scorerate >= 90) {
        scorecomment = ""+k;
        $(".scorerate").css("color","#9E2F50");
    } else if (scorerate >= 60) {
        scorecomment = ""+k;
        $(".scorerate").css("color","#308F6A");
    } else {
        scorecomment = ""+k;
        $(".scorerate").css("color","#666");
    }


$("#gamecontent .scorecomment").html(scorecomment);


    //scoreimg = "picture/people/"+scoreimg+".png";
    //$("#gamecontent .scoreimg").attr("src",scoreimg);
    


/*
    //
    var lastscore = getvalue(ce);
    if (lastscore == null||scorerate>lastscore) {
        savevalue(ce,scorerate);
        scorechange = "";
    } else {
        scorechange = "";
    }
    $("#gamecontent .scorechange").html(scorechange);

    //Episode
    var k = $("#tipmenu .coursemenu div[episode = "+ce+"]").next().attr("episode");
    if (k != null && k != "" && remember == 1) {savevalue("ce",k);savevalue("cs",0);savevalue("ca",0);}
    */
}




function jumptoquiz() {
    var k = $("#allcontent .option:not(.done)").eq(0).parent().parent().parent().attr("articlenumber");
    jumptoarticle(k);
}

function jumptostory(storyid){
    var storyid;
    var n = $("#allcontent .slide[storyid = "+storyid+"]").attr("articlenumber");
    if (typeof(n)=="undefined") {n=0};
    if (n==null || n=="") {n=0}
    n=parseInt(n);
    jumptoarticle(n);
}



//
function playanimation() {
    var $ani = $("#gamecontent .slide").eq(cs).find(".animation").eq(0);

    if (!$ani.attr("played")||$ani.attr("played") != 1) {
        var thefunction = $ani.attr("function");
        eval(thefunction+"();");
    }

}



function speedquiz() {
    var $ani = $("#gamecontent .slide").eq(cs).find(".animation").eq(0);
    $ani.empty();
    $ani.attr("score",0);
    var timelimit = $ani.attr("timelimit");
    timelimit = parseInt(timelimit)+3;
    $ani.append("<div class = sentense></div>");
    $ani.find(".sentense").append($ani.parent().find(".yesorno").html());
    $ani.find(".sentense p").css({"text-align":"center","font-size":"32px"});

    $ani.append("<div class = 'yes tap' style = 'background:#E3D3BC;position:absolute;left:298px;top:250px;width:200px;height:100px;line-height:100px;font-size:32px;text-align:center;-webkit-border-radius:0.2em;-moz-border-radius:0.2em;border:1px solid #93857C;'></div>");
    $ani.append("<div class = 'no tap' style = 'background:#E3D3BC;position:absolute;left:532px;top:250px;width:200px;height:100px;line-height:100px;font-size:32px;text-align:center;-webkit-border-radius:0.2em;-moz-border-radius:0.2em;border:1px solid #93857C;'></div>");
    $ani.append("<div class = 'currentquiz tap' style = 'position:absolute;left:0;top:150px;width:1024px;height:100px;line-height:170%;font-size:32px;text-align:center;'></div>");
    $ani.append("<div class = 'quizperformance tap' style = 'position:absolute;left:266px;top:400px;width:512px;height:200px;line-height:170%;font-size:32px;text-align:center;background:#FFF1E0;'></div>");

    //
    $ani.append("<div class = 'tap tstable movein' style = 'display:none;'><table><thead><tr><th scope = col class = header></th><th style = 'text-align:center' scope = 'col' class = header nowrap></th><th style = 'text-align:right' scope = col class = header nowrap></th></tr></thead><tbody></tbody></table></div>");


    //
    $ani.append("<div class = 'timelimit tap'>"+timelimit+"</div><div class = 'tap timelimittext' style = ''></div>");
    //csclockpage
    var clockpage = cs;
    var _timelimit = function(){
        timelimit = timelimit-1;
        if (timelimit < 0) {
            timelimit = 0;
            _endquiz();
            $ani.find(".quizresult").prepend("");
        } else if ($ani.find(".sentense p").length>0&&clockpage == cs) {
            setTimeout(_timelimit, 1000);
        }
        if (timelimit <= 10){
            $ani.find(".timelimit").css("color","#9E2F50");
        }
        $ani.find(".timelimit").html(timelimit);}



    _timelimit();

    //
    function _popquiz() {
        $ani.find(".sentense").hide();
        var quiznumber = $ani.find(".sentense p").length;
        if (quiznumber>0) {
            var k = Math.floor(Math.random()*quiznumber);
            $ani.find(".currentquiz").empty().append($ani.find(".sentense p").eq(k));
        }
    }

    //
    function _endquiz() {
        $ani.find(".yes,.no,.currentquiz").remove();
        $ani.find(".tstable").show();
        myscore = $ani.find(".quizperformance .quizcorrect").length;
        $ani.find(".tstable th").eq(0).html(''+myscore+'').css({"font-size":"21px","text-align":"center","font-family":"arial"});
        $ani.append("<div class = 'quizcomment tap' style = 'position:absolute;left:30px;top:50px;width:964px;line-height:170%;font-size:26px;text-align:center;'></div>");
        $ani.find(".endquiz").unbind().bind("click",function(){
            turnpage(1);
            timelimit = 0;
        });
        var quizcomment = "";
        var allquiz = $(".yesorno p").length;
        allquiz = parseInt(allquiz);
        var quizrate = Math.round(100 * myscore/allquiz);

        if (quizrate > 70) reviewPanel();

        $ani.find(".quizcomment").html(quizcomment);
        $("#gamecontent .slide").eq(cs).attr("score", myscore);
        $ani.find(".quizperformance").remove();
        $ani.find(".timelimit,.timelimittext").remove();

    }



    _popquiz();



    //
    $(".yes.tap,.no.tap").unbind().bind("click",function(){
        var quiznumber = $ani.find(".sentense p").length;

        if (quiznumber >= 0){
            //summary

            var k1 = $ani.find(".currentquiz p").eq(0).html();
            var k2;
            var k3;

            if ($(this).hasClass("yes")&&$ani.find(".currentquiz p").eq(0).hasClass("yes")) {
                k2 = "<img src = img/tsright.png>";
                k3 = "<img src = img/tsfalse.png>";
            } else if ($(this).hasClass("no")&&!$ani.find(".currentquiz p").eq(0).hasClass("yes")){
                k2 = "<img src = img/tsfalse.png>";
                k3 = "<img src = img/tsright.png>";
            } else if ($(this).hasClass("yes")&&!$ani.find(".currentquiz p").eq(0).hasClass("yes")) {
                k2 = "<img src = img/tswrong.png>";
                k3 = "<img src = img/tstrue.png>";
            } else {
                k2 = "<img src = img/tstrue.png>";
                k3 = "<img src = img/tswrong.png>";
            }


            $ani.find(".tstable tbody").append("<tr><td class = td1>"+k1+"</td><td>"+k2+"</td><td>"+k3+"</td></tr>");



            if (($(this).hasClass("yes")&&$ani.find(".currentquiz p").eq(0).hasClass("yes"))||($(this).hasClass("no")&&!$ani.find(".currentquiz p").eq(0).hasClass("yes"))) {
                $ani.find(".quizperformance").append("<div class = 'quizcorrect ro' style = 'height:75px;width:100px;float:left;'></div>");
            } else {
                $ani.find(".quizperformance").append("<div class = 'wo' style = 'height:75px;width:100px;float:left;'></div>");
            }


            if (quiznumber>0) {
                _popquiz();
            }else {
                _endquiz();
            }
        } 
    });



}



function GetCookie(name){
    var start = document.cookie.indexOf(name+" = ");
    var len = start+name.length+1;
    if ((!start) && (name  !=  document.cookie.substring(0,name.length))) return null;
    if (start  ==  -1) return null;
    var end = document.cookie.indexOf(";",len);
    if (end  ==  -1) end = document.cookie.length;
    return decodeURIComponent(document.cookie.substring(len,end));
}

function SetCookie (name, value , sec , path , domain) {
    var argv = SetCookie.arguments;
    var argc = SetCookie.arguments.length;

    var expires = new Date()
        if(!sec) sec = 600 * (24 * 60 * 60 * 1000);
        else sec = 1000*sec;
    expires.setTime (expires.getTime() + sec)

        var path = (argc > 3) ? argv[3] : null;
    var domain = (argc > 4) ? argv[4] : null;
    var secure = (argc > 5) ? argv[5] : false;
    document.cookie = name + " = " + escape (value) +
        ((expires  ==  null) ? "" : ("; expires = " + expires.toGMTString())) +
        ((path  ==  null) ? "/" : ("; path = " + path)) +
        ((domain  ==  null) ? "" : ("; domain = " + domain)) +
        ((secure  ==  true) ? "; secure" : "");
}
function DeleteCookie (name) {
    var exp = new Date();
    exp.setTime (exp.getTime() - 1);
    var cval = GetCookie (name);
    document.cookie = name + " = " + cval + "; expires = " + exp.toGMTString();
}






function savevalue(thekey,thevalue) {
    try {
        thekey = thekey.toString();
        if (typeof(thevalue)=="undefined" || thevalue==null) {
            thevalue=0;
        }
        thevalue = thevalue.toString();
        //
        thekey = thekey ? thekey.replace(/\//g,"-").replace(/\?\:\;\,/g,"") : thekey;
        thevalue =  thevalue ? thevalue.replace(/\//g,"-").replace(/\?\:\;\,/g,"") : thevalue;

        if (localStorage){
            localStorage.removeItem(thekey);localStorage.setItem(thekey,thevalue);
        } else {
            SetCookie(thekey,thevalue,"","/");
        }
    } catch (ignore) {
    
    }
}

function getvalue(thekey){
    try {
        var kl;
        if (localStorage){kl = localStorage.getItem(thekey);} else {kl = GetCookie(thekey);}
        return kl;
    } catch (ignore) {
        return "";
    }
}

function getpvalue(theurl, thep) {
    var theurl, thep,k,thev;
    if (theurl.toLowerCase().indexOf(thep + "=")>1) {
        k = theurl.toLowerCase().indexOf(thep) + thep.length + 1;
        thev = theurl.toLowerCase().substring(k,theurl.length);
        thev = thev.replace(/\&.*/g,"");
    } else {
        thev = "";
    }
    return thev;
}

function checkScreenType() {
if ($(window).width()>=600) {
    screenType="big";
} else {
    screenType="small";
}
}

//GA TrackGAPVhttp://remysharp.com/2009/02/27/analytics-for-bookmarklets-injected-scripts/
function gaTrack(g,h,i,o){var f = 1000000000,k = c(f,9999999999),a = c(10000000,99999999),l = c(f,2147483647),b = (new Date()).getTime(),d = window.location,m = new Image(),n = 'http://www.google-analytics.com/__utm.gif?utmwv = 5.3.8&utms = 5&utmn = '+uniqueK+'&utmcs = UTF-8&utmsr = 1024x768&utmsc = 32-bit&utmul=zh-cn&utmje=1&utmfl=11.6%20r602&utmdt='+o+'&utmhid=1113132287&utmhn='+h+'&utmr=0&utmp='+i+'&utmac='+g.replace(/\//g,"%2F")+'&utmcc=__utma%3D'+uniqueA+'.'+uniqueL+'.'+uniqueB+'.'+uniqueB+'.'+uniqueB+'.10%3B%2B__utmb%3D'+uniqueA+'%3B%2B__utmc%3D'+uniqueA+'%3B%2B__utmz%3D'+uniqueA+'.'+uniqueB+'.1.1.utmcsr%3D(direct)%7Cutmccn%3D(direct)%7Cutmcmd%3D(none)%3B&utmu=DAC~';m.src = n}






function c(e,j){return e+Math.floor(Math.random()*(j-e))}


//
function setChart() {
    var titleSize=25;
    var enableLegend=true;
    if ($(window).width()<=600) {titleSize=17;enableLegend=false;}
    FTChartStyle = {
        colors: ['#9e2f50', '#4781aa', '#eda45e', '#a6a471', '#736e7e', '#94826b', '#936971', '#c36256', '#8ab5cd'],
        chart: {
            backgroundColor: '#fff1e0',
            borderWidth: 0,
            plotBackgroundColor: '#fff1e0',
            plotShadow: false,
            plotBorderWidth: 0,
            spacingRight: 20
        },
        title: {
            align : 'center',
            style: { 
                color: '#333',
                font: 'bold '+titleSize+'px arial,"Hiragino Sans GB","Heiti SC",STHeiti',
                lineHeight:'162%'
            }
        },
        subtitle: {
            align: 'right',
            y: 20,
            style: { 
                color: '#333333',
                font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti'
            }
        },


        xAxis: {
            lineColor: '#333',
            lineWidth: 2,
            tickColor: '#333',
            tickWidth: 1,
            tickPosition: 'outside',
            allowDecimals: false,
            showFirstLabel: true,
            labels: {
                style: {
                    color: '#333',
                    font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti'
                }
            }
        },

        //
        yAxis: [{
            gridLineColor: '#999',
            labels: {
                style: {
                    color: '#333',
                    font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti'
                }
            },
            title: {
                text: null
            }
        },
        {
            gridLineColor: '#999',
            labels: {
                style: {
                    color: '#333',
                    font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti'
                }
            },
            title: {
                text: null
            }
        }],
        plotOptions: {
            column: {
                borderWidth: 1,
                borderColor: '#000',
                shadow: false
            },	
            bar: {
                borderWidth: 1,
                borderColor: '#000',
                shadow: false
            },
            line: {
                shadow: false
            },
            pie: {
                lineWidth:1,
                slicedOffset:15,
                shadow:false,
                showInLegend:true,
                center: ["50%", "45%"],
                size: "85%",
                series: {
                    showCheckbox: true
                },
                dataLabels: {
                    enabled: false,
                    color: '#333',		
                    softConnector: false,					
                    connectorColor: '#333',
                    style: {
                        font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti',
                    },	
                }
            }
        },
        legend: {
            layout: 'vertical',
            backgroundColor: '#FFFFFF',
            align: 'right',
            verticalAlign: 'top',
            floating: true,
            enabled: enableLegend,
            shadow: false,
            borderRadius: 0,
            itemStyle: {	
                font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti',
                color: '#333'
            },
            itemHiddenStyle: {
                color: 'gray'
            },

            itemHoverStyle: {
                color: '#4781aa'
            }
        },
        labels: {
            style: {
                color: '#333'
            }
        },
        tooltip: {
            style: {
                color: '#333',
                font: '12px arial,"Hiragino Sans GB","Heiti SC",STHeiti'
            },
            borderRadius: 0,
            shadow:false
        }
    };
    highchartsOptions = Highcharts.setOptions(FTChartStyle);
}


//,slideslideslideactionaction
var testcount=0;
var uniqueL = c(1000000000,2147483647);
var uniqueK = c(1000000000,9999999999);
var uniqueA = c(10000000,99999999);
var uniqueB = (new Date()).getTime();
var allslides,allaction
var pagemoving = 0;
var fingermoving = 0;
var ce = "";
var cs = 0;
var ca = 0;
var cer = "";
var csr = 0;
var car = 0;
var currentMenu = 0;
var testindex = 0;
var remember = 1; //remember
var gameback = "intro";
var topic_object_id = "";
var username = getvalue("USER_NAME");
var thisday = new Date();
var themi = thisday.getHours()*10000 + thisday.getMinutes()*100 + thisday.getSeconds();
var thed = thisday.getFullYear()*10000 + thisday.getMonth()*100 + thisday.getDate();
var prevpage;
var scroller,contentScroller,sectionScroller,foodScroller;
var currentArticle, allArticle, currentPage=0, currentPageCount=0, articleCount, startSlide;
var currentTitle=document.title;
var contentScrollTop=0;
var screenType="small";//600big
var fontPreference="medium";
var bgMode="";
var mpuAmount=0;
var currentMPU=0;
var userinfo=navigator.userAgent||navigator.vendor||window.opera;
var isipad;
(function(a,b){if(/ipad;/i.test(a)) {isipad = 1;return;}})(navigator.userAgent||navigator.vendor||window.opera,'http://m.ftchinese.com/');
if (isipad === 1) {document.body.addEventListener("touchmove", function(e) {e.preventDefault();});}

//feature detectTouch
//agent sniffing
var deviceType = 'other';
if (/ipad/i.test(userinfo)) {
    deviceType = 'iPad';
} else if (/ipod|iphone/i.test(userinfo)) {
    deviceType = 'iPhone';
} else if (/android/i.test(userinfo)) {
    deviceType = 'Android';
} else if (/bb10/i.test(userinfo)) {
    deviceType = 'BB10';
}
if (deviceType === 'other') {
    $('html').addClass('is-desktop');
} else {
    $('html').addClass('is-touch');
}


var islocal = 1;
(function(a,b){if(/ftmailbox/i.test(a) || /ftchinese/i.test(a)) {islocal = 0;return;}})(window.location.href,'http://m.ftchinese.com/');

var tap = "click";if(isipad == 1){tap = "touchend"};
var tapstart = "click";if(isipad == 1){tapstart = "touchstart"};
var slider,courseSlider;
var coverheight;
var FTChartStyle,highchartsOptions,Highcharts;



var rtime = new Date(1, 1, 2000, 12,00,00);
var timeout = false;
var delta = 200;
function resizeend() {
    if (new Date() - rtime < delta) {
        setTimeout(resizeend, delta);
    } else {
        timeout = false;
        reflowarticle();
    }
}

function reflowarticle(){
    calculateWH();
    jumptoarticle(currentArticle);
}