"use strict";function Delegate(e){this.listenerMap=[{},{}],e&&this.root(e),this.handle=Delegate.prototype.handle.bind(this)}function matchesTag(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function matchesRoot(e,t){return this.rootElement===window?t===document:this.rootElement===t}function matchesId(e,t){return e===t.id}function findTop(e){var t=0;if(e.offsetParent){do t+=e.offsetTop;while(e=e.offsetParent);return t}}function getBodyHeight(){var e=window,t=document,o=t.documentElement,n=t.getElementsByTagName("body")[0],a=e.innerHeight||o.clientHeight||n.clientHeight;return a}function stickyAdsPrepare(){if("object"==typeof stickyAds&&stickyAds.length>0)for(var e=0;e<stickyAds.length;e++){var t=document.getElementById(stickyAds[e].BannerId).parentNode.parentNode.parentNode.parentNode,o=document.getElementById(stickyAds[e].BannerId).parentNode.parentNode.parentNode;stickyAds[e].oTop=findTop(t),stickyAds[e].currentClass=o.className}}function stickyBottomPrepare(){if(gNavOffsetY=findTop(document.querySelector(".o-nav__placeholder")),bodyHeight=getBodyHeight(),document.getElementById("story-share-placeholder")&&(gShareOffsetY=findTop(document.getElementById("story-share-placeholder"))),w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,sectionsWithSide.length>0)for(var e=0;e<sectionsWithSide.length;e++)sectionClassName[e]=sectionsWithSide[e].className,/fixmain|fixside|bottommain|bottomside|sticktop/.test(sectionClassName[e])||(containerTop[e]=findTop(sectionsWithSide[e]),mainHeight[e]=sectionsWithSide[e].querySelector(".content-inner").offsetHeight,sideHeight[e]=sectionsWithSide[e].querySelector(".side-inner").offsetHeight+defaultPadding,minHeight[e]=Math.min(mainHeight[e],sideHeight[e]),maxHeight[e]=Math.max(mainHeight[e],sideHeight[e]))}function stickyBottomUpdate(){var e=htmlClass.replace(/ o-nav-sticky/g,"").replace(/ share-sticky/g,"");if("function"==typeof requestAnimationFrame&&requestAnimationFrame(stickyBottomUpdate),"number"==typeof gShareOffsetY&&gShareOffsetY>gNavOffsetY?(scrollTop>=gShareOffsetY?e+=" share-sticky":scrollTop>=gNavHeight&&(e+=" o-nav-sticky"),e!==htmlClass&&(htmlClass=e,document.documentElement.className=htmlClass)):scrollTop>=gNavOffsetY?htmlClass.indexOf(" o-nav-sticky")<0&&(htmlClass+=" o-nav-sticky",document.documentElement.className=htmlClass):htmlClass.indexOf(" o-nav-sticky")>=0&&(htmlClass=htmlClass.replace(/ o-nav-sticky/g,""),document.documentElement.className=htmlClass),sectionsWithSideLength>0&&w>hasSideWidth)for(var t=0;sectionsWithSideLength>t;t++){sectionClassNameNew[t]=sectionClassName[t].replace(/fixmain|fixside|bottommain|bottomside|sticktop/g,"");var o=0,n=0,a="";maxHeight[t]+gNavHeight+defaultPadding>=bodyHeight&&maxHeight[t]-minHeight[t]>=100&&(minHeight[t]+gNavHeight+defaultPadding<bodyHeight?(a=" sticktop",o=containerTop[t]+maxHeight[t]-minHeight[t]-scrollTop-gNavHeight-defaultPadding,n=containerTop[t]-gNavHeight-scrollTop-defaultPadding,/side-left/.test(sectionClassName[t])&&(o+=defaultPadding)):(o=containerTop[t]+maxHeight[t]-bodyHeight-scrollTop,n=containerTop[t]+minHeight[t]-bodyHeight-scrollTop,/side-left/.test(sectionClassName[t])&&(o+=defaultPadding/2)),mainHeight[t]>sideHeight[t]?0>=o?sectionClassNameNew[t]+=" bottomside":0>=n&&(sectionClassNameNew[t]+=" fixside"+a):mainHeight[t]<sideHeight[t]&&(30>o?sectionClassNameNew[t]+=" bottommain":0>n&&(sectionClassNameNew[t]+=" fixmain"+a))),sectionClassNameNew[t]=sectionClassNameNew[t].replace(/[\s]+/g," "),sectionClassNameNew[t]!==sectionClassName[t]&&(sectionClassName[t]=sectionClassNameNew[t],sectionsWithSide[t].className=sectionClassNameNew[t])}if("object"==typeof stickyAds&&stickyAds.length>0)for(var i=0;i<stickyAds.length;i++){var s=stickyAds[i].oTop-scrollTop-gNavHeight,r=s+stickyAds[i].stickyHeight,c="";c=0>=s&&r>0?" is-fix":"",c="banner-container"+c,c!==stickyAds[i].currentClass&&(stickyAds[i].currentClass=c,document.getElementById(stickyAds[i].BannerId).parentNode.parentNode.parentNode.className=c)}}function requestTick(){ticking||requestAnimationFrame(stickyBottomUpdate),ticking=!0}function stickyBottom(){scrollTop=window.scrollY||document.documentElement.scrollTop,"function"==typeof requestAnimationFrame?requestTick():stickyBottomUpdate()}function loadImages(){var e,t=document.querySelectorAll("figure.loading");for(e=0;e<t.length;e++){var o=t[e],n=o.offsetWidth,a=o.offsetHeight,i=o.getAttribute("data-url"),s=o.className||"",r="cover",c=o.parentNode.className||"";isRetinaDevice===!0&&(n=2*n,a=2*a),/brand/.test(c)&&(r="contain"),/sponsor/.test(s)?(i=i.replace("i.ftimg.net","i.ftmailbox.com"),i=encodeURIComponent(i),i="https://image.webservices.ft.com/v1/images/raw/"+i+"?source=ftchinese&height="+a+"&fit="+r,o.innerHTML='<img src="'+i+'">',o.className=""):n>0&&a>0&&(i=i.replace("i.ftimg.net","i.ftmailbox.com"),i=encodeURIComponent(i),i="https://image.webservices.ft.com/v1/images/raw/"+i+"?source=ftchinese&width="+n+"&height="+a+"&fit="+r,o.innerHTML='<img src="'+i+'">',o.className="")}var l=document.querySelectorAll("figure.loading-video");for(hostForVideo="",("localhost"===window.location.hostname||0===window.location.hostname.indexOf("192.168")||0===window.location.hostname.indexOf("10.113")||0===window.location.hostname.indexOf("127.0"))&&(hostForVideo="http://www.ftchinese.com"),e=0;e<l.length;e++){var d=l[e],m=d.offsetWidth,h=d.offsetHeight,f=d.getAttribute("data-vid");m>0&&h>0&&(d.innerHTML='<iframe name="video-frame" id="video-frame" style="width:100%;height:100%;position:absolute;" src="'+hostForVideo+"/video/"+f+"?i=2&k=1&w="+m+"&h="+h+'&autostart=false" scrolling="no" frameborder="0" allowfullscreen=true></iframe>',d.className="")}}function isTouchDevice(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),"function"==typeof e.ongesturestart?!0:!1}function Nav(e){function t(){e?e instanceof HTMLElement||(e=document.querySelector(e)):e=document.body;var t=new Delegate(e);s.delegate=t,s.rootEl=e}function o(){var e=".nav-section-head.mobile",t=s.rootEl.querySelectorAll(e);s.delegate.on("click",e,function(e,o){for(var n=0;n<t.length;n++)t[n].setAttribute("aria-selected","false");o.setAttribute("aria-selected","true")})}function n(){var e=s.rootEl.querySelector("[data-o-nav-togglable]"),t=i.navClassName+"--open";e&&e.addEventListener("click",function(){document.documentElement.classList.toggle(t),document.body.classList.toggle(t)})}function a(){var e="[data-o-nav-togglable]";s.delegate.on("click",e,function(e,t){var o=t.getAttribute("aria-pressed");"true"===o?t.setAttribute("aria-pressed","false"):"false"!==o&&o||t.setAttribute("aria-pressed","true")})}var i={navClassName:"o-nav"},s=this;t(),n(),a(),o()}function oNavSections(e){for(var t=".nav-section",o=e.querySelectorAll(t),n={},a=0,i=o.length;i>a;a++){var s=o[a],r=s.getAttribute("aria-selected"),c=s.getAttribute("data-section");!r&&c&&(n[c]=s)}return n}function zipObject(e,t){for(var o in e)e[o].appendChild(t[o])}Delegate.prototype.root=function(e){var t,o=this.listenerMap;if(this.rootElement){for(t in o[1])o[1].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!0);for(t in o[0])o[0].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!1)}if(!e||!e.addEventListener)return this.rootElement&&delete this.rootElement,this;this.rootElement=e;for(t in o[1])o[1].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!0);for(t in o[0])o[0].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!1);return this},Delegate.prototype.captureForType=function(e){return-1!==["blur","error","focus","load","resize","scroll"].indexOf(e)},Delegate.prototype.on=function(e,t,o,n){var a,i,s,r;if(!e)throw new TypeError("Invalid event type: "+e);if("function"==typeof t&&(n=o,o=t,t=null),void 0===n&&(n=this.captureForType(e)),"function"!=typeof o)throw new TypeError("Handler must be a type of Function");return a=this.rootElement,i=this.listenerMap[n?1:0],i[e]||(a&&a.addEventListener(e,this.handle,n),i[e]=[]),t?/^[a-z]+$/i.test(t)?(r=t,s=matchesTag):/^#[a-z0-9\-_]+$/i.test(t)?(r=t.slice(1),s=matchesId):(r=t,s=matches):(r=null,s=matchesRoot.bind(this)),i[e].push({selector:t,handler:o,matcher:s,matcherParam:r}),this},Delegate.prototype.off=function(e,t,o,n){var a,i,s,r,c;if("function"==typeof t&&(n=o,o=t,t=null),void 0===n)return this.off(e,t,o,!0),this.off(e,t,o,!1),this;if(s=this.listenerMap[n?1:0],!e){for(c in s)s.hasOwnProperty(c)&&this.off(c,t,o);return this}if(r=s[e],!r||!r.length)return this;for(a=r.length-1;a>=0;a--)i=r[a],t&&t!==i.selector||o&&o!==i.handler||r.splice(a,1);return r.length||(delete s[e],this.rootElement&&this.rootElement.removeEventListener(e,this.handle,n)),this},Delegate.prototype.handle=function(e){var t,o,n,a,i,s,r,c=e.type,l=[],d="ftLabsDelegateIgnore";if(e[d]!==!0){switch(r=e.target,3===r.nodeType&&(r=r.parentNode),n=this.rootElement,a=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:l=this.listenerMap[1][c];break;case 2:this.listenerMap[0]&&this.listenerMap[0][c]&&(l=l.concat(this.listenerMap[0][c])),this.listenerMap[1]&&this.listenerMap[1][c]&&(l=l.concat(this.listenerMap[1][c]));break;case 3:l=this.listenerMap[0][c]}for(o=l.length;r&&o;){for(t=0;o>t&&(i=l[t],i);t++)if(i.matcher.call(r,i.matcherParam,r)&&(s=this.fire(e,r,i)),s===!1)return e[d]=!0,void e.preventDefault();if(r===n)break;o=l.length,r=r.parentElement}}},Delegate.prototype.fire=function(e,t,o){return o.handler.call(t,e,t)};var matches=function(e){if(e){var t=e.prototype;return t.matches||t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector}}(Element);Delegate.prototype.destroy=function(){this.off(),this.root()};var containerTop=[],mainHeight=[],sideHeight=[],bodyHeight,gNavOffsetY=0,gNavHeight=44,gShareOffsetY,defaultPadding=30,hasSideWidth=690,sectionsWithSide=document.querySelectorAll(".block-container.has-side"),w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,delegate,htmlClass=document.documentElement.className,sectionsWithSideLength=sectionsWithSide.length,sectionClassName=[],sectionClassNameNew=[],minHeight=[],maxHeight=[],isRetinaDevice=window.devicePixelRatio>1,scrollTop=window.scrollY||document.documentElement.scrollTop,ticking=!1,hostForVideo="";try{delegate=new Delegate(document.body)}catch(ignore){}if(gNavOffsetY=findTop(document.querySelector(".o-nav__placeholder")),gNavOffsetY>30&&w>490&&isTouchDevice()===!1)try{stickyBottomPrepare(),stickyAdsPrepare();var addEvent=window.attachEvent||window.addEventListener,eventScroll=window.attachEvent?"onscroll":"scroll",eventResize=window.attachEvent?"onresize":"resize";addEvent(eventScroll,function(){stickyBottom()}),addEvent(eventResize,function(){stickyBottomPrepare(),stickyAdsPrepare()}),setInterval(function(){stickyBottomPrepare(),stickyAdsPrepare()},1e4)}catch(ignore){}"undefined"==typeof SVGRect&&(document.documentElement.className+=" no-svg"),loadImages();try{delegate.on("error","img",function(){this.style.display="none"})}catch(ignore){}try{delegate.on("click",".video-package .XL2 a.image",function(){for(var e=hostForVideo+this.getAttribute("href"),t=this.parentNode.parentNode.parentNode,o=t.querySelector("#video-package-play"),n=o.offsetWidth,a=o.offsetHeight,i=this.parentNode.parentNode,s=i.querySelector(".item-headline a").innerHTML,r=this.parentNode.parentNode.parentNode.querySelectorAll(".video-package .XL2"),c=0;c<r.length;c++){var l=r[c].className;l.indexOf(" on")>=0&&(l=l.replace(" on",""),r[c].className=l)}return this.parentNode.parentNode.className+=" on",o.querySelector("iframe").src=e+"?i=2&k=1&w="+n+"&h="+a+"&autostart=true",t.querySelector(".video-package-title a").innerHTML=s,t.querySelector(".video-package-title a").href=e,!1})}catch(ignore){}delegate.on("click",".overlay-close, .overlay-bg",function(){var e=this.getAttribute("data-parentid");closeOverlay(e)});var fontOptionsEle,fs,xhr=new XMLHttpRequest,ajaxMethod,ajaxUrl,message={};message.head={},message.head.transactiontype="61009",message.head.source="web",message.body={},message.body.ielement={},message.body.ielement.storyid="",/127\.0|localhost|192\.168/.test(window.location.href)?(ajaxMethod="GET",ajaxUrl="/api/page/recommend.json"):(ajaxMethod="POST",ajaxUrl="/eaclient/apijson.php"),xhr.open(ajaxMethod,encodeURI(ajaxUrl)),xhr.setRequestHeader("Content-Type","application/json"),xhr.onload=function(){if(200===xhr.status){var e=JSON.parse(xhr.responseText),t=8,o=0,n="";if("0"===e.body.oelement.errorcode&&e.body.odatalist&&e.body.odatalist.length>0){for(var a=0;a<e.body.odatalist.length;a++){var i="XL3 L3 M6 S6 P12",s=e.body.odatalist[a].cheadline,r=e.body.odatalist[a].piclink,c=e.body.odatalist[a].storyid,l="",d="PT";o%4===0&&(d+=" XLT LT"),o%2===0&&(d+=" MT ST"),""!==d&&o>0&&(l='<div class="'+d+'"></div>'),t>o&&r&&""!==r&&(n+=l+'<div class="item-container '+i+' has-image no-lead"><div class="item-inner"><h2 class="item-headline"><a target="_blank" href="/story/'+c+'?tcode=smartrecommend">'+s+'</a></h2><a class="image" target="_blank" href="/story/'+c+'?tcode=smartrecommend"><figure class="loading" data-url="'+r+'"></figure></a><div class="item-bottom"></div></div></div>',o+=1)}document.getElementById("story-recommend").innerHTML=n,document.getElementById("story-recommend-container").style.display="block",loadImages()}}else 200!==xhr.status},xhr.send(JSON.stringify(message)),fontOptionsEle=document.getElementById("font-options"),delegate.on("click","#font-options div",function(){var e,t=this.className||"",o=document.querySelector(".story-container").className;t.indexOf("selected")<0&&(e=fontOptionsEle.querySelector(".selected").className,e=e.replace(/ selected/g,""),fontOptionsEle.querySelector(".selected").className=e,this.className=t+" selected",SetCookie("fs",t,"","/"),document.querySelector(".story-container").className=o+" "+t,stickyBottomPrepare(),stickyAdsPrepare())}),fs=GetCookie("fs"),"string"==typeof fs&&null!==fs&&""!==fs?(document.getElementById("font-options").querySelector("."+fs.replace(/ /g,".")).className=fs+" selected",document.querySelector(".story-container").className=document.querySelector(".story-container").className+" "+fs):document.getElementById("font-setting").querySelector(".normal").className="normal selected";var ajax={getData:function(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(o.status>=200&&o.status<300||304===o.status){var e=o.getResponseHeader("Content-Type");-1!==e.indexOf("html")&&o.responseXML?t(null,o.responseXML):"application/json"===e?t(null,JSON.parse(o.responseText)):t(null,o.responseText)}else t(o.status)},o.open("GET",e),o.send(null)}},navEl=document.querySelector(".o-nav");new Nav(navEl);var initialNavSections=oNavSections(navEl);ajax.getData("/m/corp/ajax-nav.html",function(e,t){if(!e){var o=document.createElement("ol");o.innerHTML=t;for(var n=o.querySelectorAll(".nav-section"),a={},i=0,s=n.length;s>i;i++){var r=n[i],c=r.getAttribute("data-section"),l=r.querySelector(".nav-items");a[c]=l}zipObject(initialNavSections,a)}});