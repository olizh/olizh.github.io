"use strict";function Delegate(e){this.listenerMap=[{},{}],e&&this.root(e),this.handle=Delegate.prototype.handle.bind(this)}function matchesTag(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function matchesRoot(e,t){return this.rootElement===window?t===document:this.rootElement===t}function matchesId(e,t){return e===t.id}function Nav(e){function t(){e?e instanceof HTMLElement||(e=document.querySelector(e)):e=document.body;var t=new Delegate(e);s.delegate=t,s.rootEl=e}function n(){var e=".nav-section-head.mobile",t=s.rootEl.querySelectorAll(e);s.delegate.on("click",e,function(e,n){for(var i=0;i<t.length;i++)t[i].setAttribute("aria-selected","false");n.setAttribute("aria-selected","true")})}function i(){var e=s.rootEl.querySelector("[data-o-nav-togglable]"),t=a.navClassName+"--open";e&&e.addEventListener("click",function(){document.documentElement.classList.toggle(t),document.body.classList.toggle(t)})}function o(){var e="[data-o-nav-togglable]";s.delegate.on("click",e,function(e,t){var n=t.getAttribute("aria-pressed");"true"===n?t.setAttribute("aria-pressed","false"):"false"!==n&&n||t.setAttribute("aria-pressed","true")})}var a={navClassName:"o-nav"},s=this;t(),i(),o(),n()}function oNavSections(e){for(var t=".nav-section",n=e.querySelectorAll(t),i={},o=0,a=n.length;a>o;o++){var s=n[o],r=s.getAttribute("aria-selected"),c=s.getAttribute("data-section");!r&&c&&(i[c]=s)}return i}function zipObject(e,t){for(var n in e)e[n].appendChild(t[n])}function findTop(e){var t=0;if(e.offsetParent){do t+=e.offsetTop;while(e=e.offsetParent);return t}}function getBodyHeight(){var e=window,t=document,n=t.documentElement,i=t.getElementsByTagName("body")[0],o=e.innerHeight||n.clientHeight||i.clientHeight;return o}function stickyAdsPrepare(){if("object"==typeof stickyAds&&stickyAds.length>0)for(var e=0;e<stickyAds.length;e++){var t=document.getElementById(stickyAds[e].BannerId).parentNode.parentNode.parentNode.parentNode,n=document.getElementById(stickyAds[e].BannerId).parentNode.parentNode.parentNode;stickyAds[e].oTop=findTop(t),stickyAds[e].currentClass=n.className}}function stickyBottomPrepare(){if(gNavOffsetY=findTop(document.querySelector(".o-nav__placeholder")),bodyHeight=getBodyHeight(),document.getElementById("story-share-placeholder")&&(gShareOffsetY=findTop(document.getElementById("story-share-placeholder"))),w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,sectionsWithSide.length>0)for(var e=0;e<sectionsWithSide.length;e++)sectionClassName[e]=sectionsWithSide[e].className,/fixmain|fixside|bottommain|bottomside|sticktop/.test(sectionClassName[e])||(containerTop[e]=findTop(sectionsWithSide[e]),mainHeight[e]=sectionsWithSide[e].querySelector(".content-inner").offsetHeight,sideHeight[e]=sectionsWithSide[e].querySelector(".side-inner").offsetHeight+defaultPadding,minHeight[e]=Math.min(mainHeight[e],sideHeight[e]),maxHeight[e]=Math.max(mainHeight[e],sideHeight[e]))}function stickyBottomUpdate(){var e=htmlClass.replace(/ o-nav-sticky/g,"").replace(/ share-sticky/g,"");if("function"==typeof requestAnimationFrame&&requestAnimationFrame(stickyBottomUpdate),"number"==typeof gShareOffsetY&&gShareOffsetY>gNavOffsetY?(scrollTop>=gShareOffsetY?e+=" share-sticky":scrollTop>=gNavHeight&&(e+=" o-nav-sticky"),e!==htmlClass&&(htmlClass=e,document.documentElement.className=htmlClass)):scrollTop>=gNavOffsetY?htmlClass.indexOf(" o-nav-sticky")<0&&(htmlClass+=" o-nav-sticky",document.documentElement.className=htmlClass):htmlClass.indexOf(" o-nav-sticky")>=0&&(htmlClass=htmlClass.replace(/ o-nav-sticky/g,""),document.documentElement.className=htmlClass),sectionsWithSideLength>0&&w>hasSideWidth)for(var t=0;sectionsWithSideLength>t;t++){sectionClassNameNew[t]=sectionClassName[t].replace(/fixmain|fixside|bottommain|bottomside|sticktop/g,"");var n=0,i=0,o="";maxHeight[t]+gNavHeight+defaultPadding>=bodyHeight&&maxHeight[t]-minHeight[t]>=100&&(minHeight[t]+gNavHeight+defaultPadding<bodyHeight?(o=" sticktop",n=containerTop[t]+maxHeight[t]-minHeight[t]-scrollTop-gNavHeight-defaultPadding,i=containerTop[t]-gNavHeight-scrollTop-defaultPadding,/side-left/.test(sectionClassName[t])&&(n+=defaultPadding)):(n=containerTop[t]+maxHeight[t]-bodyHeight-scrollTop,i=containerTop[t]+minHeight[t]-bodyHeight-scrollTop,/side-left/.test(sectionClassName[t])&&(n+=defaultPadding/2)),mainHeight[t]>sideHeight[t]?0>=n?sectionClassNameNew[t]+=" bottomside":0>=i&&(sectionClassNameNew[t]+=" fixside"+o):mainHeight[t]<sideHeight[t]&&(30>n?sectionClassNameNew[t]+=" bottommain":0>i&&(sectionClassNameNew[t]+=" fixmain"+o))),sectionClassNameNew[t]=sectionClassNameNew[t].replace(/[\s]+/g," "),sectionClassNameNew[t]!==sectionClassName[t]&&(sectionClassName[t]=sectionClassNameNew[t],sectionsWithSide[t].className=sectionClassNameNew[t])}if("object"==typeof stickyAds&&stickyAds.length>0)for(var a=0;a<stickyAds.length;a++){var s=stickyAds[a].oTop-scrollTop-gNavHeight,r=s+stickyAds[a].stickyHeight,c="";c=0>=s&&r>0?" is-fix":"",c="banner-container"+c,c!==stickyAds[a].currentClass&&(stickyAds[a].currentClass=c,document.getElementById(stickyAds[a].BannerId).parentNode.parentNode.parentNode.className=c)}}function requestTick(){ticking||requestAnimationFrame(stickyBottomUpdate),ticking=!0}function stickyBottom(){scrollTop=window.scrollY||document.documentElement.scrollTop,"function"==typeof requestAnimationFrame?requestTick():stickyBottomUpdate()}function loadImages(){var e,t=document.querySelectorAll("figure.loading");for(e=0;e<t.length;e++){var n=t[e],i=n.offsetWidth,o=n.offsetHeight,a=n.getAttribute("data-url"),s=n.className||"",r="cover",c=n.parentNode.className||"";isRetinaDevice===!0&&(i=2*i,o=2*o),/brand/.test(c)&&(r="contain"),/sponsor/.test(s)?(a=a.replace("i.ftimg.net","i.ftmailbox.com"),a=encodeURIComponent(a),a="https://image.webservices.ft.com/v1/images/raw/"+a+"?source=ftchinese&height="+o+"&fit="+r,n.innerHTML='<img src="'+a+'">',n.className=""):i>0&&o>0&&(a=a.replace("i.ftimg.net","i.ftmailbox.com"),a=encodeURIComponent(a),a="https://image.webservices.ft.com/v1/images/raw/"+a+"?source=ftchinese&width="+i+"&height="+o+"&fit="+r,n.innerHTML='<img src="'+a+'">',n.className="")}var l=document.querySelectorAll("figure.loading-video");for(hostForVideo="",("localhost"===window.location.hostname||0===window.location.hostname.indexOf("192.168")||0===window.location.hostname.indexOf("10.113")||0===window.location.hostname.indexOf("127.0"))&&(hostForVideo="http://www.ftchinese.com"),e=0;e<l.length;e++){var d=l[e],h=d.offsetWidth,m=d.offsetHeight,f=d.getAttribute("data-vid");h>0&&m>0&&(d.innerHTML='<iframe name="video-frame" id="video-frame" style="width:100%;height:100%;position:absolute;" src="'+hostForVideo+"/video/"+f+"?i=2&k=1&w="+h+"&h="+m+'&autostart=false" scrolling="no" frameborder="0" allowfullscreen=true></iframe>',d.className="")}}function isTouchDevice(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),"function"==typeof e.ongesturestart?!0:!1}Delegate.prototype.root=function(e){var t,n=this.listenerMap;if(this.rootElement){for(t in n[1])n[1].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!0);for(t in n[0])n[0].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!1)}if(!e||!e.addEventListener)return this.rootElement&&delete this.rootElement,this;this.rootElement=e;for(t in n[1])n[1].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!0);for(t in n[0])n[0].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!1);return this},Delegate.prototype.captureForType=function(e){return-1!==["blur","error","focus","load","resize","scroll"].indexOf(e)},Delegate.prototype.on=function(e,t,n,i){var o,a,s,r;if(!e)throw new TypeError("Invalid event type: "+e);if("function"==typeof t&&(i=n,n=t,t=null),void 0===i&&(i=this.captureForType(e)),"function"!=typeof n)throw new TypeError("Handler must be a type of Function");return o=this.rootElement,a=this.listenerMap[i?1:0],a[e]||(o&&o.addEventListener(e,this.handle,i),a[e]=[]),t?/^[a-z]+$/i.test(t)?(r=t,s=matchesTag):/^#[a-z0-9\-_]+$/i.test(t)?(r=t.slice(1),s=matchesId):(r=t,s=matches):(r=null,s=matchesRoot.bind(this)),a[e].push({selector:t,handler:n,matcher:s,matcherParam:r}),this},Delegate.prototype.off=function(e,t,n,i){var o,a,s,r,c;if("function"==typeof t&&(i=n,n=t,t=null),void 0===i)return this.off(e,t,n,!0),this.off(e,t,n,!1),this;if(s=this.listenerMap[i?1:0],!e){for(c in s)s.hasOwnProperty(c)&&this.off(c,t,n);return this}if(r=s[e],!r||!r.length)return this;for(o=r.length-1;o>=0;o--)a=r[o],t&&t!==a.selector||n&&n!==a.handler||r.splice(o,1);return r.length||(delete s[e],this.rootElement&&this.rootElement.removeEventListener(e,this.handle,i)),this},Delegate.prototype.handle=function(e){var t,n,i,o,a,s,r,c=e.type,l=[],d="ftLabsDelegateIgnore";if(e[d]!==!0){switch(r=e.target,3===r.nodeType&&(r=r.parentNode),i=this.rootElement,o=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:l=this.listenerMap[1][c];break;case 2:this.listenerMap[0]&&this.listenerMap[0][c]&&(l=l.concat(this.listenerMap[0][c])),this.listenerMap[1]&&this.listenerMap[1][c]&&(l=l.concat(this.listenerMap[1][c]));break;case 3:l=this.listenerMap[0][c]}for(n=l.length;r&&n;){for(t=0;n>t&&(a=l[t],a);t++)if(a.matcher.call(r,a.matcherParam,r)&&(s=this.fire(e,r,a)),s===!1)return e[d]=!0,void e.preventDefault();if(r===i)break;n=l.length,r=r.parentElement}}},Delegate.prototype.fire=function(e,t,n){return n.handler.call(t,e,t)};var matches=function(e){if(e){var t=e.prototype;return t.matches||t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector}}(Element);Delegate.prototype.destroy=function(){this.off(),this.root()};var ajax={getData:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(n.status>=200&&n.status<300||304===n.status){var e=n.getResponseHeader("Content-Type");-1!==e.indexOf("html")&&n.responseXML?t(null,n.responseXML):"application/json"===e?t(null,JSON.parse(n.responseText)):t(null,n.responseText)}else t(n.status)},n.open("GET",e),n.send(null)}},navEl=document.querySelector(".o-nav");new Nav(navEl);var initialNavSections=oNavSections(navEl);ajax.getData("/m/corp/ajax-nav.html",function(e,t){if(!e){var n=document.createElement("ol");n.innerHTML=t;for(var i=n.querySelectorAll(".nav-section"),o={},a=0,s=i.length;s>a;a++){var r=i[a],c=r.getAttribute("data-section"),l=r.querySelector(".nav-items");o[c]=l}zipObject(initialNavSections,o)}});var containerTop=[],mainHeight=[],sideHeight=[],bodyHeight,gNavOffsetY=0,gNavHeight=44,gShareOffsetY,defaultPadding=30,hasSideWidth=690,sectionsWithSide=document.querySelectorAll(".block-container.has-side"),w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,delegate,htmlClass=document.documentElement.className,sectionsWithSideLength=sectionsWithSide.length,sectionClassName=[],sectionClassNameNew=[],minHeight=[],maxHeight=[],isRetinaDevice=window.devicePixelRatio>1,scrollTop=window.scrollY||document.documentElement.scrollTop,ticking=!1,hostForVideo="";try{delegate=new Delegate(document.body)}catch(ignore){}if(gNavOffsetY=findTop(document.querySelector(".o-nav__placeholder")),gNavOffsetY>30&&w>490&&isTouchDevice()===!1)try{stickyBottomPrepare(),stickyAdsPrepare();var addEvent=window.attachEvent||window.addEventListener,eventScroll=window.attachEvent?"onscroll":"scroll",eventResize=window.attachEvent?"onresize":"resize";addEvent(eventScroll,function(){stickyBottom()}),addEvent(eventResize,function(){stickyBottomPrepare(),stickyAdsPrepare()}),setInterval(function(){stickyBottomPrepare(),stickyAdsPrepare()},1e4)}catch(ignore){}"undefined"==typeof SVGRect&&(document.documentElement.className+=" no-svg"),loadImages();try{delegate.on("error","img",function(){this.style.display="none"})}catch(ignore){}try{delegate.on("click",".video-package .XL2 a.image",function(){for(var e=hostForVideo+this.getAttribute("href"),t=this.parentNode.parentNode.parentNode,n=t.querySelector("#video-package-play"),i=n.offsetWidth,o=n.offsetHeight,a=this.parentNode.parentNode,s=a.querySelector(".item-headline a").innerHTML,r=this.parentNode.parentNode.parentNode.querySelectorAll(".video-package .XL2"),c=0;c<r.length;c++){var l=r[c].className;l.indexOf(" on")>=0&&(l=l.replace(" on",""),r[c].className=l)}return this.parentNode.parentNode.className+=" on",n.querySelector("iframe").src=e+"?i=2&k=1&w="+i+"&h="+o+"&autostart=true",t.querySelector(".video-package-title a").innerHTML=s,t.querySelector(".video-package-title a").href=e,!1})}catch(ignore){}delegate.on("click",".overlay-close, .overlay-bg",function(){var e=this.getAttribute("data-parentid");closeOverlay(e)});