function renderAudioData(e){var t=document.getElementById("audio-json-text");if(t){var r=t.value;audioData=JSON.parse(r),audioLastSpokenSentenseTime=findAudioMaxTime(audioData);for(var o="",i=0;i<audioData.text.length;i++){o+="<p>";for(var n=0;n<audioData.text[i].length;n++)o+='<span id="span-'+i+"-"+n+'" onclick="seekAudio(this)" data-section="'+i+'" data-row="'+n+'">'+audioData.text[i][n].text+"</span>";o+="</p>"}e.innerHTML=o,handleInlineVideos(e);try{webkit.messageHandlers.audioData.postMessage(audioData)}catch(e){}}}function handleInlineVideos(e){for(var t=e.querySelectorAll(".inlinevideo"),r=0;r<t.length;r++){var o=t[r],i=o.offsetWidth||window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=parseInt(9*i/16,10),a=o.id||"",s=o.getAttribute("vid")||"",u=o.getAttribute("title")||"",d="";""!==a?d="https://p.bokecc.com/playhtml.bo?vid="+a+"&siteid=922662811F1A49E9&autoStart=false&playerid=3571A3BF2AEC8829&playertype=1":""!==s&&(d="/video/"+s+"?i=2&w="+i+"&h="+n+"&autostart=false"),""!==d&&'<div class="o-responsive-video-wrapper-outer"><div class="o-responsive-video-wrapper-inner"><iframe src="'+d+'" frameborder="0" style="width:100%;height:100%;" allowfullscreen="true"></iframe></div></div>';var l="";""!==u&&(l=""!==s?'<a class="o-responsive-video-caption" href="/video/'+s+'" target="_blank">'+u+"</a>":'<div class="o-responsive-video-caption">'+u+"</div>"),o.className="o-responsive-video-container",o.innerHTML='<div class="o-responsive-video-wrapper-outer"><div class="o-responsive-video-wrapper-inner"><iframe src="https://p.bokecc.com/playhtml.bo?vid='+a+'&siteid=922662811F1A49E9&autoStart=false&playerid=3571A3BF2AEC8829&playertype=1" frameborder="0" style="width:100%;height:100%;" allowfullscreen="true"></iframe></div></div>'+l}}function showHightlight(e,t){var r=document.getElementById("story-body-container").querySelectorAll("span"),o=document.getElementById("span-"+e+"-"+t),i=function(e){var t=0;if(e&&e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return t}}(o),n=o.offsetHeight,a=window.innerHeight,s=window.scrollY,u=i-5,d=document.querySelector("header"),l=0;d&&(u-=101),document.documentElement.className.indexOf("is-ftc-app")>=0&&currentAudio&&(l=44);for(var c=0;c<r.length;c++){var f=r[c].getAttribute("data-section");f=parseInt(f,10);var p=r[c].getAttribute("data-row");p=parseInt(p,10);var m,g=r[c].className;m=f===e&&p===t?g.indexOf(" is-current")>=0?g:g+" is-current":g.replace(" is-current",""),m!==g&&(r[c].className=m)}(s>u||s+a<i+n+l)&&("undefined"!=typeof webkit?webkit.messageHandlers.scrollTo.postMessage(u):window.scrollTo({behavior:"smooth",top:u}))}function seekAudio(e){var t=e.getAttribute("data-section"),r=e.getAttribute("data-row");t=parseInt(t,10),r=parseInt(r,10),showHightlight(t,r);var o=audioData.text[t][r].start;if(null!==o&&o>0)if("undefined"!=typeof webkit)webkit.messageHandlers.seekAudio.postMessage(o);else{var i=document.getElementById("current-audio");i.currentTime=o,i.paused===!0&&i.play()}}function updateAudioTime(e){if(audioCurrentTime=e.currentTime,currentTimeEle){var t=e.duration;if(audioCurrentTime>0&&audioCurrentTime<t){if(progressBarEle){var r=audioCurrentTime/t,o=progressBarWidth*r-scrubEle.offsetWidth/2;progressBarEle.style[transformStyle]="scaleX("+r+")",isProgressTouched===!1&&(scrubEle.style.left=o+"px")}currentTimeEle.innerHTML=getMinuteSecond(audioCurrentTime),totalTimeEle.innerHTML=getMinuteSecond(t)}}audioHasRendered===!0&&updateAudioTimeForRenderedText(audioCurrentTime,audioData)}function audioEnded(){for(var e=document.getElementById("story-body-container").querySelectorAll("span.is-current"),t=0;t<e.length;t++)e[t].className=""}function updateAudioTimeForRenderedText(e,t){for(var r=0;r<t.text.length;r++)for(var o=0;o<t.text[r].length;o++){var i=t.text[r][o].start;if(i){var n=i>=e,a=i===audioLastSpokenSentenseTime&&i<e;if(n||a){var s=lastIndex.k,u=lastIndex.l,d=(r!==latestIndex.k||o!==latestIndex.l)&&n,l=a&&lastIndex.isLastSentenseHighlighting===!1;return void((d||l)&&(l?showHightlight(r,o):showHightlight(s,u),latestIndex={k:r,l:o}))}lastIndex={k:r,l:o,isLastSentenseHighlighting:a}}}}function findAudioMaxTime(e){for(var t,r=0;r<e.text.length;r++)for(var o=0;o<e.text[r].length;o++){var i=e.text[r][o].start;i&&(t=i)}return t}function getMinuteSecond(e){if(e>0){var t=Math.floor(e),r=t%60;r<10&&(r="0"+r);var o=Math.floor(t/60);return o<10&&(o="0"+o),o+":"+r}return"00:00"}function GetVendorPrefix(e){for(var t=document.createElement("div"),r="",o=0;o<e.length;o++){if(void 0!==t.style[e[o]]){r=e[o];break}r=null}return r}function updateTotalTime(){var e=currentAudio.duration;totalTimeEle&&(totalTimeEle.innerHTML=getMinuteSecond(e))}function playerToggle(e,t){e.setAttribute("disabled",!0),"play"===t?(currentAudio.play(),pauseButton.removeAttribute("disabled")):(currentAudio.pause(),playButton.removeAttribute("disabled"))}function findLeft(e){var t=0;if(e&&e.offsetParent){do{t+=e.offsetLeft}while(e=e.offsetParent);return t}}function progessBarClick(e){var t=e.clientX-findLeft(e.target),r=e.target.offsetWidth;if(t>0&&r>t&&currentAudio&&currentAudio.duration>0){var o=t/r,i=currentAudio.duration*o;currentAudio.currentTime=i,currentAudio.play();var n=t-scrubEle.offsetWidth/2;progressBarEle.style[transformStyle]="scaleX("+o+")",scrubEle.style.left=n+"px",playButton.setAttribute("disabled",!0),pauseButton.removeAttribute("disabled")}}function progressTouchStart(e){isProgressTouched=!0,scrubEle.style[transformStyle]="scaleX(1)",progressTouchMove(e),e.preventDefault()}function progressTouchMove(e){if(isProgressTouched!==!1){var t=e.changedTouches[0].clientX-findLeft(e.target),r=e.target.offsetWidth;if(t>0&&r>t&&currentAudio&&currentAudio.duration>0){var o=t-scrubEle.offsetWidth/2;scrubEle.style.left=o+"px"}}}function progressTouchEnd(e){if(console.log("touche end fired! "),isProgressTouched!==!1){isProgressTouched=!1;var t=e.changedTouches[0].clientX-findLeft(e.target),r=e.target.offsetWidth;if((t=Math.min(Math.max(t,0),r))>=0&&r>=t&&currentAudio&&currentAudio.duration>=0){var o=t/r,i=currentAudio.duration*o,n=t-scrubEle.offsetWidth/2;scrubEle.style.left=n+"px",progressBarEle.style[transformStyle]="scaleX("+o+")",currentAudio.currentTime=i}scrubEle.style[transformStyle]="scaleX(0)",e.preventDefault()}}function progressTouchCancel(e){isProgressTouched!==!1&&(isProgressTouched=!1,scrubEle.style[transformStyle]="scaleX(0)",e.preventDefault())}function initAudioPlayer(){if(currentAudio){playButton&&(playButton.onclick=function(){playerToggle(this,"play")}),pauseButton&&(pauseButton.onclick=function(){playerToggle(this,"pause")}),currentAudio.oncanplay=function(){updateTotalTime()},currentAudio.ondurationchange=function(){updateTotalTime()},currentAudio.addEventListener("loadedmetadata",function(){updateTotalTime()},!1),currentAudio.onplay=function(){updateTotalTime(),pauseButton.removeAttribute("disabled"),playButton.setAttribute("disabled",!0)},currentAudio.onpause=function(){updateTotalTime(),playButton.removeAttribute("disabled"),pauseButton.setAttribute("disabled",!0)},progressBarContainer&&(isTouchDevice()?(progressBarContainer.addEventListener("touchstart",progressTouchStart,!1),window.addEventListener("touchmove",progressTouchMove,!1),window.addEventListener("touchend",progressTouchEnd,!1),window.addEventListener("touchcancel",progressTouchCancel,!1)):(progressBarContainer.addEventListener("click",progessBarClick,!1),progressBarContainer.addEventListener("mouseover",function(){progressBarWidth=progressBarEle.offsetWidth,scrubEle.style[transformStyle]="scaleX(1)"}),progressBarContainer.addEventListener("mouseout",function(){scrubEle.style[transformStyle]="scaleX(0)"}))),progressBarWidth=progressBarEle.offsetWidth,window.addEventListener("resize",function(){progressBarWidth=progressBarEle.offsetWidth});var e=document.querySelector(".subscription-promo-container");e&&e.classList&&e.classList.remove("show-image-in-mobile")}}var audioCurrentTime,audioData={url:"",text:[]},audioLastSpokenSentenseTime,audioHasRendered=!1,currentAudio=document.getElementById("current-audio"),playButton=document.querySelector(".control__play"),pauseButton=document.querySelector(".control__pause"),currentTimeEle=document.querySelector(".audio-time-text"),totalTimeEle=document.querySelector(".audio-time-text__total"),progressBarEle=document.querySelector(".audio-time-progress__fill"),scrubEle=document.querySelector(".audio-time-progress__scrub"),progressBarContainer=document.querySelector(".audio-time-progress"),transformStyle=GetVendorPrefix(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]),progressBarWidth,isProgressTouched=!1,lastIndex={k:0,l:0,isLastSentenseHighlighting:!1},latestIndex={k:0,l:0};initAudioPlayer();