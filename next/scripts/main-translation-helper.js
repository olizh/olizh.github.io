function GetCookie(e){var n=document.cookie.indexOf(e+"="),i=n+e.length+1,t=document.cookie.indexOf(";",i);return n||e===document.cookie.substring(0,e.length)?n===-1?null:(t===-1&&(t=document.cookie.length),decodeURIComponent(document.cookie.substring(i,t))):null}function SetCookie(e,n,i,t,o){var r=SetCookie.arguments,a=SetCookie.arguments.length,d=new Date,s=a>5&&r[5];t=a>3?r[3]:null,o=a>4?r[4]:null,null===i||""===i?i=5184e7:i*=1e3,d.setTime(d.getTime()+i),document.cookie=e+"="+escape(n)+(null===d?"":"; expires="+d.toGMTString())+(null===t?"/":"; path="+t)+(null===o?"":"; domain="+o)+(s===!0?"; secure":"")}function DeleteCookie(e){var n=new Date,i=GetCookie(e);n.setTime(n.getTime()-1),document.cookie=e+"="+i+"; expires="+n.toGMTString()}function paravalue(e,n){var i,t;return e.indexOf(n+"=")>1?(i=e.indexOf(n+"=")+n.length+1,t=e.substring(i,e.length),t=t.replace(/[\&\#].*/g,"")):t="",t}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function updateSubscriberStatus(){var e=GetCookie("paywall");return null!==e?"premium"===e?(" is-subscriber is-premium","VIP"):(" is-subscriber is-standard","Subscriber"):null}function updateClientIdLinks(){window.gClientId=GetCookie("_ga");for(var e=document.querySelectorAll(".o-client-id-link"),n=0;n<e.length;n++){var i=e[n],t=i.href;if(t&&"string"==typeof t&&t.indexOf("/")>=0){var o=t.indexOf("?")>0?"&":"?",r=i.className;i.href=t+o+"clientId="+window.gClientId,i.className=r.replace(/o-client-id-link/g,"")}}}function trackerNew(){function e(e,n){gtag("config",gaMeasurementId,e),gtag("config",gaMeasurementId2,n)}var n,i,t,o,r,a,d,s,c,l={},u={},m=window.location.href,g="",p="",f={},y=GetCookie("USER_NAME")||GetCookie("USER_NAME_FT")||"",h=GetCookie("USER_ID")||"",v=GetCookie("ccode")||"",_=0,k=updateSubscriberStatus();void 0===window.languagePreference&&(window.languagePreference=GetCookie("LanguagePreference")||0),l.linker={domains:["ftacademy.cn","ft.com","ftchinese.com"]},l.custom_map={metric1:"engagement_score",metric2:"copy_text",metric4:"read_to_half",dimension2:"user_type",dimension4:"page_type",dimension5:"ftc_team",dimension6:"author",dimension7:"phone_version",dimension8:"story_genre",dimension9:"story_area",dimension10:"story_industry",dimension11:"main_topic",dimension12:"sub_topic",dimension13:"visiting_source",dimension14:"cm_user_id",dimension15:"reader_type",dimension16:"use_block",dimension17:"prefer_language",dimension18:"screen_type"},w>0&&(_=w>1220?"XL: above 1220":w>980?"Large: 981-1220":w>690?"Medium: 691-981":w>490?"Small: 491-690":"Phone: under 491",l.screen_type=_),c=/ipad/i.test(ua)?"iPad":/OS [0-9]+\_/i.test(ua)&&/iphone|ipod/i.test(ua)?"iPhone":/android/i.test(ua)?"Android":isTouchDevice()===!0?"Other Touch Device":"Desktop",c="Page by "+c,l.contentGroup4=c,g=paravalue(m,"ccode"),m.indexOf("gift_id")>0?(i="marketing",g="GiftArticle"):m.indexOf("isappinstalled")>0&&m.indexOf("code")<0?(i="marketing",g="2G178002"):m.indexOf("#s=d")>0?(i="DailyEmail",g="1D110215"):m.indexOf("#s=n")>0?(i="DailyEmail",g="1D130201"):m.indexOf("#s=o")>0?(i="DailyEmail",g="1D130202"):m.indexOf("#s=p")>0?(i="PMEmail",g="1P110215"):m.indexOf("#s=w")>0?(i="WeeklyEmail",g="1W110215"):m.indexOf("?wt")>0?(i="Marketing",g="WeChatNewsQuiz"):"1D110215"===g?i="DailyEmail":"1P110215"===g?i="PMEmail":"1W110215"===g?i="WeeklyEmail":"1R110215"===g?i="RSS":"1Z120420"===g?i="Zacker":m.indexOf("utm_campaign")>=0?(g=paravalue(m,"utm_campaign"),i=paravalue(m,"utm_source")):""===g?(g=GetCookie("ccode")||"",i="Other"):i="Other";try{""!==g&&g!==v&&(SetCookie("ccode",g,864e4,"/",".ftchinese.com"),SetCookie("ccode",g,864e4,"/"))}catch(e){}o="marketing",r="campaign",/micromessenger/i.test(ua)?(o="WeChat",r="Social"):i.indexOf("Email")>=0?(o="EmailNewsletter",r="referral"):i.indexOf("RSS")>=0?(o="RSS",r="referral"):i.indexOf("Zacker")>=0&&(o="Zacker",r="referral");try{l.AllowAnchor=!0,""!==g&&m.indexOf("utm_campaign")<0&&(l.campaign={name:g,source:o,medium:r},m=window.location.href)}catch(e){}if("string"==typeof window.interactiveType)try{l.contentGroup1=window.interactiveType}catch(e){}t=k&&"string"==typeof k&&""!==k?k:""===y?"visitor":"member",window.androidUserInfo&&(h=window.androidUserInfo.id||h,y=window.androidUserInfo.userName||y,t=window.androidUserInfo.isMember?"premium"===window.androidUserInfo.membership.tier?"VIP":"Subscriber":"member"),gUserType=t,""!==h&&(l.user_id=h,l.cm_user_id=h,u.user_id=h),l.user_type=gUserType,l.visiting_source=i;try{n=window.gKeyTag,n=n.replace(/白底|靠右|单页|插图|透明|高清|置顶|沉底|资料|突发/g,"").replace(/,+/g,",")}catch(e){}p="",s="",m.indexOf("story")>=0?p="Story":m.indexOf("interactive")>=0?(p="Interactive",s="product"):m.indexOf("photo")>=0?(p="Photo",s="product"):m.indexOf("video")>=0?(p="Video",s="video"):p=m.indexOf("search")>=0?"Search":m.indexOf("channel")>=0?"Channel":m.indexOf("comment")>=0?"coment":m.indexOf("column")>=0?"Column":m.indexOf("tag")>=0?"Tag":m.indexOf("topic")>=0?"Topic":"/"===m||"/?refresh="===m||m.indexOf("index.php")>=0?"Home":"Other",l.page_type=p,void 0===window.ftcteam||null===window.ftcteam||""===window.ftcteam?""!==s&&(l.ftc_team=s):l.ftc_team=window.ftcteam,void 0!==window.gauthor&&null!==window.gauthor&&""!==window.gauthor&&(l.author=window.gauthor),void 0!==window.storyGenre&&null!==window.storyGenre&&""!==window.storyGenre&&(l.story_genre=window.storyGenre),void 0!==window.storyArea&&null!==window.storyArea&&""!==window.storyArea&&(l.story_area=window.storyArea),void 0!==window.storyIndustry&&null!==window.storyIndustry&&""!==window.storyIndustry&&(l.story_industry=window.storyIndustry),void 0!==window.mainTopic&&null!==window.mainTopic&&""!==window.mainTopic&&(l.main_topic=window.mainTopic),void 0!==window.subTopic&&null!==window.subTopic&&""!==window.subTopic&&(l.sub_topic=window.subTopic),updateClientIdLinks(),f={UserType:t},gtag("set","user_properties",f),"yes"===window.isBlocked||"yes"===window.bBlocked?l.use_block="yes":"no"===window.isBlocked&&(l.use_block="no"),void 0!==window.bpage&&0!==window.bpage&&null!==window.bpage?(a=m,a=void 0!==window.virtualPage?window.virtualPage:a.replace(/^.*\/story/g,"story"),void 0!==window.metaInfo&&(a=a+"?"+window.metaInfo),a="/barrier/"+window.bpage+"/"+a,e(l,u)):void 0!==window.virtualPage?(d=m,d=d.replace(/^.*\/(story|video|interactive)\/[0-9]+/g,"").replace(/^.*\.com[\/]*/g,"").replace(/search\/.*$/g,""),void 0!==window.metaInfo?d=/\?.*\#/i.test(d)?d.replace(/#/g,"&"+window.metaInfo+"#"):d.indexOf("?")>=0?d+"&"+window.metaInfo:d.indexOf("#")>=0?d.replace(/#/g,"?"+window.metaInfo+"#"):d+"?"+window.metaInfo:/\?/i.test(d)&&(d=d.replace(/\?/g,"&")),void 0===window.gAutoStart&&(l.page_path=window.virtualPage+d,e(l,u))):void 0===window.gAutoStart&&e(l,u)}function isTouchDevice(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function showOverlay(e){document.getElementById(e).className="overlay-container on"}function closeOverlay(e){void 0!==e?document.getElementById(e).className="overlay-container":(document.getElementById("pop-ad").style.display="none",document.getElementById("pop-ad").innerHTML="")}function showWarningMessage(e){var n="red"===e?"membership-red-card-prompt":"membership-yellow-card-prompt",i=document.getElementById(n);if(i){i.className=i.className.replace(/ hide/g,"");var t=i.querySelector(".email-link");t&&(t.href="mailto: subscriber.service@ftchinese.com?subject=Appeal For "+window.userId),gtag("event","Show",{event_label:window.userId,event_category:"Subscription Warning: "+e,non_interaction:!0})}}function checkUserWarnings(){if(""!==window.userId){var e=window.gYellowCardUserIds||"",n=window.gRedCardUserIds||"";window.cardType="clear",n.indexOf(window.userId)>=0?(showWarningMessage("red"),window.cardType="red",DeleteCookie("paywall"),DeleteCookie("paywall_expire")):e.indexOf(window.userId)>=0&&(window.cardType="yellow",showWarningMessage("yellow"));try{var i={userId:window.userId,cardType:window.cardType};webkit.messageHandlers.card.postMessage(i)}catch(e){}}}function parseUrlSearch(){var e=location.search;if(e){e=e.substring(1),e=decodeURIComponent(e);return e.split("&")}}function getUrlParams(e){var n="",i=parseUrlSearch();if(i&&i.length>0){for(var t=[],o=0,r=i.length;o<r;o++)i[o].indexOf(e)>-1&&(t=i[o].split("="),t.length>1&&(n=t[1]));return n}return n}function convertTextToArray(e){return e.replace(/[\r\n]+/g,splitter).split(splitter)}function addTranslation(e){if(!(e.className.indexOf(" selected")>=0)){var n=e.innerText;e.className+=" selected",e.title="";var i=document.getElementById("final-translation"),t=""===i.value?"":"\n\n";i.value+=t+n}}function start(){for(var e=document.getElementById("english-text"),n=convertTextToArray(e.value),i=document.querySelectorAll(".chinese-translation"),t=[],o=0;o<i.length;o++){var r=i[o].value;t.push(convertTextToArray(r))}for(var a="",d=0;d<n.length;d++){a+="<p>"+n[d]+"</p>";for(var s=0;s<t.length;s++){var c=t[s];c[d]&&(a+='<p onclick="addTranslation(this)" class="chinese-translation" title="click to add this translation to the right">'+c[d]+"</p>")}a+="<hr>"}document.getElementById("story-body-container").innerHTML=a,e.style.display="none",document.getElementById("start-button").style.display="none",document.getElementById("translations").style.display="none",document.querySelector(".sidebar").style.display="grid"}function finish(){if(console.log("paste the chinese text back! "),window.opener){var e=document.getElementById("final-translation").value;window.opener.document.getElementById("cbody").value=e,window.opener.document.getElementById("tag").value+=",translation_confirmed",window.close()}}var w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,ua=navigator.userAgent||navigator.vendor||"",gUserType="visitor",gaMeasurementId="UA-1608715-1",gaMeasurementId2="G-PDY0XG13PH",username=GetCookie("USER_NAME")||GetCookie("USER_NAME_FT")||"",userId=GetCookie("USER_ID")||"",ccodeCookie=GetCookie("ccode")||"",user_name=GetCookie("USER_NAME")||GetCookie("USER_NAME_FT");null!==user_name&&(document.documentElement.className+=" is-member"),window.ccodeValue=getUrlParams("ccode")||getUrlParams("utm_campaign")||GetCookie("ccode");var splitter="-|-";if(window.opener){var englishText=window.opener.document.getElementById("ebody").value;document.getElementById("english-text").value=englishText;var translationText=window.opener.document.getElementById("cbody").value;translations=translationText.split(splitter);for(var translationsHTML="",k=0;k<translations.length;k++)translationsHTML+='<textarea class="commentTextArea chinese-translation" width="100%" rows="3">'+translations[k]+"</textarea>";document.getElementById("translations").innerHTML=translationsHTML,start()}