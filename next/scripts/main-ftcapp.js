"use strict";function Delegate(e){this.listenerMap=[{},{}],e&&this.root(e),this.handle=Delegate.prototype.handle.bind(this)}function matchesTag(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function matchesRoot(e,t){return this.rootElement===window?t===document:this.rootElement===t}function matchesId(e,t){return e===t.id}function findTop(e){var t=0;if(e&&e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return t}}function getBodyHeight(){var e=window,t=document,i=t.documentElement,o=t.getElementsByTagName("body")[0];return e.innerHeight||i.clientHeight||o.clientHeight}function stickyAdsPrepare(){if("object"==typeof stickyAds&&stickyAds.length>0)for(var e=0;e<stickyAds.length;e++){var t=document.getElementById(stickyAds[e].BannerId).parentNode.parentNode.parentNode.parentNode,i=document.getElementById(stickyAds[e].BannerId).parentNode.parentNode.parentNode;stickyAds[e].oTop=findTop(t),stickyAds[e].currentClass=i.className}}function loadImagesLazy(){if(1!==figuresLoadStatus){for(var e=0,t=0;t<figuresLazy.length;t++)if(""!==figuresLazy[t]){if(void 0===scrollTop&&(scrollTop=window.scrollY||document.documentElement.scrollTop),scrollTop+2*bodyHeight>figuresLazy[t].imageTop){var i=document.createElement("IMG");i.src=figuresLazy[t].imageUrl,i.setAttribute("data-backupimage",figuresLazy[t].imageUrlBack),figures[t].appendChild(i),figures[t].className=figuresLazy[t].loadedClass,figuresLazy[t]="",setTimeout(function(){var e=i.complete,t=i.getAttribute("data-backupimage"),o=i.getAttribute("data-reloaded")||"";e===!1&&t&&"yes"!==o&&(i.src=t,i.setAttribute("data-reloaded","yes"))},5e3)}e++}0===e&&(figuresLoadStatus=1)}}function loadVideosLazy(){if(1!==videosLoadStatus){for(var e=0,t=0;t<videosLazy.length;t++)""!==videosLazy[t]&&(scrollTop+2*bodyHeight>videosLazy[t].videoTop&&(videos[t].innerHTML=videosLazy[t].ih,videos[t].className="",videosLazy[t]=""),e++);0===e&&(videosLoadStatus=1)}}function trackViewables(){trackQualityRead()}function loadImages(){var e,t=window.location.search,i=!1;figures=document.querySelectorAll("figure.loading"),figuresLazy=[],figuresLoadStatus=0;try{(360===w||375===w||320===w||414===w||768===w||1024===w||w>1220)&&(i=!0)}catch(e){}for(e=0;e<figures.length;e++){var o,n,a=figures[e],r=a.offsetWidth,s=a.offsetHeight,c=findTop(a),l=a.getAttribute("data-url")||"",d=a.className||"",f="cover",g=a.parentNode.className||"",m=!1,u="",h="https://www.ft.com/__origami/service/image/v2/images/raw/",y="https://thumbor.ftacademy.cn/unsafe/",p=!0;if(""===l&&(p=!1),isRetinaDevice===!0&&(r*=2,s*=2,u="is-retina"),(!t||t.indexOf("?ad=no")===-1)&&i===!1){if(0!==r%100){var v=s/r;r=100*(parseInt(r/100,10)+1),s=parseInt(r*v,10),u="is-retina"}}l.indexOf(h)>=0?(l=l.replace(h,"").replace(/\?.*$/g,""),l=decodeURIComponent(l)):l.indexOf(y)>=0&&(l=l.replace(y,"").replace(/^[0-9x]+\//g,"").replace(/^(picture)/g,"https://thumbor.ftacademy.cn/unsafe/$1")),/brand/.test(g)&&(f="contain"),n=encodeURIComponent(l),o=0===l.indexOf("https://thumbor.ftacademy.cn/unsafe/")?l.replace("https://thumbor.ftacademy.cn/unsafe/",""):l,/sponsor|logo/.test(d)?(l=y+"0x"+s+"/"+o,n=h+n+"?source=ftchinese&height="+s+"&fit="+f+"&from=next001",m=!0):r>0&&s>0&&(l=y+r+"x"+s+"/"+o,n=h+n+"?source=ftchinese&width="+r+"&height="+s+"&fit="+f+"&from=next001",m=!0),"On"===window.gNoImageWithData&&"data"===window.gConnectionType&&(m=!1),p===!1&&(m=!1),figuresLazy[e]=m===!0?{imageTop:c,imageUrl:l,imageUrlBack:n,loadedClass:u}:""}for(videos=document.querySelectorAll("figure.loading-video"),videosLazy=[],videosLoadStatus=0,hostForVideo="","localhost"!==window.location.hostname&&0!==window.location.hostname.indexOf("192.168")&&0!==window.location.hostname.indexOf("10.113")&&0!==window.location.hostname.indexOf("127.0")||(hostForVideo="http://www.ftchinese.com"),e=0;e<videos.length;e++){var b=videos[e],k=findTop(b),S=b.offsetWidth,N=b.offsetHeight,A=b.getAttribute("data-vid"),T=b.getAttribute("data-type")||b.getAttribute("data-item-type")||"video",_=b.getAttribute("data-autoplay")||"",H=b.getAttribute("data-third-party-frame-url"),I="";if("yes"===_?(_="true",I="&videowall=yes"):_="false",S>0&&N>0&&t.indexOf("?ad=no")===-1&&"http://www.ftchinese.com"!==hostForVideo){var O;O=H?H:hostForVideo+"/"+T+"/"+A+"?i=2&w="+S+"&h="+N+"&autostart="+_+I,videosLazy[e]={ih:'<iframe name="video-frame" id="video-frame" style="width:100%;height:100%;position:absolute;" src="'+O+'" scrolling="no" frameborder="0" allowfullscreen=true></iframe>',videoTop:k}}else videosLazy[e]=""}loadImagesLazy(),loadVideosLazy(),trackViewables()}function viewablesInit(){if(sections.length>0&&"string"==typeof window.gPageId&&""!==window.gPageId){var e={block:0,banner:0,mpu:0,storympu:0,footer:0,"in-story-recommend":0};window.bBlocked="unknown";for(var t=0;t<sections.length;t++){var i,o,n=findTop(sections[t]),a=sections[t].offsetHeight,r="other",s=0,c="",l="",d=!1;i=!("object"!=typeof viewables[t]||!viewables[t].viewed)&&viewables[t].viewed,sections[t].className.indexOf("bn-ph")>=0?(0===t&&"number"!=typeof n&&document.getElementById("topad")&&sections[t].previousSibling.offsetTop>0&&(n=sections[t].previousSibling.offsetTop,a=sections[t].previousSibling.offsetHeight),r="banner",s=.5,d=!0):"story_main_mpu"===sections[t].id?(r="storympu",s=.5,d=!0):sections[t].className.indexOf("mpu-container")>=0?(r="mpu",s=.5,d=!0):sections[t].className.indexOf("footer")>=0?r="footer":sections[t].className.indexOf("block")>=0?r="block":sections[t].className.indexOf("in-story-recommend")>=0&&(r="in-story-recommend"),d===!0&&null!==(o=sections[t].querySelector(".banner-iframe"))&&(c=o.getAttribute("data-adch")||"",l=o.getAttribute("data-adPosition")||""),e[r]++,"number"==typeof n?(viewables[t]={id:r+"-"+e[r],top:n,height:a,minimum:s,time:1e3,viewed:i,adch:c,adPosition:l},0===t&&(window.bBlocked="no")):(viewables[t]="",0===t&&(window.bBlocked="yes")),sections[t].setAttribute("data-id",r+"-"+e[r]),"in-story-recommend"===r&&window.gReplacedInstroyWithAd&&viewables[t]&&(viewables[t].id="instoryAd"+textIndex,gInstoryAdHasTrackInview===!1?(viewables[t].viewed=!1,gInstoryAdHasTrackInview=!0):viewables[t].viewed=!0)}}}function stickyBottomPrepare(){var e=document.querySelector(".o-nav__placeholder");void 0===e&&(e=document.body),gNavOffsetY=findTop(e),bodyHeight=getBodyHeight(gNavOffsetY),"object"==typeof recommendInner&&(gRecomendOffsetY=findTop(recommendInner));var t=document.querySelector(".story-action .action-inner");t&&(gShareOffsetHeight=t.offsetHeight);var i=document.querySelector(".story-page");i&&(gStoryContentOffsetY=findTop(i),gStoryContentOffsetHeight=i.offsetHeight),document.getElementById("audio-placeholder")&&(gAudioOffsetY=findTop(document.getElementById("audio-placeholder")));var o=document.querySelector("#story-body-container, .story-container");o&&(gStoryBodyBottomOffsetY=findTop(o)+o.offsetHeight);var n,a=document.querySelectorAll(".sticky-element").length,r=document.querySelector(".sticky-element");if(r&&(n=r.querySelector(".sticky-element-inner")),1===a&&r&&n){r.style.height="auto",n.style.height="auto",gStickyElementOffsetY=findTop(r);var s=r.offsetHeight,c=n.offsetWidth;s>0&&c>0&&(r.style.height=s+"px",n.style.height=s+"px",n.style.width=c+"px")}var l=document.getElementById("language-switch-placeholder");if(l&&(gLanguageSwitchOffsetY=findTop(l)),w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,sectionsWithSide&&sectionsWithSide.length>0)for(var d=0;d<sectionsWithSide.length;d++)sectionClassName[d]=sectionsWithSide[d].className,w<hasSideWidth?(sectionClassNameNew[d]=sectionClassName[d].replace(/ fixmain| fixside| bottommain| bottomside| sticktop/g,""),sectionClassNameNew[d]!==sectionClassName[d]&&(sectionClassName[d]=sectionClassNameNew[d],sectionsWithSide[d].className=sectionClassNameNew[d])):/fixmain|fixside|bottommain|bottomside|sticktop/.test(sectionClassName[d])||(containerTop[d]=findTop(sectionsWithSide[d]),mainHeight[d]=sectionsWithSide[d].querySelector(".content-inner").offsetHeight,sideHeight[d]=sectionsWithSide[d].querySelector(".side-inner").offsetHeight+defaultPadding,minHeight[d]=Math.min(mainHeight[d],sideHeight[d]),maxHeight[d]=Math.max(mainHeight[d],sideHeight[d]));viewablesInit()}function stickyBottomUpdate(){var e=htmlClass.replace(/( o-nav-sticky)|( tool-sticky)|( audio-sticky)|( sticky-element-on)|( tool-bottom)/g,"");if("function"==typeof requestAnimationFrame&&requestAnimationFrame(stickyBottomUpdate),gShowLanguageSwitchOnly===!1?("number"==typeof gLanguageSwitchOffsetY&&gLanguageSwitchOffsetY>gNavOffsetY?scrollTop+gNavOffsetY>=gLanguageSwitchOffsetY&&(e+=" audio-sticky"):scrollTop>=gNavOffsetY&&(e+=" o-nav-sticky"),"number"==typeof gAudioOffsetY&&gAudioOffsetY>gNavOffsetY&&scrollTop+gNavOffsetY>=gAudioOffsetY&&(e+=" audio-sticky")):e+=" audio-sticky","number"==typeof gStoryContentOffsetY&&(scrollTop>=gStoryContentOffsetHeight+gStoryContentOffsetY-gShareOffsetHeight-gShareFixTop-gBlockPadding?e+=" tool-bottom":scrollTop>=gStoryContentOffsetY-gShareFixTop&&(e+=" tool-sticky")),"number"==typeof gStickyElementOffsetY&&gStickyElementOffsetY>gNavOffsetY&&scrollTop+gNavHeight>=gStickyElementOffsetY&&(e+=" sticky-element-on"),e!==htmlClass&&(htmlClass=e,document.documentElement.className=htmlClass),sectionsWithSideLength>0&&w>hasSideWidth)for(var t=0;t<sectionsWithSideLength;t++){sectionClassNameNew[t]=sectionClassName[t].replace(/fixmain|fixside|bottommain|bottomside|sticktop/g,"");var i=0,o=0,n="";maxHeight[t]+gNavHeight+defaultPadding>=bodyHeight&&maxHeight[t]-minHeight[t]>=100&&(minHeight[t]+gNavHeight+defaultPadding<bodyHeight?(n=" sticktop",i=containerTop[t]+maxHeight[t]-minHeight[t]-scrollTop-gNavHeight-defaultPadding,o=containerTop[t]-gNavHeight-scrollTop-defaultPadding,/side-left/.test(sectionClassName[t])&&(i+=defaultPadding)):(i=containerTop[t]+maxHeight[t]-bodyHeight-scrollTop,o=containerTop[t]+minHeight[t]-bodyHeight-scrollTop,/side-left/.test(sectionClassName[t])&&(i+=defaultPadding/2)),mainHeight[t]>sideHeight[t]?i<=0?sectionClassNameNew[t]+=" bottomside":o<=0&&(sectionClassNameNew[t]+=" fixside"+n):mainHeight[t]<sideHeight[t]&&(i<30?sectionClassNameNew[t]+=" bottommain":o<0&&(sectionClassNameNew[t]+=" fixmain"+n))),sectionClassNameNew[t]=sectionClassNameNew[t].replace(/[\s]+/g," "),sectionClassNameNew[t]!==sectionClassName[t]&&(sectionClassName[t]=sectionClassNameNew[t],sectionsWithSide[t].className=sectionClassNameNew[t])}if("object"==typeof stickyAds&&stickyAds.length>0)for(var a=0;a<stickyAds.length;a++){var r=stickyAds[a].oTop-scrollTop-gNavHeight,s=r+stickyAds[a].stickyHeight,c="";c=r<=0&&s>0?" is-fix":"",c="banner-container"+c,c!==stickyAds[a].currentClass&&(stickyAds[a].currentClass=c,document.getElementById(stickyAds[a].BannerId).parentNode.parentNode.parentNode.className=c)}gRecomendInViewNoted===!1&&window.recommendLoaded===!0&&"object"==typeof window.recommendInner&&gRecomendOffsetY>0&&scrollTop+bodyHeight>gRecomendOffsetY&&(void 0===window.ftItemId&&(window.ftItemId=""),gRecomendInViewNoted=!0),"object"==typeof inreadAd&&inreadAd.h>0&&inreadAd.t>0&&inreadAd.displayed===!1&&scrollTop+bodyHeight>inreadAd.t+inreadAd.h&&showInreadAd(),loadImagesLazy(),loadVideosLazy(),trackViewables()}function requestTick(){ticking||requestAnimationFrame(stickyBottomUpdate),ticking=!0}function stickyBottom(){scrollTop=window.scrollY||document.documentElement.scrollTop,"function"==typeof requestAnimationFrame?requestTick():stickyBottomUpdate()}function setResizeClass(){htmlClass.indexOf(" resized")<0&&gShowLanguageSwitchOnly===!1&&(htmlClass+=" resized",document.documentElement.className=htmlClass)}function validHTMLCode(){if(!/print|findpassword|search|corp|marketing|event|innotree|webview=ftcapp|newad=yes/.test(window.location.href)){document.querySelectorAll&&("home"===window.gPageId?0===document.querySelectorAll(".item-container").length&&!0:"story"===window.gPageId?0===document.querySelectorAll(".story-body, .subscribe-lock-container").length&&!0:"string"==typeof window.gPageId&&0===document.querySelectorAll(".item-container").length&&!0)}}function checkLanguageSwitch(){var e,t=document.referrer||"",i=window.location.hostname||"",o=""!==t&&""!==i&&t.indexOf(i)>=0;e=!!document.querySelector(".language-switch-inner"),(o||isTouchDevice())&&e?(document.documentElement.className+=" show-language-switch-only audio-sticky",gShowLanguageSwitchOnly=!0):gShowLanguageSwitchOnly=!1}function isHidden(e){return null===e.offsetParent}function openLink(e){try{webkit.messageHandlers.link.postMessage(e)}catch(t){document.location=e}}function trackInternalPromos(){setTimeout(function(){for(var e=document.querySelectorAll(".n-internal-promo"),t=0;t<e.length;t++){var i=e[t],o=i.getAttribute("data-promo-id"),n=i.getAttribute("data-promo-name"),a=i.getAttribute("data-promo-creative"),r=i.getAttribute("data-promo-position"),s=i.getAttribute("data-event-category")||"Web Privileges";isHidden(i)===!1&&(gtag("event","view_promotion",{promotions:[{id:o,name:n,creative_name:a,creative_slot:r}]}),gtag("event","Display",{event_label:"From:"+o,event_category:s,non_interaction:!0}),i.onclick=function(){function e(){s||(openLink(r),s=!0)}var t=this.getAttribute("data-promo-id"),i=this.getAttribute("data-promo-name"),o=this.getAttribute("data-promo-creative"),n=this.getAttribute("data-promo-position"),a=this.getAttribute("data-event-category")||"Web Privileges";gtag("event","select_content",{promotions:[{id:t,name:i,creative_name:o,creative_slot:n}]});var r=this.href,s=!1,c=this.getAttribute("target");if(r&&!c)return setTimeout(e,1e3),gtag("event","Tap",{event_label:"From:"+t,event_category:a,event_callback:function(){e()}}),!1;gtag("event","Tap",{event_label:"From:"+t,event_category:a})})}},3e3)}function trackRead(e,t){if(""!==ftItemId&&window[e]!==!0){var i={action:e};if(void 0!==window.privilegeEventLabel&&"Subscriber"!==window.gUserType&&"VIP"!==window.gUserType)return;try{webkit?webkit.messageHandlers.qualityread.postMessage(i):Android&&Android.qualityread(JSON.stringify(i))}catch(e){}var o=window.privilegeEventLabel||ftItemId,n={send_page_view:!1};n[t]=1,gtag("config",gaMeasurementId,n),gtag("event",e,{event_label:o,event_category:"Quality Read"}),window[e]=!0}}function trackQualityRead(){if(void 0!==gStoryBodyBottomOffsetY){var e=gStoryBodyBottomOffsetY-bodyHeight;if(e>0){scrollTop>=e/2&&trackRead("Read To Half","read_to_half");setProgress(parseInt(100*scrollTop/e,10))}}}function setProgress(e){if(null!==window.circle&&void 0!==window.circle&&e!==window.currentPercent){var t=window.circumference-e/100*window.circumference;window.circle.style.strokeDashoffset=t,window.currentPercent=t,e>=100?(window.hasFinishedReading=!0,window.circle.style.fill="#990f3d",window.circle.style.stroke="transparent"):(window.circle.style.fill="#f2dfce",window.circle.style.stroke="#990f3d"),window.hasFinishedReading===!0&&(document.querySelector(".progress-tick-path").style.fill=e>=100?"white":"#990f3d")}}function initProgressCircle(){if(window.cutsTheMustard){if(window.circle=document.querySelector("circle"),null===window.circle||void 0===window.circle)return;var e=window.circle.r.baseVal.value;window.circumference=2*e*Math.PI,window.circle.style.strokeDasharray=window.circumference+" "+window.circumference,window.circle.style.strokeDashoffset=window.circumference,setProgress(0),window.circle.style.stroke="#990f3d",window.circle.style.fill="#f2dfce"}}function checkFollow(){if(!localStorage)return void alert("亲爱的读者，您的浏览器不支持localStorage，请您更换现代浏览器来使用关注的功能。");for(var e=localStorage.getItem(key),t=JSON.parse(e)||{},i=document.querySelectorAll("button.myft-follow"),o=0;o<i.length;o++){var n=i[o].getAttribute("data-type"),a=i[o].getAttribute("data-tag");a.indexOf("%")>=0&&(a=decodeURIComponent(a),i[o].setAttribute("data-tag",a)),"object"==typeof t[n]&&(t[n].indexOf(a)>=0?(i[o].innerHTML="已关注",i[o].className=i[o].className.replace(/ plus/g," tick")):(i[o].innerHTML="关注",i[o].className=i[o].className.replace(/ tick/g," plus")))}}Delegate.prototype.root=function(e){var t,i=this.listenerMap;if(this.rootElement){for(t in i[1])i[1].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!0);for(t in i[0])i[0].hasOwnProperty(t)&&this.rootElement.removeEventListener(t,this.handle,!1)}if(!e||!e.addEventListener)return this.rootElement&&delete this.rootElement,this;this.rootElement=e;for(t in i[1])i[1].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!0);for(t in i[0])i[0].hasOwnProperty(t)&&this.rootElement.addEventListener(t,this.handle,!1);return this},Delegate.prototype.captureForType=function(e){return["blur","error","focus","load","resize","scroll"].indexOf(e)!==-1},Delegate.prototype.on=function(e,t,i,o){var n,a,r,s;if(!e)throw new TypeError("Invalid event type: "+e);if("function"==typeof t&&(o=i,i=t,t=null),void 0===o&&(o=this.captureForType(e)),"function"!=typeof i)throw new TypeError("Handler must be a type of Function");return n=this.rootElement,a=this.listenerMap[o?1:0],a[e]||(n&&n.addEventListener(e,this.handle,o),a[e]=[]),t?/^[a-z]+$/i.test(t)?(s=t,r=matchesTag):/^#[a-z0-9\-_]+$/i.test(t)?(s=t.slice(1),r=matchesId):(s=t,r=matches):(s=null,r=matchesRoot.bind(this)),a[e].push({selector:t,handler:i,matcher:r,matcherParam:s}),this},Delegate.prototype.off=function(e,t,i,o){var n,a,r,s,c;if("function"==typeof t&&(o=i,i=t,t=null),void 0===o)return this.off(e,t,i,!0),this.off(e,t,i,!1),this;if(r=this.listenerMap[o?1:0],!e){for(c in r)r.hasOwnProperty(c)&&this.off(c,t,i);return this}if(!(s=r[e])||!s.length)return this;for(n=s.length-1;n>=0;n--)a=s[n],t&&t!==a.selector||i&&i!==a.handler||s.splice(n,1);return s.length||(delete r[e],this.rootElement&&this.rootElement.removeEventListener(e,this.handle,o)),this},Delegate.prototype.handle=function(e){var t,i,o,n,a,r,s=e.type,c=[];if(e.ftLabsDelegateIgnore!==!0){switch(r=e.target,3===r.nodeType&&(r=r.parentNode),o=this.rootElement,e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:c=this.listenerMap[1][s];break;case 2:this.listenerMap[0]&&this.listenerMap[0][s]&&(c=c.concat(this.listenerMap[0][s])),this.listenerMap[1]&&this.listenerMap[1][s]&&(c=c.concat(this.listenerMap[1][s]));break;case 3:c=this.listenerMap[0][s]}for(i=c.length;r&&i;){for(t=0;t<i&&(n=c[t]);t++)if(n.matcher.call(r,n.matcherParam,r)&&(a=this.fire(e,r,n)),a===!1)return e.ftLabsDelegateIgnore=!0,void e.preventDefault();if(r===o)break;i=c.length,r=r.parentElement}}},Delegate.prototype.fire=function(e,t,i){return i.handler.call(t,e,t)};var matches=function(e){if(e){var t=e.prototype;return t.matches||t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector}}(Element);Delegate.prototype.destroy=function(){this.off(),this.root()};var containerTop=[],mainHeight=[],sideHeight=[],bodyHeight,gNavOffsetY=0,gNavHeight=44,gShareFixTop=80,gBlockPadding=30,gShareOffsetHeight,gStoryContentOffsetY,gStoryContentOffsetHeight,gStickyElementOffsetY,gAudioOffsetY,gLanguageSwitchOffsetY,gRecomendOffsetY,gRecomendInViewNoted=!1,gStoryBodyBottomOffsetY,gInstoryAdHasTrackInview=!1,ftItemId=window.FTStoryid||window.interactiveId||"",defaultPadding=30,hasSideWidth=690,sectionsWithSide=document.querySelectorAll(".block-container.has-side"),sections=document.querySelectorAll(".block-container, .footer-container, .bn-ph, .mpu-container, #story_main_mpu, .in-story-recommend"),delegate,htmlClass=document.documentElement.className,sectionsWithSideLength=sectionsWithSide.length,sectionClassName=[],sectionClassNameNew=[],minHeight=[],maxHeight=[],isRetinaDevice=window.devicePixelRatio>1,scrollTop=window.scrollY||document.documentElement.scrollTop,ticking=!1,hostForVideo="",currentFavButton,figures=document.querySelectorAll("figure.loading"),figuresLazy=[],figuresLoadStatus=0,videos=document.querySelectorAll("figure.loading-video"),videosLazy=[],videosLoadStatus=0,viewables=[],gShowLanguageSwitchOnly;try{delegate=new Delegate(document.body)}catch(e){}try{validHTMLCode()}catch(e){}0===(gNavOffsetY=findTop(document.querySelector(".o-nav__placeholder")))&&(gNavOffsetY=findTop(document.querySelector(".site-map")));var addEvent=window.attachEvent||window.addEventListener,eventResize=window.attachEvent?"onresize":"resize",eventScroll=window.attachEvent?"onscroll":"scroll";if(checkLanguageSwitch(),gNavOffsetY>30&&w>490||document.getElementById("audio-placeholder"))try{stickyBottomPrepare(),stickyAdsPrepare(),addEvent(eventScroll,function(){stickyBottom(),trackViewables()}),addEvent(eventResize,function(){stickyBottomPrepare(),stickyAdsPrepare(),setResizeClass(),loadImages()}),setInterval(function(){stickyBottomPrepare(),stickyAdsPrepare()},1e4)}catch(e){}else stickyBottomPrepare(),bodyHeight=getBodyHeight(),addEvent(eventResize,function(){bodyHeight=getBodyHeight(),loadImages(),setResizeClass()}),addEvent(eventScroll,function(){scrollTop=window.scrollY||document.documentElement.scrollTop,loadImagesLazy(),loadVideosLazy(),trackViewables()});"undefined"==typeof SVGRect&&(document.documentElement.className+=" no-svg"),loadImages(),viewablesInit();try{delegate.on("error","img",function(){if(""!==this.getAttribute("src")){var e=this.getAttribute("data-backupimage")||"";""!==e?(this.setAttribute("data-backupimage",""),this.src=e):(this.setAttribute("data-hide-image-reason","failed to load"),this.style.display="none")}})}catch(e){}try{delegate.on("click",".video-package .XL2 a.image",function(){var e=hostForVideo+this.getAttribute("href"),t=this.parentNode.parentNode.parentNode,i=t.querySelector("#video-package-play"),o=i.offsetWidth,n=i.offsetHeight,a=this.parentNode.parentNode,r=a.querySelector(".item-headline a").innerHTML,s=this.parentNode.parentNode.parentNode.querySelectorAll(".video-package .XL2");e=e.replace(/#.*$/g,"");for(var c=0;c<s.length;c++){var l=s[c].className;l.indexOf(" on")>=0&&(l=l.replace(" on",""),s[c].className=l)}return this.parentNode.parentNode.className+=" on",i.querySelector("iframe").src=e+"?i=2&k=1&w="+o+"&h="+n+"&autostart=true",t.querySelector(".video-package-title a").innerHTML=r,t.querySelector(".video-package-title a").href=e,!1}),delegate.on("click","a, .track-click",function(){var e=this.getAttribute("data-ec")||"",t=this.getAttribute("data-ea")||"",i=this.getAttribute("data-el")||"";if(""!==e&&""!==t&&(this.className.indexOf("track-click")>=0&&gtag("event",t,{event_label:i,event_category:e}),"uluAd"===i)){var o=new Image,n=0,a="Success",r="Fail",s=function(){n>0&&(a="Success"+n,r="Fail"+n),o.onload=function(){},o.onerror=function(){++n<=5&&s()},o.src="http://e.cn.miaozhen.com/r/k=2049651&p=76w3I&dx=__IPDX__&rt=2&ns=__IP__&ni=__IESID__&v=__LOC__&xa=__ADPLATFORM__&tr=__REQUESTID__&mo=__OS__&m0=__OPENUDID__&m0a=__DUID__&m1=__ANDROIDID1__&m1a=__ANDROIDID__&m2=__IMEI__&m4=__AAID__&m5=__IDFA__&m6=__MAC1__&m6a=__MAC__&o="};s()}}),delegate.on("click",".overlay",function(e){"cell"===e.target.className&&closeOverlay()})}catch(e){}delegate.on("click",".overlay-close, .overlay-bg",function(){var e=this.getAttribute("data-parentid");closeOverlay(e)}),delegate.on("click",".current-edition span",function(){var e=this.parentNode.parentNode.className;e.indexOf(" on")>0?e=e.replace(/ on/g,""):e+=" on",this.parentNode.parentNode.className=e}),delegate.on("click",".icon-save button",function(){if(""===username||null===username)return void alert("您必须登录后能才能收藏文章!");var e,t=this.id.replace(/addfavlink/g,"");if("收藏"===this.innerHTML)e="add";else{if("删除"!==this.innerHTML)return;e="remove"}currentFavButton=document.getElementById("addfavlink"+t)||document.getElementById("addfavlink"),currentFavButton.innerHTML="add"===e?"保存...":"删除...";var i=new XMLHttpRequest;i.open("POST","/users/"+e+"favstory/"+t),i.setRequestHeader("Content-Type","application/text"),i.onload=function(){if(200===i.status){var t=i.responseText;"ok"!==t&&""!==t||(currentFavButton.innerHTML="add"===e?"删除":"收藏")}else i.status},i.send(JSON.stringify({storyid:t}))}),delegate.on("click",".close-img",function(){var e=document.querySelector(".warn-content");e&&(e.style.display="none",SetCookie("DSW","1","","/",null))}),trackInternalPromos();var deleteWarn=GetCookie("DSW")||"",warnContent=document.querySelector(".warn-content");warnContent&&(warnContent.style.display=deleteWarn?"none":"block");try{if("VIP"===window.gUserType||"Subscriber"===window.gUserType)for(var fullScreenContainers=document.querySelectorAll(".o-ads.fullscreen-pc, .o-ads.fullscreen-ad"),i=0;i<fullScreenContainers.length;i++)fullScreenContainers[i].setAttribute("data-o-ads-formats-small","false"),fullScreenContainers[i].setAttribute("data-o-ads-formats-medium","false"),fullScreenContainers[i].setAttribute("data-o-ads-formats-large","false"),fullScreenContainers[i].setAttribute("data-o-ads-formats-extra","false"),fullScreenContainers[i].setAttribute("data-o-ads-formats-default","false")}catch(e){}if(isTouchDevice()&&window.location.href.indexOf("ftcapp")<0)for(var itemLeads=document.querySelectorAll(".item-lead"),i=0;i<itemLeads.length;i++){var itemContainer=itemLeads[i].parentNode;if(itemContainer){var itemHeadline=itemContainer.querySelector(".item-headline-link");if(itemHeadline){var link=itemHeadline.href;link&&""!==link&&(itemLeads[i].innerHTML='<a href="'+link+'">'+itemLeads[i].innerHTML+"</div>")}}}void 0===window.privilegeEventLabel||"Subscriber"!==window.gUserType&&"VIP"!==window.gUserType||(window.privilegeEventCategory=window.privilegeEventCategory||"Web Privileges",gtag("event","Read",{event_label:window.privilegeEventLabel,event_category:window.privilegeEventCategory,non_interaction:!0})),initProgressCircle(),function(){try{for(var e=document.querySelectorAll("[data-time]"),t=0;t<e.length;t++){var i=e[t],o=parseInt(i.getAttribute("data-time"),10),n=new Date,a=n.getTime()/1e3,r=a-o,s=i.innerHTML,c=s;if(r<0)return;var l=new Date(1e3*o),d=l.getFullYear(),f=l.getMonth()+1,g=l.getDate(),m=("00"+l.getHours()).slice(-"00".length),u=("00"+l.getMinutes()).slice(-"00".length);if("story-time"===i.className){c=(0===s.indexOf("更新于")?"更新于":"发布于")+d+"年"+f+"月"+g+"日 "+m+":"+u}else if(r<3600){var h=Math.floor(r/60);c=h+"分钟前"}else if(r<86400){var y=Math.floor(r/3600);c=y+"小时前"}else if(r<604800){var p=Math.floor(r/86400);c=p+"天前"}else c=d+"年"+f+"月"+g+"日";c!==s&&(i.innerHTML=c)}}catch(e){}}();try{var key="my-ft-follow";delegate.on("click",".myft-follow",function(){var e=!(this.className.indexOf(" plus")>0);if(!localStorage)return void alert("亲爱的读者，您的浏览器不支持localStorage，请您更换现代浏览器来使用关注的功能。");var t=localStorage.getItem(key),i=JSON.parse(t)||{},o=this.getAttribute("data-tag")||"",n=this.getAttribute("data-type")||"tag";if(""===o)return void alert("亲爱的读者，我们无法识别您关注的标签，请您刷新页面重新试试。");if("object"!=typeof i[n]&&(i[n]=[]),e===!1)i[n].indexOf(o)<0&&i[n].push(o);else{for(var a=[],r=0;r<i[n].length;r++)i[n][r]!==o&&a.push(i[n][r]);i[n]=a}var s=JSON.stringify(i);localStorage.setItem(key,s),checkFollow()})}catch(e){}checkFollow();