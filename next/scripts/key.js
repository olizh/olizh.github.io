function GetCookie(e){var n=document.cookie.indexOf(e+"="),i=n+e.length+1,t=document.cookie.indexOf(";",i);return n||e===document.cookie.substring(0,e.length)?n===-1?null:(t===-1&&(t=document.cookie.length),decodeURIComponent(document.cookie.substring(i,t))):null}function SetCookie(e,n,i,t,o){var a=SetCookie.arguments,r=SetCookie.arguments.length,d=new Date,s=r>5&&a[5];t=r>3?a[3]:null,o=r>4?a[4]:null,null===i||""===i?i=5184e7:i*=1e3,d.setTime(d.getTime()+i),document.cookie=e+"="+escape(n)+(null===d?"":"; expires="+d.toGMTString())+(null===t?"/":"; path="+t)+(null===o?"":"; domain="+o)+(s===!0?"; secure":"")}function DeleteCookie(e){var n=new Date,i=GetCookie(e);n.setTime(n.getTime()-1),document.cookie=e+"="+i+"; expires="+n.toGMTString()}function paravalue(e,n){var i,t;return e.indexOf(n+"=")>1?(i=e.indexOf(n+"=")+n.length+1,t=e.substring(i,e.length),t=t.replace(/[\&\#].*/g,"")):t="",t}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function updateSubscriberStatus(){var e=GetCookie("paywall");return null!==e?"premium"===e?(" is-subscriber is-premium","VIP"):(" is-subscriber is-standard","Subscriber"):null}function updateClientIdLinks(){window.gClientId=GetCookie("_ga");for(var e=document.querySelectorAll(".o-client-id-link"),n=0;n<e.length;n++){var i=e[n],t=i.href;if(t&&"string"==typeof t&&t.indexOf("/")>=0){var o=t.indexOf("?")>0?"&":"?",a=i.className;i.href=t+o+"clientId="+window.gClientId,i.className=a.replace(/o-client-id-link/g,"")}}}function trackerNew(){function e(e,n){gtag("config",gaMeasurementId,e),gtag("config",gaMeasurementId2,n)}var n,i,t,o,a,r,d,s,c,l={},u={},p=window.location.href,m="",g="",f={},h=GetCookie("USER_NAME")||GetCookie("USER_NAME_FT")||"",v=GetCookie("USER_ID")||"",y=GetCookie("ccode")||"",T=0,b=updateSubscriberStatus();void 0===window.languagePreference&&(window.languagePreference=GetCookie("LanguagePreference")||0),l.linker={domains:["ftacademy.cn","ft.com","ftchinese.com"]},l.custom_map={metric1:"engagement_score",metric2:"copy_text",metric4:"read_to_half",dimension2:"user_type",dimension4:"page_type",dimension5:"ftc_team",dimension6:"author",dimension7:"phone_version",dimension8:"story_genre",dimension9:"story_area",dimension10:"story_industry",dimension11:"main_topic",dimension12:"sub_topic",dimension13:"visiting_source",dimension14:"cm_user_id",dimension15:"reader_type",dimension16:"use_block",dimension17:"prefer_language",dimension18:"screen_type"},w>0&&(T=w>1220?"XL: above 1220":w>980?"Large: 981-1220":w>690?"Medium: 691-981":w>490?"Small: 491-690":"Phone: under 491",l.screen_type=T),c=/ipad/i.test(ua)?"iPad":/OS [0-9]+\_/i.test(ua)&&/iphone|ipod/i.test(ua)?"iPhone":/android/i.test(ua)?"Android":isTouchDevice()===!0?"Other Touch Device":"Desktop",c="Page by "+c,l.contentGroup4=c,m=paravalue(p,"ccode"),p.indexOf("gift_id")>0?(i="marketing",m="GiftArticle"):p.indexOf("isappinstalled")>0&&p.indexOf("code")<0?(i="marketing",m="2G178002"):p.indexOf("#s=d")>0?(i="DailyEmail",m="1D110215"):p.indexOf("#s=n")>0?(i="DailyEmail",m="1D130201"):p.indexOf("#s=o")>0?(i="DailyEmail",m="1D130202"):p.indexOf("#s=p")>0?(i="PMEmail",m="1P110215"):p.indexOf("#s=w")>0?(i="WeeklyEmail",m="1W110215"):p.indexOf("?wt")>0?(i="Marketing",m="WeChatNewsQuiz"):"1D110215"===m?i="DailyEmail":"1P110215"===m?i="PMEmail":"1W110215"===m?i="WeeklyEmail":"1R110215"===m?i="RSS":"1Z120420"===m?i="Zacker":p.indexOf("utm_campaign")>=0?(m=paravalue(p,"utm_campaign"),i=paravalue(p,"utm_source")):""===m?(m=GetCookie("ccode")||"",i="Other"):i="Other";try{""!==m&&m!==y&&(SetCookie("ccode",m,864e4,"/",".ftchinese.com"),SetCookie("ccode",m,864e4,"/"))}catch(e){}o="marketing",a="campaign",/micromessenger/i.test(ua)?(o="WeChat",a="Social"):i.indexOf("Email")>=0?(o="EmailNewsletter",a="referral"):i.indexOf("RSS")>=0?(o="RSS",a="referral"):i.indexOf("Zacker")>=0&&(o="Zacker",a="referral");try{l.AllowAnchor=!0,""!==m&&p.indexOf("utm_campaign")<0&&(l.campaign={name:m,source:o,medium:a},p=window.location.href)}catch(e){}if("string"==typeof window.interactiveType)try{l.contentGroup1=window.interactiveType}catch(e){}t=b&&"string"==typeof b&&""!==b?b:""===h?"visitor":"member",window.androidUserInfo&&(v=window.androidUserInfo.id||v,h=window.androidUserInfo.userName||h,t=window.androidUserInfo.isMember?"premium"===window.androidUserInfo.membership.tier?"VIP":"Subscriber":"member"),gUserType=t,""!==v&&(l.user_id=v,l.cm_user_id=v,u.user_id=v),l.user_type=gUserType,l.visiting_source=i;try{n=window.gKeyTag,n=n.replace(/白底|靠右|单页|插图|透明|高清|置顶|沉底|资料|突发/g,"").replace(/,+/g,",")}catch(e){}g="",s="",p.indexOf("story")>=0?g="Story":p.indexOf("interactive")>=0?(g="Interactive",s="product"):p.indexOf("photo")>=0?(g="Photo",s="product"):p.indexOf("video")>=0?(g="Video",s="video"):g=p.indexOf("search")>=0?"Search":p.indexOf("channel")>=0?"Channel":p.indexOf("comment")>=0?"coment":p.indexOf("column")>=0?"Column":p.indexOf("tag")>=0?"Tag":p.indexOf("topic")>=0?"Topic":"/"===p||"/?refresh="===p||p.indexOf("index.php")>=0?"Home":"Other",l.page_type=g,void 0===window.ftcteam||null===window.ftcteam||""===window.ftcteam?""!==s&&(l.ftc_team=s):l.ftc_team=window.ftcteam,void 0!==window.gauthor&&null!==window.gauthor&&""!==window.gauthor&&(l.author=window.gauthor),void 0!==window.storyGenre&&null!==window.storyGenre&&""!==window.storyGenre&&(l.story_genre=window.storyGenre),void 0!==window.storyArea&&null!==window.storyArea&&""!==window.storyArea&&(l.story_area=window.storyArea),void 0!==window.storyIndustry&&null!==window.storyIndustry&&""!==window.storyIndustry&&(l.story_industry=window.storyIndustry),void 0!==window.mainTopic&&null!==window.mainTopic&&""!==window.mainTopic&&(l.main_topic=window.mainTopic),void 0!==window.subTopic&&null!==window.subTopic&&""!==window.subTopic&&(l.sub_topic=window.subTopic),updateClientIdLinks(),f={UserType:t},gtag("set","user_properties",f),"yes"===window.isBlocked||"yes"===window.bBlocked?l.use_block="yes":"no"===window.isBlocked&&(l.use_block="no"),void 0!==window.bpage&&0!==window.bpage&&null!==window.bpage?(r=p,r=void 0!==window.virtualPage?window.virtualPage:r.replace(/^.*\/story/g,"story"),void 0!==window.metaInfo&&(r=r+"?"+window.metaInfo),r="/barrier/"+window.bpage+"/"+r,e(l,u)):void 0!==window.virtualPage?(d=p,d=d.replace(/^.*\/(story|video|interactive)\/[0-9]+/g,"").replace(/^.*\.com[\/]*/g,"").replace(/search\/.*$/g,""),void 0!==window.metaInfo?d=/\?.*\#/i.test(d)?d.replace(/#/g,"&"+window.metaInfo+"#"):d.indexOf("?")>=0?d+"&"+window.metaInfo:d.indexOf("#")>=0?d.replace(/#/g,"?"+window.metaInfo+"#"):d+"?"+window.metaInfo:/\?/i.test(d)&&(d=d.replace(/\?/g,"&")),void 0===window.gAutoStart&&(l.page_path=window.virtualPage+d,e(l,u))):void 0===window.gAutoStart&&e(l,u)}function isTouchDevice(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function showOverlay(e){document.getElementById(e).className="overlay-container on"}function closeOverlay(e){void 0!==e?document.getElementById(e).className="overlay-container":(document.getElementById("pop-ad").style.display="none",document.getElementById("pop-ad").innerHTML="")}function showWarningMessage(e){var n="red"===e?"membership-red-card-prompt":"membership-yellow-card-prompt",i=document.getElementById(n);if(i){i.className=i.className.replace(/ hide/g,"");var t=i.querySelector(".email-link");t&&(t.href="mailto: subscriber.service@ftchinese.com?subject=Appeal For "+window.userId),gtag("event","Show",{event_label:window.userId,event_category:"Subscription Warning: "+e,non_interaction:!0})}}function checkUserWarnings(){if(""!==window.userId){var e=window.gYellowCardUserIds||"",n=window.gRedCardUserIds||"";window.cardType="clear",n.indexOf(window.userId)>=0?(showWarningMessage("red"),window.cardType="red",DeleteCookie("paywall"),DeleteCookie("paywall_expire")):e.indexOf(window.userId)>=0&&(window.cardType="yellow",showWarningMessage("yellow"));try{var i={userId:window.userId,cardType:window.cardType};webkit.messageHandlers.card.postMessage(i)}catch(e){}}}function parseUrlSearch(){var e=location.search;if(e){e=e.substring(1),e=decodeURIComponent(e);return e.split("&")}}function getUrlParams(e){var n="",i=parseUrlSearch();if(i&&i.length>0){for(var t=[],o=0,a=i.length;o<a;o++)i[o].indexOf(e)>-1&&(t=i[o].split("="),t.length>1&&(n=t[1]));return n}return n}function getSearchVars(){var e={};if(window.location.search.length>1)for(var n,i=window.parent.location.search,t=0,o=i.substr(1).split("&");t<o.length;t++)n=o[t].split("="),e[decodeURIComponent(n[0])]=n.length>1?decodeURIComponent(n[1]):"";return e}function initAds(){uaString=navigator.userAgent||navigator.vendor||"",isWeChat=/micromessenger/i.test(uaString),w1=Math.max(document.documentElement.clientWidth,window.innerWidth||0),(w2=window.screen.availWidth||0)>0&&w1>w2&&(w1=w2)}function sendEvent(e,n,i,t){try{gtag("event",n,{event_label:i,event_category:e,value:t})}catch(o){eventsToSend.push({ec:e,ea:n,el:i,ei:t})}}function clearEvents(){for(var e=eventsToSend.length,n=0;n<e;n++)gtag("event",eventsToSend[n].ea,{event_label:eventsToSend[n].el,event_category:eventsToSend[n].ec,value:eventsToSend[n].ei});eventsToSend=[],window.gaLoaded=!0}function checkB(){var e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",document.body.appendChild(e),window.setTimeout(function(){0===e.offsetHeight?(isBlocked="yes",showPayWall()):isBlocked="no",e.remove()},100)}function showPayWall(){if(null===GetCookie("USER_ID"))return void displayPayWallInBody();var e=new XMLHttpRequest;e.open("GET","/index.php/jsapi/paywall"),e.setRequestHeader("Content-Type","application/json"),e.onload=function(){if(200===e.status){1===JSON.parse(e.responseText).paywall&&displayPayWallInBody()}},e.send()}function displayPayWallInBody(){var e=document.getElementById("story-body-container");if(e){var n=window.FTStoryid||"";window.gSubscriptionEventLabel="AdBlocker/story/"+n;var i="http://www.ftchinese.com/index.php/ft/subscription?el="+window.gSubscriptionEventLabel,t='<p>亲爱的读者，我们注意到您使用了广告拦截。我们完全理解您这样做的原因！</p><p>但是维持FT中文网的正常运转是需要成本的，如果您喜欢FT中文网，可以：</p><p>1. <a class="highlight o-client-id-link" href="'+i+'">成为付费会员</a>。这样您可以继续使用广告拦截，同时可以跨平台阅读或收听FT中文网的独家内容、英文原文、以及音频。</p><p>或</p><p>2. 将FT中文网加到您的广告拦截的白名单中，以继续浏览FT中文网的免费内容。</p><p>根据我们了解的信息，国产的浏览器大部分都内置了这一功能，我们建议您更换一个纯净浏览器（例如：Firefox、Chrome等）来打开我们的网页，这样您就可以正常浏览我们的免费文章。感谢您的支持。</p>',o="<div><div>"+t+'</div><div>如果已经是会员，请<a href="http://user.ftchinese.com/login" class="o-client-id-link">点击这里</a>登录</div><div><p></p></div></div></div>';e.innerHTML=o,updateClientIdLinks(),gtag("event","Display",{event_label:window.gSubscriptionEventLabel,event_category:"Web Privileges"})}}function checkLandingPage(){var e=window.location.host||"";gIsLandingPage=(document.referrer||"").indexOf(e)<0}function getDeviceCategory(){var e="PC";return(/iPad/i.test(uaString)||/OS [0-9]+\_/i.test(uaString)&&(/iPhone/i.test(uaString)||/iPod/i.test(uaString))||/Android|micromessenger/i.test(uaString)||w1<=490||"ftcapp"===searchVars.webview)&&(e="Mobile"),e}function getDeviceTpye(){var e="PC";return/iPad/i.test(uaString)?(e="PadWeb",searchVars.webview&&"ftcapp"===searchVars.webview&&(e="PadApp")):/OS [0-9]+\_/i.test(uaString)&&(/iPhone/i.test(uaString)||/iPod/i.test(uaString))?(e="iPhoneWeb",searchVars.webview&&"ftcapp"===searchVars.webview&&(e="iPhoneApp")):(/Android|micromessenger/i.test(uaString)||w1<=490)&&(e="AndroidWeb"),e}function getAdChannelId(){return""}function getBannerBG(){var e="";return"luxury"===window.pageTheme?e="&bg=e0cdac":"ebook"===window.pageTheme&&(e="&bg=777777"),e}function isLocal(){return"localhost"===window.location.hostname||0===window.location.hostname.indexOf("192.168")||0===window.location.hostname.indexOf("10.113")||0===window.location.hostname.indexOf("127.0")}function writeAdNew(e){return console.log("writeAdNew"),""}function adReachability(){return""}function getRandomInt(e,n){return e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e))+e}function sendImpToThirdParty(e,n,i){if("string"==typeof e){"object"!=typeof window.parent.gTrackThirdParyImpression&&(window.parent.gTrackThirdParyImpression={});var t=0,o=e,a=!1,r=function(){var e=arguments[0]||"",n=arguments[1]||"",t=arguments[2]||"",o="G"+Math.round(1e12*Math.random());try{window.parent.gtag("event",n,{event_label:t,event_category:e,non_interaction:!0})}catch(r){var a=new Image;a.src="http://www.ftchinese.com/index.php/ft/hit/"+i+"/2?ec="+e+"&ea="+n+"&el="+encodeURIComponent(t)+"&r="+o}},d=function(){var s,c="IMG"+Math.round(1e12*Math.random()),l=(new Date).getTime(),u=e;try{s=arguments[0]||""}catch(e){s=""}u.indexOf("?")<0&&(u+="?"),u=u.replace("ord=[timestamp]","ord="+l)+"&"+c+"&ftctime="+l,t>0&&(0===o.indexOf("https")?(u=u.replace("https://ad.doubleclick.net","http://ad.doubleclick.net"),u=u.replace("https://v.admaster.com.cn","http://v.admaster.com.cn")):(u=u.replace("http://ad.doubleclick.net","https://ad.doubleclick.net"),u=u.replace("http://v.admaster.com.cn","https://v.admaster.com.cn"))),o=u,window.parent.gTrackThirdParyImpression[c]=new Image,window.parent.gTrackThirdParyImpression[c].src=u,window.parent.gTrackThirdParyImpression[c].title=n+" ("+i+")",window.parent.gTrackThirdParyImpression[c].alt=e,window.parent.gTrackThirdParyImpression[c].onload=function(){var e="";e=0===t?"Success":""!==s?"Success on Retry"+s:"Success on Retry"+t,r(this.title,e,this.alt),delete window.parent.gTrackThirdParyImpression[c],a=!0},window.parent.gTrackThirdParyImpression[c].onerror=function(){var e="";if(e=0===t?"Fail":""!==s?"Fail on Retry"+s:"Fail on Retry"+t,r(this.title,e,this.alt),"string"==typeof window.uaString)try{window.parent._hmt.push(["_trackEvent",this.title,"Fail",window.uaString])}catch(e){}++t<=3&&setTimeout(d,100*t*t*t)}};d(),setTimeout(function(){if(a===!1&&0===t){t=2;d(" from Pending"),r(n+" ("+i+")","Request from Pending",e)}},1e4),r(n+" ("+i+")","Request",e)}}function postVal(e){if(GetCookie("USER_ID")||""){var n=new XMLHttpRequest;n.open("post","/engagement.php"),n.setRequestHeader("Content-Type","application/text"),n.onload=function(){},n.send(JSON.stringify(e))}}function updateDisplay(e){if(!(e in addrs)){addrs[e]=!0;for(var n=Object.keys(addrs).filter(function(e){return addrs[e]}),i=0;i<n.length;i++)n[i].length>16&&(n.splice(i,1),i--);return ipAddress=n[0],n[0]}}function grepSDP(e){e.split("\r\n").forEach(function(e,n,i){if(~e.indexOf("a=candidate")){var t=e.split(" "),o=t[4];"host"===t[7]&&updateDisplay(o)}else if(~e.indexOf("c=")){var t=e.split(" "),o=t[2];updateDisplay(o)}})}function getRTC(){var e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(e){var n=new e({iceServers:[]});n.createDataChannel("",{reliable:!1}),n.onicecandidate=function(e){e.candidate&&grepSDP("a="+e.candidate.candidate)},n.createOffer(function(e){grepSDP(e.sdp),n.setLocalDescription(e)},function(e){console.warn("offer failed",e)})}else console.log("不支持RTCPeerConnection")}function getBrowserTime(){function e(){n=(new Date).getTime()}var n="";document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){n=(new Date).getTime()}),window.onload=function(){getRTC();var e=(new Date).getTime();postVal({ipAddress:ipAddress,url:location.href,refer:document.referrer,timeIn:n,timeOut:e,userId:GetCookie("USER_ID")||null,functionName:"onload"})},window.onbeforeunload=function(){postVal({ipAddress:ipAddress,url:location.href,refer:document.referrer,timeIn:n,timeOut:(new Date).getTime(),userId:GetCookie("USER_ID")||null,functionName:"onbeforeunload"})}}var w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,ua=navigator.userAgent||navigator.vendor||"",gUserType="visitor",gaMeasurementId="UA-1608715-1",gaMeasurementId2="G-PDY0XG13PH",username=GetCookie("USER_NAME")||GetCookie("USER_NAME_FT")||"",userId=GetCookie("USER_ID")||"",ccodeCookie=GetCookie("ccode")||"",user_name=GetCookie("USER_NAME")||GetCookie("USER_NAME_FT");null!==user_name&&(document.documentElement.className+=" is-member"),window.ccodeValue=getUrlParams("ccode")||getUrlParams("utm_campaign")||GetCookie("ccode");var gIsLandingPage=!1,uaString,w1,w2,isWeChat;window.gaLoaded=!1;var eventsToSend=[],isBlocked="unknown";initAds(),isWeChat===!0&&(document.documentElement.className+=" is-wechat"),checkLandingPage();var searchVars=getSearchVars(),deviceCategory=getDeviceCategory(),deviceType=getDeviceTpye(),adChannelId=getAdChannelId(),bannerBG=getBannerBG(),isLocal=isLocal(),gCanReplaceInstoryWithAd=!1,gReplacedInstroyWithAd=!1,ipAddress="",addrs=Object.create(null);addrs["0.0.0.0"]=!1,getRTC(),getBrowserTime();