function findContainer(e){var t=e,a=0;do{t=t.parentNode,a++}while(t.className.indexOf("item-inner")<0&&t.className.indexOf("links")<0&&!/^li$/i.test(t.tagName)&&a<10);return t.className.indexOf("links")>=0?e:t}function getPercentage(e,t){var a=e;return a=1e4*a/t,a=Math.round(a)/100,a+="%"}function displayResults(e){try{var t=JSON.stringify(e.result,null,2);textnode3.style.display="block",textnode.style.backgroundColor="white",textnode.value=t}catch(e){}var a,o,n,i,r;/127.0|localhost|192.168/.test(window.location.href)?(a=e.reports[0].data.rows,o=e.reports[0].data.totals[0].values[0],n=e.reports[1].data.totals[0].values[0],r=e.reports[2].data):(a=e.result.reports[0].data.rows,o=e.result.reports[0].data.totals[0].values[0],n=e.result.reports[1].data.totals[0].values[0],r=e.result.reports[2].data),i=Math.round(1e4*o/n)/1e4,document.getElementById("show-click-rate").innerHTML=i,document.getElementById("show-click-rate").style.color="#c36256",document.getElementById("show-click-total").innerHTML=o,document.getElementById("show-click-total").style.color="#c36256",document.getElementById("show-page-view").innerHTML=n,document.getElementById("show-page-view").style.color="#c36256";for(var s=0;s<a.length;s++){var d,l,c,p,u=a[s].dimensions[0],g=a[s].metrics[0].values[0],y=document.querySelector("[data-el="+u+"]"),h="";null!==y&&g>0&&o>0&&(l=g/n,l=100*Math.sqrt(l),l+="%",d=getPercentage(g,n),y.title=g,c=findContainer(y),0===u.indexOf("Side")&&(h=" is-side-data"),p='<div style="position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;min-height:44px;overflow:visible;width:100%;cursor:pointer;" class="ga-data-show'+h+'" data-value="'+g+'" title="'+g+" Clicks ("+d+')"><div style="position:absolute;top:0;left:15px;right:15px;bottom:15px;background:rgba(0,0,0,0.95);color:white;z-index:999999999;"><div style="margin:auto;position:absolute;top:0;left:0;right:0;bottom:0;width:'+l+";height:"+l+";background:green;width:"+d+';"></div><div style="padding: 5px 0 0 10px;" >'+g+'</div><div style="position:absolute;right:10px;bottom:10px;">'+d+"</div></div></div>",c.style.position="relative",c.style.overflow="visible",c.innerHTML=p+c.innerHTML)}for(var m=document.querySelectorAll(".block-container"),v=0;v<m.length;v++){for(var x,w,f,b=m[v].querySelectorAll(".ga-data-show"),D=0,k=0,S=0,q="",E=0;E<b.length;E++){var C=b[E].getAttribute("data-value")||0;C=parseInt(C),D+=C,b[E].className.indexOf("is-side-data")>=0?S+=C:k+=C}D>0&&(w=getPercentage(D,n),S>0&&(q=" "+k+" on main ("+getPercentage(k,o)+"). "+S+" on side. ("+getPercentage(S,o)+")"),x='<div click-rate="'+w+'" title="Total Clicks on this Block: '+D+" ("+w+"). "+q+'" class="ga-data-show-block" style="position:absolute;top:0;right:30px;width:150px;height:90px;padding-left:5px;line-height:30px;text-align:left;background:#c36256;color:white;z-index:999999999;cursor:pointer;">点击率：'+w+"</div>",m[v].style.position="relative",f=document.createElement("div"),f.innerHTML=x,m[v].appendChild(f))}for(var N=r.maximums[0].values[0],A="<b>页面各板块展示率：</b><br>",I=0;I<r.rows.length;I++){var T,M,O=r.rows[I].dimensions[0].replace(/\//g,""),B=r.rows[I].metrics[0].values[0],H=Math.round(1e4*B/N)/100+"%",L=document.querySelector("[data-id="+O+"]"),R="",G=0;0===O.indexOf("block-")&&L.querySelector(".list-link")&&(O=L.querySelector(".list-link").innerHTML),A+='<div style="margin:10px 0;position:relative;width:100%;height:30px;"><div style="position:absolute;top:0;bottom:0;width: '+H+';background:#c36256;"></div><div style="position:absolute;top:0;left:0;right:0;bottom:0;padding:5px;">'+O+": "+B+", "+H+"</div></div>",L&&(L.querySelector(".ga-data-show-block")?(R=L.querySelector(".ga-data-show-block").getAttribute("click-rate").replace(/%/g,""),R=Number(R),G=L.offsetHeight,G>0?(R=1e4*R*N/(G*B),R=Math.round(R)):R="",L.querySelector(".ga-data-show-block").innerHTML="展示率："+H+"<br>"+L.querySelector(".ga-data-show-block").innerHTML+"<br>效率指数: "+R):(T='<div class="ga-data-show-block" style="position:absolute;top:0;right:30px;width:150px;height:30px;line-height:30px;padding-left:5px;background:#c36256;color:white;z-index:999999999;cursor:pointer;">展示率：'+H+"</div>",L.style.position="relative",M=document.createElement("div"),M.innerHTML=T,L.appendChild(M)))}document.getElementById("in-view-data").innerHTML=A}function queryReports(){queryJSON={reportRequests:[{viewId:VIEW_ID,dateRanges:[{startDate:startDate,endDate:endDate}],metrics:[{expression:"ga:totalEvents"}],dimensions:[{name:"ga:eventLabel"}],dimensionFilterClauses:[{operator:"AND",filters:[{dimensionName:"ga:eventAction",operator:"EXACT",expressions:["home"]},{dimensionName:"ga:eventCategory",operator:"EXACT",expressions:["Click"]}]}],orderBys:[{fieldName:"ga:eventLabel"}]},{viewId:VIEW_ID,dateRanges:[{startDate:startDate,endDate:endDate}],metrics:[{expression:"ga:pageviews"}],dimensionFilterClauses:[{operator:"AND",filters:[{dimensionName:"ga:pagePath",operator:"REGEXP",expressions:["^(/|/index.php)$"]}]}]},{viewId:VIEW_ID,dateRanges:[{startDate:startDate,endDate:endDate}],metrics:[{expression:"ga:totalEvents"}],dimensions:[{name:"ga:eventLabel"}],dimensionFilterClauses:[{operator:"AND",filters:[{dimensionName:"ga:eventAction",operator:"EXACT",expressions:["In View"]},{dimensionName:"ga:eventCategory",operator:"EXACT",expressions:["home"]}]}],orderBys:[{fieldName:"ga:totalEvents",sortOrder:"DESCENDING"}]}]},textnode2.value=JSON.stringify(queryJSON,null,2),gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",body:queryJSON}).then(displayResults,console.error.bind(console))}function queryReports2(){queryJSON=JSON.parse(textnode2.value),textnode.style.backgroundColor="grey",textnode.value="更新数据...",gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",body:queryJSON}).then(displayResults,console.error.bind(console))}function queryReportsTest(){var e=new XMLHttpRequest,t={};e.open("GET",encodeURI("/api/ga/home-clicks.json")),e.setRequestHeader("Content-Type","application/json"),e.onload=function(){if(200===e.status){displayResults(JSON.parse(e.responseText))}},e.send(JSON.stringify(t)),textnode2.value=JSON.stringify(queryJSON,null,2)}function fixDateFormat(e){return e.replace(/\//g,"-").replace(/\-([0-9])\-/g,"-0$1-").replace(/\-([0-9])$/g,"-0$1")}function queryGAData(){var e,t=document.getElementById("show-ga-data"),a=document.getElementById("ga-start-date").value||"",o=document.getElementById("ga-end-date").value||"";if(""===gGADataStatus)/^[0-9]{4}\-[0-9]{1,2}\-[0-9]{1,2}$/.test(a)&&(startDate=fixDateFormat(a)),/^[0-9]{4}\-[0-9]{1,2}\-[0-9]{1,2}$/.test(o)&&(endDate=fixDateFormat(o)),document.getElementById("ga-start-date").value=startDate,document.getElementById("ga-end-date").value=endDate,document.getElementById("ga-start-date").readOnly=!0,document.getElementById("ga-end-date").readOnly=!0,/127.0|localhost|192.168/.test(window.location.href)?queryReportsTest():function(e){var t,a=e.getElementsByTagName("script")[0];t=e.createElement("script"),t.async=!0,t.src="https://apis.google.com/js/client:platform.js",a.parentNode.insertBefore(t,a)}(window.document),t.innerHTML="隐藏点击数据",gGADataStatus="show";else if("show"===gGADataStatus){e=document.querySelectorAll(".ga-data-show, .ga-data-show-block");for(var n=0;n<e.length;n++)e[n].style.display="none";t.innerHTML="显示点击数据",gGADataStatus="hide"}else if("hide"===gGADataStatus){e=document.querySelectorAll(".ga-data-show, .ga-data-show-block");for(var i=0;i<e.length;i++)e[i].style.display="block";t.innerHTML="隐藏点击数据",gGADataStatus="show"}}var VIEW_ID="69390283",gGADataStatus="",startDate="7daysAgo",endDate="today",queryJSON={},textnode,textnode2,textnode3;if(/showHotClick=yes/.test(window.location.href)){var firstAdContainer=document.querySelector(".bn-ph"),gaContainer=document.createElement("div");gaContainer.id="ga-container",gaContainer.style.margin="0 auto 15px auto",gaContainer.style.maxWidth="1200px",firstAdContainer.parentNode.insertBefore(gaContainer,firstAdContainer),gaContainer.innerHTML='<div class="g-signin2" data-onsuccess="queryReports"></div><div>Start Date: <input id="ga-start-date" type="text" placeholder="YYYY-MM-DD"> End Date: <input id="ga-end-date" type="text" placeholder="YYYY-MM-DD"> <button id="show-ga-data" onclick="queryGAData()">显示点击数据</button> Clicks per Page：<span id="show-click-rate">...</span>  Clicks：<span id="show-click-total">...</span>  Page View：<span id="show-page-view">...</span></div><div id="in-view-data"></div>';var node=document.body;textnode=document.createElement("textarea"),textnode.id="query-output",textnode.style.width="100%",textnode.style.maxWidth="1200px",textnode.style.margin="auto",textnode.style.display="block",textnode.style.height="300px",textnode2=document.createElement("textarea"),textnode2.id="query-input",textnode2.style.width="100%",textnode2.style.height="300px",textnode2.style.maxWidth="1200px",textnode2.style.margin="auto",textnode2.style.display="block",textnode3=document.createElement("button"),textnode3.id="query-rerun",textnode3.innerHTML="查询",textnode3.style.margin="15px auto",textnode3.style.display="none",textnode3.style.width="250px",textnode3.onclick=queryReports2,node.appendChild(textnode2),node.appendChild(textnode3),node.appendChild(textnode),document.querySelectorAll(".app-download-container")[0].style.display="none",document.querySelectorAll(".app-download-container")[1].style.display="none"}